<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÇ¥ Ï∫òÎ¶∞Îçî - Lego</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --bg-gray: #f4f6f8;
            --border-color: #e5e7eb;
            --primary-blue: #2563eb;
            --text-dark: #1e293b;
            --task-blue-bg: #dbeafe; --task-blue-text: #1e40af; --task-blue-border: #3b82f6;
            --task-green-bg: #dcfce7; --task-green-text: #166534; --task-green-border: #22c55e;
            --task-yellow-bg: #fef9c3; --task-yellow-text: #854d0e; --task-yellow-border: #eab308;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-gray);
            margin: 0; padding: 0;
            color: var(--text-dark);
            height: 100vh; display: flex; flex-direction: column;
        }

        /* --- Header Navigation --- */
        .top-nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--primary-blue);
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-menu-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-menu-btn:hover {
            background: var(--bg-gray);
        }

        .nav-menu-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .logout-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--bg-gray);
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            padding: 25px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* --- Filter Bar --- */
        .filter-bar {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 15px 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .filter-group select {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            cursor: pointer;
        }

        /* --- Main Layout: Calendar + Schedule List --- */
        .content-wrapper {
            flex: 1;
            display: flex;
            gap: 15px;
            overflow: hidden;
        }

        .calendar-section {
            flex: 2;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .schedule-list-section {
            flex: 1;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .schedule-list-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 1rem;
        }

        .schedule-list-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .schedule-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .schedule-item:hover {
            background: var(--bg-gray);
            border-color: var(--border-color);
        }

        .schedule-item.selected {
            background: #eff6ff;
            border-color: var(--primary-blue);
        }

        .schedule-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .schedule-number.blue {
            background: var(--task-blue-border);
            color: white;
        }

        .schedule-number.green {
            background: var(--task-green-border);
            color: white;
        }

        .schedule-number.yellow {
            background: var(--task-yellow-border);
            color: white;
        }

        .schedule-info {
            flex: 1;
            min-width: 0;
        }

        .schedule-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .schedule-time {
            font-size: 0.75rem;
            color: #64748b;
        }

        /* --- Detail Panel --- */
        .detail-panel {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: none;
        }

        .detail-panel.show {
            display: block;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-row {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            width: 120px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #64748b;
            flex-shrink: 0;
        }

        .detail-value {
            flex: 1;
            font-size: 0.85rem;
            color: var(--text-dark);
        }

        .close-detail-btn {
            float: right;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #94a3b8;
            line-height: 1;
            padding: 0;
            margin-top: -5px;
        }

        .close-detail-btn:hover {
            color: var(--text-dark);
        }

        /* --- Calendar Styles --- */
        .toolbar {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            z-index: 100002;
        }

        .date-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-button {
            background: white;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-dark);
            transition: all 0.2s;
        }

        .nav-button:hover {
            background: var(--bg-gray);
        }

        .current-date {
            font-size: 1.1rem;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }

        .view-switch {
            display: flex;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 8px;
        }

        .view-switch button {
            border: none;
            background: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #64748b;
        }

        .view-switch button.active {
            background: white;
            color: var(--text-dark);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        .legend-wrapper {
            position: relative;
            margin-left: 10px;
            z-index: 100001;
        }

        .legend-btn {
            background: #f1f5f9;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .legend-popup {
            display: none;
            position: absolute;
            top: 40px;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            width: 220px;
            z-index: 100000 !important;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .legend-wrapper:hover .legend-popup {
            display: block;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* --- Calendar Grid --- */
        .calendar-grid {
            flex: 1;
            overflow: auto;
            display: none;
        }
        
        .calendar-grid.week-view {
            grid-template-columns: 80px repeat(5, 1fr);
            grid-template-rows: 45px repeat(10, 80px);
        }
        
        .calendar-grid.month-view {
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 45px repeat(5, 120px);
            position: relative;
            overflow: visible;
        }
        
        .calendar-grid.active {
            display: grid !important;
        }

        .calendar-grid.month-view .cell[data-date] {
            position: relative;
            z-index: 1;
            overflow: visible;
        }

        .calendar-grid.day-view {
            grid-template-columns: 80px 1fr;
            grid-template-rows: 45px repeat(24, 60px);
        }

        .cell {
            border: 1px solid var(--border-color);
            position: relative;
        }

        .cell-header {
            background: #fafafa;
            font-weight: 600;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .time-label {
            background: #fafafa;
            font-size: 0.75rem;
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-view .cell:not(.cell-header):not(.time-label),
        .day-view .cell:not(.cell-header):not(.time-label) {
            overflow: visible;
        }

        .month-view-cell {
            min-height: 120px;
            padding: 8px;
            vertical-align: top;
            position: relative;
            cursor: pointer;
        }

        .month-view-cell .date-number {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .schedule-indicator {
            margin-top: 5px;
            overflow: visible;
        }

        .task {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            min-height: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 1;
            padding: 4px 8px;
            border-radius: 6px;
            border-left: 4px solid;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
        }

        .task:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: visible;
        }

        .task.blue {
            background: var(--task-blue-bg);
            color: var(--task-blue-text);
            border-left-color: var(--task-blue-border);
        }

        .task.green {
            background: var(--task-green-bg);
            color: var(--task-green-text);
            border-left-color: var(--task-green-border);
        }

        .task.yellow {
            background: var(--task-yellow-bg);
            color: var(--task-yellow-text);
            border-left-color: var(--task-yellow-border);
        }

        .task-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        .task-detail-tooltip {
            display: none;
            position: absolute;
            left: 50%;
            bottom: 100%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: normal;
            pointer-events: none;
        }

        .task-detail-tooltip.force-show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10000 !important;
        }

        .task-hover-area {
            background: rgba(255,0,0,0);
            z-index: 100;
            pointer-events: auto;
        }

        .month-task-bar {
            position: absolute;
            height: 22px;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.65rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            cursor: pointer;
            border-left: 3px solid;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 10000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .month-task-bar.blue {
            background: var(--task-blue-bg);
            color: var(--task-blue-text);
            border-left-color: var(--task-blue-border);
        }

        .month-task-bar.green {
            background: var(--task-green-bg);
            color: var(--task-green-text);
            border-left-color: var(--task-green-border);
        }

        .month-task-bar.yellow {
            background: var(--task-yellow-bg);
            color: var(--task-yellow-text);
            border-left-color: var(--task-yellow-border);
        }

        .month-task-bar.same-task-highlight {
            outline: 3px solid var(--primary-blue);
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
            transform: scale(1.02);
            z-index: 10001;
        }

        .month-task-tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            min-width: 180px;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-size: 0.75rem;
            line-height: 1.4;
            white-space: normal;
            z-index: 99999;
            pointer-events: none;
        }

        .month-task-bar:hover .month-task-tooltip {
            display: block;
        }

        #prev-btn, #next-btn {
            z-index: 50000;
        }
    </style>
</head>
<body>
    <!-- ÏÉÅÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div class="top-nav">
        <div class="nav-left">
            <h1>üß± Lego</h1>
            <div class="nav-menu" id="navMenu">
                <button class="nav-menu-btn active" onclick="location.href='my_calendar.html'">ÎÇ¥ Ï∫òÎ¶∞Îçî</button>
            </div>
        </div>
        <div class="nav-right">
            <div class="user-info" id="userInfo"></div>
            <button class="logout-btn" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
        </div>
    </div>

    <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
    <div class="main-content">
        <!-- ÌïÑÌÑ∞ Î∞î -->
        <div class="filter-bar">
            <div class="filter-group">
                <label>ÌååÌä∏Î≥Ñ</label>
                <select id="filter-team" onchange="applyFilters()">
                    <option value="all">Ï†ÑÏ≤¥</option>
                    <option value="dev">Í∞úÎ∞úÌåÄ</option>
                    <option value="design">ÎîîÏûêÏù∏ÌåÄ</option>
                </select>
            </div>
            <div class="filter-group">
                <label>ÌîÑÎ°úÏ†ùÌä∏Î≥Ñ</label>
                <select id="filter-project" onchange="applyFilters()">
                    <option value="all">Ï†ÑÏ≤¥</option>
                    <option value="project-a">ÌîÑÎ°úÏ†ùÌä∏ A</option>
                    <option value="project-b">ÌîÑÎ°úÏ†ùÌä∏ B</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Í∞úÏù∏Î≥Ñ</label>
                <select id="filter-user" disabled>
                    <option value="me">ÎÇ¥ ÏùºÏ†ï</option>
                </select>
            </div>
        </div>

        <!-- Ï∫òÎ¶∞Îçî + ÏùºÏ†ï Î¶¨Ïä§Ìä∏ -->
        <div class="content-wrapper">
            <!-- Ï∫òÎ¶∞Îçî ÏÑπÏÖò -->
            <div class="calendar-section">
                <div class="toolbar">
                    <div class="date-nav">
                        <button class="nav-button" id="prev-btn" onclick="navigate('prev')">‚óÄ</button>
                        <div class="current-date" id="current-date">2023ÎÖÑ 3Ïõî</div>
                        <button class="nav-button" id="next-btn" onclick="navigate('next')">‚ñ∂</button>
                    </div>

                    <div style="display: flex; align-items: center;">
                        <div class="view-switch">
                            <button onclick="changeView(this)" data-view="month" class="active">Ïõî</button>
                            <button onclick="changeView(this)" data-view="week">Ï£º</button>
                            <button onclick="changeView(this)" data-view="day">Ïùº</button>
                        </div>
                        <div class="legend-wrapper">
                            <button class="legend-btn">üé® Î∂ÑÎ•ò</button>
                            <div class="legend-popup">
                                <div class="legend-item">
                                    <div class="dot" style="background: var(--task-blue-border);"></div>
                                    <span>Í∏∞Ìöç</span>
                                </div>
                                <div class="legend-item">
                                    <div class="dot" style="background: var(--task-green-border);"></div>
                                    <span>Í∞úÎ∞ú</span>
                                </div>
                                <div class="legend-item">
                                    <div class="dot" style="background: var(--task-yellow-border);"></div>
                                    <span>ÎîîÏûêÏù∏</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÏõîÎ≥Ñ Î∑∞ -->
                <div class="calendar-grid month-view active" id="month-grid"></div>

                <!-- Ï£ºÎ≥Ñ Î∑∞ -->
                <div class="calendar-grid week-view" id="week-grid"></div>

                <!-- ÏùºÎ≥Ñ Î∑∞ -->
                <div class="calendar-grid day-view" id="day-grid"></div>
            </div>

            <!-- ÏùºÏ†ï Î¶¨Ïä§Ìä∏ ÏÑπÏÖò -->
            <div class="schedule-list-section">
                <div class="schedule-list-header" id="schedule-list-title">
                    üìã ÏùºÏ†ï Î¶¨Ïä§Ìä∏
                </div>
                <div class="schedule-list-content" id="schedule-list"></div>
            </div>
        </div>

        <!-- ÏÉÅÏÑ∏Ï†ïÎ≥¥ Ìå®ÎÑê -->
        <div class="detail-panel" id="detail-panel">
            <button class="close-detail-btn" onclick="closeDetailPanel()">√ó</button>
            <div class="detail-section">
                <div class="detail-section-title">üìå ÌÖåÏä§ÌÅ¨ Ï†ïÎ≥¥</div>
                <div class="detail-row">
                    <div class="detail-label">Ï†úÎ™©</div>
                    <div class="detail-value" id="detail-task-title">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ïπ¥ÌÖåÍ≥†Î¶¨</div>
                    <div class="detail-value" id="detail-task-category">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Îã¥ÎãπÏûê</div>
                    <div class="detail-value" id="detail-task-user">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ÏùºÏ†ï</div>
                    <div class="detail-value" id="detail-task-schedule">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ìï†Îãπ ÏãúÍ∞Ñ</div>
                    <div class="detail-value" id="detail-task-hours">-</div>
                </div>
            </div>
            <div class="detail-section">
                <div class="detail-section-title">üìÇ ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥</div>
                <div class="detail-row">
                    <div class="detail-label">ÌîÑÎ°úÏ†ùÌä∏Î™Ö</div>
                    <div class="detail-value" id="detail-project-name">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Í∏∞Ï§Ä ÏãúÍ∞Ñ</div>
                    <div class="detail-value" id="detail-project-standard">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Ìï†Îãπ ÏãúÍ∞Ñ</div>
                    <div class="detail-value" id="detail-project-assigned">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ÏßÑÌñâÎ•†</div>
                    <div class="detail-value" id="detail-project-progress">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ïù∏Ï¶ù Ï≤¥ÌÅ¨
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if (!currentUser) {
            alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
            window.location.href = 'login.html';
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌëúÏãú
        document.getElementById('userInfo').textContent = `${currentUser.name} (${getRoleName(currentUser.role)})`;

        // Ïó≠Ìï†Î≥Ñ Î©îÎâ¥ Ï∂îÍ∞Ä
        const navMenu = document.getElementById('navMenu');
        if (currentUser.role === 'admin') {
            navMenu.innerHTML += `
                <button class="nav-menu-btn" onclick="location.href='admin.html'">Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú</button>
                <button class="nav-menu-btn" onclick="location.href='lego_mockup.html'">Ï†ÑÏ≤¥ Ï∫òÎ¶∞Îçî</button>
                <button class="nav-menu-btn" onclick="location.href='task_schedule.html'">ÌÖåÏä§ÌÅ¨ Í¥ÄÎ¶¨</button>
            `;
        } else if (currentUser.role === 'teamlead') {
            navMenu.innerHTML += `
                <button class="nav-menu-btn" onclick="location.href='teamlead.html'">ÌåÄÏû• ÎåÄÏãúÎ≥¥Îìú</button>
                <button class="nav-menu-btn" onclick="location.href='lego_mockup.html'">Ï†ÑÏ≤¥ Ï∫òÎ¶∞Îçî</button>
                <button class="nav-menu-btn" onclick="location.href='task_schedule.html'">ÌÖåÏä§ÌÅ¨ Í¥ÄÎ¶¨</button>
            `;
        } else {
            navMenu.innerHTML += `
                <button class="nav-menu-btn" onclick="location.href='task_schedule.html'">ÌÖåÏä§ÌÅ¨ Í¥ÄÎ¶¨</button>
            `;
        }

        function getRoleName(role) {
            const roleNames = {
                'admin': 'Í¥ÄÎ¶¨Ïûê',
                'teamlead': 'ÌåÄÏû•',
                'user': 'ÌåÄÏõê'
            };
            return roleNames[role] || 'ÏÇ¨Ïö©Ïûê';
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞
        const USERS = {
            'user-kim': { name: 'ÍπÄÏ≤†Ïàò', team: 'dev' },
            'user-lee': { name: 'Ïù¥ÏòÅÌù¨', team: 'dev' },
            'user-park': { name: 'Î∞ïÎ™ÖÏàò', team: 'design' },
            'user-haha': { name: 'ÌïòÌïò', team: 'design' }
        };

        const CATEGORIES = {
            'planning': { name: 'Í∏∞Ìöç', color: 'blue', colorCode: '#3b82f6' },
            'development': { name: 'Í∞úÎ∞ú', color: 'green', colorCode: '#22c55e' },
            'design': { name: 'ÎîîÏûêÏù∏', color: 'yellow', colorCode: '#eab308' }
        };

        const PROJECTS = {
            'project-a': {
                name: 'ÌîÑÎ°úÏ†ùÌä∏ A',
                standardHours: 100,
                assignedHours: 60
            },
            'project-b': {
                name: 'ÌîÑÎ°úÏ†ùÌä∏ B',
                standardHours: 80,
                assignedHours: 45
            }
        };

        const TASKS = {
            'task-001': {
                taskId: 'task-001',
                title: 'DB ÏÑ§Í≥Ñ',
                category: 'planning',
                standardHours: 16,
                projectId: 'project-a'
            },
            'task-002': {
                taskId: 'task-002',
                title: 'API Í∞úÎ∞ú',
                category: 'development',
                standardHours: 24,
                projectId: 'project-a'
            },
            'task-003': {
                taskId: 'task-003',
                title: 'UI ÎîîÏûêÏù∏',
                category: 'design',
                standardHours: 20,
                projectId: 'project-b'
            }
        };

        const TASK_ASSIGNMENTS = [
            {
                taskId: 'task-001',
                user: 'user-kim',
                startDate: '2023-03-01',
                endDate: '2023-03-02',
                startTime: '09:00',
                endTime: '18:00',
                assignedHours: 16
            },
            {
                taskId: 'task-002',
                user: 'user-kim',
                startDate: '2023-03-06',
                endDate: '2023-03-07',
                startTime: '10:00',
                endTime: '15:00',
                assignedHours: 10
            },
            {
                taskId: 'task-003',
                user: 'user-park',
                startDate: '2023-03-01',
                endDate: '2023-03-01',
                startTime: '13:00',
                endTime: '17:00',
                assignedHours: 4
            }
        ];

        // ÌòÑÏû¨ Î°úÍ∑∏Ïù∏Ìïú ÏÇ¨Ïö©ÏûêÏùò ÏùºÏ†ïÎßå ÌïÑÌÑ∞ÎßÅ
        let filteredAssignments = TASK_ASSIGNMENTS.filter(assignment => 
            assignment.user === currentUser.userId
        );

        function getSchedulesForDate(dateStr) {
            const schedules = [];
            filteredAssignments.forEach(assignment => {
                if (dateStr >= assignment.startDate && dateStr <= assignment.endDate) {
                    const task = TASKS[assignment.taskId];
                    if (task) {
                        schedules.push({
                            ...assignment,
                            title: task.title,
                            category: task.category,
                            projectId: task.projectId
                        });
                    }
                }
            });
            return schedules;
        }

        const SCHEDULE_DATA = new Proxy({}, {
            get: function(target, dateStr) {
                if (typeof dateStr !== 'string' || !dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    return target[dateStr];
                }
                if (!target[dateStr]) {
                    target[dateStr] = getSchedulesForDate(dateStr);
                }
                return target[dateStr];
            }
        });

        // ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyFilters() {
            const teamFilter = document.getElementById('filter-team').value;
            const projectFilter = document.getElementById('filter-project').value;

            filteredAssignments = TASK_ASSIGNMENTS.filter(assignment => {
                if (assignment.user !== currentUser.userId) return false;

                const user = USERS[assignment.user];
                const task = TASKS[assignment.taskId];

                if (teamFilter !== 'all' && user.team !== teamFilter) return false;
                if (projectFilter !== 'all' && task.projectId !== projectFilter) return false;

                return true;
            });

            // SCHEDULE_DATA Ï∫êÏãú Ï¥àÍ∏∞Ìôî
            for (let key in SCHEDULE_DATA) {
                if (key.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    delete SCHEDULE_DATA[key];
                }
            }

            // ÌòÑÏû¨ Î∑∞ Ïû¨ÏÉùÏÑ±
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');
            if (activeView === 'month') {
                generateMonthView(currentYear, currentMonth);
            } else if (activeView === 'week') {
                const weekDates = getWeekDates(currentWeekStart);
                generateWeekView(weekDates);
            } else if (activeView === 'day') {
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                generateDayView(currentDayDate, dateStr);
            }

            updateScheduleList();
        }

        // ÌòÑÏû¨ ÌëúÏãú Ï§ëÏù∏ ÎÇ†Ïßú
        let currentYear = 2023;
        let currentMonth = 3;
        let currentWeekStart = new Date(2023, 2, 6);
        let currentDayDate = new Date(2023, 2, 9);
        let selectedSchedule = null;

        // Î∑∞ Ï†ÑÌôò
        function changeView(btn) {
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const view = btn.getAttribute('data-view');
            document.querySelectorAll('.calendar-grid').forEach(grid => grid.classList.remove('active'));

            if (view === 'month') {
                document.getElementById('month-grid').classList.add('active');
                generateMonthView(currentYear, currentMonth);
                updateDateDisplay();
            } else if (view === 'week') {
                document.getElementById('week-grid').classList.add('active');
                const weekDates = getWeekDates(currentWeekStart);
                generateWeekView(weekDates);
                updateDateDisplay();
            } else if (view === 'day') {
                document.getElementById('day-grid').classList.add('active');
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                generateDayView(currentDayDate, dateStr);
                updateDateDisplay();
            }

            updateScheduleList();
        }

        // ÎÇ†Ïßú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateDateDisplay() {
            const dateDisplay = document.getElementById('current-date');
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');

            if (activeView === 'month') {
                dateDisplay.textContent = `${currentYear}ÎÖÑ ${currentMonth}Ïõî`;
            } else if (activeView === 'week') {
                const weekEnd = new Date(currentWeekStart);
                weekEnd.setDate(weekEnd.getDate() + 4);
                dateDisplay.textContent = `${currentWeekStart.getFullYear()}ÎÖÑ ${currentWeekStart.getMonth() + 1}Ïõî ${currentWeekStart.getDate()}Ïùº ~ ${weekEnd.getMonth() + 1}Ïõî ${weekEnd.getDate()}Ïùº`;
            } else if (activeView === 'day') {
                dateDisplay.textContent = `${currentDayDate.getFullYear()}ÎÖÑ ${currentDayDate.getMonth() + 1}Ïõî ${currentDayDate.getDate()}Ïùº`;
            }
        }

        // ÏùºÏ†ï Î¶¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updateScheduleList() {
            const listContainer = document.getElementById('schedule-list');
            const listTitle = document.getElementById('schedule-list-title');
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');

            let schedules = [];
            let titleText = '';

            if (activeView === 'month') {
                titleText = `üìã ${currentYear}ÎÖÑ ${currentMonth}Ïõî ÏùºÏ†ï`;
                const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const daySchedules = SCHEDULE_DATA[dateStr] || [];
                    schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                }
            } else if (activeView === 'week') {
                const weekEnd = new Date(currentWeekStart);
                weekEnd.setDate(weekEnd.getDate() + 4);
                titleText = `üìã ${currentWeekStart.getMonth() + 1}/${currentWeekStart.getDate()} ~ ${weekEnd.getMonth() + 1}/${weekEnd.getDate()} ÏùºÏ†ï`;
                
                const weekDates = getWeekDates(currentWeekStart);
                weekDates.forEach(date => {
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    const daySchedules = SCHEDULE_DATA[dateStr] || [];
                    schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                });
            } else if (activeView === 'day') {
                titleText = `üìã ${currentDayDate.getMonth() + 1}Ïõî ${currentDayDate.getDate()}Ïùº ÏùºÏ†ï`;
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                const daySchedules = SCHEDULE_DATA[dateStr] || [];
                schedules = daySchedules.map(s => ({ ...s, date: dateStr }));
            }

            listTitle.textContent = titleText;

            if (schedules.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 40px 20px;">ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                return;
            }

            listContainer.innerHTML = '';
            schedules.forEach((schedule, index) => {
                const category = CATEGORIES[schedule.category];
                const task = TASKS[schedule.taskId];
                
                const scheduleItem = document.createElement('div');
                scheduleItem.className = 'schedule-item';
                scheduleItem.onclick = () => showScheduleDetail(schedule);

                scheduleItem.innerHTML = `
                    <div class="schedule-number ${category.color}">${index + 1}</div>
                    <div class="schedule-info">
                        <div class="schedule-title">${schedule.title}</div>
                        <div class="schedule-time">${schedule.date} ${schedule.startTime} ~ ${schedule.endTime}</div>
                    </div>
                `;

                listContainer.appendChild(scheduleItem);
            });
        }

        // ÏùºÏ†ï Î¶¨Ïä§Ìä∏ÏóêÏÑú ÌÅ¥Î¶≠ Ïãú ÏÉÅÏÑ∏Ï†ïÎ≥¥ ÌëúÏãú
        function showScheduleDetail(schedule) {
            selectedSchedule = schedule;

            // Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú ÏÑ†ÌÉù ÌëúÏãú
            document.querySelectorAll('.schedule-item').forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            const task = TASKS[schedule.taskId];
            const category = CATEGORIES[schedule.category];
            const user = USERS[schedule.user];
            const project = PROJECTS[schedule.projectId];

            // ÌÖåÏä§ÌÅ¨ Ï†ïÎ≥¥
            document.getElementById('detail-task-title').textContent = schedule.title;
            document.getElementById('detail-task-category').textContent = category.name;
            document.getElementById('detail-task-user').textContent = user.name;
            document.getElementById('detail-task-schedule').textContent = `${schedule.startDate} ~ ${schedule.endDate}`;
            document.getElementById('detail-task-hours').textContent = `${schedule.assignedHours}ÏãúÍ∞Ñ`;

            // ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥
            document.getElementById('detail-project-name').textContent = project.name;
            document.getElementById('detail-project-standard').textContent = `${project.standardHours}ÏãúÍ∞Ñ`;
            document.getElementById('detail-project-assigned').textContent = `${project.assignedHours}ÏãúÍ∞Ñ`;
            const progress = Math.round((project.assignedHours / project.standardHours) * 100);
            document.getElementById('detail-project-progress').textContent = `${progress}%`;

            // Ìå®ÎÑê ÌëúÏãú
            document.getElementById('detail-panel').classList.add('show');
        }

        // Ï∫òÎ¶∞ÎçîÏóêÏÑú ÌÅ¥Î¶≠ Ïãú ÏÉÅÏÑ∏Ï†ïÎ≥¥ ÌëúÏãú (Ïò§Î•∏Ï™Ω Î¶¨Ïä§Ìä∏ÏôÄ Ïó∞Îèô)
        function showScheduleDetailFromCalendar(schedule) {
            console.log('showScheduleDetailFromCalendar Ìò∏Ï∂úÎê®:', schedule);
            selectedSchedule = schedule;

            // taskÏóêÏÑú categoryÏôÄ projectId Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
            const task = TASKS[schedule.taskId];
            if (!task) {
                console.error('TaskÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå:', schedule.taskId);
                alert('ÏùºÏ†ï Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            const category = CATEGORIES[task.category];  // taskÏóêÏÑú category Í∞ÄÏ†∏Ïò§Í∏∞
            const user = USERS[schedule.user];
            const project = PROJECTS[task.projectId];    // taskÏóêÏÑú projectId Í∞ÄÏ†∏Ïò§Í∏∞

            if (!category || !user || !project) {
                console.error('Îç∞Ïù¥ÌÑ∞ ÎàÑÎùΩ:', { task, category, user, project, schedule });
                alert('ÏùºÏ†ï Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            // ÌÖåÏä§ÌÅ¨ Ï†ïÎ≥¥
            document.getElementById('detail-task-title').textContent = task.title;
            document.getElementById('detail-task-category').textContent = category.name;
            document.getElementById('detail-task-user').textContent = user.name;
            document.getElementById('detail-task-schedule').textContent = `${schedule.startDate} ~ ${schedule.endDate}`;
            document.getElementById('detail-task-hours').textContent = `${schedule.assignedHours}ÏãúÍ∞Ñ`;

            // ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥
            document.getElementById('detail-project-name').textContent = project.name;
            document.getElementById('detail-project-standard').textContent = `${project.standardHours}ÏãúÍ∞Ñ`;
            document.getElementById('detail-project-assigned').textContent = `${project.assignedHours}ÏãúÍ∞Ñ`;
            const progress = Math.round((project.assignedHours / project.standardHours) * 100);
            document.getElementById('detail-project-progress').textContent = `${progress}%`;

            // Ïò§Î•∏Ï™Ω Î¶¨Ïä§Ìä∏ÏóêÏÑú Ìï¥Îãπ ÏùºÏ†ï Ï∞æÏïÑÏÑú ÏÑ†ÌÉù ÌëúÏãú
            const scheduleItems = document.querySelectorAll('.schedule-item');
            scheduleItems.forEach(item => {
                item.classList.remove('selected');
                
                // ÏùºÏ†ï Î¶¨Ïä§Ìä∏Ïùò Í∞Å ÏïÑÏù¥ÌÖúÍ≥º ÎπÑÍµê (taskId, user, startDateÎ°ú Îß§Ïπ≠)
                const itemIndex = Array.from(scheduleItems).indexOf(item);
                const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');
                
                let schedules = [];
                if (activeView === 'month') {
                    const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const daySchedules = SCHEDULE_DATA[dateStr] || [];
                        schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                    }
                } else if (activeView === 'week') {
                    const weekDates = getWeekDates(currentWeekStart);
                    weekDates.forEach(date => {
                        const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                        const daySchedules = SCHEDULE_DATA[dateStr] || [];
                        schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                    });
                } else if (activeView === 'day') {
                    const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                    const daySchedules = SCHEDULE_DATA[dateStr] || [];
                    schedules = daySchedules.map(s => ({ ...s, date: dateStr }));
                }

                // Ìï¥Îãπ Ïù∏Îç±Ïä§Ïùò Ïä§ÏºÄÏ§ÑÍ≥º ÎπÑÍµê
                if (schedules[itemIndex]) {
                    const listSchedule = schedules[itemIndex];
                    if (listSchedule.taskId === schedule.taskId && 
                        listSchedule.user === schedule.user) {
                        item.classList.add('selected');
                    }
                }
            });

            // Ìå®ÎÑê ÌëúÏãú
            console.log('Ìå®ÎÑê ÌëúÏãú Ï§ë...');
            const detailPanel = document.getElementById('detail-panel');
            detailPanel.classList.add('show');
            console.log('Ìå®ÎÑê ÌÅ¥ÎûòÏä§:', detailPanel.className);
        }

        function closeDetailPanel() {
            document.getElementById('detail-panel').classList.remove('show');
            document.querySelectorAll('.schedule-item').forEach(item => item.classList.remove('selected'));
            selectedSchedule = null;
        }

        // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        function navigate(direction) {
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');

            if (activeView === 'month') {
                if (direction === 'prev') {
                    currentMonth--;
                    if (currentMonth < 1) {
                        currentMonth = 12;
                        currentYear--;
                    }
                } else {
                    currentMonth++;
                    if (currentMonth > 12) {
                        currentMonth = 1;
                        currentYear++;
                    }
                }
                generateMonthView(currentYear, currentMonth);
                updateDateDisplay();
            } else if (activeView === 'week') {
                if (direction === 'prev') {
                    currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                } else {
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                }
                const weekDates = getWeekDates(currentWeekStart);
                generateWeekView(weekDates);
                updateDateDisplay();
            } else if (activeView === 'day') {
                if (direction === 'prev') {
                    currentDayDate.setDate(currentDayDate.getDate() - 1);
                } else {
                    currentDayDate.setDate(currentDayDate.getDate() + 1);
                }
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                generateDayView(currentDayDate, dateStr);
                updateDateDisplay();
            }

            updateScheduleList();
        }

        // ÏõîÎ≥Ñ Î∑∞ ÏÉùÏÑ±
        function generateMonthView(year = 2023, month = 3) {
            const monthGrid = document.getElementById('month-grid');
            monthGrid.innerHTML = '';

            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();

            const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'cell cell-header';
                header.textContent = day;
                monthGrid.appendChild(header);
            });

            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'cell month-view-cell';
                monthGrid.appendChild(emptyCell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'cell month-view-cell';
                const dateString = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                cell.setAttribute('data-date', dateString);

                const dateNumber = document.createElement('div');
                dateNumber.className = 'date-number';
                dateNumber.textContent = day;
                cell.appendChild(dateNumber);

                const scheduleIndicator = document.createElement('div');
                scheduleIndicator.className = 'schedule-indicator';
                cell.appendChild(scheduleIndicator);

                cell.addEventListener('click', (e) => {
                    if (e.target.classList.contains('month-task-bar')) return;
                    goToDayView(dateString);
                });

                monthGrid.appendChild(cell);
            }

            setTimeout(() => {
                const firstDateCell = monthGrid.querySelector('.month-view-cell[data-date]');
                if (!firstDateCell) return;

                const cellWidth = firstDateCell.offsetWidth;
                const cellHeight = firstDateCell.offsetHeight;

                const taskRanges = findContinuousTaskRanges(year, month);
                const allTaskLayers = [];

                taskRanges.forEach(range => {
                    const category = CATEGORIES[range.category];
                    const user = USERS[range.user];

                    if (!user || !category) return;

                    const startCellIndex = firstDayOfWeek + range.startDate - 1;
                    const endCellIndex = firstDayOfWeek + range.endDate - 1;

                    const startRow = Math.floor(startCellIndex / 7);
                    const endRow = Math.floor(endCellIndex / 7);

                    for (let currentRow = startRow; currentRow <= endRow; currentRow++) {
                        const rowStartIndex = currentRow * 7;
                        const rowEndIndex = rowStartIndex + 6;

                        const barStartIndex = Math.max(startCellIndex, rowStartIndex);
                        const barEndIndex = Math.min(endCellIndex, rowEndIndex);

                        const barStartCol = barStartIndex % 7;
                        const barEndCol = barEndIndex % 7;
                        const barSpan = barEndCol - barStartCol + 1;

                        let layerIndex = 0;
                        let foundLayer = false;

                        for (let i = 0; i < allTaskLayers.length; i++) {
                            const layer = allTaskLayers[i];

                            if (layer.row !== currentRow) continue;

                            let hasConflict = false;
                            for (let cell = barStartIndex; cell <= barEndIndex; cell++) {
                                if (layer.occupiedCells.includes(cell)) {
                                    hasConflict = true;
                                    break;
                                }
                            }

                            if (!hasConflict) {
                                layerIndex = i;
                                foundLayer = true;
                                for (let cell = barStartIndex; cell <= barEndIndex; cell++) {
                                    layer.occupiedCells.push(cell);
                                }
                                break;
                            }
                        }

                        if (!foundLayer) {
                            layerIndex = allTaskLayers.length;
                            const occupiedCells = [];
                            for (let cellIndex = barStartIndex; cellIndex <= barEndIndex; cellIndex++) {
                                occupiedCells.push(cellIndex);
                            }
                            allTaskLayers.push({
                                row: currentRow,
                                occupiedCells: occupiedCells
                            });
                        }

                        const barStartDate = Math.max(range.startDate, barStartIndex - firstDayOfWeek + 1);
                        const barEndDate = Math.min(range.endDate, barEndIndex - firstDayOfWeek + 1);

                        const taskBar = document.createElement('div');
                        taskBar.className = `month-task-bar ${category.color} ${range.user}`;
                        taskBar.setAttribute('data-task-id', range.taskId);
                        taskBar.setAttribute('data-assignment', JSON.stringify(range.assignment));

                        const topPosition = 45 + (currentRow * cellHeight) + 24 + (layerIndex * 24);
                        const leftPosition = barStartCol * cellWidth + 10;
                        const barWidth = (barSpan * cellWidth) - 20;

                        taskBar.style.top = `${topPosition}px`;
                        taskBar.style.left = `${leftPosition}px`;
                        taskBar.style.width = `${barWidth}px`;

                        const daysText = barSpan > 1 ? ` (${barSpan}Ïùº)` : '';
                        taskBar.textContent = `${user.name}: ${range.title}${daysText}`;

                        const tooltip = document.createElement('div');
                        tooltip.className = 'month-task-tooltip';
                        tooltip.innerHTML = `
                            <strong>${category.name} - ${range.title}</strong>
                            <div>üë§ Îã¥Îãπ: ${user.name}</div>
                            <div>üìÖ Í∏∞Í∞Ñ: ${barStartDate}Ïùº ~ ${barEndDate}Ïùº (${barSpan}Ïùº)</div>
                            <div>‚è±Ô∏è Ï¥ù ÏãúÍ∞Ñ: ${range.totalHours || 0}ÏãúÍ∞Ñ</div>
                        `;
                        taskBar.appendChild(tooltip);

                        taskBar.addEventListener('click', (e) => {
                            e.stopPropagation();
                            e.preventDefault();
                            const assignmentData = JSON.parse(e.currentTarget.getAttribute('data-assignment'));
                            showScheduleDetailFromCalendar(assignmentData);
                        });

                        taskBar.addEventListener('mouseenter', (e) => {
                            const taskId = e.currentTarget.getAttribute('data-task-id');
                            document.querySelectorAll(`.month-task-bar[data-task-id="${taskId}"]`).forEach(bar => {
                                bar.classList.add('same-task-highlight');
                            });
                        });

                        taskBar.addEventListener('mouseleave', (e) => {
                            const taskId = e.currentTarget.getAttribute('data-task-id');
                            document.querySelectorAll(`.month-task-bar[data-task-id="${taskId}"]`).forEach(bar => {
                                bar.classList.remove('same-task-highlight');
                            });
                        });

                        monthGrid.appendChild(taskBar);
                    }
                });
            }, 100);
        }

        function findContinuousTaskRanges(year, month) {
            const ranges = [];
            const processedAssignments = new Set();

            filteredAssignments.forEach((assignment, index) => {
                if (processedAssignments.has(index)) return;

                const startDate = new Date(assignment.startDate);
                const endDate = new Date(assignment.endDate);

                if (startDate.getFullYear() !== year || startDate.getMonth() + 1 !== month) {
                    if (endDate.getFullYear() !== year || endDate.getMonth() + 1 !== month) {
                        return;
                    }
                }

                const task = TASKS[assignment.taskId];
                if (!task) return;

                let rangeStart = startDate;
                let rangeEnd = endDate;
                let totalHours = assignment.assignedHours || 0;

                processedAssignments.add(index);

                filteredAssignments.forEach((otherAssignment, otherIndex) => {
                    if (processedAssignments.has(otherIndex)) return;
                    if (otherAssignment.taskId !== assignment.taskId) return;
                    if (otherAssignment.user !== assignment.user) return;

                    const otherStart = new Date(otherAssignment.startDate);
                    const otherEnd = new Date(otherAssignment.endDate);

                    const dayDiff = Math.abs((otherStart - rangeEnd) / (1000 * 60 * 60 * 24));

                    if (dayDiff <= 1) {
                        if (otherStart < rangeStart) rangeStart = otherStart;
                        if (otherEnd > rangeEnd) rangeEnd = otherEnd;
                        totalHours += otherAssignment.assignedHours || 0;
                        processedAssignments.add(otherIndex);
                    }
                });

                ranges.push({
                    taskId: assignment.taskId,
                    user: assignment.user,
                    title: task.title,
                    category: task.category,
                    startDate: rangeStart.getDate(),
                    endDate: rangeEnd.getDate(),
                    totalHours: totalHours,
                    assignment: assignment
                });
            });

            return ranges;
        }

        // Ï£ºÎ≥Ñ Î∑∞ ÏÉùÏÑ±
        function getWeekDates(startDate) {
            const dates = [];
            for (let i = 0; i < 5; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                dates.push(date);
            }
            return dates;
        }

        function generateWeekView(weekDates) {
            const weekGrid = document.getElementById('week-grid');
            weekGrid.innerHTML = '';

            const headerCell = document.createElement('div');
            headerCell.className = 'cell cell-header';
            headerCell.textContent = 'ÏãúÍ∞Ñ';
            weekGrid.appendChild(headerCell);

            weekDates.forEach(date => {
                const dayName = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][date.getDay()];
                const header = document.createElement('div');
                header.className = 'cell cell-header';
                header.textContent = `${date.getMonth() + 1}/${date.getDate()} (${dayName})`;
                weekGrid.appendChild(header);
            });

            for (let hour = 9; hour < 19; hour++) {
                const timeLabel = document.createElement('div');
                timeLabel.className = 'cell time-label';
                timeLabel.textContent = `${hour}:00`;
                weekGrid.appendChild(timeLabel);

                weekDates.forEach(date => {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    cell.setAttribute('data-date', dateStr);
                    cell.setAttribute('data-hour', hour);

                    const schedules = SCHEDULE_DATA[dateStr] || [];
                    const hourSchedules = schedules.filter(s => {
                        const startHour = parseInt(s.startTime.split(':')[0]);
                        return startHour === hour;
                    });

                    const middleSchedules = schedules.filter(s => {
                        const startHour = parseInt(s.startTime.split(':')[0]);
                        const endHour = parseInt(s.endTime.split(':')[0]);
                        return startHour < hour && endHour > hour;
                    });

                    const allHourSchedules = [...hourSchedules, ...middleSchedules];

                    hourSchedules.forEach((schedule, index) => {
                        const category = CATEGORIES[schedule.category];
                        const user = USERS[schedule.user];
                        if (!category || !user) return;

                        const task = document.createElement('div');
                        task.className = `task ${category.color}`;

                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const endHour = parseInt(schedule.endTime.split(':')[0]);
                        const duration = endHour - startHour;
                        const heightPercent = (duration * 100);

                        task.style.height = `${heightPercent}%`;
                        task.style.top = '0';

                        const columnCount = allHourSchedules.length;
                        const leftPercent = (index / columnCount) * 100;
                        const widthPercent = 100 / columnCount;

                        task.style.left = `${leftPercent}%`;
                        task.style.width = `${widthPercent}%`;

                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        task.setAttribute('data-schedule-id', scheduleId);
                        task.setAttribute('data-schedule', JSON.stringify(schedule));

                        const taskContent = document.createElement('div');
                        taskContent.className = 'task-content-wrapper';
                        taskContent.innerHTML = `
                            <div><strong>${schedule.title}</strong></div>
                            <div>${schedule.startTime} ~ ${schedule.endTime}</div>
                        `;
                        task.appendChild(taskContent);

                        const tooltip = document.createElement('div');
                        tooltip.className = 'task-detail-tooltip';
                        tooltip.innerHTML = `
                            <strong>${category.name} - ${schedule.title}</strong>
                            <div>üë§ Îã¥Îãπ: ${user.name}</div>
                            <div>‚è±Ô∏è ${schedule.startTime} ~ ${schedule.endTime}</div>
                            <div>üìÖ ${dateStr}</div>
                        `;
                        task.appendChild(tooltip);

                        task.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                            showScheduleDetailFromCalendar(scheduleData);
                        });

                        cell.appendChild(task);
                    });

                    middleSchedules.forEach((schedule, index) => {
                        const hoverArea = document.createElement('div');
                        hoverArea.className = 'task-hover-area';
                        hoverArea.style.position = 'absolute';
                        hoverArea.style.top = '0';
                        hoverArea.style.bottom = '0';

                        const columnCount = allHourSchedules.length;
                        const scheduleIndex = allHourSchedules.findIndex(s => s === schedule);
                        const leftPercent = (scheduleIndex / columnCount) * 100;
                        const widthPercent = 100 / columnCount;

                        hoverArea.style.left = `${leftPercent}%`;
                        hoverArea.style.width = `${widthPercent}%`;

                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        hoverArea.setAttribute('data-schedule-id', scheduleId);

                        cell.appendChild(hoverArea);
                    });

                    weekGrid.appendChild(cell);
                });
            }

            setupScheduleHoverEvents();
        }

        // ÏùºÎ≥Ñ Î∑∞ ÏÉùÏÑ±
        function generateDayView(date, dateString) {
            const dayGrid = document.getElementById('day-grid');
            dayGrid.innerHTML = '';

            const headerCell = document.createElement('div');
            headerCell.className = 'cell cell-header';
            headerCell.textContent = 'ÏãúÍ∞Ñ';
            dayGrid.appendChild(headerCell);

            const dayName = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'][date.getDay()];
            const header = document.createElement('div');
            header.className = 'cell cell-header';
            header.textContent = `${date.getMonth() + 1}/${date.getDate()} (${dayName})`;
            dayGrid.appendChild(header);

            for (let hour = 0; hour < 24; hour++) {
                const timeLabel = document.createElement('div');
                timeLabel.className = 'cell time-label';
                timeLabel.textContent = `${hour}:00`;
                dayGrid.appendChild(timeLabel);

                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.setAttribute('data-date', dateString);
                cell.setAttribute('data-hour', hour);

                const schedules = SCHEDULE_DATA[dateString] || [];
                const hourSchedules = schedules.filter(s => {
                    const startHour = parseInt(s.startTime.split(':')[0]);
                    return startHour === hour;
                });

                const middleSchedules = schedules.filter(s => {
                    const startHour = parseInt(s.startTime.split(':')[0]);
                    const endHour = parseInt(s.endTime.split(':')[0]);
                    return startHour < hour && endHour > hour;
                });

                const allHourSchedules = [...hourSchedules, ...middleSchedules];

                hourSchedules.forEach((schedule, index) => {
                    const category = CATEGORIES[schedule.category];
                    const user = USERS[schedule.user];
                    if (!category || !user) return;

                    const task = document.createElement('div');
                    task.className = `task ${category.color}`;

                    const startHour = parseInt(schedule.startTime.split(':')[0]);
                    const endHour = parseInt(schedule.endTime.split(':')[0]);
                    const duration = endHour - startHour;
                    const heightPercent = (duration * 100);

                    task.style.height = `${heightPercent}%`;
                    task.style.top = '0';

                    const columnCount = allHourSchedules.length;
                    const leftPercent = (index / columnCount) * 100;
                    const widthPercent = 100 / columnCount;

                    task.style.left = `${leftPercent}%`;
                    task.style.width = `${widthPercent}%`;

                    const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateString}-${schedule.startTime.replace(':', '')}`;
                    task.setAttribute('data-schedule-id', scheduleId);
                    task.setAttribute('data-schedule', JSON.stringify(schedule));

                    const taskContent = document.createElement('div');
                    taskContent.className = 'task-content-wrapper';
                    taskContent.innerHTML = `
                        <div><strong>${schedule.title}</strong></div>
                        <div>${schedule.startTime} ~ ${schedule.endTime}</div>
                    `;
                    task.appendChild(taskContent);

                    const tooltip = document.createElement('div');
                    tooltip.className = 'task-detail-tooltip';
                    tooltip.innerHTML = `
                        <strong>${category.name} - ${schedule.title}</strong>
                        <div>üë§ Îã¥Îãπ: ${user.name}</div>
                        <div>‚è±Ô∏è ${schedule.startTime} ~ ${schedule.endTime}</div>
                        <div>üìÖ ${dateString}</div>
                    `;
                    task.appendChild(tooltip);

                    task.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                        showScheduleDetailFromCalendar(scheduleData);
                    });

                    cell.appendChild(task);
                });

                middleSchedules.forEach((schedule, index) => {
                    const hoverArea = document.createElement('div');
                    hoverArea.className = 'task-hover-area';
                    hoverArea.style.position = 'absolute';
                    hoverArea.style.top = '0';
                    hoverArea.style.bottom = '0';

                    const columnCount = allHourSchedules.length;
                    const scheduleIndex = allHourSchedules.findIndex(s => s === schedule);
                    const leftPercent = (scheduleIndex / columnCount) * 100;
                    const widthPercent = 100 / columnCount;

                    hoverArea.style.left = `${leftPercent}%`;
                    hoverArea.style.width = `${widthPercent}%`;

                    const startHour = parseInt(schedule.startTime.split(':')[0]);
                    const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateString}-${schedule.startTime.replace(':', '')}`;
                    hoverArea.setAttribute('data-schedule-id', scheduleId);

                    cell.appendChild(hoverArea);
                });

                dayGrid.appendChild(cell);
            }

            setupScheduleHoverEvents();
        }

        function setupScheduleHoverEvents() {
            document.querySelectorAll('.task, .task-hover-area').forEach(el => {
                el.onmouseenter = function(e) {
                    const scheduleId = e.currentTarget.getAttribute('data-schedule-id');
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    if (taskBlock) {
                        taskBlock.style.zIndex = '10000';
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        if (tooltip) {
                            tooltip.classList.add('force-show');
                        }
                    }
                };

                el.onmouseleave = function(e) {
                    const scheduleId = e.currentTarget.getAttribute('data-schedule-id');
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    if (taskBlock) {
                        taskBlock.style.zIndex = '1';
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        if (tooltip) {
                            tooltip.classList.remove('force-show');
                        }
                    }
                };
            });
        }

        function goToDayView(dateString) {
            const [year, month, day] = dateString.split('-').map(Number);
            currentDayDate = new Date(year, month - 1, day);

            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelector('.view-switch button[data-view="day"]').classList.add('active');

            document.querySelectorAll('.calendar-grid').forEach(grid => grid.classList.remove('active'));
            document.getElementById('day-grid').classList.add('active');

            generateDayView(currentDayDate, dateString);
            updateDateDisplay();
            updateScheduleList();
        }

        function goToWeekView(dateString) {
            const [year, month, day] = dateString.split('-').map(Number);
            const targetDate = new Date(year, month - 1, day);

            const dayOfWeek = targetDate.getDay();
            const monday = new Date(targetDate);
            monday.setDate(targetDate.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

            currentWeekStart = monday;

            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelector('.view-switch button[data-view="week"]').classList.add('active');

            document.querySelectorAll('.calendar-grid').forEach(grid => grid.classList.remove('active'));
            document.getElementById('week-grid').classList.add('active');

            const weekDates = getWeekDates(currentWeekStart);
            generateWeekView(weekDates);
            updateDateDisplay();
            updateScheduleList();
        }

        // Ï¥àÍ∏∞ Î†åÎçîÎßÅ
        document.addEventListener('DOMContentLoaded', function() {
            generateMonthView(currentYear, currentMonth);
            updateDateDisplay();
            updateScheduleList();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ìº˜ë¦°ë” - Lego</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="users-data.js"></script>
    <script src="projects-data.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --bg-gray: #f4f6f8;
            --border-color: #e5e7eb;
            --primary-blue: #2563eb;
            --text-dark: #1e293b;
            --task-blue-bg: #dbeafe; --task-blue-text: #1e40af; --task-blue-border: #3b82f6;
            --task-green-bg: #dcfce7; --task-green-text: #166534; --task-green-border: #22c55e;
            --task-yellow-bg: #fef9c3; --task-yellow-text: #854d0e; --task-yellow-border: #eab308;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-gray);
            margin: 0; padding: 0;
            color: var(--text-dark);
            min-height: 100vh; display: flex; flex-direction: column;
            overflow-y: auto;
        }

        /* --- Header Navigation --- */
        .top-nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--primary-blue);
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-menu-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-menu-btn:hover {
            background: var(--bg-gray);
        }

        .nav-menu-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .logout-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--bg-gray);
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* --- Filter Bar --- */
        .filter-bar {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 15px 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .filter-group select {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            cursor: pointer;
        }

        /* --- Main Layout: Calendar + Schedule List --- */
        .content-wrapper {
            flex: 1;
            display: flex;
            gap: 15px;
            min-height: 0;
        }

        .calendar-section {
            flex: 2;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .schedule-list-section {
            flex: 1;
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .schedule-list-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 1rem;
        }

        .schedule-list-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            min-height: 0;
            max-height: 100%;
        }
        
        .schedule-list-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .schedule-list-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .schedule-list-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .schedule-list-content::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .schedule-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .schedule-item:hover {
            background: var(--bg-gray);
            border-color: var(--border-color);
        }

        .schedule-item.selected {
            background: #eff6ff;
            border-color: var(--primary-blue);
        }

        .schedule-item.highlighted {
            background: #eff6ff !important;
            border-color: var(--primary-blue) !important;
            border-width: 2px !important;
        }

        .schedule-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .schedule-number.blue {
            background: var(--task-blue-border);
            color: white;
        }

        .schedule-number.green {
            background: var(--task-green-border);
            color: white;
        }

        .schedule-number.yellow {
            background: var(--task-yellow-border);
            color: white;
        }

        .schedule-info {
            flex: 1;
            min-width: 0;
        }

        .schedule-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .schedule-time {
            font-size: 0.75rem;
            color: #64748b;
        }

        /* --- Detail Panel --- */
        .detail-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent; /* íˆ¬ëª…ë„ ì œê±° */
            z-index: 100003;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .detail-panel-overlay.show {
            display: block;
            opacity: 1;
        }
        
        .detail-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            padding: 25px;
            padding-top: 50px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
            z-index: 100004;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            display: block;
        }

        .detail-panel.show {
            transform: translateY(0);
        }
        
        .detail-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .detail-panel::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .detail-panel::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        .detail-panel::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .detail-project-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-row {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            width: 120px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #64748b;
            flex-shrink: 0;
        }

        .detail-value {
            flex: 1;
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.6;
            white-space: normal;
        }

        .close-detail-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f1f5f9;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            line-height: 1;
            padding: 4px 10px;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-detail-btn:hover {
            background: #e2e8f0;
            color: var(--text-dark);
        }

        /* --- Calendar Styles --- */
        .toolbar {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            position: relative;
            z-index: 100002;
        }

        .date-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-button {
            background: white;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-dark);
            transition: all 0.2s;
        }

        .nav-button:hover {
            background: var(--bg-gray);
        }

        .current-date {
            font-size: 1.1rem;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }

        .view-switch {
            display: flex;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 8px;
        }

        .view-switch button {
            border: none;
            background: none;
            padding: 6px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: #64748b;
        }

        .view-switch button.active {
            background: #e2e8f0;
            color: var(--text-dark);
            box-shadow: none;
            font-weight: 500;
        }

        .legend-wrapper {
            position: relative;
            margin-left: 10px;
            z-index: 100001;
        }

        .legend-btn {
            background: #f1f5f9;
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .legend-popup {
            display: none;
            position: absolute;
            top: 40px;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            width: 220px;
            z-index: 100000 !important;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .legend-wrapper:hover .legend-popup {
            display: block;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* --- Calendar Grid --- */
        .calendar-grid {
            flex: 1;
            overflow: auto;
            display: none;
        }
        
        .calendar-grid.week-view {
            grid-template-columns: 80px repeat(5, 1fr);
            grid-template-rows: 45px repeat(10, 80px);
        }
        
        .calendar-grid.month-view {
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 45px repeat(5, 120px);
            position: relative;
            overflow: visible;
        }
        
        .calendar-grid.active {
            display: grid !important;
        }

        .calendar-grid.month-view .cell[data-date] {
            position: relative;
            z-index: 1;
            overflow: visible;
        }

        .calendar-grid.day-view {
            grid-template-columns: 80px 1fr;
            grid-template-rows: 45px repeat(24, 60px);
        }

        .cell {
            border: 1px solid var(--border-color);
            position: relative;
        }

        .cell-header {
            background: #fafafa;
            font-weight: 600;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .time-label {
            background: #fafafa;
            font-size: 0.75rem;
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .week-view .cell:not(.cell-header):not(.time-label),
        .day-view .cell:not(.cell-header):not(.time-label) {
            overflow: visible;
        }

        .month-view-cell {
            min-height: 120px;
            padding: 8px;
            vertical-align: top;
            position: relative;
            cursor: pointer;
        }

        .month-view-cell .date-number {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .schedule-indicator {
            margin-top: 5px;
            overflow: visible;
        }

        .task {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            min-height: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 1;
            padding: 4px 8px;
            border-radius: 6px;
            border-left: 4px solid;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
        }

        .task:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: visible;
        }

        .task.blue {
            background: var(--task-blue-bg);
            color: var(--task-blue-text);
            border-left-color: var(--task-blue-border);
        }

        .task.green {
            background: var(--task-green-bg);
            color: var(--task-green-text);
            border-left-color: var(--task-green-border);
        }

        .task.yellow {
            background: var(--task-yellow-bg);
            color: var(--task-yellow-text);
            border-left-color: var(--task-yellow-border);
        }

        .task-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        .task-detail-tooltip {
            display: none;
            position: absolute;
            left: 50%;
            bottom: 100%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: normal;
            pointer-events: none;
        }

        .task-detail-tooltip.force-show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10000 !important;
        }

        .task-hover-area {
            background: rgba(255,0,0,0);
            z-index: 100;
            pointer-events: auto;
        }

        .month-task-bar {
            position: absolute;
            height: 22px;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.65rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            cursor: pointer;
            border-left: 3px solid;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 10000;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .month-task-bar.blue {
            background: var(--task-blue-bg);
            color: var(--task-blue-text);
            border-left-color: var(--task-blue-border);
        }

        .month-task-bar.green {
            background: var(--task-green-bg);
            color: var(--task-green-text);
            border-left-color: var(--task-green-border);
        }

        .month-task-bar.yellow {
            background: var(--task-yellow-bg);
            color: var(--task-yellow-text);
            border-left-color: var(--task-yellow-border);
        }

        .month-task-bar.same-task-highlight {
            outline: 3px solid var(--primary-blue);
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
            transform: scale(1.02);
            z-index: 10001;
        }

        .month-task-tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 12px;
            min-width: 180px;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-size: 0.75rem;
            line-height: 1.4;
            white-space: normal;
            z-index: 99999;
            pointer-events: none;
        }

        .month-task-bar:hover .month-task-tooltip {
            display: block;
        }

        #prev-btn, #next-btn {
            z-index: 50000;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="top-nav">
        <div class="nav-left">
            <h1>ğŸ§± Lego</h1>
            <div class="nav-menu" id="navMenu">
                <!-- ì—­í• ë³„ ë©”ë‰´ëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
            </div>
        </div>
        <div class="nav-right">
            <div class="user-info" id="userInfo"></div>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content">
        <!-- í•„í„° ë°” -->
        <div class="filter-bar">
            <div class="filter-group">
                <label>íŒŒíŠ¸ë³„</label>
                <select id="filter-team" onchange="applyFilters()">
                    <option value="all">ì „ì²´</option>
                    <option value="dev">ê°œë°œíŒ€</option>
                    <option value="design">ë””ìì¸íŒ€</option>
                </select>
            </div>
            <div class="filter-group">
                <label>í”„ë¡œì íŠ¸ë³„</label>
                <select id="filter-project" onchange="applyFilters()">
                    <option value="all">ì „ì²´</option>
                    <option value="project-a">í”„ë¡œì íŠ¸ A</option>
                    <option value="project-b">í”„ë¡œì íŠ¸ B</option>
                </select>
            </div>
            <div class="filter-group">
                <label>ê°œì¸ë³„</label>
                <select id="filter-user" disabled>
                    <option value="me">ë‚´ ì¼ì •</option>
                </select>
            </div>
        </div>

        <!-- ìº˜ë¦°ë” + ì¼ì • ë¦¬ìŠ¤íŠ¸ -->
        <div class="content-wrapper">
            <!-- ìº˜ë¦°ë” ì„¹ì…˜ -->
            <div class="calendar-section">
                <div class="toolbar">
                    <div class="date-nav">
                        <button class="nav-button" id="prev-btn" onclick="navigate('prev')">â—€</button>
                        <div class="current-date" id="current-date">2023ë…„ 3ì›”</div>
                        <button class="nav-button" id="next-btn" onclick="navigate('next')">â–¶</button>
                    </div>

                    <div style="display: flex; align-items: center;">
                        <div class="view-switch">
                            <button onclick="changeView(this)" data-view="month" class="active">ì›”</button>
                            <button onclick="changeView(this)" data-view="week">ì£¼</button>
                            <button onclick="changeView(this)" data-view="day">ì¼</button>
                        </div>
                        <div class="legend-wrapper">
                            <button class="legend-btn">ğŸ¨ ë¶„ë¥˜</button>
                            <div class="legend-popup">
                                <div class="legend-item">
                                    <div class="dot" style="background: var(--task-blue-border);"></div>
                                    <span>ê¸°íš</span>
                                </div>
                                <div class="legend-item">
                                    <div class="dot" style="background: var(--task-green-border);"></div>
                                    <span>ê°œë°œ</span>
                                </div>
                                <div class="legend-item">
                                    <div class="dot" style="background: var(--task-yellow-border);"></div>
                                    <span>ë””ìì¸</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì›”ë³„ ë·° -->
                <div class="calendar-grid month-view active" id="month-grid"></div>

                <!-- ì£¼ë³„ ë·° -->
                <div class="calendar-grid week-view" id="week-grid"></div>

                <!-- ì¼ë³„ ë·° -->
                <div class="calendar-grid day-view" id="day-grid"></div>
            </div>

            <!-- ì¼ì • ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div class="schedule-list-section">
                <div class="schedule-list-header" id="schedule-list-title">
                    ğŸ“‹ ì¼ì • ë¦¬ìŠ¤íŠ¸
                </div>
                <div class="schedule-list-content" id="schedule-list"></div>
            </div>
        </div>

        <!-- ìƒì„¸ì •ë³´ íŒ¨ë„ ì˜¤ë²„ë ˆì´ -->
        <div class="detail-panel-overlay" id="detail-panel-overlay" onclick="closeDetailPanel()"></div>
        
        <!-- ìƒì„¸ì •ë³´ íŒ¨ë„ -->
        <div class="detail-panel" id="detail-panel" onclick="event.stopPropagation()">
            <button class="close-detail-btn" onclick="closeDetailPanel()">Ã—</button>
            <div class="detail-project-title" id="detail-project-title">-</div>
            <div class="detail-section">
                <div class="detail-section-title">ğŸ“Œ í…ŒìŠ¤í¬ ì •ë³´</div>
                <div class="detail-row">
                    <div class="detail-label">ì œëª©</div>
                    <div class="detail-value" id="detail-task-title">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ì¹´í…Œê³ ë¦¬</div>
                    <div class="detail-value" id="detail-task-category">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ë‹´ë‹¹ì</div>
                    <div class="detail-value" id="detail-task-user">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ì¼ì •</div>
                    <div class="detail-value" id="detail-task-schedule">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">í• ë‹¹ ì‹œê°„</div>
                    <div class="detail-value" id="detail-task-hours">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ë¹„ê³ </div>
                    <div class="detail-value" id="detail-task-note">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì¸ì¦ ì²´í¬
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if (!currentUser) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        document.getElementById('userInfo').textContent = `${currentUser.name} (${getRoleName(currentUser.role)})`;

        // í˜„ì¬ í˜ì´ì§€ ê°ì§€
        const currentPage = window.location.pathname.split('/').pop() || 'my_calendar.html';
        
        // í†µì¼ëœ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ë Œë”ë§
        function renderNavigation() {
            const navMenu = document.getElementById('navMenu');
            let menuHTML = '';
            
            // ê´€ë¦¬ì: ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ, ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ë“±ë¡, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬
            if (currentUser.role === 'admin') {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'admin.html' ? 'active' : ''}" onclick="location.href='admin.html'">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_register.html' ? 'active' : ''}" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            // íŒ€ì¥: íŒ€ì¥ ëŒ€ì‹œë³´ë“œ, ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ë“±ë¡, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬
            else if (currentUser.role === 'teamlead') {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'teamlead.html' ? 'active' : ''}" onclick="location.href='teamlead.html'">íŒ€ì¥ ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_register.html' ? 'active' : ''}" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            // íŒ€ì›: ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬ (íŒ€ì¥ ëŒ€ì‹œë³´ë“œ, í”„ë¡œì íŠ¸ ë“±ë¡ ì œì™¸)
            else {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            
            navMenu.innerHTML = menuHTML;
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
        renderNavigation();

        function getRoleName(role) {
            const roleNames = {
                'admin': 'ê´€ë¦¬ì',
                'teamlead': 'íŒ€ì¥',
                'user': 'íŒ€ì›'
            };
            return roleNames[role] || 'ì‚¬ìš©ì';
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // ë°ì´í„° ë¡œë“œ (users-data.js, projects-data.jsì—ì„œ)
        let USERS = {};
        let CATEGORIES = {};
        let PROJECTS = {};
        let TASKS = {};
        
        function loadMockData() {
            try {
                // USERS_DATAì—ì„œ ë¡œë“œ
                if (typeof USERS_DATA !== 'undefined' && USERS_DATA.users) {
                    USERS = {};
                    USERS_DATA.users.forEach(user => {
                        USERS[user.id] = { name: user.name, team: user.team };
                    });
                    CATEGORIES = USERS_DATA.categories || {};
                }
                
                // PROJECTS_DATAì—ì„œ ë¡œë“œ
                if (typeof PROJECTS_DATA !== 'undefined') {
                    if (PROJECTS_DATA.projects) {
                        PROJECTS = {};
                        PROJECTS_DATA.projects.forEach(project => {
                            PROJECTS[project.id] = {
                                name: project.name,
                                standardHours: 0,
                                assignedHours: 0
                            };
                        });
                    }
                    
                    // tasksë¥¼ ê°ì²´ë¡œ ë³€í™˜
                    if (PROJECTS_DATA.tasks) {
                        TASKS = {};
                        PROJECTS_DATA.tasks.forEach(task => {
                            TASKS[task.id] = {
                                taskId: task.id,
                                title: task.ì†Œë¶„ë¥˜ || task.ì¤‘ë¶„ë¥˜ || task.title,
                                category: getCategoryFromMajor(task.ëŒ€ë¶„ë¥˜) || task.category || 'planning',
                                standardHours: task.ê¸°ì¤€ì‹œê°„ || task.totalHours || 0,
                                projectId: task.projectId
                            };
                        });
                    }
                }
            } catch (error) {
                console.error('ëª©ì—… ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        loadMockData();
        
        function getCategoryFromMajor(ëŒ€ë¶„ë¥˜) {
            if (!ëŒ€ë¶„ë¥˜) return 'planning';
            if (ëŒ€ë¶„ë¥˜.includes('ê¸°íš') || ëŒ€ë¶„ë¥˜.includes('í–‰ì‚¬') || ëŒ€ë¶„ë¥˜.includes('ê²½ì˜')) {
                return 'planning';
            } else if (ëŒ€ë¶„ë¥˜.includes('ê°œë°œ') || ëŒ€ë¶„ë¥˜.includes('ì¬ë¬´')) {
                return 'development';
            } else if (ëŒ€ë¶„ë¥˜.includes('ë””ìì¸') || ëŒ€ë¶„ë¥˜.includes('ì‹œê°')) {
                return 'design';
            }
            return 'planning';
        }

        // localStorageì—ì„œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ
        let TASK_ASSIGNMENTS = [];
        let filteredAssignments = [];
        let lastScheduleDataHash = null; // ì´ì „ ë°ì´í„° í•´ì‹œ ì €ì¥
        
        function getSchedulesForDate(dateStr) {
            const schedules = [];
            filteredAssignments.forEach(assignment => {
                if (dateStr >= assignment.startDate && dateStr <= assignment.endDate) {
                    // TASKSì—ì„œ ì°¾ê±°ë‚˜, assignmentì— ì´ë¯¸ titleì´ ìˆìœ¼ë©´ ì‚¬ìš©
                    const task = TASKS[assignment.taskId];
                    schedules.push({
                        ...assignment,
                        title: task ? task.title : (assignment.title || 'í…ŒìŠ¤í¬'),
                        category: task ? task.category : (assignment.category || 'planning'),
                        projectId: task ? task.projectId : (assignment.projectId || 'project-unknown')
                    });
                }
            });
            return schedules;
        }

        const SCHEDULE_DATA = new Proxy({}, {
            get: function(target, dateStr) {
                if (typeof dateStr !== 'string' || !dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    return target[dateStr];
                }
                if (!target[dateStr]) {
                    target[dateStr] = getSchedulesForDate(dateStr);
                }
                return target[dateStr];
            }
        });
        
        function loadSchedulesFromLocalStorage() {
            // localStorageì—ì„œ ë¡œë“œ
            const saved = localStorage.getItem('projectSchedules');
            if (!saved) {
                return;
            }
            
            // ë°ì´í„° í•´ì‹œ ê³„ì‚° (ê°„ë‹¨í•œ ë¬¸ìì—´ ê¸¸ì´ì™€ ë‚´ìš© ê¸°ë°˜)
            const currentHash = saved.length + saved.substring(0, 100);
            
            // ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë·° ì¬ìƒì„±í•˜ì§€ ì•ŠìŒ
            if (lastScheduleDataHash === currentHash) {
                return;
            }
            
            lastScheduleDataHash = currentHash;
            
            let data;
            try {
                data = JSON.parse(saved);
            } catch (e) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', e);
                return;
            }
            
            if (data) {
                try {
                    const schedules = data.schedules || [];
                    
                    // ìŠ¤ì¼€ì¤„ì„ TASK_ASSIGNMENTS í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    TASK_ASSIGNMENTS = schedules.map(schedule => {
                        // ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ì†Œë¶„ë¥˜ ê¸°ì¤€)
                        let category = 'planning';
                        if (schedule.task && schedule.task.ì†Œë¶„ë¥˜) {
                            const ì†Œë¶„ë¥˜ = schedule.task.ì†Œë¶„ë¥˜.toLowerCase();
                            if (ì†Œë¶„ë¥˜.includes('ê°œë°œ') || ì†Œë¶„ë¥˜.includes('api') || ì†Œë¶„ë¥˜.includes('ì•±')) {
                                category = 'development';
                            } else if (ì†Œë¶„ë¥˜.includes('ë””ìì¸') || ì†Œë¶„ë¥˜.includes('ui') || ì†Œë¶„ë¥˜.includes('ë¸Œëœë”©')) {
                                category = 'design';
                            }
                        }
                        
                        // ì‚¬ìš©ì ID ë§¤í•‘ (ì´ë¦„ ê¸°ì¤€)
                        let userId = schedule.userId || schedule.userName;
                        if (schedule.userName === 'ì´ê²½ìˆ˜' || schedule.userName === 'ê¹€ì² ìˆ˜') {
                            userId = 'user-kim';
                        } else if (schedule.userName === 'ë¬¸ì •ì„' || schedule.userName === 'ì´ì˜í¬') {
                            userId = 'user-lee';
                        }
                        
                        return {
                            taskId: schedule.taskId,
                            user: userId,
                            startDate: schedule.startDate,
                            endDate: schedule.endDate,
                            startTime: schedule.startTime,
                            endTime: schedule.endTime,
                            assignedHours: schedule.assignedHours || 0,
                            title: schedule.task ? (schedule.task.ì†Œë¶„ë¥˜ || schedule.task.ì‚¬ì—…ëª… || 'í…ŒìŠ¤í¬') : 'í…ŒìŠ¤í¬',
                            category: category,
                            projectId: schedule.task ? schedule.task.ì‚¬ì—…ëª… : 'project-unknown',
                            note: schedule.task ? (schedule.task.ë¹„ê³  || schedule.note || '') : (schedule.note || '')
                        };
                    });
                    
                    // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì¼ì •ë§Œ í•„í„°ë§
                    filteredAssignments = TASK_ASSIGNMENTS.filter(assignment => {
                        // userId ë§¤ì¹­
                        if (assignment.user === currentUser.userId) return true;
                        
                        // ì´ë¦„ ë§¤ì¹­ (ì´ê²½ìˆ˜/ë¬¸ì •ì„)
                        if (currentUser.name === 'ì´ê²½ìˆ˜' && assignment.user === 'user-kim') return true;
                        if (currentUser.name === 'ë¬¸ì •ì„' && assignment.user === 'user-lee') return true;
                        
                        // ì´ì „ ë°ì´í„° í˜¸í™˜ì„± (ê¹€ì² ìˆ˜/ì´ì˜í¬)
                        if (currentUser.name === 'ì´ê²½ìˆ˜' && (assignment.user === 'ê¹€ì² ìˆ˜' || assignment.user === 'ì´ê²½ìˆ˜')) return true;
                        if (currentUser.name === 'ë¬¸ì •ì„' && (assignment.user === 'ì´ì˜í¬' || assignment.user === 'ë¬¸ì •ì„')) return true;
                        
                        return false;
                    });
                    
                    // SCHEDULE_DATA ìºì‹œ ì´ˆê¸°í™”
                    for (let key in SCHEDULE_DATA) {
                        if (key.match(/^\d{4}-\d{2}-\d{2}$/)) {
                            delete SCHEDULE_DATA[key];
                        }
                    }
                    
                    // ë·° ì¬ìƒì„±
                    const activeView = document.querySelector('.view-switch button.active')?.getAttribute('data-view') || 'month';
                    if (activeView === 'month') {
                        generateMonthView(currentYear, currentMonth);
                    } else if (activeView === 'week') {
                        const weekDates = getWeekDates(currentWeekStart);
                        generateWeekView(weekDates);
                    } else if (activeView === 'day') {
                        const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                        generateDayView(currentDayDate, dateStr);
                    }
                    updateDateDisplay();
                    updateScheduleList();
                } catch (e) {
                    console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', e);
                }
            }
        }
        
        // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë‚ ì§œ (ì˜¤ëŠ˜ë¡œ ì„¤ì •) - loadSchedulesFromLocalStorage í˜¸ì¶œ ì „ì— ì„ ì–¸ í•„ìš”
        const today = new Date();
        let currentYear = today.getFullYear();
        let currentMonth = today.getMonth() + 1;
        // ì´ë²ˆ ì£¼ ì›”ìš”ì¼ ê³„ì‚°
        const dayOfWeek = today.getDay();
        const monday = new Date(today);
        monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
        let currentWeekStart = monday;
        let currentDayDate = new Date(today);
        let selectedSchedule = null;

        // ì´ˆê¸° ë¡œë“œ
        loadSchedulesFromLocalStorage();
        
        // localStorage ë³€ê²½ ê°ì§€ (ë‹¤ë¥¸ íƒ­ì—ì„œ ìŠ¤ì¼€ì¤„ ë“±ë¡ ì‹œ)
        window.addEventListener('storage', function(e) {
            if (e.key === 'projectSchedules') {
                loadSchedulesFromLocalStorage();
            }
        });
        
        // ì£¼ê¸°ì ìœ¼ë¡œ ì²´í¬ (ê°™ì€ íƒ­ì—ì„œë„ ì—…ë°ì´íŠ¸) - ë°ì´í„° ë³€ê²½ ì‹œì—ë§Œ ì—…ë°ì´íŠ¸
        setInterval(function() {
            loadSchedulesFromLocalStorage();
        }, 10000); // 3ì´ˆì—ì„œ 10ì´ˆë¡œ ë³€ê²½í•˜ì—¬ ê¹œë¹¡ì„ ê°ì†Œ

        // í•„í„° ì ìš©
        function applyFilters() {
            const teamFilter = document.getElementById('filter-team').value;
            const projectFilter = document.getElementById('filter-project').value;

            filteredAssignments = TASK_ASSIGNMENTS.filter(assignment => {
                if (assignment.user !== currentUser.userId) return false;

                const user = USERS[assignment.user];
                const task = TASKS[assignment.taskId];

                if (teamFilter !== 'all' && user.team !== teamFilter) return false;
                if (projectFilter !== 'all' && task.projectId !== projectFilter) return false;

                return true;
            });

            // SCHEDULE_DATA ìºì‹œ ì´ˆê¸°í™”
            for (let key in SCHEDULE_DATA) {
                if (key.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    delete SCHEDULE_DATA[key];
                }
            }

            // í˜„ì¬ ë·° ì¬ìƒì„±
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');
            if (activeView === 'month') {
                generateMonthView(currentYear, currentMonth);
            } else if (activeView === 'week') {
                const weekDates = getWeekDates(currentWeekStart);
                generateWeekView(weekDates);
            } else if (activeView === 'day') {
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                generateDayView(currentDayDate, dateStr);
            }

            updateScheduleList();
        }

        // ë·° ì „í™˜
        function changeView(btn) {
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const view = btn.getAttribute('data-view');
            document.querySelectorAll('.calendar-grid').forEach(grid => grid.classList.remove('active'));

            if (view === 'month') {
                document.getElementById('month-grid').classList.add('active');
                generateMonthView(currentYear, currentMonth);
                updateDateDisplay();
            } else if (view === 'week') {
                document.getElementById('week-grid').classList.add('active');
                const weekDates = getWeekDates(currentWeekStart);
                generateWeekView(weekDates);
                updateDateDisplay();
            } else if (view === 'day') {
                document.getElementById('day-grid').classList.add('active');
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                generateDayView(currentDayDate, dateStr);
                updateDateDisplay();
            }

            updateScheduleList();
        }

        // ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateDateDisplay() {
            const dateDisplay = document.getElementById('current-date');
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');

            if (activeView === 'month') {
                dateDisplay.textContent = `${currentYear}ë…„ ${currentMonth}ì›”`;
            } else if (activeView === 'week') {
                const weekEnd = new Date(currentWeekStart);
                weekEnd.setDate(weekEnd.getDate() + 4);
                dateDisplay.textContent = `${currentWeekStart.getFullYear()}ë…„ ${currentWeekStart.getMonth() + 1}ì›” ${currentWeekStart.getDate()}ì¼ ~ ${weekEnd.getMonth() + 1}ì›” ${weekEnd.getDate()}ì¼`;
            } else if (activeView === 'day') {
                dateDisplay.textContent = `${currentDayDate.getFullYear()}ë…„ ${currentDayDate.getMonth() + 1}ì›” ${currentDayDate.getDate()}ì¼`;
            }
        }

        // ì¼ì • ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateScheduleList() {
            const listContainer = document.getElementById('schedule-list');
            const listTitle = document.getElementById('schedule-list-title');
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');

            let schedules = [];
            let titleText = '';

            if (activeView === 'month') {
                titleText = `ğŸ“‹ ${currentYear}ë…„ ${currentMonth}ì›” ì¼ì •`;
                const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const daySchedules = SCHEDULE_DATA[dateStr] || [];
                    schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                }
            } else if (activeView === 'week') {
                const weekEnd = new Date(currentWeekStart);
                weekEnd.setDate(weekEnd.getDate() + 4);
                titleText = `ğŸ“‹ ${currentWeekStart.getMonth() + 1}/${currentWeekStart.getDate()} ~ ${weekEnd.getMonth() + 1}/${weekEnd.getDate()} ì¼ì •`;
                
                const weekDates = getWeekDates(currentWeekStart);
                weekDates.forEach(date => {
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    const daySchedules = SCHEDULE_DATA[dateStr] || [];
                    schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                });
            } else if (activeView === 'day') {
                titleText = `ğŸ“‹ ${currentDayDate.getMonth() + 1}ì›” ${currentDayDate.getDate()}ì¼ ì¼ì •`;
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                const daySchedules = SCHEDULE_DATA[dateStr] || [];
                schedules = daySchedules.map(s => ({ ...s, date: dateStr }));
            }

            listTitle.textContent = titleText;

            if (schedules.length === 0) {
                listContainer.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 40px 20px;">ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            listContainer.innerHTML = '';
            schedules.forEach((schedule, index) => {
                const category = CATEGORIES[schedule.category];
                const task = TASKS[schedule.taskId];
                
                const scheduleItem = document.createElement('div');
                scheduleItem.className = 'schedule-item';
                scheduleItem.setAttribute('data-task-id', schedule.taskId);
                scheduleItem.setAttribute('data-user', schedule.user);
                scheduleItem.setAttribute('data-schedule', JSON.stringify(schedule));
                scheduleItem.onclick = () => showScheduleDetail(schedule);

                // í˜¸ë²„ ì‹œ ë™ì¼í•œ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸
                scheduleItem.addEventListener('mouseenter', () => {
                    highlightRelatedTasks(schedule);
                });

                scheduleItem.addEventListener('mouseleave', () => {
                    unhighlightRelatedTasks(schedule);
                });

                scheduleItem.innerHTML = `
                    <div class="schedule-number ${category.color}">${index + 1}</div>
                    <div class="schedule-info">
                        <div class="schedule-title">${schedule.title}</div>
                        <div class="schedule-time">${schedule.date} ${schedule.startTime} ~ ${schedule.endTime}</div>
                    </div>
                `;

                listContainer.appendChild(scheduleItem);
            });
        }

        // ì‹œê°„ ê³„ì‚° í—¬í¼ í•¨ìˆ˜
        function calculateHours(startTime, endTime) {
            if (startTime === '00:00' && endTime === '23:59') {
                return 24; // ì¢…ì¼
            }
            const start = startTime.split(':').map(Number);
            const end = endTime.split(':').map(Number);
            const startMinutes = start[0] * 60 + start[1];
            const endMinutes = end[0] * 60 + end[1];
            const diffMinutes = endMinutes - startMinutes;
            return diffMinutes / 60; // ì‹œê°„ ë‹¨ìœ„ë¡œ ë°˜í™˜
        }

        // ì¼ì • í¬ë§·íŒ… í•¨ìˆ˜ (ì—¬ëŸ¬ ë‚ ì§œì— ê±¸ì¹œ ì¼ì •ì„ ë‚ ì§œë³„ë¡œ í‘œì‹œ)
        function formatScheduleDisplay(schedule) {
            const taskId = schedule.taskId;
            const user = schedule.user;
            
            // ë™ì¼í•œ í…ŒìŠ¤í¬ì™€ ì‚¬ìš©ìì˜ ëª¨ë“  í• ë‹¹ ì°¾ê¸°
            const relatedAssignments = filteredAssignments.filter(assignment => 
                assignment.taskId === taskId && assignment.user === user
            );
            
            if (relatedAssignments.length === 0) {
                const hours = calculateHours(schedule.startTime, schedule.endTime);
                return `${schedule.startDate} ${schedule.startTime} ~ ${schedule.endTime} (${hours}ì‹œê°„)`;
            }
            
            // ê° í• ë‹¹ì„ ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™” (ì‹¤ì œ í• ë‹¹ëœ ë‚ ì§œì™€ ì‹œê°„ë§Œ í‘œì‹œ)
            const dateGroups = {};
            relatedAssignments.forEach(assignment => {
                const startDateStr = assignment.startDate;
                const endDateStr = assignment.endDate;
                
                if (startDateStr === endDateStr) {
                    // ê°™ì€ ë‚ ì§œ - í•´ë‹¹ ë‚ ì§œì— ì‹œê°„ í‘œì‹œ
                    if (!dateGroups[startDateStr]) {
                        dateGroups[startDateStr] = [];
                    }
                    dateGroups[startDateStr].push({
                        startTime: assignment.startTime,
                        endTime: assignment.endTime
                    });
                } else {
                    // ì—¬ëŸ¬ ë‚ ì— ê±¸ì¹œ í• ë‹¹ - ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ë§Œ í‘œì‹œ
                    // ì‹œì‘ì¼
                    if (!dateGroups[startDateStr]) {
                        dateGroups[startDateStr] = [];
                    }
                    dateGroups[startDateStr].push({
                        startTime: assignment.startTime,
                        endTime: '23:59'
                    });
                    
                    // ì¢…ë£Œì¼
                    if (!dateGroups[endDateStr]) {
                        dateGroups[endDateStr] = [];
                    }
                    dateGroups[endDateStr].push({
                        startTime: '00:00',
                        endTime: assignment.endTime
                    });
                    
                    // ì¤‘ê°„ ë‚ ì§œëŠ” ë‹¤ë¥¸ í• ë‹¹ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                    // (ì‹¤ì œë¡œ ì¤‘ê°„ ë‚ ì§œì— í• ë‹¹ì´ ìˆìœ¼ë©´ ë³„ë„ì˜ assignmentë¡œ ì¡´ì¬í•¨)
                }
            });
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ í‘œì‹œ
            const sortedDates = Object.keys(dateGroups).sort();
            const scheduleLines = sortedDates.map(dateStr => {
                const timeSlots = dateGroups[dateStr];
                // ê°™ì€ ë‚ ì§œì— ì—¬ëŸ¬ ì‹œê°„ëŒ€ê°€ ìˆìœ¼ë©´ ëª¨ë‘ í‘œì‹œ
                // ì¤‘ë³µ ì œê±° ë° ì •ë ¬
                const uniqueTimeSlots = [];
                timeSlots.forEach(slot => {
                    const exists = uniqueTimeSlots.some(existing => 
                        existing.startTime === slot.startTime && existing.endTime === slot.endTime
                    );
                    if (!exists) {
                        uniqueTimeSlots.push(slot);
                    }
                });
                
                // ì‹œê°„ëŒ€ ì •ë ¬
                uniqueTimeSlots.sort((a, b) => a.startTime.localeCompare(b.startTime));
                
                const timeDisplay = uniqueTimeSlots.map(slot => {
                    const hours = calculateHours(slot.startTime, slot.endTime);
                    if (slot.startTime === '00:00' && slot.endTime === '23:59') {
                        return `ì¢…ì¼ (${hours}ì‹œê°„)`;
                    }
                    return `${slot.startTime} ~ ${slot.endTime} (${hours}ì‹œê°„)`;
                }).join(', ');
                
                return `${dateStr} ${timeDisplay}`;
            });
            
            return scheduleLines.join('<br>');
        }

        // ì¼ì • ë¦¬ìŠ¤íŠ¸ì—ì„œ í´ë¦­ ì‹œ ìƒì„¸ì •ë³´ í‘œì‹œ
        function showScheduleDetail(schedule) {
            selectedSchedule = schedule;

            // ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ ì„ íƒ í‘œì‹œ
            document.querySelectorAll('.schedule-item').forEach(item => item.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            const task = TASKS[schedule.taskId];
            const category = CATEGORIES[schedule.category];
            const user = USERS[schedule.user];
            const project = PROJECTS[schedule.projectId];

            // í”„ë¡œì íŠ¸ íƒ€ì´í‹€
            document.getElementById('detail-project-title').textContent = project.name;

            // í…ŒìŠ¤í¬ ì •ë³´
            document.getElementById('detail-task-title').textContent = schedule.title;
            document.getElementById('detail-task-category').textContent = category.name;
            document.getElementById('detail-task-user').textContent = user.name;
            document.getElementById('detail-task-schedule').innerHTML = formatScheduleDisplay(schedule);
            document.getElementById('detail-task-hours').textContent = `${schedule.assignedHours}ì‹œê°„`;
            document.getElementById('detail-task-note').textContent = schedule.note || '-';

            // íŒ¨ë„ í‘œì‹œ
            document.getElementById('detail-panel-overlay').classList.add('show');
            document.getElementById('detail-panel').classList.add('show');
            
            // ëª¨ë“  taskì™€ task-barì˜ z-indexë¥¼ íŒ¨ë„ë³´ë‹¤ ë‚®ê²Œ ì„¤ì •
            document.querySelectorAll('.task, .month-task-bar').forEach(el => {
                el.style.zIndex = '1';
            });
        }

        // ìº˜ë¦°ë”ì—ì„œ í´ë¦­ ì‹œ ìƒì„¸ì •ë³´ í‘œì‹œ (ì˜¤ë¥¸ìª½ ë¦¬ìŠ¤íŠ¸ì™€ ì—°ë™)
        function showScheduleDetailFromCalendar(schedule) {
            console.log('showScheduleDetailFromCalendar í˜¸ì¶œë¨:', schedule);
            selectedSchedule = schedule;

            // taskì—ì„œ categoryì™€ projectId ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const task = TASKS[schedule.taskId];
            if (!task) {
                console.error('Taskë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', schedule.taskId);
                alert('ì¼ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const category = CATEGORIES[task.category];  // taskì—ì„œ category ê°€ì ¸ì˜¤ê¸°
            const user = USERS[schedule.user];
            const project = PROJECTS[task.projectId];    // taskì—ì„œ projectId ê°€ì ¸ì˜¤ê¸°

            if (!category || !user || !project) {
                console.error('ë°ì´í„° ëˆ„ë½:', { task, category, user, project, schedule });
                alert('ì¼ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í”„ë¡œì íŠ¸ íƒ€ì´í‹€
            document.getElementById('detail-project-title').textContent = project.name;

            // í…ŒìŠ¤í¬ ì •ë³´
            document.getElementById('detail-task-title').textContent = task.title;
            document.getElementById('detail-task-category').textContent = category.name;
            document.getElementById('detail-task-user').textContent = user.name;
            document.getElementById('detail-task-schedule').innerHTML = formatScheduleDisplay(schedule);
            document.getElementById('detail-task-hours').textContent = `${schedule.assignedHours}ì‹œê°„`;
            document.getElementById('detail-task-note').textContent = schedule.note || '-';

            // ì˜¤ë¥¸ìª½ ë¦¬ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ ì¼ì • ì°¾ì•„ì„œ ì„ íƒ í‘œì‹œ
            const scheduleItems = document.querySelectorAll('.schedule-item');
            scheduleItems.forEach(item => {
                item.classList.remove('selected');
                
                // ì¼ì • ë¦¬ìŠ¤íŠ¸ì˜ ê° ì•„ì´í…œê³¼ ë¹„êµ (taskId, user, startDateë¡œ ë§¤ì¹­)
                const itemIndex = Array.from(scheduleItems).indexOf(item);
                const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');
                
                let schedules = [];
                if (activeView === 'month') {
                    const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const daySchedules = SCHEDULE_DATA[dateStr] || [];
                        schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                    }
                } else if (activeView === 'week') {
                    const weekDates = getWeekDates(currentWeekStart);
                    weekDates.forEach(date => {
                        const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                        const daySchedules = SCHEDULE_DATA[dateStr] || [];
                        schedules.push(...daySchedules.map(s => ({ ...s, date: dateStr })));
                    });
                } else if (activeView === 'day') {
                    const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                    const daySchedules = SCHEDULE_DATA[dateStr] || [];
                    schedules = daySchedules.map(s => ({ ...s, date: dateStr }));
                }

                // í•´ë‹¹ ì¸ë±ìŠ¤ì˜ ìŠ¤ì¼€ì¤„ê³¼ ë¹„êµ
                if (schedules[itemIndex]) {
                    const listSchedule = schedules[itemIndex];
                    if (listSchedule.taskId === schedule.taskId && 
                        listSchedule.user === schedule.user) {
                        item.classList.add('selected');
                    }
                }
            });

            // íŒ¨ë„ í‘œì‹œ
            console.log('íŒ¨ë„ í‘œì‹œ ì¤‘...');
            document.getElementById('detail-panel-overlay').classList.add('show');
            const detailPanel = document.getElementById('detail-panel');
            detailPanel.classList.add('show');
            console.log('íŒ¨ë„ í´ë˜ìŠ¤:', detailPanel.className);
            
            // ëª¨ë“  taskì™€ task-barì˜ z-indexë¥¼ íŒ¨ë„ë³´ë‹¤ ë‚®ê²Œ ì„¤ì •
            document.querySelectorAll('.task, .month-task-bar').forEach(el => {
                el.style.zIndex = '1';
            });
        }

        function closeDetailPanel() {
            document.getElementById('detail-panel-overlay').classList.remove('show');
            document.getElementById('detail-panel').classList.remove('show');
            document.querySelectorAll('.schedule-item').forEach(item => item.classList.remove('selected'));
            selectedSchedule = null;
            
            // taskì˜ z-index ë³µì› (í•˜ì´ë¼ì´íŠ¸ëœ ê²ƒë§Œ)
            document.querySelectorAll('.task').forEach(task => {
                if (task.style.outline && task.style.outline.includes('var(--primary-blue)')) {
                    // í•˜ì´ë¼ì´íŠ¸ëœ taskëŠ” ìœ ì§€í•˜ë˜ íŒ¨ë„ì´ ë‹«í˜”ìœ¼ë¯€ë¡œ z-indexë¥¼ ë†’ì¼ ìˆ˜ ìˆìŒ
                    task.style.zIndex = '10001';
                } else {
                    task.style.zIndex = '1';
                }
            });
        }

        // ë„¤ë¹„ê²Œì´ì…˜
        function navigate(direction) {
            const activeView = document.querySelector('.view-switch button.active').getAttribute('data-view');

            if (activeView === 'month') {
                if (direction === 'prev') {
                    currentMonth--;
                    if (currentMonth < 1) {
                        currentMonth = 12;
                        currentYear--;
                    }
                } else {
                    currentMonth++;
                    if (currentMonth > 12) {
                        currentMonth = 1;
                        currentYear++;
                    }
                }
                generateMonthView(currentYear, currentMonth);
                updateDateDisplay();
            } else if (activeView === 'week') {
                if (direction === 'prev') {
                    currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                } else {
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                }
                const weekDates = getWeekDates(currentWeekStart);
                generateWeekView(weekDates);
                updateDateDisplay();
            } else if (activeView === 'day') {
                if (direction === 'prev') {
                    currentDayDate.setDate(currentDayDate.getDate() - 1);
                } else {
                    currentDayDate.setDate(currentDayDate.getDate() + 1);
                }
                const dateStr = `${currentDayDate.getFullYear()}-${String(currentDayDate.getMonth() + 1).padStart(2, '0')}-${String(currentDayDate.getDate()).padStart(2, '0')}`;
                generateDayView(currentDayDate, dateStr);
                updateDateDisplay();
            }

            updateScheduleList();
        }

        // ì›”ë³„ ë·° ìƒì„±
        function generateMonthView(year, month) {
            if (!year || !month) {
                const today = new Date();
                year = year || today.getFullYear();
                month = month || today.getMonth() + 1;
            }
            const monthGrid = document.getElementById('month-grid');
            monthGrid.innerHTML = '';

            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();

            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'cell cell-header';
                header.textContent = day;
                monthGrid.appendChild(header);
            });

            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'cell month-view-cell';
                monthGrid.appendChild(emptyCell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'cell month-view-cell';
                const dateString = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                cell.setAttribute('data-date', dateString);

                const dateNumber = document.createElement('div');
                dateNumber.className = 'date-number';
                dateNumber.textContent = day;
                cell.appendChild(dateNumber);

                const scheduleIndicator = document.createElement('div');
                scheduleIndicator.className = 'schedule-indicator';
                cell.appendChild(scheduleIndicator);

                cell.addEventListener('click', (e) => {
                    if (e.target.classList.contains('month-task-bar')) return;
                    goToDayView(dateString);
                });

                monthGrid.appendChild(cell);
            }

            setTimeout(() => {
                const firstDateCell = monthGrid.querySelector('.month-view-cell[data-date]');
                if (!firstDateCell) return;

                const cellWidth = firstDateCell.offsetWidth;
                const cellHeight = firstDateCell.offsetHeight;

                const taskRanges = findContinuousTaskRanges(year, month);
                const allTaskLayers = [];

                taskRanges.forEach(range => {
                    const category = CATEGORIES[range.category];
                    const user = USERS[range.user];

                    if (!user || !category) return;

                    const startCellIndex = firstDayOfWeek + range.startDate - 1;
                    const endCellIndex = firstDayOfWeek + range.endDate - 1;

                    const startRow = Math.floor(startCellIndex / 7);
                    const endRow = Math.floor(endCellIndex / 7);

                    for (let currentRow = startRow; currentRow <= endRow; currentRow++) {
                        const rowStartIndex = currentRow * 7;
                        const rowEndIndex = rowStartIndex + 6;

                        const barStartIndex = Math.max(startCellIndex, rowStartIndex);
                        const barEndIndex = Math.min(endCellIndex, rowEndIndex);

                        const barStartCol = barStartIndex % 7;
                        const barEndCol = barEndIndex % 7;
                        const barSpan = barEndCol - barStartCol + 1;

                        let layerIndex = 0;
                        let foundLayer = false;

                        for (let i = 0; i < allTaskLayers.length; i++) {
                            const layer = allTaskLayers[i];

                            if (layer.row !== currentRow) continue;

                            let hasConflict = false;
                            for (let cell = barStartIndex; cell <= barEndIndex; cell++) {
                                if (layer.occupiedCells.includes(cell)) {
                                    hasConflict = true;
                                    break;
                                }
                            }

                            if (!hasConflict) {
                                layerIndex = i;
                                foundLayer = true;
                                for (let cell = barStartIndex; cell <= barEndIndex; cell++) {
                                    layer.occupiedCells.push(cell);
                                }
                                break;
                            }
                        }

                        if (!foundLayer) {
                            layerIndex = allTaskLayers.length;
                            const occupiedCells = [];
                            for (let cellIndex = barStartIndex; cellIndex <= barEndIndex; cellIndex++) {
                                occupiedCells.push(cellIndex);
                            }
                            allTaskLayers.push({
                                row: currentRow,
                                occupiedCells: occupiedCells
                            });
                        }

                        const barStartDate = Math.max(range.startDate, barStartIndex - firstDayOfWeek + 1);
                        const barEndDate = Math.min(range.endDate, barEndIndex - firstDayOfWeek + 1);

                        const taskBar = document.createElement('div');
                        taskBar.className = `month-task-bar ${category.color} ${range.user}`;
                        taskBar.setAttribute('data-task-id', range.taskId);
                        taskBar.setAttribute('data-assignment', JSON.stringify(range.assignment));

                        const topPosition = 45 + (currentRow * cellHeight) + 24 + (layerIndex * 24);
                        const leftPosition = barStartCol * cellWidth + 10;
                        const barWidth = (barSpan * cellWidth) - 20;

                        taskBar.style.top = `${topPosition}px`;
                        taskBar.style.left = `${leftPosition}px`;
                        taskBar.style.width = `${barWidth}px`;

                        const daysText = barSpan > 1 ? ` (${barSpan}ì¼)` : '';
                        taskBar.textContent = `${user.name}: ${range.title}${daysText}`;

                        const tooltip = document.createElement('div');
                        tooltip.className = 'month-task-tooltip';
                        tooltip.innerHTML = `
                            <strong>${category.name} - ${range.title}</strong>
                            <div>ğŸ‘¤ ë‹´ë‹¹: ${user.name}</div>
                            <div>ğŸ“… ê¸°ê°„: ${barStartDate}ì¼ ~ ${barEndDate}ì¼ (${barSpan}ì¼)</div>
                            <div>â±ï¸ ì´ ì‹œê°„: ${range.totalHours || 0}ì‹œê°„</div>
                        `;
                        taskBar.appendChild(tooltip);

                        taskBar.addEventListener('click', (e) => {
                            e.stopPropagation();
                            e.preventDefault();
                            const assignmentData = JSON.parse(e.currentTarget.getAttribute('data-assignment'));
                            showScheduleDetailFromCalendar(assignmentData);
                        });

                        taskBar.addEventListener('mouseenter', (e) => {
                            const assignmentData = JSON.parse(e.currentTarget.getAttribute('data-assignment'));
                            highlightRelatedTasks(assignmentData);
                        });

                        taskBar.addEventListener('mouseleave', (e) => {
                            const assignmentData = JSON.parse(e.currentTarget.getAttribute('data-assignment'));
                            unhighlightRelatedTasks(assignmentData);
                        });

                        monthGrid.appendChild(taskBar);
                    }
                });
            }, 100);
        }

        function findContinuousTaskRanges(year, month) {
            const ranges = [];
            const processedAssignments = new Set();

            filteredAssignments.forEach((assignment, index) => {
                if (processedAssignments.has(index)) return;

                const startDate = new Date(assignment.startDate);
                const endDate = new Date(assignment.endDate);

                if (startDate.getFullYear() !== year || startDate.getMonth() + 1 !== month) {
                    if (endDate.getFullYear() !== year || endDate.getMonth() + 1 !== month) {
                        return;
                    }
                }

                const task = TASKS[assignment.taskId];
                if (!task) return;

                let rangeStart = startDate;
                let rangeEnd = endDate;
                let totalHours = assignment.assignedHours || 0;

                processedAssignments.add(index);

                filteredAssignments.forEach((otherAssignment, otherIndex) => {
                    if (processedAssignments.has(otherIndex)) return;
                    if (otherAssignment.taskId !== assignment.taskId) return;
                    if (otherAssignment.user !== assignment.user) return;

                    const otherStart = new Date(otherAssignment.startDate);
                    const otherEnd = new Date(otherAssignment.endDate);

                    const dayDiff = Math.abs((otherStart - rangeEnd) / (1000 * 60 * 60 * 24));

                    if (dayDiff <= 1) {
                        if (otherStart < rangeStart) rangeStart = otherStart;
                        if (otherEnd > rangeEnd) rangeEnd = otherEnd;
                        totalHours += otherAssignment.assignedHours || 0;
                        processedAssignments.add(otherIndex);
                    }
                });

                ranges.push({
                    taskId: assignment.taskId,
                    user: assignment.user,
                    title: task.title,
                    category: task.category,
                    startDate: rangeStart.getDate(),
                    endDate: rangeEnd.getDate(),
                    totalHours: totalHours,
                    assignment: assignment
                });
            });

            return ranges;
        }

        // ì£¼ë³„ ë·° ìƒì„±
        function getWeekDates(startDate) {
            const dates = [];
            for (let i = 0; i < 5; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                dates.push(date);
            }
            return dates;
        }

        function generateWeekView(weekDates) {
            const weekGrid = document.getElementById('week-grid');
            weekGrid.innerHTML = '';

            const headerCell = document.createElement('div');
            headerCell.className = 'cell cell-header';
            headerCell.textContent = 'ì‹œê°„';
            weekGrid.appendChild(headerCell);

            weekDates.forEach(date => {
                const dayName = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
                const header = document.createElement('div');
                header.className = 'cell cell-header';
                header.textContent = `${date.getMonth() + 1}/${date.getDate()} (${dayName})`;
                weekGrid.appendChild(header);
            });

            for (let hour = 9; hour < 19; hour++) {
                const timeLabel = document.createElement('div');
                timeLabel.className = 'cell time-label';
                timeLabel.textContent = `${hour}:00`;
                weekGrid.appendChild(timeLabel);

                weekDates.forEach(date => {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    cell.setAttribute('data-date', dateStr);
                    cell.setAttribute('data-hour', hour);

                    const schedules = SCHEDULE_DATA[dateStr] || [];
                    const hourSchedules = schedules.filter(s => {
                        const startHour = parseInt(s.startTime.split(':')[0]);
                        return startHour === hour;
                    });

                    const middleSchedules = schedules.filter(s => {
                        const startHour = parseInt(s.startTime.split(':')[0]);
                        const endHour = parseInt(s.endTime.split(':')[0]);
                        return startHour < hour && endHour > hour;
                    });

                    const allHourSchedules = [...hourSchedules, ...middleSchedules];

                    hourSchedules.forEach((schedule, index) => {
                        const category = CATEGORIES[schedule.category];
                        const user = USERS[schedule.user];
                        if (!category || !user) return;

                        const task = document.createElement('div');
                        task.className = `task ${category.color}`;

                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const endHour = parseInt(schedule.endTime.split(':')[0]);
                        const duration = endHour - startHour;
                        const heightPercent = (duration * 100);

                        task.style.height = `${heightPercent}%`;
                        task.style.top = '0';

                        const columnCount = allHourSchedules.length;
                        const leftPercent = (index / columnCount) * 100;
                        const widthPercent = 100 / columnCount;

                        task.style.left = `${leftPercent}%`;
                        task.style.width = `${widthPercent}%`;

                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        task.setAttribute('data-schedule-id', scheduleId);
                        task.setAttribute('data-schedule', JSON.stringify(schedule));

                        const taskContent = document.createElement('div');
                        taskContent.className = 'task-content-wrapper';
                        taskContent.innerHTML = `
                            <div><strong>${schedule.title}</strong></div>
                            <div>${schedule.startTime} ~ ${schedule.endTime}</div>
                        `;
                        task.appendChild(taskContent);

                        const tooltip = document.createElement('div');
                        tooltip.className = 'task-detail-tooltip';
                        tooltip.innerHTML = `
                            <strong>${category.name} - ${schedule.title}</strong>
                            <div>ğŸ‘¤ ë‹´ë‹¹: ${user.name}</div>
                            <div>â±ï¸ ${schedule.startTime} ~ ${schedule.endTime}</div>
                            <div>ğŸ“… ${dateStr}</div>
                        `;
                        task.appendChild(tooltip);

                        task.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                            showScheduleDetailFromCalendar(scheduleData);
                        });

                        // í˜¸ë²„ ì‹œ ë™ì¼í•œ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸
                        task.addEventListener('mouseenter', (e) => {
                            const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                            highlightRelatedTasks(scheduleData);
                        });

                        task.addEventListener('mouseleave', (e) => {
                            const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                            unhighlightRelatedTasks(scheduleData);
                        });

                        cell.appendChild(task);
                    });

                    middleSchedules.forEach((schedule, index) => {
                        const hoverArea = document.createElement('div');
                        hoverArea.className = 'task-hover-area';
                        hoverArea.style.position = 'absolute';
                        hoverArea.style.top = '0';
                        hoverArea.style.bottom = '0';

                        const columnCount = allHourSchedules.length;
                        const scheduleIndex = allHourSchedules.findIndex(s => s === schedule);
                        const leftPercent = (scheduleIndex / columnCount) * 100;
                        const widthPercent = 100 / columnCount;

                        hoverArea.style.left = `${leftPercent}%`;
                        hoverArea.style.width = `${widthPercent}%`;

                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        hoverArea.setAttribute('data-schedule-id', scheduleId);

                        cell.appendChild(hoverArea);
                    });

                    weekGrid.appendChild(cell);
                });
            }

            setupScheduleHoverEvents();
        }

        // ì¼ë³„ ë·° ìƒì„±
        function generateDayView(date, dateString) {
            const dayGrid = document.getElementById('day-grid');
            dayGrid.innerHTML = '';

            const headerCell = document.createElement('div');
            headerCell.className = 'cell cell-header';
            headerCell.textContent = 'ì‹œê°„';
            dayGrid.appendChild(headerCell);

            const dayName = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][date.getDay()];
            const header = document.createElement('div');
            header.className = 'cell cell-header';
            header.textContent = `${date.getMonth() + 1}/${date.getDate()} (${dayName})`;
            dayGrid.appendChild(header);

            for (let hour = 0; hour < 24; hour++) {
                const timeLabel = document.createElement('div');
                timeLabel.className = 'cell time-label';
                timeLabel.textContent = `${hour}:00`;
                dayGrid.appendChild(timeLabel);

                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.setAttribute('data-date', dateString);
                cell.setAttribute('data-hour', hour);

                const schedules = SCHEDULE_DATA[dateString] || [];
                const hourSchedules = schedules.filter(s => {
                    const startHour = parseInt(s.startTime.split(':')[0]);
                    return startHour === hour;
                });

                const middleSchedules = schedules.filter(s => {
                    const startHour = parseInt(s.startTime.split(':')[0]);
                    const endHour = parseInt(s.endTime.split(':')[0]);
                    return startHour < hour && endHour > hour;
                });

                const allHourSchedules = [...hourSchedules, ...middleSchedules];

                hourSchedules.forEach((schedule, index) => {
                    const category = CATEGORIES[schedule.category];
                    const user = USERS[schedule.user];
                    if (!category || !user) return;

                    const task = document.createElement('div');
                    task.className = `task ${category.color}`;

                    const startHour = parseInt(schedule.startTime.split(':')[0]);
                    const endHour = parseInt(schedule.endTime.split(':')[0]);
                    const duration = endHour - startHour;
                    const heightPercent = (duration * 100);

                    task.style.height = `${heightPercent}%`;
                    task.style.top = '0';

                    const columnCount = allHourSchedules.length;
                    const leftPercent = (index / columnCount) * 100;
                    const widthPercent = 100 / columnCount;

                    task.style.left = `${leftPercent}%`;
                    task.style.width = `${widthPercent}%`;

                    const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateString}-${schedule.startTime.replace(':', '')}`;
                    task.setAttribute('data-schedule-id', scheduleId);
                    task.setAttribute('data-schedule', JSON.stringify(schedule));

                    const taskContent = document.createElement('div');
                    taskContent.className = 'task-content-wrapper';
                    taskContent.innerHTML = `
                        <div><strong>${schedule.title}</strong></div>
                        <div>${schedule.startTime} ~ ${schedule.endTime}</div>
                    `;
                    task.appendChild(taskContent);

                    const tooltip = document.createElement('div');
                    tooltip.className = 'task-detail-tooltip';
                    tooltip.innerHTML = `
                        <strong>${category.name} - ${schedule.title}</strong>
                        <div>ğŸ‘¤ ë‹´ë‹¹: ${user.name}</div>
                        <div>â±ï¸ ${schedule.startTime} ~ ${schedule.endTime}</div>
                        <div>ğŸ“… ${dateString}</div>
                    `;
                    task.appendChild(tooltip);

                    task.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                        showScheduleDetailFromCalendar(scheduleData);
                    });

                    // í˜¸ë²„ ì‹œ ë™ì¼í•œ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸
                    task.addEventListener('mouseenter', (e) => {
                        const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                        highlightRelatedTasks(scheduleData);
                    });

                    task.addEventListener('mouseleave', (e) => {
                        const scheduleData = JSON.parse(e.currentTarget.getAttribute('data-schedule'));
                        unhighlightRelatedTasks(scheduleData);
                    });

                    cell.appendChild(task);
                });

                middleSchedules.forEach((schedule, index) => {
                    const hoverArea = document.createElement('div');
                    hoverArea.className = 'task-hover-area';
                    hoverArea.style.position = 'absolute';
                    hoverArea.style.top = '0';
                    hoverArea.style.bottom = '0';

                    const columnCount = allHourSchedules.length;
                    const scheduleIndex = allHourSchedules.findIndex(s => s === schedule);
                    const leftPercent = (scheduleIndex / columnCount) * 100;
                    const widthPercent = 100 / columnCount;

                    hoverArea.style.left = `${leftPercent}%`;
                    hoverArea.style.width = `${widthPercent}%`;

                    const startHour = parseInt(schedule.startTime.split(':')[0]);
                    const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateString}-${schedule.startTime.replace(':', '')}`;
                    hoverArea.setAttribute('data-schedule-id', scheduleId);

                    cell.appendChild(hoverArea);
                });

                dayGrid.appendChild(cell);
            }

            setupScheduleHoverEvents();
        }

        function setupScheduleHoverEvents() {
            document.querySelectorAll('.task, .task-hover-area').forEach(el => {
                el.onmouseenter = function(e) {
                    const scheduleId = e.currentTarget.getAttribute('data-schedule-id');
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    if (taskBlock) {
                        // íŒ¨ë„ì´ ì—´ë ¤ìˆìœ¼ë©´ z-indexë¥¼ ë†’ì´ì§€ ì•ŠìŒ
                        const isPanelOpen = document.getElementById('detail-panel').classList.contains('show');
                        taskBlock.style.zIndex = isPanelOpen ? '1' : '10000';
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        if (tooltip) {
                            tooltip.classList.add('force-show');
                        }
                    }
                };

                el.onmouseleave = function(e) {
                    const scheduleId = e.currentTarget.getAttribute('data-schedule-id');
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    if (taskBlock) {
                        taskBlock.style.zIndex = '1';
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        if (tooltip) {
                            tooltip.classList.remove('force-show');
                        }
                    }
                };
            });
        }

        // ë™ì¼í•œ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸ í•¨ìˆ˜
        function highlightRelatedTasks(schedule) {
            const taskId = schedule.taskId;
            const user = schedule.user;
            const isPanelOpen = document.getElementById('detail-panel').classList.contains('show');

            // ì›”ë³„ ë·°ì˜ task bar í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll(`.month-task-bar[data-task-id="${taskId}"]`).forEach(bar => {
                const assignmentData = JSON.parse(bar.getAttribute('data-assignment'));
                if (assignmentData.user === user) {
                    bar.classList.add('same-task-highlight');
                    // íŒ¨ë„ì´ ì—´ë ¤ìˆìœ¼ë©´ z-indexë¥¼ ë‚®ê²Œ ìœ ì§€
                    if (isPanelOpen) {
                        bar.style.zIndex = '1';
                    }
                }
            });

            // ì£¼ë³„/ì¼ë³„ ë·°ì˜ task í•˜ì´ë¼ì´íŠ¸
            const maxZIndex = isPanelOpen ? '1' : '10001'; // íŒ¨ë„ì´ ì—´ë ¤ìˆìœ¼ë©´ z-indexë¥¼ ë†’ì´ì§€ ì•ŠìŒ
            
            document.querySelectorAll('.task').forEach(task => {
                const scheduleAttr = task.getAttribute('data-schedule');
                if (scheduleAttr) {
                    try {
                        const scheduleData = JSON.parse(scheduleAttr);
                        if (scheduleData.taskId === taskId && scheduleData.user === user) {
                            task.style.outline = '3px solid var(--primary-blue)';
                            task.style.boxShadow = '0 0 15px rgba(37, 99, 235, 0.5)';
                            task.style.zIndex = maxZIndex;
                        }
                    } catch (e) {
                        console.error('ìŠ¤ì¼€ì¤„ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
            });

            // ì˜¤ë¥¸ìª½ ë¦¬ìŠ¤íŠ¸ì˜ schedule-item í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.schedule-item').forEach(item => {
                const scheduleAttr = item.getAttribute('data-schedule');
                if (scheduleAttr) {
                    try {
                        const itemSchedule = JSON.parse(scheduleAttr);
                        if (itemSchedule.taskId === taskId && itemSchedule.user === user) {
                            item.classList.add('highlighted');
                        }
                    } catch (e) {
                        console.error('ìŠ¤ì¼€ì¤„ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
            });
        }

        // í•˜ì´ë¼ì´íŠ¸ ì œê±° í•¨ìˆ˜
        function unhighlightRelatedTasks(schedule) {
            const taskId = schedule.taskId;
            const user = schedule.user;

            // ì›”ë³„ ë·°ì˜ task bar í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll(`.month-task-bar[data-task-id="${taskId}"]`).forEach(bar => {
                bar.classList.remove('same-task-highlight');
            });

            // ì£¼ë³„/ì¼ë³„ ë·°ì˜ task í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.task').forEach(task => {
                const scheduleAttr = task.getAttribute('data-schedule');
                if (scheduleAttr) {
                    try {
                        const scheduleData = JSON.parse(scheduleAttr);
                        if (scheduleData.taskId === taskId && scheduleData.user === user) {
                            task.style.outline = '';
                            task.style.boxShadow = '';
                            task.style.zIndex = '';
                        }
                    } catch (e) {
                        console.error('ìŠ¤ì¼€ì¤„ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
            });

            // ì˜¤ë¥¸ìª½ ë¦¬ìŠ¤íŠ¸ì˜ schedule-item í•˜ì´ë¼ì´íŠ¸ ì œê±°
            document.querySelectorAll('.schedule-item').forEach(item => {
                const scheduleAttr = item.getAttribute('data-schedule');
                if (scheduleAttr) {
                    try {
                        const itemSchedule = JSON.parse(scheduleAttr);
                        if (itemSchedule.taskId === taskId && itemSchedule.user === user) {
                            item.classList.remove('highlighted');
                        }
                    } catch (e) {
                        console.error('ìŠ¤ì¼€ì¤„ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
            });
        }

        function goToDayView(dateString) {
            const [year, month, day] = dateString.split('-').map(Number);
            currentDayDate = new Date(year, month - 1, day);

            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelector('.view-switch button[data-view="day"]').classList.add('active');

            document.querySelectorAll('.calendar-grid').forEach(grid => grid.classList.remove('active'));
            document.getElementById('day-grid').classList.add('active');

            generateDayView(currentDayDate, dateString);
            updateDateDisplay();
            updateScheduleList();
        }

        function goToWeekView(dateString) {
            const [year, month, day] = dateString.split('-').map(Number);
            const targetDate = new Date(year, month - 1, day);

            const dayOfWeek = targetDate.getDay();
            const monday = new Date(targetDate);
            monday.setDate(targetDate.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

            currentWeekStart = monday;

            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelector('.view-switch button[data-view="week"]').classList.add('active');

            document.querySelectorAll('.calendar-grid').forEach(grid => grid.classList.remove('active'));
            document.getElementById('week-grid').classList.add('active');

            const weekDates = getWeekDates(currentWeekStart);
            generateWeekView(weekDates);
            updateDateDisplay();
            updateScheduleList();
        }

        // ì´ˆê¸° ë Œë”ë§
        document.addEventListener('DOMContentLoaded', function() {
            // localStorageì—ì„œ ìŠ¤ì¼€ì¤„ ë¡œë“œ í›„ ë Œë”ë§
            loadSchedulesFromLocalStorage();
            generateMonthView(currentYear, currentMonth);
            updateDateDisplay();
            updateScheduleList();
        });
    </script>
    
    <!-- ì¼ì • ì‚­ì œ í—¬í¼ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="delete_schedule_helper.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ê³„íš ë³´ê¸° - ì¸í„°ë™í‹°ë¸Œ ëª©ì—…</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="users-data.js"></script>
    <script src="projects-data.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --bg-gray: #f4f6f8;
            --border-color: #e5e7eb;
            --primary-blue: #2563eb;
            --text-dark: #1e293b;
            --task-blue-bg: #dbeafe; --task-blue-text: #1e40af; --task-blue-border: #3b82f6;
            --task-green-bg: #dcfce7; --task-green-text: #166534; --task-green-border: #22c55e;
            --task-yellow-bg: #fef9c3; --task-yellow-text: #854d0e; --task-yellow-border: #eab308;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-gray);
            margin: 0; padding: 0;
            color: var(--text-dark);
            height: 100vh; display: flex; flex-direction: column;
            box-sizing: border-box;
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .top-nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            z-index: 1; /* íˆ´íŒë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--primary-blue);
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-menu-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-menu-btn:hover {
            background: var(--bg-gray);
        }

        .nav-menu-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .logout-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--bg-gray);
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 25px;
        }

        /* --- Layout --- */
        .main-layout { display: flex; gap: 20px; flex: 1; overflow: hidden; }

        /* --- Main Calendar Card --- */
        .content-area {
            flex: 1;
            min-width: 0; /* flex itemì´ ì¤„ì–´ë“¤ ìˆ˜ ìˆë„ë¡ í—ˆìš© */
            background: white; 
            border-radius: 12px;
            border: 1px solid var(--border-color); 
            display: flex;
            flex-direction: column; 
            overflow: hidden; /* ìŠ¤í¬ë¡¤ì€ calendar-gridì—ì„œ ì²˜ë¦¬ */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            position: relative; /* fixed íˆ´íŒì˜ ê¸°ì¤€ì  */
            z-index: 1; /* ë¶„ë¥˜ íŒì—…ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
        }

        .toolbar {
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; border-bottom: 1px solid var(--border-color);
            position: relative; z-index: 1; /* íˆ´íŒë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
        }

        .view-switch { display: flex; background: #f1f5f9; padding: 4px; border-radius: 8px; }
        .view-switch button {
            border: none; background: none; padding: 6px 14px;
            border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: #64748b;
        }
        .view-switch button.active { background: white; color: var(--text-dark); box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-weight: 600; }

        .legend-wrapper { position: relative; margin-left: 10px; z-index: 9999999; }
        .legend-btn { background: #f1f5f9; border: 1px solid var(--border-color); padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .legend-popup {
            display: none; position: fixed; /* fixedë¡œ ë³€ê²½í•˜ì—¬ ë¶€ëª¨ overflow ì˜í–¥ ì—†ì´ í‘œì‹œ */
            left: 0;
            top: 0;
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
            border: 1px solid var(--border-color);
            border-radius: 10px; padding: 15px; width: 220px; z-index: 9999999 !important; /* ìµœìƒìœ„ z-index - ëª¨ë“  ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            opacity: 1 !important; /* íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… */
            isolation: isolate; /* ë¶€ëª¨ opacity ìƒì† ì°¨ë‹¨ */
            visibility: hidden; /* JavaScriptë¡œë§Œ ì œì–´ */
        }
        /* CSS í˜¸ë²„ ê·œì¹™ ì œê±° - JavaScriptë¡œë§Œ ì œì–´ */
        .legend-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 0.85rem; }
        .dot { width: 12px; height: 12px; border-radius: 3px; }

        /* --- Calendar Grid --- */
        .calendar-grid {
            flex: 1; overflow: auto; display: none;
            position: relative; /* íˆ´íŒ ìœ„ì¹˜ ê³„ì‚°ì„ ìœ„í•œ ê¸°ì¤€ì  */
            z-index: 1; /* ë¶„ë¥˜ íŒì—…ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
            isolation: isolate; /* stacking context ë¶„ë¦¬ - ë¶„ë¥˜ íŒì—…ê³¼ ë…ë¦½ì ìœ¼ë¡œ */
        }
        
        /* ì£¼ë³„ ë·° */
        .calendar-grid.week-view {
            grid-template-columns: 80px repeat(5, 1fr);
            grid-template-rows: 45px repeat(10, 80px);
        }
        
        /* ì›”ë³„ ë·° */
        .calendar-grid.month-view {
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 45px repeat(5, 120px);
            position: relative;
            overflow: visible; /* íˆ´íŒì´ ë°–ìœ¼ë¡œ ë‚˜ì˜¤ë„ë¡ */
        }
        
        /* Active ìƒíƒœ - ë°˜ë“œì‹œ ë§ˆì§€ë§‰ì— ì •ì˜ */
        .calendar-grid.active { display: grid !important; }
        .calendar-grid.month-view .cell[data-date] {
            position: relative;
            z-index: 1;
            overflow: visible; /* íˆ´íŒì´ ì…€ ë°–ìœ¼ë¡œ ë‚˜ì˜¤ë„ë¡ */
        }
        
        /* ì›”ë³„ ë·° ì¼ì • í‘œì‹œ */
        .schedule-indicator { 
            font-size: 0.7rem; 
            margin-top: 8px; 
            line-height: 1.6; 
            position: relative;
            overflow: visible;
        }
        .schedule-indicator .person { display: flex; align-items: center; gap: 4px; margin-bottom: 3px; position: relative; }
        .schedule-indicator .person-name { color: #475569; font-weight: 500; cursor: pointer; }
        .schedule-indicator .person-name:hover { color: var(--primary-blue); text-decoration: underline; }
        .schedule-indicator .task-dots { display: inline-flex; gap: 3px; margin-left: 2px; }
        
        /* ì›”ë³„ ë·° ì—°ì† í…ŒìŠ¤í¬ ë°” */
        .month-task-bar {
            position: absolute;
            height: 22px;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.65rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            cursor: pointer;
            border-left: 3px solid;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            pointer-events: auto;
            left: 2px;
            right: 2px;
            max-width: calc(100% - 4px); /* ì…€ ë„ˆë¹„ë¥¼ ë„˜ì§€ ì•Šë„ë¡ */
            box-sizing: border-box;
        }
        
        /* í…ŒìŠ¤í¬ ë°” ì»¨í…Œì´ë„ˆ */
        .task-bars-container {
            position: absolute;
            top: 24px;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden; /* ì…€ ë°–ìœ¼ë¡œ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ */
        }
        .month-task-bar:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10000;
            overflow: visible;
        }
        
        /* ê°™ì€ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ */
        .month-task-bar.same-task-highlight {
            outline: 3px solid #2563eb;
            outline-offset: 2px;
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.4);
            z-index: 999;
            transform: scale(1.02);
            transition: all 0.2s ease;
        }
        
        /* ì›”ë³„ ë·° í…ŒìŠ¤í¬ ë°” íˆ´íŒ */
        .month-task-tooltip {
            display: none;
            position: fixed; /* fixedë¡œ ë³€ê²½í•˜ì—¬ ë¶€ëª¨ overflow ì˜í–¥ ì—†ì´ í‘œì‹œ */
            left: 50%;
            bottom: auto;
            top: auto;
            transform: translateX(-50%);
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            z-index: 9999999 !important; /* ìµœìƒìœ„ z-index - ëª¨ë“  ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: normal;
            pointer-events: none;
            opacity: 1 !important; /* íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… */
            isolation: isolate; /* ë¶€ëª¨ opacity ìƒì† ì°¨ë‹¨ */
        }
        /* ì›”ë³„ ë·° íˆ´íŒì€ JavaScriptë¡œë§Œ ì œì–´ */
        .month-task-tooltip strong {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-size: 0.85rem;
        }
        .month-task-tooltip div {
            margin-bottom: 4px;
            color: #64748b;
        }
        .month-task-bar.blue { 
            background: var(--task-blue-bg); 
            color: var(--task-blue-text); 
            border-left-color: var(--task-blue-border); 
        }
        .month-task-bar.green { 
            background: var(--task-green-bg); 
            color: var(--task-green-text); 
            border-left-color: var(--task-green-border); 
        }
        .month-task-bar.yellow { 
            background: var(--task-yellow-bg); 
            color: var(--task-yellow-text); 
            border-left-color: var(--task-yellow-border); 
        }
        
        /* ì‚¬ëŒë³„ ì—…ë¬´ íˆ´íŒ */
        .task-tooltip {
            display: none;
            position: fixed; /* fixedë¡œ ë³€ê²½í•˜ì—¬ ë¶€ëª¨ overflow ì˜í–¥ ì—†ì´ í‘œì‹œ */
            left: 0;
            top: 20px;
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            min-width: 180px;
            z-index: 9999999 !important; /* ìµœìƒìœ„ z-index - ëª¨ë“  ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            font-size: 0.75rem;
            line-height: 1.5;
            opacity: 1 !important; /* íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… */
            isolation: isolate; /* ë¶€ëª¨ opacity ìƒì† ì°¨ë‹¨ */
        }
        .person:hover .task-tooltip { 
            display: block !important;
            opacity: 1 !important; /* íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… */
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
        }
        .task-tooltip .tooltip-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        .task-tooltip .task-item {
            display: flex;
            align-items: start;
            gap: 6px;
            margin-bottom: 5px;
            color: #475569;
        }
        .task-tooltip .task-item:last-child { margin-bottom: 0; }
        
        /* ì¼ë³„ ë·° */
        .calendar-grid.day-view {
            grid-template-columns: 80px 1fr;
            grid-template-rows: 45px repeat(10, 80px);
        }
        .cell { border-right: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; position: relative; overflow: hidden; }
        
        /* ì£¼ë³„/ì¼ë³„/ì›”ë³„ ë·°ëŠ” íˆ´íŒì´ ë³´ì´ë„ë¡ overflow visible */
        .week-view .cell:not(.cell-header):not(.time-label),
        .day-view .cell:not(.cell-header):not(.time-label),
        .month-view .cell[data-date] {
            overflow: visible;
        }
        .cell-header { 
            background: #fafafa; position: sticky; top: 0; z-index: 0; /* ë¶„ë¥˜ íŒì—…ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • (0ìœ¼ë¡œ ë³€ê²½) */
            display: flex; justify-content: center; align-items: center;
            font-size: 0.85rem; font-weight: 600; color: #64748b;
        }
        .time-label { display: flex; justify-content: center; padding-top: 10px; font-size: 0.8rem; color: #94a3b8; }
        
        /* ì›”ë³„ ë·° ë‚ ì§œ ì…€ í´ë¦­ ê°€ëŠ¥ */
        .month-view .cell[data-date] { cursor: pointer; transition: 0.2s; }
        .month-view .cell[data-date]:hover { background: #f0f9ff !important; }
        .month-view .cell[data-date].selected { background: #dbeafe !important; border: 2px solid var(--primary-blue); }

        .task {
            position: absolute; left: 8px; right: 8px; top: 5px;
            border-radius: 8px; padding: 10px; font-size: 0.8rem;
            cursor: pointer; border-left: 4px solid rgba(0,0,0,0.2);
            transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 20px;
            z-index: 1;
        }
        .task:hover {
            /* í˜¸ë²„ íš¨ê³¼ëŠ” ìœ ì§€í•˜ë˜ íˆ´íŒì€ JavaScriptë¡œë§Œ ì œì–´ */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: visible;
        }
        .task-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }
        
        /* ì¤‘ê°„ ì‹œê°„ëŒ€ í˜¸ë²„ ì˜ì—­ */
        .task-hover-area {
            pointer-events: auto;
            z-index: 10000 !important; /* ê¸°ë³¸ z-indexë¥¼ ë†’ê²Œ ì„¤ì •í•˜ì—¬ task ë¸”ë¡ ìœ„ì— í‘œì‹œ */
        }
        .task-hover-area:hover {
            z-index: 10001 !important; /* í˜¸ë²„ ì‹œ ë” ë†’ì€ z-index */
        }
        /* JavaScriptë¡œ ì œì–´ë˜ëŠ” ê°•ì œ íˆ´íŒ í‘œì‹œ */
        .task-detail-tooltip.force-show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important; /* íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… */
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
            z-index: 9999999 !important; /* ìµœìƒìœ„ z-index */
            isolation: isolate !important; /* ë¶€ëª¨ opacity ìƒì† ì°¨ë‹¨ */
        }
        
        /* ì¼ì • ë¸”ë¡ íˆ´íŒ */
        .task-detail-tooltip {
            display: none;
            position: fixed; /* fixedë¡œ ë³€ê²½í•˜ì—¬ ë¶€ëª¨ overflow ì˜í–¥ ì—†ì´ í‘œì‹œ */
            left: 50%;
            bottom: auto;
            top: auto;
            transform: translateX(-50%);
            margin-bottom: 8px;
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            z-index: 9999999 !important; /* ìµœìƒìœ„ z-index - ëª¨ë“  ìš”ì†Œ ìœ„ì— í‘œì‹œ */
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: normal;
            pointer-events: none;
            opacity: 1 !important; /* íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… */
            isolation: isolate; /* ë¶€ëª¨ opacity ìƒì† ì°¨ë‹¨ */
        }
        /* íˆ´íŒì€ JavaScriptë¡œë§Œ ì œì–´ (CSS í˜¸ë²„ ì œê±°í•˜ì—¬ ê¹œë¹¡ì„ ë°©ì§€) */
        .task .task-detail-tooltip.force-show { 
            display: block !important;
            z-index: 9999999 !important; /* ìµœìƒìœ„ z-index */
        }
        .task-detail-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: white;
        }
        .task-detail-tooltip .tooltip-row {
            margin-bottom: 6px;
        }
        .task-detail-tooltip .tooltip-row:last-child {
            margin-bottom: 0;
        }
        .task-detail-tooltip .tooltip-label {
            font-weight: 600;
            color: #64748b;
            font-size: 0.7rem;
        }
        .task-detail-tooltip .tooltip-value {
            color: var(--text-dark);
            font-weight: 500;
        }
        .task.blue { background: var(--task-blue-bg); color: var(--task-blue-text); border-left-color: var(--task-blue-border); }
        .task.green { background: var(--task-green-bg); color: var(--task-green-text); border-left-color: var(--task-green-border); }
        .task.yellow { background: var(--task-yellow-bg); color: var(--task-yellow-text); border-left-color: var(--task-yellow-border); }
        .task.hidden { display: none !important; }
        
        /* ë“±ë¡ëœ í…ŒìŠ¤í¬ ìŠ¤íƒ€ì¼ (íšŒìƒ‰, ë¶ˆíˆ¬ëª…) */
        .task.scheduled,
        .month-task-bar.scheduled {
            background: #9ca3af !important;
            color: #ffffff !important;
            border-left-color: #6b7280 !important;
            opacity: 1 !important;
        }
        /* íˆ´íŒì€ ë¶€ëª¨ì˜ opacityë¥¼ ìƒì†ë°›ì§€ ì•Šë„ë¡ */
        .task.scheduled .task-detail-tooltip {
            opacity: 1 !important;
            isolation: isolate;
        }
        .month-task-bar.scheduled .month-task-tooltip {
            opacity: 1 !important;
            background: #ffffff !important; /* ëª…ì‹œì  í°ìƒ‰ ë°°ê²½ */
            background-color: #ffffff !important; /* ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • */
            isolation: isolate;
        }
        /* ëª¨ë“  íˆ´íŒì€ ë¶€ëª¨ì˜ opacityë¥¼ ìƒì†ë°›ì§€ ì•Šë„ë¡ */
        .task .task-detail-tooltip,
        .month-task-bar .month-task-tooltip,
        .person .task-tooltip {
            opacity: 1 !important;
            background: #ffffff !important;
            background-color: #ffffff !important;
            isolation: isolate;
        }
        
        .task.scheduled.blue,
        .month-task-bar.scheduled.blue {
            background: #9ca3af !important;
            color: #ffffff !important;
            border-left-color: #6b7280 !important;
        }
        
        .task.scheduled.green,
        .month-task-bar.scheduled.green {
            background: #9ca3af !important;
            color: #ffffff !important;
            border-left-color: #6b7280 !important;
        }
        
        .task.scheduled.yellow,
        .month-task-bar.scheduled.yellow {
            background: #9ca3af !important;
            color: #ffffff !important;
            border-left-color: #6b7280 !important;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 300px; background: white; border-radius: 12px;
            border: 1px solid var(--border-color); padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: width 0.3s ease;
            position: relative;
            z-index: 1; /* íˆ´íŒë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
        }
        .sidebar.collapsed {
            width: 60px;
            padding: 25px 10px;
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .sidebar.collapsed .sidebar-header {
            justify-content: center;
            margin-bottom: 0;
        }
        .sidebar h3 { 
            font-size: 1.1rem; 
            margin: 0; 
            flex: 1;
            transition: opacity 0.3s ease, width 0.3s ease;
        }
        .sidebar.collapsed h3 {
            opacity: 0;
            width: 0;
            overflow: hidden;
            margin: 0;
        }
        .sidebar-toggle {
            background: #f1f5f9;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 1rem;
            color: #475569;
            transition: all 0.2s;
            flex-shrink: 0;
            min-width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .sidebar-toggle:hover {
            background: #e2e8f0;
        }
        .sidebar-content {
            transition: opacity 0.3s ease, max-height 0.3s ease;
            overflow: hidden;
        }
        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            pointer-events: none;
        }
        .team-group { margin-bottom: 25px; }
        .team-header { display: flex; align-items: center; gap: 10px; font-weight: 700; margin-bottom: 12px; color: var(--primary-blue); font-size: 0.95rem; }
        .member-item { display: flex; align-items: center; gap: 10px; padding: 6px 0; margin-left: 15px; font-size: 0.9rem; color: #475569; }
        input[type="checkbox"] { width: 17px; height: 17px; accent-color: var(--primary-blue); cursor: pointer; }

    </style>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="top-nav">
        <div class="nav-left">
            <h1 onclick="location.href='my_calendar.html'">ğŸ§± Lego</h1>
            <div class="nav-menu" id="navMenu">
                <!-- ì—­í• ë³„ ë©”ë‰´ëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
            </div>
        </div>
        <div class="nav-right">
            <div class="user-info" id="userInfo"></div>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
    <div class="main-layout">
        <div class="content-area">
            <div class="toolbar">
                <div style="display: flex; align-items: center;">
                    <div class="view-switch">
                        <button class="active" onclick="changeView(this)">ì›” (Month)</button>
                        <button onclick="changeView(this)">ì£¼ (Week)</button>
                        <button onclick="changeView(this)">ì¼ (Day)</button>
                    </div>
                    <div class="legend-wrapper">
                        <button class="legend-btn">ğŸ¨ ë¶„ë¥˜ (Legend)</button>
                        <!-- íŒì—…ì€ JavaScriptì—ì„œ bodyì— ì§ì ‘ appendë¨ -->
                    </div>
                </div>
                <div style="display:flex;align-items:center;gap:12px;position:relative;z-index:1;">
                    <button id="prev-btn" onclick="navigate(-1)" style="background:#f1f5f9;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:16px;color:#475569;display:none;position:relative;z-index:1;">â—€</button>
                    <div style="font-weight:600;min-width:200px;text-align:center;" id="current-date-display">2023ë…„ 3ì›”</div>
                    <button id="next-btn" onclick="navigate(1)" style="background:#f1f5f9;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:16px;color:#475569;display:none;position:relative;z-index:1;">â–¶</button>
                </div>
            </div>

            <!-- ì£¼ë³„ ë·° (Week View) - ë™ì  ìƒì„±ë¨ -->
            <div class="calendar-grid week-view" id="week-view-grid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ì›”ë³„ ë·° (Month View) - ë™ì  ìƒì„±ë¨ -->
            <div class="calendar-grid month-view active" id="month-view-grid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ì¼ë³„ ë·° (Day View) - ë™ì  ìƒì„±ë¨ -->
            <div class="calendar-grid day-view" id="day-view-grid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <aside class="sidebar" id="filter-sidebar">
            <div class="sidebar-header">
                <h3>íŒ€/ì‚¬ì› í•„í„°</h3>
                <button class="sidebar-toggle" id="filter-toggle" onclick="toggleFilterSidebar()" title="í•„í„° ì ‘ê¸°/í¼ì¹˜ê¸°">â—€</button>
            </div>
            
            <div class="sidebar-content" id="filter-content">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </aside>
    </div>

    <script>
        // ============================================
        // ğŸ” ì¸ì¦ ì²´í¬ ë° ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
        // ============================================
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if (!currentUser) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        function getRoleName(role) {
            const roleNames = {
                'admin': 'ê´€ë¦¬ì',
                'teamlead': 'íŒ€ì¥',
                'user': 'íŒ€ì›'
            };
            return roleNames[role] || 'ì‚¬ìš©ì';
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        document.getElementById('userInfo').textContent = `${currentUser.name} (${getRoleName(currentUser.role)})`;

        // í˜„ì¬ í˜ì´ì§€ ê°ì§€
        const currentPage = window.location.pathname.split('/').pop() || 'entire_calendar.html';
        
        // í†µì¼ëœ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ë Œë”ë§
        function renderNavigation() {
            const navMenu = document.getElementById('navMenu');
            let menuHTML = '';
            
            // ê´€ë¦¬ì: ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ, ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ë“±ë¡, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬
            if (currentUser.role === 'admin') {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'admin.html' ? 'active' : ''}" onclick="location.href='admin.html'">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_register.html' ? 'active' : ''}" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            // íŒ€ì¥: íŒ€ì¥ ëŒ€ì‹œë³´ë“œ, ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ë“±ë¡, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬
            else if (currentUser.role === 'teamlead') {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'teamlead.html' ? 'active' : ''}" onclick="location.href='teamlead.html'">íŒ€ì¥ ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_register.html' ? 'active' : ''}" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            // íŒ€ì›: ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬ (íŒ€ì¥ ëŒ€ì‹œë³´ë“œ, í”„ë¡œì íŠ¸ ë“±ë¡ ì œì™¸)
            else {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            
            navMenu.innerHTML = menuHTML;
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
        renderNavigation();

        // ============================================
        // ğŸ‘¥ í•„í„° ì‚¬ì´ë“œë°” ë™ì  ìƒì„±
        // ============================================
        function renderFilterSidebar() {
            const filterContent = document.getElementById('filter-content');
            if (!filterContent) return;
            
            // users-data.jsì—ì„œ ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
            const users = typeof USERS_DATA !== 'undefined' ? USERS_DATA.users : [];
            
            // ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ìì‹ ì˜ íŒ€ë§Œ í‘œì‹œ
            const isAdmin = currentUser.role === 'admin';
            const userTeam = currentUser.team;
            
            // íŒ€ë³„ë¡œ ì‚¬ìš©ì ê·¸ë£¹í™”
            const teamMap = {};
            users.forEach(user => {
                // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ìì‹ ì˜ íŒ€ë§Œ í‘œì‹œ
                if (!isAdmin && user.team !== userTeam && user.role !== 'admin') {
                    return;
                }
                
                // admin íŒ€ì€ ì œì™¸ (ê´€ë¦¬ìëŠ” í•„í„°ì— í‘œì‹œí•˜ì§€ ì•ŠìŒ)
                if (user.team === 'admin') {
                    return;
                }
                
                if (!teamMap[user.team]) {
                    teamMap[user.team] = [];
                }
                teamMap[user.team].push(user);
            });
            
            // íŒ€ ì´ë¦„ ë§¤í•‘
            const teamNames = {
                'dev': 'ê°œë°œíŒ€',
                'design': 'ë””ìì¸íŒ€',
                'planning': 'ê¸°íšíŒ€'
            };
            
            let html = '';
            Object.keys(teamMap).sort().forEach(teamKey => {
                const teamMembers = teamMap[teamKey];
                const teamName = teamNames[teamKey] || teamKey;
                
                html += `
                    <div class="team-group">
                        <div class="team-header">
                            <input type="checkbox" id="team-${teamKey}" checked onchange="handleTeamAllClick('${teamKey}')"> 
                            <label for="team-${teamKey}">${teamName} (ì „ì²´)</label>
                        </div>
                `;
                
                teamMembers.forEach(member => {
                    html += `
                        <div class="member-item">
                            <input type="checkbox" checked class="member-check ${teamKey}-member" data-user="${member.id}" onchange="handleMemberClick('${teamKey}')"> ${member.name}
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
            
            filterContent.innerHTML = html;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í•„í„° ë Œë”ë§
        renderFilterSidebar();

        // ============================================
        // ğŸ“Š ë°ì´í„° ê´€ë¦¬ ì˜ì—­ (Data Management)
        // ============================================
        // 
        // âš ï¸ ì¤‘ìš”: ì¼ì • ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ì•„ë˜ ì˜ì—­ë§Œ ìˆ˜ì •í•˜ì„¸ìš”!
        // 
        // 1. TASKS: í”„ë¡œì íŠ¸ì˜ í…ŒìŠ¤í¬ ì •ì˜ (ëŒ€/ì¤‘/ì†Œë¶„ë¥˜, ê¸°ì¤€ ì‹œê°„)
        // 2. TASK_ASSIGNMENTS: í…ŒìŠ¤í¬ë³„ ì‹¤ì œ ë°°ì • ìŠ¤ì¼€ì¤„
        // 
        // í…ŒìŠ¤í¬ í˜•ì‹:
        //    taskId: ê³ ìœ  ID
        //    title: í…ŒìŠ¤í¬ ì œëª©
        //    category: ì†Œë¶„ë¥˜ (planning/development/design)
        //    totalHours: ê¸°ì¤€ ì‹œê°„ (í•´ë‹¹ í…ŒìŠ¤í¬ë¥¼ ì™„ë£Œí•˜ëŠ”ë° í•„ìš”í•œ ì´ ì‹œê°„)
        // 
        // ìŠ¤ì¼€ì¤„ í˜•ì‹:
        //    taskId: í…ŒìŠ¤í¬ ID (TASKSì˜ taskIdì™€ ë§¤ì¹­)
        //    user: ë‹´ë‹¹ì ID
        //    startDate: ì‹œì‘ ë‚ ì§œ 'YYYY-MM-DD'
        //    endDate: ì¢…ë£Œ ë‚ ì§œ 'YYYY-MM-DD' (í•˜ë£¨ë§Œì´ë©´ startDateì™€ ë™ì¼)
        //    startTime: ì‹œì‘ ì‹œê°„ 'HH:MM'
        //    endTime: ì¢…ë£Œ ì‹œê°„ 'HH:MM'
        //    note: ì¶”ê°€ ë©”ëª¨ (ì„ íƒì‚¬í•­)
        // 
        // ============================================
        
        // JSON íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ
        let USERS = {};
        let CATEGORIES = {};
        let TASKS = {};
        
        async function loadMockData() {
            try {
                // users-data.jsì—ì„œ ë¡œë“œ (ì „ì—­ ë³€ìˆ˜ USERS_DATA ì‚¬ìš©)
                if (typeof USERS_DATA !== 'undefined') {
                    USERS = {};
                    USERS_DATA.users.forEach(user => {
                        USERS[user.id] = { name: user.name, team: user.team };
                    });
                    CATEGORIES = USERS_DATA.categories || {};
                    console.log('âœ… ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', USERS);
                }
                
                // projects-data.jsì—ì„œ ë¡œë“œ (ì „ì—­ ë³€ìˆ˜ PROJECTS_DATA ì‚¬ìš©)
                if (typeof PROJECTS_DATA !== 'undefined') {
                    // tasksë¥¼ ê°ì²´ë¡œ ë³€í™˜
                    TASKS = {};
                    PROJECTS_DATA.tasks.forEach(task => {
                        TASKS[task.id] = {
                            taskId: task.id,
                            title: task.ì†Œë¶„ë¥˜ || task.ì¤‘ë¶„ë¥˜,
                            category: getCategoryFromMajor(task.ëŒ€ë¶„ë¥˜),
                            totalHours: task.ê¸°ì¤€ì‹œê°„ || task.í• ë‹¹ì‹œê°„ || 0
                        };
                    });
                    console.log('âœ… í”„ë¡œì íŠ¸ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', TASKS);
                }
            } catch (error) {
                console.error('ëª©ì—… ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        function getCategoryFromMajor(ëŒ€ë¶„ë¥˜) {
            if (!ëŒ€ë¶„ë¥˜) return 'planning';
            if (ëŒ€ë¶„ë¥˜.includes('ê¸°íš') || ëŒ€ë¶„ë¥˜.includes('í–‰ì‚¬') || ëŒ€ë¶„ë¥˜.includes('ê²½ì˜')) {
                return 'planning';
            } else if (ëŒ€ë¶„ë¥˜.includes('ê°œë°œ') || ëŒ€ë¶„ë¥˜.includes('ì¬ë¬´')) {
                return 'development';
            } else if (ëŒ€ë¶„ë¥˜.includes('ë””ìì¸') || ëŒ€ë¶„ë¥˜.includes('ì‹œê°')) {
                return 'design';
            }
            return 'planning';
        }
        
        // localStorageì—ì„œ íŒ€ì›ì´ ë“±ë¡í•œ ìŠ¤ì¼€ì¤„ ë¡œë“œ (êµ¬ë²„ì „ í˜¸í™˜ìš© - ë” ì´ìƒ ì‚¬ìš© ì•ˆ í•¨)
        function loadSchedulesFromLocalStorageOld() {
            try {
                const saved = localStorage.getItem('taskSchedules');
                if (saved) {
                    const userSchedules = JSON.parse(saved);
                    console.log('ğŸ“¥ localStorageì—ì„œ ìŠ¤ì¼€ì¤„ ë¡œë“œ (êµ¬ë²„ì „):', userSchedules);
                    // ë°°ì—´ì¸ì§€ í™•ì¸
                    if (Array.isArray(userSchedules)) {
                        return userSchedules;
                    } else {
                        console.warn('âš ï¸ taskSchedulesê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', userSchedules);
                        return [];
                    }
                }
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
            return [];
        }

        // ì‚¬ìš©ì ì´ë¦„ì„ user IDë¡œ ë§¤í•‘
        function getUserByName(userName) {
            for (const [userId, userInfo] of Object.entries(USERS)) {
                if (userInfo.name === userName) {
                    return userId;
                }
            }
            return null;
        }

        // ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ëŒ€ë¶„ë¥˜ -> ì†Œë¶„ë¥˜)
        function getCategoryFromTask(task) {
            const ëŒ€ë¶„ë¥˜ = task.ëŒ€ë¶„ë¥˜ || task.task?.ëŒ€ë¶„ë¥˜ || '';
            if (ëŒ€ë¶„ë¥˜.includes('ê¸°íš') || ëŒ€ë¶„ë¥˜.includes('í–‰ì‚¬') || ëŒ€ë¶„ë¥˜.includes('ê²½ì˜')) {
                return 'planning';
            } else if (ëŒ€ë¶„ë¥˜.includes('ê°œë°œ') || ëŒ€ë¶„ë¥˜.includes('ì¬ë¬´')) {
                return 'development';
            } else if (ëŒ€ë¶„ë¥˜.includes('ë””ìì¸') || ëŒ€ë¶„ë¥˜.includes('ì‹œê°')) {
                return 'design';
            }
            return 'planning'; // ê¸°ë³¸ê°’
        }

        // localStorage ìŠ¤ì¼€ì¤„ì„ TASK_ASSIGNMENTS í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function convertUserSchedulesToAssignments(userSchedules) {
            const converted = [];
            // ë°°ì—´ì´ ì•„ë‹Œ ê²½ìš° ì²˜ë¦¬
            if (!Array.isArray(userSchedules)) {
                console.warn('âš ï¸ userSchedulesê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', userSchedules);
                return converted;
            }
            userSchedules.forEach(schedule => {
                const userId = getUserByName(schedule.userName);
                if (!userId) return;
                
                const category = getCategoryFromTask(schedule.task || schedule);
                
                // taskId ìƒì„± (ì†Œë¶„ë¥˜ ê¸°ë°˜)
                const taskId = `user-task-${schedule.taskId || schedule.id}`;
                
                // TASKSì— ì¶”ê°€ (ì—†ëŠ” ê²½ìš°)
                if (!TASKS[taskId]) {
                    TASKS[taskId] = {
                        taskId: taskId,
                        title: schedule.task?.ì¤‘ë¶„ë¥˜ || schedule.task?.ì†Œë¶„ë¥˜ || 'í…ŒìŠ¤í¬',
                        category: category,
                        totalHours: schedule.task?.í• ë‹¹ì‹œê°„ || schedule.assignedHours || 0,
                        isUserScheduled: true // ë“±ë¡ëœ í…ŒìŠ¤í¬ í‘œì‹œ
                    };
                }
                
                converted.push({
                    taskId: taskId,
                    user: userId,
                    startDate: schedule.startDate,
                    endDate: schedule.endDate,
                    startTime: schedule.startTime,
                    endTime: schedule.endTime,
                    assignedHours: schedule.assignedHours,
                    isUserScheduled: true // ë“±ë¡ëœ í…ŒìŠ¤í¬ í‘œì‹œ
                });
            });
            return converted;
        }

        // í…ŒìŠ¤í¬ ë°°ì • ìŠ¤ì¼€ì¤„ (ì‹¤ì œ ì‘ì—… ì¼ì •) - localStorageì™€ JSONì—ì„œ ë¡œë“œ
        let TASK_ASSIGNMENTS = [];
        let dataLoaded = false; // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í”Œë˜ê·¸
        
        // ============================================
        // ğŸ“… í—¬í¼ í•¨ìˆ˜: TASK_ASSIGNMENTSë¡œë¶€í„° ë‚ ì§œë³„ ìŠ¤ì¼€ì¤„ ìƒì„±
        // ============================================
        
        /**
         * íŠ¹ì • ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ìŠ¤ì¼€ì¤„ì„ ê°€ì ¸ì˜µë‹ˆë‹¤
         * @param {string} dateStr - 'YYYY-MM-DD' í˜•ì‹ì˜ ë‚ ì§œ
         * @returns {Array} í•´ë‹¹ ë‚ ì§œì˜ ìŠ¤ì¼€ì¤„ ë°°ì—´
         */
        function getSchedulesForDate(dateStr) {
            const schedules = [];
            
            TASK_ASSIGNMENTS.forEach(assignment => {
                const task = TASKS[assignment.taskId];
                if (!task) return;
                
                //ë‚ ì§œê°€ ë²”ìœ„ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
                const targetDate = new Date(dateStr);
                const startDate = new Date(assignment.startDate);
                const endDate = new Date(assignment.endDate);
                
                if (targetDate >= startDate && targetDate <= endDate) {
                    // ì´ ë°°ì •ì´ í•´ë‹¹ ë‚ ì§œì— ì†í•¨
                    schedules.push({
                        taskId: assignment.taskId,
                        user: assignment.user,
                        category: task.category,
                        title: task.title,
                        startTime: assignment.startTime,
                        endTime: assignment.endTime,
                        note: assignment.note || '',
                        startDate: assignment.startDate,
                        endDate: assignment.endDate,
                        totalHours: task.totalHours,
                        isUserScheduled: assignment.isUserScheduled || false
                    });
                }
            });
            
            return schedules;
        }
        
        // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ SCHEDULE_DATA (ê¸°ì¡´ ì½”ë“œì™€ í˜¸í™˜)
        const SCHEDULE_DATA = {
        };
        
        // SCHEDULE_DATAë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” Proxy
        const SCHEDULE_DATA_HANDLER = {
            get: function(target, dateStr) {
                if (typeof dateStr !== 'string' || !dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    return target[dateStr];
                }
                // ìºì‹œì— ì—†ìœ¼ë©´ ë™ì ìœ¼ë¡œ ìƒì„±
                if (!target[dateStr]) {
                    target[dateStr] = getSchedulesForDate(dateStr);
                }
                return target[dateStr];
            }
        };
        
        const SCHEDULE_DATA_PROXY = new Proxy(SCHEDULE_DATA, SCHEDULE_DATA_HANDLER);
        
        // ============================================
        // ğŸ¯ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì˜ì—­
        // ============================================
        
        // 1. íŒ€ ì „ì²´ ì„ íƒ í´ë¦­ ì‹œ
        function handleTeamAllClick(teamType) {
            const isChecked = document.getElementById(`team-${teamType}`).checked;
            const members = document.querySelectorAll(`.${teamType}-member`);
            members.forEach(m => m.checked = isChecked);
            syncCalendar();
        }

        // 2. ê°œë³„ ë©¤ë²„ í´ë¦­ ì‹œ (íŒ€ ì „ì²´ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—°ë™)
        function handleMemberClick(teamType) {
            const teamAllCb = document.getElementById(`team-${teamType}`);
            const members = document.querySelectorAll(`.${teamType}-member`);
            const checkedCount = document.querySelectorAll(`.${teamType}-member:checked`).length;

            // í•˜ë‚˜ë¼ë„ ì„ íƒ í•´ì œ ì‹œ ì „ì²´ ì„ íƒ í•´ì œ, ëª¨ë‘ ì„ íƒ ì‹œ ì „ì²´ ì„ íƒ ì²´í¬
            teamAllCb.checked = (members.length === checkedCount);
            
            syncCalendar();
        }

        // í•„í„° ì‚¬ì´ë“œë°” ì ‘ê¸°/í¼ì¹˜ê¸°
        function toggleFilterSidebar() {
            const sidebar = document.getElementById('filter-sidebar');
            const toggleBtn = document.getElementById('filter-toggle');
            
            sidebar.classList.toggle('collapsed');
            
            // ë²„íŠ¼ ë°©í–¥ ë³€ê²½
            if (sidebar.classList.contains('collapsed')) {
                toggleBtn.textContent = 'â–¶';
                toggleBtn.title = 'í•„í„° í¼ì¹˜ê¸°';
            } else {
                toggleBtn.textContent = 'â—€';
                toggleBtn.title = 'í•„í„° ì ‘ê¸°';
            }
        }

        // 3. ìº˜ë¦°ë” í™”ë©´ ë™ê¸°í™”
        function syncCalendar() {
            const activeUsers = Array.from(document.querySelectorAll('.member-check:checked'))
                                     .map(cb => cb.dataset.user);
            
            // Task ë¸”ë¡ í•„í„°ë§ (ì£¼ë³„/ì¼ë³„ ë·°)
            document.querySelectorAll('.task').forEach(t => {
                t.style.display = 'none';
            });
            
            activeUsers.forEach(user => {
                document.querySelectorAll('.task.' + user).forEach(task => {
                    task.style.display = 'block';
                });
            });
            
            // ì›”ë³„ ë·°ì˜ í…ŒìŠ¤í¬ ë°” í•„í„°ë§
            document.querySelectorAll('.month-task-bar').forEach(bar => {
                const classList = Array.from(bar.classList);
                const userClass = classList.find(c => c.startsWith('user-'));
                
                if (userClass && activeUsers.includes(userClass)) {
                    bar.style.display = 'flex';
                } else if (userClass) {
                    bar.style.display = 'none';
                }
            });
            
            // ì›”ë³„ ë·°ì˜ ì‚¬ëŒë³„ ì¼ì • í‘œì‹œ í•„í„°ë§
            document.querySelectorAll('.month-view .person').forEach(person => {
                const classList = Array.from(person.classList);
                const userClass = classList.find(c => c.startsWith('user-'));
                
                if (userClass && activeUsers.includes(userClass)) {
                    person.style.display = 'flex';
                } else if (userClass) {
                    person.style.display = 'none';
                }
            });
            
            // ë¹ˆ ì¼ì • í‘œì‹œ ìˆ¨ê¸°ê¸° (ëª¨ë“  ì‚¬ëŒì´ í•„í„°ë§ëœ ê²½ìš°)
            document.querySelectorAll('.schedule-indicator').forEach(indicator => {
                const visiblePersons = Array.from(indicator.querySelectorAll('.person')).filter(p => p.style.display !== 'none');
                if (visiblePersons.length === 0) {
                    indicator.style.display = 'none';
                } else {
                    indicator.style.display = 'block';
                }
            });
        }

        // ============================================
        // ğŸ“… ë°ì´í„° ê¸°ë°˜ ë·° ìƒì„± í•¨ìˆ˜
        // ============================================
        
        // íŠ¹ì • ë‚ ì§œì˜ ì¼ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getScheduleByDate(dateStr) {
            return getSchedulesForDate(dateStr);
        }
        
        // ë‚ ì§œë³„ë¡œ ì‚¬ìš©ìë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ì¼ì • ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getScheduleSummaryByDate(dateStr) {
            const schedules = getScheduleByDate(dateStr);
            const userSchedules = {};
            
            schedules.forEach(schedule => {
                if (!userSchedules[schedule.user]) {
                    userSchedules[schedule.user] = {
                        userName: USERS[schedule.user].name,
                        categories: []
                    };
                }
                
                if (!userSchedules[schedule.user].categories.find(c => c.category === schedule.category)) {
                    userSchedules[schedule.user].categories.push({
                        category: schedule.category,
                        categoryName: CATEGORIES[schedule.category].name,
                        color: CATEGORIES[schedule.category].color,
                        colorCode: CATEGORIES[schedule.category].colorCode,
                        tasks: []
                    });
                }
                
                const catIndex = userSchedules[schedule.user].categories.findIndex(c => c.category === schedule.category);
                userSchedules[schedule.user].categories[catIndex].tasks.push({
                    title: schedule.title,
                    startTime: schedule.startTime,
                    endTime: schedule.endTime,
                    note: schedule.note
                });
            });
            
            return userSchedules;
        }

        function changeView(btn) {
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // ë·° íƒ€ì… ê²°ì •
            const viewText = btn.textContent.trim();
            let viewType = 'week-view';
            if (viewText.includes('ì›”')) viewType = 'month-view';
            else if (viewText.includes('ì¼')) viewType = 'day-view';
            
            // ëª¨ë“  ìº˜ë¦°ë” ê·¸ë¦¬ë“œ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.calendar-grid').forEach(grid => {
                grid.classList.remove('active');
            });
            
            // ì„ íƒëœ ë·°ë§Œ í‘œì‹œ
            document.querySelector(`.${viewType}`).classList.add('active');
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ë° í™”ì‚´í‘œ ë²„íŠ¼ ì œì–´
            const monthNames = ['', '1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            // ëª¨ë“  ë·°ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ
            prevBtn.style.display = 'block';
            nextBtn.style.display = 'block';
            
            if (viewType === 'month-view') {
                document.getElementById('current-date-display').textContent = `${currentYear}ë…„ ${monthNames[currentMonth]}`;
            } else if (viewType === 'day-view') {
                document.getElementById('current-date-display').textContent = currentDayDateDisplay.replace(/\s*\([^)]*\)/, '');
            } else {
                // ì£¼ë³„ ë·°
                const startDate = new Date(currentWeekDates[0]);
                const endDate = new Date(currentWeekDates[4]);
                const startMonth = startDate.getMonth() + 1;
                const startDay = startDate.getDate();
                const endMonth = endDate.getMonth() + 1;
                const endDay = endDate.getDate();
                document.getElementById('current-date-display').textContent = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            }
        }

        // ë‚ ì§œ í´ë¦­ ì‹œ ì¼ë³„ ë·°ë¡œ ì „í™˜
        // ì£¼ë³„ ë·°ë¡œ ì´ë™ (íŠ¹ì • ë‚ ì§œê°€ ì†í•œ ì£¼)
        function goToWeekView(targetDate) {
            // í•´ë‹¹ ë‚ ì§œê°€ ì†í•œ ì£¼ì˜ ì›”ìš”ì¼ ì°¾ê¸°
            const date = new Date(targetDate);
            const day = date.getDay(); // 0(ì¼) ~ 6(í† )
            const mondayOffset = day === 0 ? -6 : 1 - day; // ì›”ìš”ì¼ê¹Œì§€ì˜ ê±°ë¦¬
            const monday = new Date(date);
            monday.setDate(date.getDate() + mondayOffset);
            
            // í•´ë‹¹ ì£¼ì˜ ë‚ ì§œ ë°°ì—´ ìƒì„± (ì›”~ê¸ˆ)
            const weekDates = [];
            for (let i = 0; i < 5; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                weekDates.push(dateStr);
            }
            
            // í˜„ì¬ ì£¼ ì—…ë°ì´íŠ¸
            currentWeekDates = weekDates;
            
            // ì£¼ë³„ ë·° ì¬ìƒì„±
            generateWeekView(weekDates);
            
            // ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.calendar-grid').forEach(grid => {
                grid.classList.remove('active');
            });
            
            // ì£¼ë³„ ë·° í‘œì‹œ
            document.querySelector('.week-view').classList.add('active');
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.view-switch button')[1].classList.add('active'); // ì£¼ë³„ ë²„íŠ¼
            
            // ìƒë‹¨ ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const startDate = new Date(weekDates[0]);
            const endDate = new Date(weekDates[4]);
            const startMonth = startDate.getMonth() + 1;
            const startDay = startDate.getDate();
            const endMonth = endDate.getMonth() + 1;
            const endDay = endDate.getDate();
            document.getElementById('current-date-display').textContent = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
            
            console.log('ğŸ“… ì£¼ë³„ ë·°ë¡œ ì´ë™:', weekDates);
        }
        
        function goToDayView(dateString, event) {
            // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ (ì´ì „ ì„ íƒ í•´ì œ)
            document.querySelectorAll('.month-view .cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('selected');
            }
            
            // ë‚ ì§œ ë°ì´í„° ì¶”ì¶œ (data-date ì†ì„±ì—ì„œ)
            let dateStr;
            if (event && event.currentTarget) {
                dateStr = event.currentTarget.getAttribute('data-date');
            } else if (typeof dateString === 'string' && dateString.match(/^\d{4}-\d{2}-\d{2}$/)) {
                // dateStringì´ ì´ë¯¸ YYYY-MM-DD í˜•ì‹ì¸ ê²½ìš°
                dateStr = dateString;
                const date = new Date(dateStr);
                const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
                dateString = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ (${dayNames[date.getDay()]})`;
            } else {
                dateStr = event ? event.currentTarget.getAttribute('data-date') : dateString;
            }
            
            // ìƒë‹¨ íˆ´ë°” ë‚ ì§œ ì—…ë°ì´íŠ¸ (ìš”ì¼ ì œì™¸)
            const shortDate = dateString.replace(/\s*\([^)]*\)/, '');
            document.getElementById('current-date-display').textContent = shortDate;
            
            // ì¼ë³„ ë·° ì¬ìƒì„±
            currentDayDate = dateStr;
            currentDayDateDisplay = dateString;
            generateDayView(dateStr, dateString);
            
            // ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.calendar-grid').forEach(grid => {
                grid.classList.remove('active');
            });
            
            // ì¼ë³„ ë·° í‘œì‹œ
            document.querySelector('.day-view').classList.add('active');
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.view-switch button')[2].classList.add('active'); // ì¼ë³„ ë²„íŠ¼
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('prev-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'block';
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // ì›” ì´ë™ í•¨ìˆ˜ (ì´ì „/ë‹¤ìŒ ë‹¬)
        function navigateMonth(direction) {
            currentMonth += direction;
            
            // ì›” ë²”ìœ„ ì¡°ì •
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            
            // ì›”ë³„ ë·° ì¬ìƒì„±
            generateMonthView(currentYear, currentMonth);
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // ì£¼ ì´ë™ í•¨ìˆ˜ (ì´ì „/ë‹¤ìŒ ì£¼)
        function navigateWeek(direction) {
            // í˜„ì¬ ì£¼ì˜ ì²« ë²ˆì§¸ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì´ë™
            const firstDate = new Date(currentWeekDates[0]);
            firstDate.setDate(firstDate.getDate() + (direction * 7)); // 7ì¼ì”© ì´ë™
            
            // ìƒˆë¡œìš´ ì£¼ì˜ ë‚ ì§œ ë°°ì—´ ìƒì„± (ì›”~ê¸ˆ)
            currentWeekDates = [];
            for (let i = 0; i < 5; i++) {
                const date = new Date(firstDate);
                date.setDate(firstDate.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                currentWeekDates.push(dateStr);
            }
            
            // ì£¼ë³„ ë·° ì¬ìƒì„±
            generateWeekView(currentWeekDates);
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const startDate = new Date(currentWeekDates[0]);
            const endDate = new Date(currentWeekDates[4]);
            const startMonth = startDate.getMonth() + 1;
            const startDay = startDate.getDate();
            const endMonth = endDate.getMonth() + 1;
            const endDay = endDate.getDate();
            document.getElementById('current-date-display').textContent = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // ì¼ ì´ë™ í•¨ìˆ˜ (ì´ì „/ë‹¤ìŒ ì¼)
        function navigateDay(direction) {
            // í˜„ì¬ ë‚ ì§œì—ì„œ directionì¼ ì´ë™
            const date = new Date(currentDayDate);
            date.setDate(date.getDate() + direction);
            
            // ìƒˆë¡œìš´ ë‚ ì§œ ë¬¸ìì—´ ìƒì„±
            currentDayDate = date.toISOString().split('T')[0];
            
            // ë‚ ì§œ í‘œì‹œ í˜•ì‹ ìƒì„±
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
            const dayName = dayNames[date.getDay()];
            currentDayDateDisplay = `${year}ë…„ ${month}ì›” ${day}ì¼ (${dayName})`;
            
            // ì¼ë³„ ë·° ì¬ìƒì„±
            generateDayView(currentDayDate, currentDayDateDisplay);
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('current-date-display').textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // í†µí•© ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
        function navigate(direction) {
            // í˜„ì¬ í™œì„±í™”ëœ ë·° ì°¾ê¸°
            const activeView = document.querySelector('.calendar-grid.active');
            
            if (activeView.classList.contains('month-view')) {
                navigateMonth(direction);
            } else if (activeView.classList.contains('week-view')) {
                navigateWeek(direction);
            } else if (activeView.classList.contains('day-view')) {
                navigateDay(direction);
            }
        }
        
        // ============================================
        // ğŸ“… ì£¼ë³„ ë·° ë™ì  ìƒì„±
        // ============================================
        
        // í˜„ì¬ ì£¼ë³„ ë·°ì— í‘œì‹œí•  ë‚ ì§œ ë°°ì—´ (ì˜¤ëŠ˜ ë‚ ì§œê°€ ì†í•œ ì£¼ì˜ ì›”~ê¸ˆ)
        function getCurrentWeekDates() {
            const today = new Date();
            const day = today.getDay(); // 0(ì¼) ~ 6(í† )
            const mondayOffset = day === 0 ? -6 : 1 - day; // ì›”ìš”ì¼ê¹Œì§€ì˜ ê±°ë¦¬
            const monday = new Date(today);
            monday.setDate(today.getDate() + mondayOffset);
            
            const weekDates = [];
            for (let i = 0; i < 5; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                weekDates.push(dateStr);
            }
            return weekDates;
        }
        let currentWeekDates = getCurrentWeekDates();
        
        function generateWeekView(weekDates = currentWeekDates) {
            const weekGrid = document.getElementById('week-view-grid');
            weekGrid.innerHTML = '';
            
            // ì‹œê°„ ë°°ì—´ (09:00~18:00)
            const hours = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
            
            // ìš”ì¼ í—¤ë” ìƒì„±
            let headerHTML = '<div class="cell cell-header">ì‹œê°„</div>';
            const dayNames = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'];
            weekDates.forEach((dateStr, index) => {
                const date = new Date(dateStr);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                headerHTML += `<div class="cell cell-header">${dayNames[index]} (${month}/${day})</div>`;
            });
            weekGrid.innerHTML += headerHTML;
            
            // ì‹œê°„ë³„ í–‰ ìƒì„±
            hours.forEach(hour => {
                let rowHTML = `<div class="cell time-label">${hour}</div>`;
                
                weekDates.forEach(dateStr => {
                    const schedules = getScheduleByDate(dateStr);
                    let cellContent = '';
                    
                    // í•´ë‹¹ ì‹œê°„ì— ì‹œì‘í•˜ëŠ” ì¼ì • ì°¾ê¸°
                    const hourSchedules = schedules.filter(s => s.startTime === hour);
                    const columnCount = hourSchedules.length;
                    
                    if (columnCount > 1) {
                        // ê²¹ì¹˜ëŠ” ì¼ì •ì´ ìˆëŠ” ê²½ìš° - ì»¬ëŸ¼ ë¶„í•  ë°©ì‹
                        hourSchedules.forEach((schedule, index) => {
                            const category = CATEGORIES[schedule.category];
                            const user = USERS[schedule.user];
                            const startHour = parseInt(schedule.startTime.split(':')[0]);
                            const endHour = parseInt(schedule.endTime.split(':')[0]);
                            const durationHours = endHour - startHour;
                            const height = durationHours * 80 - 20;
                            
                            // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ - ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ë¸”ë¡)
                            const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                            
                            // ì»¬ëŸ¼ ë¶„í• : ë™ì¼í•œ ë„ˆë¹„ë¡œ ë‚˜ëˆ”
                            const widthPercent = 100 / columnCount;
                            const leftPercent = (100 / columnCount) * index;
                            const rightPercent = 100 - leftPercent - widthPercent;
                            
                            const note = schedule.note ? `<br><small style="opacity:1;">${schedule.note}</small>` : '';
                            const noteText = schedule.note ? schedule.note : '';
                            
                            // íˆ´íŒ HTML
                            const tooltip = `<div class="task-detail-tooltip">
                                <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                                ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                            </div>`;
                            
                            const scheduledClass = schedule.isUserScheduled ? ' scheduled' : '';
                            cellContent += `<div class="task ${category.color} ${schedule.user}${scheduledClass}" data-schedule-id="${scheduleId}" data-date="${dateStr}" onclick="goToDayView('${dateStr}')" style="height: ${height}px; position: absolute; left: calc(${leftPercent}% + 4px); right: calc(${rightPercent}% + 4px); width: auto; top: 5px; z-index: ${index + 1}; cursor: pointer; ${index < columnCount - 1 ? 'border-right: 2px solid white;' : ''}"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                        });
                    } else {
                        // ê²¹ì¹˜ì§€ ì•ŠëŠ” ê²½ìš° - ì „ì²´ ë„ˆë¹„ ì‚¬ìš©
                        hourSchedules.forEach(schedule => {
                            const category = CATEGORIES[schedule.category];
                            const user = USERS[schedule.user];
                            const startHour = parseInt(schedule.startTime.split(':')[0]);
                            const endHour = parseInt(schedule.endTime.split(':')[0]);
                            const durationHours = endHour - startHour;
                            const height = durationHours * 80 - 20;
                            
                            // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ - ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ë¸”ë¡)
                            const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                            console.log(`âœ… ì‹œì‘ ë¸”ë¡ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                            
                            const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                            const noteText = schedule.note ? schedule.note : '';
                            
                            // íˆ´íŒ HTML
                            const tooltip = `<div class="task-detail-tooltip">
                                <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                                ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                            </div>`;
                            
                            const scheduledClass = schedule.isUserScheduled ? ' scheduled' : '';
                            cellContent += `<div class="task ${category.color} ${schedule.user}${scheduledClass}" data-schedule-id="${scheduleId}" data-date="${dateStr}" onclick="goToDayView('${dateStr}')" style="height: ${height}px; cursor: pointer;"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                        });
                    }
                    
                    // ì¤‘ê°„ ì‹œê°„ëŒ€ ì¼ì • (ì‹œì‘í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì§„í–‰ ì¤‘ì¸ ì¼ì •)ì— ëŒ€í•œ í˜¸ë²„ ì˜ì—­ ì¶”ê°€
                    const currentHourNum = parseInt(hour.split(':')[0]);
                    const middleSchedules = schedules.filter(s => {
                        const startHourNum = parseInt(s.startTime.split(':')[0]);
                        const endHourNum = parseInt(s.endTime.split(':')[0]);
                        return s.startTime !== hour && currentHourNum >= startHourNum && currentHourNum < endHourNum;
                    });
                    
                    if (middleSchedules.length > 0) {
                        // í˜„ì¬ ì‹œê°„ì— ì§„í–‰ ì¤‘ì¸ ëª¨ë“  ì¼ì • (ì‹œì‘ + ì¤‘ê°„)
                        const allOngoingSchedules = schedules.filter(s => {
                            const startHourNum = parseInt(s.startTime.split(':')[0]);
                            const endHourNum = parseInt(s.endTime.split(':')[0]);
                            return currentHourNum >= startHourNum && currentHourNum < endHourNum;
                        });
                        
                        middleSchedules.forEach(schedule => {
                            // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ - ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ë¸”ë¡)
                            const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                            console.log(`ğŸ”´ í˜¸ë²„ ì˜ì—­ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                            
                            // ì´ ì¼ì •ì´ ì „ì²´ ì§„í–‰ ì¤‘ì¸ ì¼ì • ì¤‘ ëª‡ ë²ˆì§¸ì¸ì§€ ì°¾ê¸°
                            const scheduleIndex = allOngoingSchedules.findIndex(s => 
                                s.taskId === schedule.taskId && s.user === schedule.user && s.startTime === schedule.startTime
                            );
                            
                            // ì»¬ëŸ¼ ìœ„ì¹˜ ê³„ì‚° (ì‹œì‘ ì‹œê°„ê³¼ ë™ì¼í•œ ìœ„ì¹˜)
                            const totalColumns = allOngoingSchedules.length;
                            const widthPercent = 100 / totalColumns;
                            const leftPercent = (100 / totalColumns) * scheduleIndex;
                            const rightPercent = 100 - leftPercent - widthPercent;
                            
                            // ì¼ì •ì˜ ì „ì²´ ë†’ì´ ê³„ì‚°
                            const startHour = parseInt(schedule.startTime.split(':')[0]);
                            const endHour = parseInt(schedule.endTime.split(':')[0]);
                            const durationHours = endHour - startHour;
                            const totalHeight = durationHours * 80 - 20;
                            
                            // í˜„ì¬ ì‹œê°„ëŒ€ì—ì„œì˜ ì˜¤í”„ì…‹ ê³„ì‚°
                            const hourOffset = currentHourNum - startHour;
                            const topOffset = hourOffset * 80 + 5;
                            const remainingHeight = totalHeight - (hourOffset * 80);
                            const cellHeight = Math.min(80 - 5, remainingHeight);
                            
                            // íˆ¬ëª…í•œ í˜¸ë²„ ì˜ì—­ - ì…€ ì „ì²´ ë†’ì´ë¥¼ ì°¨ì§€ (z-indexë¥¼ ë†’ì—¬ì„œ task ë¸”ë¡ ìœ„ì— í‘œì‹œ)
                            cellContent += `<div class="task-hover-area ${schedule.user}" data-schedule-id="${scheduleId}" style="position: absolute; left: calc(${leftPercent}% + 8px); right: calc(${rightPercent}% + 8px); width: auto; top: 0; bottom: 0; z-index: 10000; background: rgba(255,0,0,0.05); cursor: pointer; pointer-events: auto;"></div>`;
                        });
                    }
                    
                    rowHTML += `<div class="cell" style="position: relative;">${cellContent}</div>`;
                });
                
                weekGrid.innerHTML += rowHTML;
            });
            
            // í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì •
            setupScheduleHoverEvents();
        }
        
        // ì¼ì • í˜¸ë²„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupScheduleHoverEvents() {
            console.log('ğŸ”§ í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì • ì¤‘...');
            
            // 1. Task ë¸”ë¡ ìì²´ì— í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
            const taskBlocks = document.querySelectorAll('.task[data-schedule-id]');
            console.log(`ë°œê²¬ëœ Task ë¸”ë¡: ${taskBlocks.length}ê°œ`);
            
            taskBlocks.forEach((taskBlock, index) => {
                const scheduleId = taskBlock.getAttribute('data-schedule-id');
                console.log(`Task ë¸”ë¡ ${index}: ${scheduleId}`);
                
                if (!scheduleId) return;
                
                // ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ
                taskBlock.onmouseenter = function(e) {
                    console.log(`ğŸ–±ï¸ [Task ë¸”ë¡] í˜¸ë²„ ì§„ì…: ${scheduleId}`);
                    
                    // z-index ìƒìŠ¹
                    this.style.zIndex = '10000';
                    
                    const tooltip = this.querySelector('.task-detail-tooltip');
                    if (tooltip) {
                        // ë¨¼ì € í‘œì‹œí•˜ì—¬ ì‹¤ì œ í¬ê¸° ì¸¡ì • (visibility: hiddenìœ¼ë¡œ ë³´ì´ì§€ ì•Šê²Œ)
                        tooltip.style.visibility = 'hidden';
                        tooltip.style.display = 'block';
                        tooltip.classList.add('force-show');
                        
                        // íƒœìŠ¤í¬ ë¸”ë¡ ìœ„ì¹˜ ì‚¬ìš©
                        const rect = this.getBoundingClientRect();
                        const tooltipHeight = tooltip.offsetHeight;
                        const tooltipWidth = tooltip.offsetWidth;
                        
                        // íˆ´íŒì„ íƒœìŠ¤í¬ ë¸”ë¡ ì¤‘ì•™ ë°”ë¡œ ìœ„ì— ê³ ì •
                        let top = rect.top - tooltipHeight - 8;
                        let left = rect.left + (rect.width / 2);
                        
                        // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
                        if (top < 10) {
                            // ìœ„ìª½ ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ì•„ë˜ìª½ì— í‘œì‹œ
                            top = rect.bottom + 8;
                        }
                        if (left - (tooltipWidth / 2) < 10) {
                            left = tooltipWidth / 2 + 10;
                        } else if (left + (tooltipWidth / 2) > window.innerWidth - 10) {
                            left = window.innerWidth - (tooltipWidth / 2) - 10;
                        }
                        
                        tooltip.style.top = `${top}px`;
                        tooltip.style.left = `${left}px`;
                        tooltip.style.transform = 'translateX(-50%)';
                        tooltip.style.visibility = 'visible';
                        tooltip.style.setProperty('opacity', '1', 'important'); // íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… (!important)
                        tooltip.style.setProperty('background-color', '#ffffff', 'important'); // ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • (!important)
                        tooltip.style.setProperty('background', '#ffffff', 'important'); // ë°°ê²½ ëª…ì‹œì  ì„¤ì • (!important)
                        tooltip.style.zIndex = '9999999'; // ìµœìƒìœ„ z-index ëª…ì‹œì  ì„¤ì •
                        console.log('âœ… íˆ´íŒ í‘œì‹œ');
                    }
                };
                
                // ë§ˆìš°ìŠ¤ ë– ë‚¬ì„ ë•Œ
                taskBlock.onmouseleave = function() {
                    console.log(`ğŸ–±ï¸ [Task ë¸”ë¡] í˜¸ë²„ ì´íƒˆ: ${scheduleId}`);
                    
                    // z-index ë³µêµ¬
                    this.style.zIndex = '1';
                    
                    const tooltip = this.querySelector('.task-detail-tooltip');
                    if (tooltip) {
                        tooltip.classList.remove('force-show');
                        tooltip.style.visibility = 'hidden';
                        tooltip.style.display = 'none';
                        console.log('âŒ íˆ´íŒ ìˆ¨ê¹€');
                    }
                };
            });
            
            // 2. í˜¸ë²„ ì˜ì—­ì— ì§ì ‘ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const hoverAreas = document.querySelectorAll('.task-hover-area');
            console.log(`ë°œê²¬ëœ í˜¸ë²„ ì˜ì—­: ${hoverAreas.length}ê°œ`);
            
            hoverAreas.forEach((hoverArea, index) => {
                const scheduleId = hoverArea.getAttribute('data-schedule-id');
                console.log(`í˜¸ë²„ ì˜ì—­ ${index}: ${scheduleId}`);
                
                if (!scheduleId) return;
                
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                hoverArea.onmouseenter = null;
                hoverArea.onmouseleave = null;
                
                // ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ
                hoverArea.onmouseenter = function(e) {
                    console.log(`ğŸ–±ï¸ í˜¸ë²„ ì§„ì…: ${scheduleId}`);
                    
                    // í˜¸ë²„ ì˜ì—­ì˜ z-indexë¥¼ ë” ë†’ê²Œ ì„¤ì •
                    this.style.zIndex = '10001';
                    
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    console.log('ì°¾ì€ ë¸”ë¡:', taskBlock);
                    
                    if (taskBlock) {
                        // ë¸”ë¡ì˜ z-indexë¥¼ ì˜¬ë ¤ì„œ í˜¸ë²„ ì˜ì—­ê³¼ í•¨ê»˜ í‘œì‹œ
                        taskBlock.style.zIndex = '10000';
                        
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        console.log('ì°¾ì€ íˆ´íŒ:', tooltip);
                        
                        if (tooltip) {
                            // ë¨¼ì € í‘œì‹œí•˜ì—¬ ì‹¤ì œ í¬ê¸° ì¸¡ì • (visibility: hiddenìœ¼ë¡œ ë³´ì´ì§€ ì•Šê²Œ)
                            tooltip.style.visibility = 'hidden';
                            tooltip.style.display = 'block';
                            tooltip.classList.add('force-show');
                            
                            // íƒœìŠ¤í¬ ë¸”ë¡ ìœ„ì¹˜ ì‚¬ìš©
                            const taskRect = taskBlock.getBoundingClientRect();
                            const tooltipHeight = tooltip.offsetHeight;
                            const tooltipWidth = tooltip.offsetWidth;
                            
                            // íˆ´íŒì„ íƒœìŠ¤í¬ ë¸”ë¡ ì¤‘ì•™ ë°”ë¡œ ìœ„ì— ê³ ì •
                            let top = taskRect.top - tooltipHeight - 8;
                            let left = taskRect.left + (taskRect.width / 2);
                            
                            // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
                            if (top < 10) {
                                // ìœ„ìª½ ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ì•„ë˜ìª½ì— í‘œì‹œ
                                top = taskRect.bottom + 8;
                            }
                            if (left - (tooltipWidth / 2) < 10) {
                                left = tooltipWidth / 2 + 10;
                            } else if (left + (tooltipWidth / 2) > window.innerWidth - 10) {
                                left = window.innerWidth - (tooltipWidth / 2) - 10;
                            }
                            
                            tooltip.style.top = `${top}px`;
                            tooltip.style.left = `${left}px`;
                            tooltip.style.transform = 'translateX(-50%)';
                            tooltip.style.visibility = 'visible';
                            tooltip.style.setProperty('opacity', '1', 'important'); // íˆ¬ëª…ë„ ì œê±° - ì™„ì „ ë¶ˆíˆ¬ëª… (!important)
                            tooltip.style.setProperty('background-color', '#ffffff', 'important'); // ë°°ê²½ìƒ‰ ëª…ì‹œì  ì„¤ì • (!important)
                            tooltip.style.setProperty('background', '#ffffff', 'important'); // ë°°ê²½ ëª…ì‹œì  ì„¤ì • (!important)
                            tooltip.style.zIndex = '9999999'; // ìµœìƒìœ„ z-index ëª…ì‹œì  ì„¤ì •
                            console.log('âœ… íˆ´íŒ í‘œì‹œ');
                        }
                    }
                };
                
                // ë§ˆìš°ìŠ¤ ë– ë‚¬ì„ ë•Œ
                hoverArea.onmouseleave = function() {
                    console.log(`ğŸ–±ï¸ í˜¸ë²„ ì´íƒˆ: ${scheduleId}`);
                    
                    // í˜¸ë²„ ì˜ì—­ì˜ z-indexë¥¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
                    this.style.zIndex = '10000';
                    
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    if (taskBlock) {
                        // z-indexë¥¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
                        taskBlock.style.zIndex = '1';
                        
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        if (tooltip) {
                            tooltip.classList.remove('force-show');
                            tooltip.style.visibility = 'hidden';
                            tooltip.style.display = 'none';
                            console.log('âŒ íˆ´íŒ ìˆ¨ê¹€');
                        }
                    }
                };
            });
            
            console.log('âœ… í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì • ì™„ë£Œ');
        }
        
        // ============================================
        // ğŸ“… ì›”ë³„ ë·° í˜„ì¬ ìƒíƒœ
        // ============================================
        
        // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì´ˆê¸°í™”
        const today = new Date();
        let currentYear = today.getFullYear();
        let currentMonth = today.getMonth() + 1;
        
        // ============================================
        // ğŸ“† ì¼ë³„ ë·° ë™ì  ìƒì„±
        // ============================================
        
        // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì´ˆê¸°í™”
        const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        let currentDayDate = todayStr;
        let currentDayDateDisplay = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼ (${dayNames[today.getDay()]})`;
        
        function generateDayView(dateStr = currentDayDate, dateDisplay = currentDayDateDisplay) {
            const dayGrid = document.getElementById('day-view-grid');
            dayGrid.innerHTML = '';
            
            // ì‹œê°„ ë°°ì—´ (09:00~18:00)
            const hours = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
            
            // í—¤ë” ìƒì„±
            let headerHTML = '<div class="cell cell-header">ì‹œê°„</div>';
            headerHTML += `<div class="cell cell-header" id="day-view-date">${dateDisplay}</div>`;
            dayGrid.innerHTML += headerHTML;
            
            // ì‹œê°„ë³„ í–‰ ìƒì„±
            const schedules = getScheduleByDate(dateStr);
            
            hours.forEach(hour => {
                let cellContent = '';
                
                // í•´ë‹¹ ì‹œê°„ì— ì‹œì‘í•˜ëŠ” ì¼ì • ì°¾ê¸°
                const hourSchedules = schedules.filter(s => s.startTime === hour);
                const columnCount = hourSchedules.length;
                
                if (columnCount > 1) {
                    // ê²¹ì¹˜ëŠ” ì¼ì •ì´ ìˆëŠ” ê²½ìš° - ì»¬ëŸ¼ ë¶„í•  ë°©ì‹
                    hourSchedules.forEach((schedule, index) => {
                        const category = CATEGORIES[schedule.category];
                        const user = USERS[schedule.user];
                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const endHour = parseInt(schedule.endTime.split(':')[0]);
                        const durationHours = endHour - startHour;
                        const height = durationHours * 80 - 20;
                        
                        // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        
                        // ì»¬ëŸ¼ ë¶„í• : ë™ì¼í•œ ë„ˆë¹„ë¡œ ë‚˜ëˆ”
                        const widthPercent = 100 / columnCount;
                        const leftPercent = (100 / columnCount) * index;
                        const rightPercent = 100 - leftPercent - widthPercent;
                        
                        const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                        const noteText = schedule.note ? schedule.note : '';
                        
                        // íˆ´íŒ HTML
                        const tooltip = `<div class="task-detail-tooltip">
                            <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                            ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                        </div>`;
                        
                        const scheduledClass = schedule.isUserScheduled ? ' scheduled' : '';
                        cellContent += `<div class="task ${category.color} ${schedule.user}${scheduledClass}" data-schedule-id="${scheduleId}" style="height: ${height}px; position: absolute; left: calc(${leftPercent}% + 4px); right: calc(${rightPercent}% + 4px); width: auto; top: 5px; z-index: ${index + 1}; ${index < columnCount - 1 ? 'border-right: 2px solid white;' : ''}"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                    });
                } else {
                    // ê²¹ì¹˜ì§€ ì•ŠëŠ” ê²½ìš° - ì „ì²´ ë„ˆë¹„ ì‚¬ìš©
                    hourSchedules.forEach(schedule => {
                        const category = CATEGORIES[schedule.category];
                        const user = USERS[schedule.user];
                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const endHour = parseInt(schedule.endTime.split(':')[0]);
                        const durationHours = endHour - startHour;
                        const height = durationHours * 80 - 20;
                        
                        // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        console.log(`âœ… [ì¼ë³„] ì‹œì‘ ë¸”ë¡ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                        
                        const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                        const noteText = schedule.note ? schedule.note : '';
                        
                        // íˆ´íŒ HTML
                        const tooltip = `<div class="task-detail-tooltip">
                            <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                            ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                        </div>`;
                        
                        const scheduledClass = schedule.isUserScheduled ? ' scheduled' : '';
                        cellContent += `<div class="task ${category.color} ${schedule.user}${scheduledClass}" data-schedule-id="${scheduleId}" style="height: ${height}px;"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                    });
                }
                
                // ì¤‘ê°„ ì‹œê°„ëŒ€ ì¼ì • (ì‹œì‘í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì§„í–‰ ì¤‘ì¸ ì¼ì •)ì— ëŒ€í•œ í˜¸ë²„ ì˜ì—­ ì¶”ê°€
                const currentHourNum = parseInt(hour.split(':')[0]);
                const middleSchedules = schedules.filter(s => {
                    const startHourNum = parseInt(s.startTime.split(':')[0]);
                    const endHourNum = parseInt(s.endTime.split(':')[0]);
                    return s.startTime !== hour && currentHourNum >= startHourNum && currentHourNum < endHourNum;
                });
                
                if (middleSchedules.length > 0) {
                    // í˜„ì¬ ì‹œê°„ì— ì§„í–‰ ì¤‘ì¸ ëª¨ë“  ì¼ì • (ì‹œì‘ + ì¤‘ê°„)
                    const allOngoingSchedules = schedules.filter(s => {
                        const startHourNum = parseInt(s.startTime.split(':')[0]);
                        const endHourNum = parseInt(s.endTime.split(':')[0]);
                        return currentHourNum >= startHourNum && currentHourNum < endHourNum;
                    });
                    
                    middleSchedules.forEach(schedule => {
                        // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        console.log(`ğŸ”´ [ì¼ë³„] í˜¸ë²„ ì˜ì—­ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                        
                        // ì´ ì¼ì •ì´ ì „ì²´ ì§„í–‰ ì¤‘ì¸ ì¼ì • ì¤‘ ëª‡ ë²ˆì§¸ì¸ì§€ ì°¾ê¸°
                        const scheduleIndex = allOngoingSchedules.findIndex(s => 
                            s.taskId === schedule.taskId && s.user === schedule.user && s.startTime === schedule.startTime
                        );
                        
                        // ì»¬ëŸ¼ ìœ„ì¹˜ ê³„ì‚° (ì‹œì‘ ì‹œê°„ê³¼ ë™ì¼í•œ ìœ„ì¹˜)
                        const totalColumns = allOngoingSchedules.length;
                        const widthPercent = 100 / totalColumns;
                        const leftPercent = (100 / totalColumns) * scheduleIndex;
                        const rightPercent = 100 - leftPercent - widthPercent;
                        
                        // íˆ¬ëª…í•œ í˜¸ë²„ ì˜ì—­ - ì…€ ì „ì²´ ë†’ì´ ì°¨ì§€ (z-indexë¥¼ ë†’ì—¬ì„œ task ë¸”ë¡ ìœ„ì— í‘œì‹œ)
                        cellContent += `<div class="task-hover-area ${schedule.user}" data-schedule-id="${scheduleId}" style="position: absolute; left: calc(${leftPercent}% + 4px); right: calc(${rightPercent}% + 4px); width: auto; top: 0; bottom: 0; z-index: 10000; background: rgba(255,0,0,0.05); cursor: pointer; pointer-events: auto;"></div>`;
                    });
                }
                
                dayGrid.innerHTML += `<div class="cell time-label">${hour}</div><div class="cell" style="position: relative;">${cellContent}</div>`;
            });
            
            // í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì •
            setupScheduleHoverEvents();
        }
        
        // ============================================
        // ğŸ“… ì›”ë³„ ë·° í—¬í¼ í•¨ìˆ˜
        // ============================================
        
        /**
         * í•œ ë‹¬ ì „ì²´ì˜ ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„ì„ ì°¾ìŠµë‹ˆë‹¤
         * @param {number} year - ì—°ë„
         * @param {number} month - ì›”
         * @returns {Array} ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„ ë°°ì—´
         */
        function findContinuousTaskRanges(year, month) {
            const ranges = [];
            const lastDate = new Date(year, month, 0).getDate();
            
            // ëª¨ë“  ë‚ ì§œì˜ ìŠ¤ì¼€ì¤„ ìˆ˜ì§‘
            const allSchedules = [];
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const daySchedules = getScheduleByDate(dateStr);
                
                daySchedules.forEach(schedule => {
                    allSchedules.push({
                        ...schedule,
                        date: date,
                        dateStr: dateStr
                    });
                });
            }
            
            // ì‚¬ëŒ-í…ŒìŠ¤í¬ë³„ë¡œ ê·¸ë£¹í™”
            const taskGroups = {};
            allSchedules.forEach(schedule => {
                const key = `${schedule.user}-${schedule.taskId}`;
                if (!taskGroups[key]) {
                    taskGroups[key] = [];
                }
                taskGroups[key].push(schedule);
            });
            
            // ê° ê·¸ë£¹ì—ì„œ ì—°ì†ëœ ë‚ ì§œ êµ¬ê°„ ì°¾ê¸°
            Object.values(taskGroups).forEach(group => {
                // ë‚ ì§œìˆœ ì •ë ¬
                group.sort((a, b) => a.date - b.date);
                
                let rangeStart = group[0];
                let rangeEnd = group[0];
                
                for (let i = 1; i < group.length; i++) {
                    if (group[i].date === rangeEnd.date + 1) {
                        // ì—°ì†ëœ ë‚ ì§œ
                        rangeEnd = group[i];
                    } else {
                        // ëŠê¹€ - í˜„ì¬ ë²”ìœ„ ì €ì¥í•˜ê³  ìƒˆë¡œ ì‹œì‘
                        ranges.push({
                            user: rangeStart.user,
                            taskId: rangeStart.taskId,
                            category: rangeStart.category,
                            title: rangeStart.title,
                            startDate: rangeStart.date,
                            endDate: rangeEnd.date,
                            startDateStr: rangeStart.dateStr,
                            endDateStr: rangeEnd.dateStr,
                            totalHours: rangeStart.totalHours
                        });
                        
                        rangeStart = group[i];
                        rangeEnd = group[i];
                    }
                }
                
                // ë§ˆì§€ë§‰ ë²”ìœ„ ì €ì¥
                ranges.push({
                    user: rangeStart.user,
                    taskId: rangeStart.taskId,
                    category: rangeStart.category,
                    title: rangeStart.title,
                    startDate: rangeStart.date,
                    endDate: rangeEnd.date,
                    startDateStr: rangeStart.dateStr,
                    endDateStr: rangeEnd.dateStr,
                    totalHours: rangeStart.totalHours
                });
            });
            
            return ranges;
        }
        
        // ============================================
        // ğŸ“… ì›”ë³„ ë·° ë™ì  ìƒì„±
        // ============================================
        
        function generateMonthView(year, month) {
            // ê¸°ë³¸ê°’ì´ ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©
            if (!year || !month) {
                const today = new Date();
                year = year || today.getFullYear();
                month = month || today.getMonth() + 1;
            }
            const monthGrid = document.getElementById('month-view-grid');
            monthGrid.innerHTML = '';
            
            // í˜„ì¬ ìƒíƒœ ì—…ë°ì´íŠ¸
            currentYear = year;
            currentMonth = month;
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const monthNames = ['', '1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('current-date-display').textContent = `${year}ë…„ ${monthNames[month]}`;
            
            // í—¤ë” ìƒì„±
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            let headerHTML = '';
            dayNames.forEach(day => {
                headerHTML += `<div class="cell cell-header">${day}</div>`;
            });
            monthGrid.innerHTML += headerHTML;
            
            // í•´ë‹¹ ì›”ì˜ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚  ê³„ì‚°
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const firstDayOfWeek = firstDay.getDay(); // 0(ì¼) ~ 6(í† )
            const lastDate = lastDay.getDate();
            
            // ì´ì „ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ë“¤
            const prevLastDay = new Date(year, month - 1, 0);
            const prevLastDate = prevLastDay.getDate();
            
            let dateHTML = '';
            let cellCount = 0;
            
            // ì´ì „ ë‹¬ ë‚ ì§œë“¤
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const date = prevLastDate - i;
                const isWeekend = cellCount % 7 === 0 || cellCount % 7 === 6;
                dateHTML += `<div class="cell" style="background:#fafafa;color:#ccc;display:flex;align-items:start;padding:8px;">${date}</div>`;
                cellCount++;
            }
            
            // ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„ ì°¾ê¸°
            const taskRanges = findContinuousTaskRanges(year, month);
            console.log('ğŸ“Š ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„:', taskRanges);
            
            // í˜„ì¬ ë‹¬ ë‚ ì§œë“¤ - í…ŒìŠ¤í¬ ë°”ë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆ ì¶”ê°€
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayOfWeek = (firstDayOfWeek + date - 1) % 7;
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const weekendStyle = isWeekend ? 'background:#fafafa;' : '';
                
                const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
                const dayName = dayNames[dayOfWeek];
                
                // ë‚ ì§œ ì…€ (í…ŒìŠ¤í¬ ë°” ì»¨í…Œì´ë„ˆ í¬í•¨)
                dateHTML += `<div class="cell" data-date="${dateStr}" data-cell-index="${cellCount}" onclick="goToDayView('${year}ë…„ ${month}ì›” ${date}ì¼ (${dayName})', event)" style="${weekendStyle}display:flex;flex-direction:column;align-items:start;padding:8px;position:relative;overflow:hidden;">`;
                dateHTML += `<div style="font-weight:600;flex-shrink:0;">${date}</div>`;
                dateHTML += `<div class="schedule-indicator" id="schedule-${dateStr}" style="flex-shrink:0;"></div>`;
                dateHTML += `<div class="task-bars-container" data-date="${dateStr}" style="position:absolute;top:24px;left:0;right:0;bottom:0;pointer-events:none;overflow:visible;"></div>`;
                dateHTML += `</div>`;
                cellCount++;
            }
            
            // ë‹¤ìŒ ë‹¬ ë‚ ì§œë“¤
            const remainingCells = (7 - (cellCount % 7)) % 7;
            for (let i = 1; i <= remainingCells; i++) {
                dateHTML += `<div class="cell" style="background:#fafafa;color:#ccc;display:flex;align-items:start;padding:8px;">${i}</div>`;
            }
            
            monthGrid.innerHTML += dateHTML;
            
            // ============================================
            // ì—°ì†ëœ í…ŒìŠ¤í¬ ë°” ë Œë”ë§ (DOM ë Œë”ë§ í›„)
            // ============================================
            
            // DOMì´ ë Œë”ë§ëœ í›„ í…ŒìŠ¤í¬ ë°” ì¶”ê°€
            setTimeout(() => {
                const gridElement = monthGrid;
                const dateCells = gridElement.querySelectorAll('.cell[data-date]');
                if (dateCells.length === 0) return;
                
                // ì „ì²´ í…ŒìŠ¤í¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë ˆì´ì–´ ê´€ë¦¬ (ë‚ ì§œë³„)
                const dateLayers = {}; // { '2025-12-01': [{ layerIndex: 0, occupiedDates: [1,2,3] }], ... }
                
                taskRanges.forEach(range => {
                    const category = CATEGORIES[range.category];
                    const user = USERS[range.user];
                    
                    if (!user || !category) return;
                    
                    // ë“±ë¡ëœ í…ŒìŠ¤í¬ì¸ì§€ í™•ì¸
                    const isScheduled = range.isUserScheduled || 
                        TASK_ASSIGNMENTS.some(a => 
                            a.taskId === range.taskId && 
                            a.user === range.user && 
                            a.isUserScheduled
                        );
                    
                    // ë‚ ì§œ ë²”ìœ„ ë‚´ì˜ ê° ë‚ ì§œì— ëŒ€í•´ ì²˜ë¦¬
                    for (let date = range.startDate; date <= range.endDate; date++) {
                        const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        const dateCell = gridElement.querySelector(`.cell[data-date="${dateStr}"]`);
                        if (!dateCell) continue;
                        
                        const taskBarsContainer = dateCell.querySelector('.task-bars-container');
                        if (!taskBarsContainer) continue;
                        
                        // í•´ë‹¹ ë‚ ì§œì˜ ë ˆì´ì–´ ê´€ë¦¬
                        if (!dateLayers[dateStr]) {
                            dateLayers[dateStr] = [];
                        }
                        
                        // ì‚¬ìš© ê°€ëŠ¥í•œ ë ˆì´ì–´ ì°¾ê¸° (ê°™ì€ taskIdê°€ ì•„ë‹Œ ë ˆì´ì–´)
                        let layerIndex = -1;
                        for (let i = 0; i < dateLayers[dateStr].length; i++) {
                            if (dateLayers[dateStr][i].taskId !== range.taskId) {
                                layerIndex = i;
                                break;
                            }
                        }
                        
                        if (layerIndex === -1) {
                            // ìƒˆ ë ˆì´ì–´ ìƒì„±
                            layerIndex = dateLayers[dateStr].length;
                            dateLayers[dateStr].push({
                                taskId: range.taskId,
                                layerIndex: layerIndex
                            });
                        }
                        
                        const barSpan = range.endDate - range.startDate + 1;
                        
                        const taskBar = document.createElement('div');
                        taskBar.className = `month-task-bar ${category.color} ${range.user} ${isScheduled ? 'scheduled' : ''}`;
                        taskBar.setAttribute('data-task-id', range.taskId);
                        taskBar.setAttribute('data-scheduled', isScheduled ? 'true' : 'false');
                        taskBar.setAttribute('data-start-date', range.startDate);
                        taskBar.setAttribute('data-end-date', range.endDate);
                        taskBar.style.pointerEvents = 'auto'; // ë¶€ëª¨ì˜ pointer-events: noneì„ ë¬´ì‹œ
                        taskBar.style.cursor = 'pointer'; // ì»¤ì„œ ë³€ê²½
                        
                        // ì…€ ë‚´ë¶€ ìƒëŒ€ ìœ„ì¹˜ ì„¤ì • (ì ì‘í˜•)
                        taskBar.style.position = 'absolute';
                        taskBar.style.top = `${layerIndex * 24}px`;
                        taskBar.style.left = '2px';
                        taskBar.style.right = '2px';
                        taskBar.style.height = '22px';
                        // widthëŠ” left/rightë¡œ ìë™ ê³„ì‚°ë˜ë¯€ë¡œ ì œê±°
                        
                        // í…ìŠ¤íŠ¸ ì¶”ê°€
                        const daysText = barSpan > 1 ? ` (${barSpan}ì¼)` : '';
                        const textNode = document.createTextNode(`${user.name}: ${range.title}${daysText}`);
                        taskBar.appendChild(textNode);
                        
                        // íˆ´íŒ ì¶”ê°€ (bodyì— ì§ì ‘ ì¶”ê°€í•˜ì—¬ overflow ì˜í–¥ ì—†ê²Œ)
                        const tooltip = document.createElement('div');
                        tooltip.className = 'month-task-tooltip';
                        tooltip.setAttribute('data-task-bar-id', `task-bar-${range.taskId}-${range.user}-${range.startDate}`);
                        tooltip.innerHTML = `
                            <strong>${category.name} - ${range.title}</strong>
                            <div>ğŸ‘¤ ë‹´ë‹¹: ${user.name}</div>
                            <div>ğŸ“… ê¸°ê°„: ${range.startDate}ì¼ ~ ${range.endDate}ì¼ (${barSpan}ì¼)</div>
                            <div>â±ï¸ ì´ ì‹œê°„: ${range.totalHours || 0}ì‹œê°„</div>
                        `;
                        // bodyì— ì§ì ‘ ì¶”ê°€ (ì…€ì˜ overflow ì˜í–¥ ì—†ê²Œ)
                        document.body.appendChild(tooltip);
                        // taskBarì— ì°¸ì¡° ì €ì¥
                        taskBar.setAttribute('data-tooltip-id', tooltip.getAttribute('data-task-bar-id'));
                        
                        // í´ë¦­ ì´ë²¤íŠ¸
                        taskBar.addEventListener('click', (e) => {
                            e.stopPropagation();
                            e.preventDefault();
                            const startDate = new Date(range.startDateStr);
                            goToWeekView(startDate);
                        });
                        
                        // í˜¸ë²„ ì´ë²¤íŠ¸
                        let hoverTimeout = null;
                        let isHovering = false;
                        
                        taskBar.addEventListener('mouseenter', function(e) {
                            e.stopPropagation();
                            const taskId = this.getAttribute('data-task-id');
                            const tooltipId = this.getAttribute('data-tooltip-id');
                            
                            // ê¸°ì¡´ íƒ€ì„ì•„ì›ƒ ì œê±°
                            if (hoverTimeout) {
                                clearTimeout(hoverTimeout);
                                hoverTimeout = null;
                            }
                            
                            isHovering = true;
                            
                            // ê°™ì€ task_idë¥¼ ê°€ì§„ ëª¨ë“  í…ŒìŠ¤í¬ ë°” í•˜ì´ë¼ì´íŠ¸
                            document.querySelectorAll('.month-task-bar').forEach(bar => {
                                const barTaskId = bar.getAttribute('data-task-id');
                                if (barTaskId === taskId) {
                                    bar.classList.add('same-task-highlight');
                                }
                            });
                            
                            // íˆ´íŒ ì°¾ê¸° (bodyì—ì„œ)
                            const tooltip = document.querySelector(`.month-task-tooltip[data-task-bar-id="${tooltipId}"]`);
                            if (!tooltip) {
                                console.warn('âš ï¸ íˆ´íŒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', tooltipId);
                                return;
                            }
                            
                            console.log('ğŸ–±ï¸ íˆ´íŒ í‘œì‹œ ì‹œë„:', taskId);
                            
                            // ë¨¼ì € í‘œì‹œí•˜ì—¬ ì‹¤ì œ í¬ê¸° ì¸¡ì • (visibility: hiddenìœ¼ë¡œ ë³´ì´ì§€ ì•Šê²Œ)
                            tooltip.style.setProperty('position', 'fixed', 'important');
                            tooltip.style.setProperty('display', 'block', 'important');
                            tooltip.style.setProperty('visibility', 'hidden', 'important');
                            tooltip.style.top = '0px';
                            tooltip.style.left = '0px';
                            tooltip.style.transform = 'none';
                            
                            // ê°•ì œ ë¦¬í”Œë¡œìš°ë¥¼ ìœ„í•´ offsetHeight ì½ê¸°
                            void tooltip.offsetHeight;
                            
                            // íƒœìŠ¤í¬ ë°” ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                            const rect = this.getBoundingClientRect();
                            const tooltipHeight = tooltip.offsetHeight || tooltip.scrollHeight || 100;
                            const tooltipWidth = tooltip.offsetWidth || tooltip.scrollWidth || 200;
                            
                            console.log('ğŸ“ íˆ´íŒ í¬ê¸°:', tooltipWidth, 'x', tooltipHeight);
                            console.log('ğŸ“ í…ŒìŠ¤í¬ ë°” ìœ„ì¹˜:', rect.left, rect.top, rect.width, rect.height);
                            
                            // íˆ´íŒì„ íƒœìŠ¤í¬ ë°” ì¤‘ì•™ ë°”ë¡œ ìœ„ì— ê³ ì • (ì¼ë³„/ì£¼ë³„ ë·°ì™€ ë™ì¼)
                            let top = rect.top - tooltipHeight - 8;
                            let left = rect.left + (rect.width / 2);
                            
                            // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
                            if (top < 10) {
                                // ìœ„ìª½ ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ì•„ë˜ìª½ì— í‘œì‹œ
                                top = rect.bottom + 8;
                            }
                            if (left - (tooltipWidth / 2) < 10) {
                                left = tooltipWidth / 2 + 10;
                            } else if (left + (tooltipWidth / 2) > window.innerWidth - 10) {
                                left = window.innerWidth - (tooltipWidth / 2) - 10;
                            }
                            
                            console.log('ğŸ“ íˆ´íŒ ìœ„ì¹˜:', left, top);
                            
                            tooltip.style.top = `${top}px`;
                            tooltip.style.left = `${left}px`;
                            tooltip.style.transform = 'translateX(-50%)';
                            tooltip.style.setProperty('display', 'block', 'important');
                            tooltip.style.setProperty('visibility', 'visible', 'important');
                            tooltip.style.setProperty('opacity', '1', 'important');
                            tooltip.style.setProperty('background-color', '#ffffff', 'important');
                            tooltip.style.setProperty('background', '#ffffff', 'important');
                            tooltip.style.setProperty('z-index', '9999999', 'important');
                            tooltip.style.setProperty('pointer-events', 'none', 'important');
                            
                            console.log('âœ… íˆ´íŒ í‘œì‹œ ì™„ë£Œ');
                        });
                        
                        taskBar.addEventListener('mouseleave', function(e) {
                            e.stopPropagation();
                            isHovering = false;
                            
                            // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ íˆ´íŒìœ¼ë¡œ ë§ˆìš°ìŠ¤ ì´ë™ ì‹œê°„ ì œê³µ
                            hoverTimeout = setTimeout(() => {
                                if (!isHovering) {
                                    document.querySelectorAll('.month-task-bar').forEach(bar => {
                                        bar.classList.remove('same-task-highlight');
                                    });
                                    
                                    const tooltipId = this.getAttribute('data-tooltip-id');
                                    const tooltip = document.querySelector(`.month-task-tooltip[data-task-bar-id="${tooltipId}"]`);
                                    if (tooltip) {
                                        tooltip.style.setProperty('display', 'none', 'important');
                                        tooltip.style.setProperty('visibility', 'hidden', 'important');
                                        console.log('âŒ íˆ´íŒ ìˆ¨ê¹€');
                                    }
                                }
                            }, 100); // 100ms ì§€ì—°
                        });
                        
                        // íˆ´íŒì—ë„ í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€ (íˆ´íŒ ìœ„ì— ë§ˆìš°ìŠ¤ê°€ ìˆì„ ë•ŒëŠ” ìˆ¨ê¸°ì§€ ì•ŠìŒ)
                        const tooltipIdForEvent = taskBar.getAttribute('data-tooltip-id');
                        const tooltipElement = document.querySelector(`.month-task-tooltip[data-task-bar-id="${tooltipIdForEvent}"]`);
                        if (tooltipElement) {
                            tooltipElement.addEventListener('mouseenter', function() {
                                isHovering = true;
                                if (hoverTimeout) {
                                    clearTimeout(hoverTimeout);
                                    hoverTimeout = null;
                                }
                            });
                            
                            tooltipElement.addEventListener('mouseleave', function() {
                                isHovering = false;
                                this.style.setProperty('display', 'none', 'important');
                                this.style.setProperty('visibility', 'hidden', 'important');
                                document.querySelectorAll('.month-task-bar').forEach(bar => {
                                    bar.classList.remove('same-task-highlight');
                                });
                            });
                        }
                        
                        // ê° ë‚ ì§œ ì…€ì— í…ŒìŠ¤í¬ ë°” ì¶”ê°€
                        taskBarsContainer.appendChild(taskBar);
                    }
                });
                
                console.log('âœ… ì›”ë³„ ë·° í…ŒìŠ¤í¬ ë°” ë Œë”ë§ ì™„ë£Œ:', taskRanges.length);
            }, 100);  // DOM ë Œë”ë§ ëŒ€ê¸°
            
            console.log('âœ… ì›”ë³„ ë·° ìƒì„± ì™„ë£Œ');
        }
        
        // ============================================
        // ğŸ¨ ì›”ë³„ ë·° íˆ´íŒ ìë™ ìƒì„±
        // ============================================
        
        function generateTooltipsForMonthView() {
            // ì›”ë³„ ë·°ì˜ ëª¨ë“  ë‚ ì§œ ì…€ì„ ì°¾ìŒ
            document.querySelectorAll('.month-view [data-date]').forEach(dateCell => {
                const dateStr = dateCell.getAttribute('data-date');
                const scheduleSummary = getScheduleSummaryByDate(dateStr);
                
                // í•´ë‹¹ ë‚ ì§œì— ì¼ì •ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                if (Object.keys(scheduleSummary).length === 0) return;
                
                // ë‚ ì§œ ì…€ ë‚´ì˜ ëª¨ë“  .person ìš”ì†Œë¥¼ ì°¾ìŒ
                const personElements = dateCell.querySelectorAll('.person');
                
                personElements.forEach(personEl => {
                    // ì´ë¯¸ íˆ´íŒì´ ìˆìœ¼ë©´ ìŠ¤í‚µ
                    if (personEl.querySelector('.task-tooltip')) return;
                    
                    // ì‚¬ìš©ì í´ë˜ìŠ¤ ì°¾ê¸° (user-kim, user-lee ë“±)
                    const userClass = Array.from(personEl.classList).find(c => c.startsWith('user-'));
                    if (!userClass) return;
                    
                    const userSchedule = scheduleSummary[userClass];
                    if (!userSchedule) return;
                    
                    // ë‚ ì§œ í¬ë§· (MM/DD)
                    const dateObj = new Date(dateStr);
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    
                    // íˆ´íŒ HTML ìƒì„±
                    const tooltip = document.createElement('div');
                    tooltip.className = 'task-tooltip';
                    
                    let tooltipHTML = `<div class="tooltip-title">${userSchedule.userName} - ${month}/${day} ì—…ë¬´</div>`;
                    
                    userSchedule.categories.forEach(cat => {
                        cat.tasks.forEach(task => {
                            tooltipHTML += `
                                <div class="task-item">
                                    <span style="color:${cat.colorCode};">â—</span>
                                    <span>${cat.categoryName} - ${task.title}</span>
                                </div>
                            `;
                        });
                    });
                    
                    tooltip.innerHTML = tooltipHTML;
                    personEl.appendChild(tooltip);
                });
            });
        }
        
        // ============================================
        // ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        // ============================================
        
        // ë¶„ë¥˜ íˆ´íŒ ìœ„ì¹˜ ì„¤ì • í•¨ìˆ˜
        function setupLegendTooltip() {
            const legendWrapper = document.querySelector('.legend-wrapper');
            const legendBtn = document.querySelector('.legend-btn');
            let legendPopup = document.querySelector('.legend-popup');
            
            if (!legendWrapper || !legendBtn) return;
            
            // íŒì—…ì´ ì—†ìœ¼ë©´ ìƒì„±
            if (!legendPopup) {
                legendPopup = document.createElement('div');
                legendPopup.className = 'legend-popup';
                legendPopup.innerHTML = `
                    <h4 style="margin:0 0 10px 0;">ì—…ë¬´ ì†Œë¶„ë¥˜ ê°€ì´ë“œ</h4>
                    <div class="legend-item"><div class="dot" style="background:var(--task-blue-border)"></div> ê¸°íš (Planning)</div>
                    <div class="legend-item"><div class="dot" style="background:var(--task-green-border)"></div> ê°œë°œ (Development)</div>
                    <div class="legend-item"><div class="dot" style="background:var(--task-yellow-border)"></div> ë””ìì¸ (Design)</div>
                    <div style="margin-top:12px;padding-top:10px;border-top:1px solid #e5e7eb;font-size:0.75rem;color:#64748b;line-height:1.4;">
                        * í•œ ì‚¬ëŒì´ ì—¬ëŸ¬ ì†Œë¶„ë¥˜ ì—…ë¬´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                `;
                // bodyì— ì§ì ‘ appendí•˜ì—¬ stacking context ë¬¸ì œ í•´ê²°
                document.body.appendChild(legendPopup);
            }
            
            // í˜¸ë²„ ì‹œ íˆ´íŒ í‘œì‹œ ë° ìœ„ì¹˜ ê³„ì‚°
            legendWrapper.addEventListener('mouseenter', function() {
                const rect = legendBtn.getBoundingClientRect();
                
                // ë¨¼ì € í‘œì‹œí•˜ì—¬ ì‹¤ì œ í¬ê¸° ì¸¡ì • (í™”ë©´ ë°–ì— ë°°ì¹˜)
                legendPopup.style.visibility = 'hidden';
                legendPopup.style.setProperty('display', 'block', 'important'); // !importantë¡œ ê°•ì œ í‘œì‹œ
                legendPopup.style.top = '0px';
                legendPopup.style.left = '0px';
                
                // ê°•ì œ ë¦¬í”Œë¡œìš°ë¥¼ ìœ„í•´ offsetHeight ì½ê¸°
                void legendPopup.offsetHeight;
                
                // ì‹¤ì œ í¬ê¸° ì¸¡ì •
                const popupHeight = legendPopup.offsetHeight || legendPopup.scrollHeight || 200;
                const popupWidth = legendPopup.offsetWidth || legendPopup.scrollWidth || 220;
                
                // íˆ´íŒì„ ë²„íŠ¼ ì•„ë˜ì— í‘œì‹œ
                let top = rect.bottom + 8;
                let left = rect.left;
                
                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
                if (top + popupHeight > window.innerHeight - 10) {
                    // ì•„ë˜ìª½ ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ìœ„ìª½ì— í‘œì‹œ
                    top = rect.top - popupHeight - 8;
                }
                if (left + popupWidth > window.innerWidth - 10) {
                    left = window.innerWidth - popupWidth - 10;
                } else if (left < 10) {
                    left = 10;
                }
                
                // ìœ„ì¹˜ ì„¤ì •
                legendPopup.style.top = `${top}px`;
                legendPopup.style.left = `${left}px`;
                legendPopup.style.setProperty('visibility', 'visible', 'important'); // !importantë¡œ ê°•ì œ í‘œì‹œ
                legendPopup.style.setProperty('display', 'block', 'important'); // !importantë¡œ ê°•ì œ í‘œì‹œ
                legendPopup.style.setProperty('opacity', '1', 'important');
                legendPopup.style.setProperty('background-color', '#ffffff', 'important');
                legendPopup.style.setProperty('background', '#ffffff', 'important');
                legendPopup.style.setProperty('z-index', '9999999', 'important'); // !importantë¡œ ê°•ì œ ì„¤ì •í•˜ì—¬ ë‹¤ë¥¸ ë·°ì— ê°€ë ¤ì§€ì§€ ì•Šë„ë¡
                legendPopup.style.setProperty('position', 'fixed', 'important'); // positionë„ !importantë¡œ ê°•ì œ ì„¤ì •
            });
            
            // í˜¸ë²„ ì´íƒˆ ì‹œ íˆ´íŒ ìˆ¨ê¹€
            legendWrapper.addEventListener('mouseleave', function() {
                legendPopup.style.setProperty('display', 'none', 'important');
                legendPopup.style.setProperty('visibility', 'hidden', 'important');
            });
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸ“… ìº˜ë¦°ë” ì´ˆê¸°í™” ì¤‘...');
            
            // 1. ë°ì´í„° ë¡œë“œ (ì‚¬ì „ì— ë“±ë¡ëœ ìœ ì €ì™€ ì¼ì • ë°ì´í„°)
            await loadMockData();
            await loadSchedulesFromLocalStorage();
            dataLoaded = true;
            console.log('ğŸ“Š ì „ì²´ ìŠ¤ì¼€ì¤„:', TASK_ASSIGNMENTS.length, 'ê°œ');
            
            // ë¶„ë¥˜ íˆ´íŒ ì„¤ì •
            setupLegendTooltip();
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì´ˆê¸°í™”
            const today = new Date();
            const todayYear = today.getFullYear();
            const todayMonth = today.getMonth() + 1;
            const todayDate = `${todayYear}-${String(todayMonth).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
            const todayDisplay = `${todayYear}ë…„ ${todayMonth}ì›” ${today.getDate()}ì¼ (${dayNames[today.getDay()]})`;
            
            // ì£¼ë³„ ë·° ë‚ ì§œ ì—…ë°ì´íŠ¸
            currentWeekDates = getCurrentWeekDates();
            
            // 2. ì›”ë³„ ë·° ìƒì„± (ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€)
            generateMonthView(todayYear, todayMonth);
            console.log('âœ… ì›”ë³„ ë·° ìƒì„± ì™„ë£Œ!');
            
            // 3. ì£¼ë³„ ë·° ìƒì„± (ì˜¤ëŠ˜ì´ ì†í•œ ì£¼)
            generateWeekView();
            console.log('âœ… ì£¼ë³„ ë·° ìƒì„± ì™„ë£Œ!');
            
            // 4. ì¼ë³„ ë·° ìƒì„± (ì˜¤ëŠ˜ ë‚ ì§œ)
            generateDayView(todayDate, todayDisplay);
            console.log('âœ… ì¼ë³„ ë·° ìƒì„± ì™„ë£Œ!');
            
            // 5. ì´ˆê¸° ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ (ì›”ë³„ ë·°ê°€ ê¸°ë³¸)
            document.getElementById('prev-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'block';
            
            // 6. ì´ˆê¸° í•„í„° ì ìš© (ì›”ë³„ ë·°ì˜ í…ŒìŠ¤í¬ ë°”ë„ í¬í•¨)
            setTimeout(() => {
                syncCalendar();
                console.log('âœ… ì´ˆê¸° í•„í„° ì ìš© ì™„ë£Œ!');
            }, 200); // ì›”ë³„ ë·° í…ŒìŠ¤í¬ ë°” ìƒì„± í›„ ì ìš©
            
            console.log('ğŸ‰ ëª¨ë“  ë·° ì´ˆê¸°í™” ì™„ë£Œ!');
        });
        
        // localStorage ë³€ê²½ ê°ì§€ (ë‹¤ë¥¸ íƒ­ì—ì„œ ìŠ¤ì¼€ì¤„ ë“±ë¡ ì‹œ)
        window.addEventListener('storage', function(e) {
            if (e.key === 'projectSchedules') {
                loadSchedulesFromLocalStorage().then(() => {
                    // í˜„ì¬ í™œì„±í™”ëœ ë·° ì¬ìƒì„±
                    const activeView = document.querySelector('.calendar-grid.active');
                    if (activeView) {
                        if (activeView.classList.contains('month-view')) {
                            generateMonthView(currentYear, currentMonth);
                        } else if (activeView.classList.contains('week-view')) {
                            generateWeekView();
                        } else if (activeView.classList.contains('day-view')) {
                            generateDayView(currentDayDate, currentDayDateDisplay);
                        }
                        syncCalendar();
                    }
                });
            }
        });
        
        // ì£¼ê¸°ì ìœ¼ë¡œ ì²´í¬ (ê°™ì€ íƒ­ì—ì„œë„ ì—…ë°ì´íŠ¸)
        setInterval(async function() {
            if (dataLoaded) {
                const beforeCount = TASK_ASSIGNMENTS.length;
                await loadSchedulesFromLocalStorage();
                const afterCount = TASK_ASSIGNMENTS.length;
                
                // ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ë·° ì¬ìƒì„±
                if (beforeCount !== afterCount) {
                    const activeView = document.querySelector('.calendar-grid.active');
                    if (activeView) {
                        if (activeView.classList.contains('month-view')) {
                            generateMonthView(currentYear, currentMonth);
                        } else if (activeView.classList.contains('week-view')) {
                            generateWeekView();
                        } else if (activeView.classList.contains('day-view')) {
                            generateDayView(currentDayDate, currentDayDateDisplay);
                        }
                        syncCalendar();
                    }
                }
            }
        }, 10000); // 10ì´ˆë§ˆë‹¤ ì²´í¬
        
        // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ì›”ë³„ ë·° ì¬ìƒì„± (ì ì‘í˜• ë ˆì´ì•„ì›ƒ)
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                const activeView = document.querySelector('.calendar-grid.active');
                if (activeView && activeView.classList.contains('month-view')) {
                    generateMonthView(currentYear, currentMonth);
                    setTimeout(() => {
                        syncCalendar();
                    }, 200);
                }
            }, 300); // ë””ë°”ìš´ì‹±
        });
        
        
        // ============================================
        // ğŸ’¾ localStorageì—ì„œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ
        // ============================================
        
        // JSON íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ
        async function loadFromJSON() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) {
                    return null;
                }
                const data = await response.json();
                return data;
            } catch (error) {
                return null;
            }
        }
        
        async function loadSchedulesFromLocalStorage() {
            // localStorageì—ì„œ ë¡œë“œ
            const saved = localStorage.getItem('projectSchedules');
            if (!saved) {
                console.log('âš ï¸ projectSchedulesê°€ ì—†ìŠµë‹ˆë‹¤.');
                // ê¸°ì¡´ TASK_ASSIGNMENTSëŠ” ìœ ì§€ (ì´ˆê¸° ë¡œë“œê°€ ì•„ë‹Œ ê²½ìš°)
                return;
            }
            
            try {
                const data = JSON.parse(saved);
                const schedules = data.schedules || [];
                
                console.log('ğŸ“¥ ì €ì¥ëœ ìŠ¤ì¼€ì¤„ ë¡œë“œ:', schedules.length, 'ê°œ');
                
                // ì‚¬ìš©ì ë§¤í•‘ (ì´ë¦„ -> user ID)
                const userMapping = {};
                if (typeof USERS_DATA !== 'undefined') {
                    USERS_DATA.users.forEach(user => {
                        userMapping[user.name] = user.id;
                    });
                }
                
                // ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ Set ì‚¬ìš©
                const existingAssignments = new Set();
                TASK_ASSIGNMENTS.forEach(a => {
                    existingAssignments.add(`${a.taskId}-${a.user}-${a.startDate}-${a.startTime}`);
                });
                
                let addedCount = 0;
                schedules.forEach(schedule => {
                    const task = schedule.task || {};
                    const userName = schedule.userName || schedule.user;
                    const userId = userMapping[userName] || getUserByName(userName);
                    
                    if (!userId) {
                        // ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš° ê²½ê³ ë§Œ ì¶œë ¥í•˜ê³  ìŠ¤í‚µ (ì—ëŸ¬ê°€ ì•„ë‹Œ ê²½ê³ )
                        console.warn('âš ï¸ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', userName, '- ìŠ¤ì¼€ì¤„ì´ ìŠ¤í‚µë©ë‹ˆë‹¤.');
                        return;
                    }
                    
                    const category = getCategoryFromTask(task);
                    const assignmentKey = `${schedule.taskId}-${userId}-${schedule.startDate}-${schedule.startTime}`;
                    
                    // ì¤‘ë³µ ì²´í¬
                    if (existingAssignments.has(assignmentKey)) {
                        return;
                    }
                    
                    // TASKSì— ì¶”ê°€ (ì¤‘ë³µ ì²´í¬)
                    if (!TASKS[schedule.taskId]) {
                        TASKS[schedule.taskId] = {
                            taskId: schedule.taskId,
                            title: task.ì†Œë¶„ë¥˜ || task.ì¤‘ë¶„ë¥˜ || task.title || 'í…ŒìŠ¤í¬',
                            category: category,
                            totalHours: task.í• ë‹¹ì‹œê°„ || task.ê¸°ì¤€ì‹œê°„ || 0,
                            projectId: task.projectId || task.ì‚¬ì—…ëª… || 'project-unknown'
                        };
                    }
                    
                    // TASK_ASSIGNMENTSì— ì¶”ê°€
                    TASK_ASSIGNMENTS.push({
                        taskId: schedule.taskId,
                        user: userId,
                        startDate: schedule.startDate,
                        endDate: schedule.endDate,
                        startTime: schedule.startTime,
                        endTime: schedule.endTime,
                        note: task.ë¹„ê³  || schedule.note || '',
                        isUserScheduled: true
                    });
                    
                    existingAssignments.add(assignmentKey);
                    addedCount++;
                });
                
                console.log('âœ… ìŠ¤ì¼€ì¤„ ë¡œë“œ ì™„ë£Œ - TASKS:', Object.keys(TASKS).length, 'ê°œ');
                console.log('âœ… ìŠ¤ì¼€ì¤„ ë¡œë“œ ì™„ë£Œ - TASK_ASSIGNMENTS:', TASK_ASSIGNMENTS.length, 'ê°œ (ìƒˆë¡œ ì¶”ê°€:', addedCount, 'ê°œ)');
                
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ============================================
        // ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ë° ë°ì´í„° ì²˜ë¦¬
        // ============================================
        
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    processExcelData(jsonData);
                } catch (error) {
                    console.error('ì—‘ì…€ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
                    alert('ì—‘ì…€ íŒŒì¼ ì½ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function processExcelData(data) {
            console.log('ğŸ“Š ì—‘ì…€ ë°ì´í„°:', data);
            
            // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
            TASK_ASSIGNMENTS.length = 0;
            Object.keys(TASKS).forEach(key => delete TASKS[key]);
            
            let taskCounter = 1;
            const categoryMapping = {
                'ê¸°íš': 'planning',
                'ê°œë°œ': 'development',
                'ë””ìì¸': 'design',
                'ì´¬ì˜': 'design',
                'ì—ì…‹': 'development',
                'êµìœ¡': 'planning'
            };
            
            // ì‚¬ìš©ì ë§¤í•‘ (ì‹¤ì œë¡œëŠ” ì—‘ì…€ì—ì„œ ë‹´ë‹¹ì ì •ë³´ë¥¼ ì½ì–´ì™€ì•¼ í•¨)
            const userMapping = {
                'ì´ê²½ìˆ˜': 'user-kim',
                'ê¹€ì² ìˆ˜': 'user-kim', // ì´ì „ ë°ì´í„° í˜¸í™˜ì„±
                'ì´ì˜í¬': 'user-lee',
                'ë°•ëª…ìˆ˜': 'user-park',
                'í•˜í•˜': 'user-haha'
            };
            
            data.forEach((row, index) => {
                const taskId = `task-${String(taskCounter).padStart(3, '0')}`;
                
                // ì†Œë¶„ë¥˜ì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ë¡ 
                const category3 = row['ì†Œë¶„ë¥˜'] || row['category3'] || '';
                let category = 'planning';
                for (const [key, value] of Object.entries(categoryMapping)) {
                    if (category3.includes(key)) {
                        category = value;
                        break;
                    }
                }
                
                // í…ŒìŠ¤í¬ ì •ì˜ ìƒì„±
                TASKS[taskId] = {
                    taskId: taskId,
                    title: row['ì¤‘ë¶„ë¥˜'] || row['category2'] || `í…ŒìŠ¤í¬ ${taskCounter}`,
                    category: category,
                    totalHours: parseInt(row['ê¸°ì¤€ì‹œê°„'] || row['standardHours']) || 8
                };
                
                // ì„ì‹œ í• ë‹¹ ìƒì„± (ì‹¤ì œë¡œëŠ” ì—‘ì…€ì—ì„œ ë‹´ë‹¹ì, ë‚ ì§œ ì •ë³´ë¥¼ ì½ì–´ì™€ì•¼ í•¨)
                const userName = row['ë‹´ë‹¹ì'] || Object.keys(userMapping)[index % 4];
                const userId = userMapping[userName] || 'user-kim';
                const hours = TASKS[taskId].totalHours;
                
                // 3ì›” ì²«ì§¸ ì£¼ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë°°ì¹˜
                const startDay = 1 + Math.floor(taskCounter / 2);
                const endDay = Math.min(startDay + Math.ceil(hours / 8) - 1, 31);
                
                TASK_ASSIGNMENTS.push({
                    taskId: taskId,
                    user: userId,
                    startDate: `2023-03-${String(startDay).padStart(2, '0')}`,
                    endDate: `2023-03-${String(endDay).padStart(2, '0')}`,
                    startTime: '09:00',
                    endTime: hours <= 8 ? `${9 + hours}:00` : '18:00',
                    note: row['ë¹„ê³ '] || row['note'] || ''
                });
                
                taskCounter++;
            });
            
            console.log('âœ… ì²˜ë¦¬ëœ í…ŒìŠ¤í¬:', TASKS);
            console.log('âœ… ì²˜ë¦¬ëœ í• ë‹¹:', TASK_ASSIGNMENTS);
            
            // ëª¨ë“  ë·° ì¬ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
            generateMonthView(currentYear, currentMonth);
            generateWeekView();
            generateDayView();
            syncCalendar();
            
            alert(`${data.length}ê°œì˜ í…ŒìŠ¤í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }
    </script>
    </div> <!-- main-container ë‹«ê¸° -->
</body>
</html>
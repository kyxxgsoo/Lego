<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ë“±ë¡ - Lego</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --bg-gray: #f4f6f8;
            --border-color: #e5e7eb;
            --primary-blue: #2563eb;
            --text-dark: #1e293b;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .top-nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--primary-blue);
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-menu-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-menu-btn:hover {
            background: var(--bg-gray);
        }

        .nav-menu-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .logout-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--bg-gray);
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* ì™¼ìª½: ë¸”ë¡ ì˜ì—­ */
        .blocks-section {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            min-height: 600px;
        }

        .blocks-section h2 {
            margin: 0 0 20px 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .blocks-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .task-block-group {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }

        .task-block-group.planning {
            border-left-color: #3b82f6;
        }

        .task-block-group.development {
            border-left-color: #22c55e;
        }

        .task-block-group.design {
            border-left-color: #eab308;
        }

        .task-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .task-block-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .task-block-meta {
            font-size: 0.85rem;
            color: #64748b;
        }

        .task-blocks-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .task-block {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 2px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .task-block:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .task-block.planning {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .task-block.planning.scheduled-active {
            background: #3b82f6 !important;
            border-color: #2563eb !important;
            color: white !important;
            opacity: 1;
        }

        .task-block.development {
            background: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }

        .task-block.development.scheduled-active {
            background: #22c55e !important;
            border-color: #16a34a !important;
            color: white !important;
            opacity: 1;
        }

        .task-block.design {
            background: #fef9c3;
            border-color: #eab308;
            color: #854d0e;
        }

        .task-block.design.scheduled-active {
            background: #eab308 !important;
            border-color: #ca8a04 !important;
            color: white !important;
            opacity: 1;
        }

        .task-block.scheduled {
            background: #9ca3af !important;
            border-color: #6b7280 !important;
            color: white !important;
            opacity: 0.7;
        }

        .task-block-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            background: #1e293b;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: normal;
            min-width: 180px;
            max-width: 250px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            line-height: 1.5;
        }
        
        .task-block-tooltip div {
            margin-bottom: 2px;
        }
        
        .task-block-tooltip div:last-child {
            margin-bottom: 0;
        }

        /* íˆ´íŒì€ JSë¡œ ì œì–´í•˜ë¯€ë¡œ CSS hover ì œê±° */

        /* ì˜¤ë¥¸ìª½: íŒ€ì› ë¦¬ìŠ¤íŠ¸ */
        .team-list-section {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-height: 800px;
            overflow-y: auto;
        }

        .team-list-section h2 {
            margin: 0 0 15px 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-btn {
            flex: 1;
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: var(--primary-blue);
            background: #eff6ff;
        }

        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .team-member-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-blue);
        }

        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .member-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .member-task-count {
            background: var(--primary-blue);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .member-task-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .member-task-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
        }

        .member-task-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 6px;
        }

        .member-task-title {
            font-weight: 600;
            color: var(--text-dark);
        }

        .member-task-hours {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .member-task-categories {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .category-tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .category-tag.primary {
            background: #dbeafe;
            color: #1e40af;
        }

        .category-tag.secondary {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .category-tag.tertiary {
            background: #fef3c7;
            color: #92400e;
        }

        /* ì—…ë¡œë“œ ì„¹ì…˜ */
        .upload-section {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .upload-section h2 {
            margin: 0 0 15px 0;
            font-size: 1.5rem;
            color: var(--primary-blue);
        }

        .upload-section p {
            color: #64748b;
            margin: 10px 0;
        }

        .btn {
            background-color: var(--primary-blue);
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .file-input {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="top-nav">
        <div class="nav-left">
            <h1 onclick="location.href='my_calendar.html'">ğŸ§± Lego</h1>
            <div class="nav-menu" id="navMenu">
                <button class="nav-menu-btn" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                <!-- ì—­í• ë³„ ë©”ë‰´ëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
            </div>
        </div>
        <div class="nav-right">
            <div class="user-info" id="userInfo"></div>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <!-- ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="upload-section" id="uploadSection">
            <h2>ğŸ“„ í”„ë¡œì íŠ¸ ì—‘ì…€ íŒŒì¼ ë“±ë¡</h2>
            <p>ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ í”„ë¡œì íŠ¸ í…ŒìŠ¤í¬ë¥¼ ë“±ë¡í•˜ì„¸ìš”</p>
            <input type="file" id="excelFileInput" class="file-input" accept=".xlsx,.xls" onchange="handleExcelUpload(event)">
            <button class="btn" onclick="document.getElementById('excelFileInput').click()">
                ğŸ“ ì—‘ì…€ë¡œ ë“±ë¡í•˜ê¸°
            </button>
            <p style="color: #94a3b8; font-size: 0.85rem; margin-top: 15px;">
                <strong>í•„ìˆ˜ ì»¬ëŸ¼:</strong> ì†Œì†, ì´ë¦„, ëŒ€ë¶„ë¥˜, ì¤‘ë¶„ë¥˜, ì†Œë¶„ë¥˜, ê¸°ì¤€ì‹œê°„, í• ë‹¹ì‹œê°„
            </p>
        </div>

        <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ (ë°ì´í„° ë¡œë“œ í›„ í‘œì‹œ) -->
        <div id="mainContent" style="display: none;">
            <div class="main-layout">
                <!-- ì™¼ìª½: í…ŒìŠ¤í¬ ë¸”ë¡ ì˜ì—­ -->
                <div class="blocks-section">
                    <h2>ğŸ§± í”„ë¡œì íŠ¸ í…ŒìŠ¤í¬ ë¸”ë¡</h2>
                    <div class="blocks-container" id="blocksContainer">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½: íŒ€ì› ë¦¬ìŠ¤íŠ¸ -->
                <div class="team-list-section">
                    <h2>ğŸ‘¥ í…ŒìŠ¤í¬ ë¦¬ìŠ¤íŠ¸</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" id="filterByMember" onclick="changeFilter('member')">
                            ğŸ‘¤ íŒ€ì›ë³„
                        </button>
                        <button class="filter-btn" id="filterByTask" onclick="changeFilter('task')">
                            ğŸ“‹ í…ŒìŠ¤í¬ë³„
                        </button>
                    </div>
                    <div id="teamListContainer">
                        <!-- ë™ì  ìƒì„± -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        const loggedInUser = JSON.parse(sessionStorage.getItem('currentUser'));
        
        if (!loggedInUser) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        // íŒ€ì¥ ê¶Œí•œ ì²´í¬
        const isTeamLead = loggedInUser.role === 'teamlead' || loggedInUser.role === 'admin';
        
        if (!isTeamLead) {
            alert('í”„ë¡œì íŠ¸ ë“±ë¡ì€ íŒ€ì¥ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            window.location.href = 'task_schedule.html';
        }

        function getRoleName(role) {
            const roleNames = {
                'admin': 'ê´€ë¦¬ì',
                'teamlead': 'íŒ€ì¥',
                'user': 'íŒ€ì›'
            };
            return roleNames[role] || 'ì‚¬ìš©ì';
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        document.getElementById('userInfo').textContent = `${loggedInUser.name} (${getRoleName(loggedInUser.role)})`;

        // ì—­í• ë³„ ë©”ë‰´ ì¶”ê°€
        const navMenu = document.getElementById('navMenu');
        if (loggedInUser.role === 'admin') {
            navMenu.innerHTML += `
                <button class="nav-menu-btn" onclick="location.href='admin.html'">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-menu-btn" onclick="location.href='lego_mockup.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                <button class="nav-menu-btn active" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                <button class="nav-menu-btn" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
            `;
        } else if (loggedInUser.role === 'teamlead') {
            navMenu.innerHTML += `
                <button class="nav-menu-btn" onclick="location.href='teamlead.html'">íŒ€ì¥ ëŒ€ì‹œë³´ë“œ</button>
                <button class="nav-menu-btn" onclick="location.href='lego_mockup.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                <button class="nav-menu-btn active" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                <button class="nav-menu-btn" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
            `;
        } else {
            navMenu.innerHTML += `
                <button class="nav-menu-btn" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
            `;
        }

        let projectData = [];
        let schedules = [];
        let currentFilter = 'member'; // 'member' or 'task'

        // ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ëŒ€ë¶„ë¥˜ -> ì†Œë¶„ë¥˜)
        function getCategoryFromMajor(majorCategory) {
            if (majorCategory.includes('ê¸°íš') || majorCategory.includes('í–‰ì‚¬') || majorCategory.includes('ê²½ì˜')) {
                return 'planning';
            } else if (majorCategory.includes('ê°œë°œ') || majorCategory.includes('ì¬ë¬´')) {
                return 'development';
            } else if (majorCategory.includes('ë””ìì¸') || majorCategory.includes('ì‹œê°')) {
                return 'design';
            }
            return 'planning'; // ê¸°ë³¸ê°’
        }

        // ì‹œê°„ ê³„ì‚° í•¨ìˆ˜ (startTime, endTime, startDate, endDateë¥¼ ê³ ë ¤)
        function calculateHours(startTime, endTime, startDate = null, endDate = null) {
            const [startH, startM] = startTime.split(':').map(Number);
            const [endH, endM] = endTime.split(':').map(Number);
            
            let hours = (endH * 60 + endM - startH * 60 - startM) / 60;
            
            // ë‚ ì§œ ë²”ìœ„ê°€ ìˆìœ¼ë©´ ì¼ìˆ˜ì— ë”°ë¼ ì‹œê°„ ê³„ì‚°
            if (startDate && endDate && startDate !== endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                if (daysDiff > 1) {
                    // ì²«ë‚ : ì‹œì‘ì‹œê°„ë¶€í„° 18ì‹œê¹Œì§€
                    const firstDayHours = (18 - startH) + (startM / 60);
                    // ë§ˆì§€ë§‰ë‚ : 9ì‹œë¶€í„° ì¢…ë£Œì‹œê°„ê¹Œì§€
                    const lastDayHours = (endH - 9) + (endM / 60);
                    // ì¤‘ê°„ë‚ ë“¤: 9ì‹œë¶€í„° 18ì‹œê¹Œì§€ (9ì‹œê°„)
                    const middleDaysHours = (daysDiff - 2) * 9;
                    
                    hours = firstDayHours + lastDayHours + middleDaysHours;
                }
            }
            
            return Math.max(0, hours);
        }

        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    processExcelData(jsonData);
                } catch (error) {
                    console.error('ì—‘ì…€ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
                    alert('ì—‘ì…€ íŒŒì¼ ì½ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processExcelData(data) {
            console.log('ğŸ“Š ì—‘ì…€ ë°ì´í„°:', data);
            
            projectData = data.map((row, index) => ({
                id: `task-${String(index + 1).padStart(3, '0')}`,
                ì†Œì†: row['ì†Œì†'] || '',
                ì´ë¦„: row['ì´ë¦„'] || '',
                ë¶€ì„œ: row['ë¶€ì„œ'] || '',
                ì‚¬ì—…ëª…: row['ì‚¬ì—…ëª…'] || '',
                ëŒ€ë¶„ë¥˜: row['ëŒ€ë¶„ë¥˜'] || '',
                ì¤‘ë¶„ë¥˜: row['ì¤‘ë¶„ë¥˜'] || '',
                ì†Œë¶„ë¥˜: row['ì†Œë¶„ë¥˜'] || '',
                ê¸°ì¤€ì‹œê°„: parseInt(row['ê¸°ì¤€ì‹œê°„']) || 0,
                í• ë‹¹ì‹œê°„: parseInt(row['í• ë‹¹ì‹œê°„']) || 0,
                ë¹„ê³ : row['ë¹„ê³ '] || ''
            }));

            // ì—…ë¡œë“œ ì„¹ì…˜ ìˆ¨ê¸°ê³  ë©”ì¸ ì»¨í…ì¸  í‘œì‹œ
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            // ìŠ¤ì¼€ì¤„ì´ ì—†ìœ¼ë©´ ìƒ˜í”Œ ìŠ¤ì¼€ì¤„ ìƒì„±
            if (schedules.length === 0) {
                schedules = createSampleSchedules();
            }

            // localStorageì— ì €ì¥
            saveToLocalStorage();

            // ë¸”ë¡ ë° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            renderTaskBlocks();
            renderTeamList();
            
            alert(`${data.length}ê°œì˜ í…ŒìŠ¤í¬ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        function renderTaskBlocks() {
            const container = document.getElementById('blocksContainer');
            container.innerHTML = '';

            if (projectData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <p>ë“±ë¡ëœ í…ŒìŠ¤í¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            // í”„ë¡œì íŠ¸ë³„ë¡œ ê·¸ë£¹í™”
            const projectGroups = {};
            projectData.forEach(task => {
                if (!projectGroups[task.ì‚¬ì—…ëª…]) {
                    projectGroups[task.ì‚¬ì—…ëª…] = [];
                }
                projectGroups[task.ì‚¬ì—…ëª…].push(task);
            });

            // ê° í”„ë¡œì íŠ¸ë³„ë¡œ ë Œë”ë§
            Object.keys(projectGroups).forEach(projectName => {
                const tasks = projectGroups[projectName];
                
                // í…ŒìŠ¤í¬ë³„ë¡œ ê·¸ë£¹í™” (ì¤‘ë¶„ë¥˜ ê¸°ì¤€)
                const taskGroups = {};
                tasks.forEach(task => {
                    const key = `${task.ëŒ€ë¶„ë¥˜}-${task.ì¤‘ë¶„ë¥˜}-${task.ì†Œë¶„ë¥˜}`;
                    if (!taskGroups[key]) {
                        taskGroups[key] = {
                            ëŒ€ë¶„ë¥˜: task.ëŒ€ë¶„ë¥˜,
                            ì¤‘ë¶„ë¥˜: task.ì¤‘ë¶„ë¥˜,
                            ì†Œë¶„ë¥˜: task.ì†Œë¶„ë¥˜,
                            ê¸°ì¤€ì‹œê°„: task.ê¸°ì¤€ì‹œê°„,
                            í• ë‹¹: []
                        };
                    }
                    if (task.í• ë‹¹ì‹œê°„ > 0) {
                        taskGroups[key].í• ë‹¹.push({
                            ì´ë¦„: task.ì´ë¦„,
                            í• ë‹¹ì‹œê°„: task.í• ë‹¹ì‹œê°„
                        });
                    }
                });

                // ê° í…ŒìŠ¤í¬ ê·¸ë£¹ ë Œë”ë§
                Object.values(taskGroups).forEach(taskGroup => {
                    const category = getCategoryFromMajor(taskGroup.ëŒ€ë¶„ë¥˜);
                    const totalBlocks = taskGroup.ê¸°ì¤€ì‹œê°„;
                    
                    // í• ë‹¹ëœ ë¸”ë¡ ìˆ˜ ê³„ì‚°
                    let assignedBlocks = taskGroup.í• ë‹¹.reduce((sum, a) => sum + a.í• ë‹¹ì‹œê°„, 0);
                    
                    // í• ë‹¹ì‹œê°„ì˜ í•©ì´ ê¸°ì¤€ì‹œê°„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ì¡°ì •
                    if (assignedBlocks !== totalBlocks && assignedBlocks > 0 && totalBlocks > 0) {
                        const ratio = totalBlocks / assignedBlocks;
                        taskGroup.í• ë‹¹.forEach(assignment => {
                            assignment.í• ë‹¹ì‹œê°„ = Math.round(assignment.í• ë‹¹ì‹œê°„ * ratio);
                        });
                        assignedBlocks = taskGroup.í• ë‹¹.reduce((sum, a) => sum + a.í• ë‹¹ì‹œê°„, 0);
                        // ë§ˆì§€ë§‰ í• ë‹¹ì— ì°¨ì´ ì¡°ì •
                        if (assignedBlocks !== totalBlocks) {
                            const diff = totalBlocks - assignedBlocks;
                            if (taskGroup.í• ë‹¹.length > 0) {
                                taskGroup.í• ë‹¹[taskGroup.í• ë‹¹.length - 1].í• ë‹¹ì‹œê°„ += diff;
                                assignedBlocks = totalBlocks;
                            }
                        }
                    } else if (assignedBlocks === 0 && totalBlocks > 0) {
                        // í• ë‹¹ì´ ì—†ìœ¼ë©´ ê¸°ì¤€ì‹œê°„ë§Œí¼ í• ë‹¹
                        assignedBlocks = totalBlocks;
                    }
                    
                    // ì‚¬ëŒë³„ë¡œ ê·¸ë£¹í™”í•˜ê³ , ë“±ë¡ëœ ê²ƒê³¼ ì•ˆëœ ê²ƒì„ ì ì ˆíˆ ì„ê¸°
                    // 1. ë“±ë¡ëœ ê²ƒê³¼ ì•ˆëœ ê²ƒ ë¶„ë¦¬
                    const scheduledAssignments = [];
                    const unscheduledAssignments = [];
                    
                    taskGroup.í• ë‹¹.forEach(assignment => {
                        const task = projectData.find(t => 
                            t.ì´ë¦„ === assignment.ì´ë¦„ &&
                            t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                            t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                            t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜
                        );
                        if (task && isTaskScheduled(task.id, assignment.ì´ë¦„)) {
                            scheduledAssignments.push(assignment);
                        } else {
                            unscheduledAssignments.push(assignment);
                        }
                    });
                    
                    // 2. ì‚¬ëŒë³„ë¡œ ê·¸ë£¹í™” (ì´ë¦„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì¼ê´€ì„± ìœ ì§€)
                    const groupedByPerson = {};
                    [...scheduledAssignments, ...unscheduledAssignments].forEach(assignment => {
                        if (!groupedByPerson[assignment.ì´ë¦„]) {
                            groupedByPerson[assignment.ì´ë¦„] = [];
                        }
                        groupedByPerson[assignment.ì´ë¦„].push(assignment);
                    });
                    
                    // 3. ì‚¬ëŒ ì´ë¦„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì™¼ìª½ë¶€í„° ì±„ìš°ê¸°
                    const sortedPersonNames = Object.keys(groupedByPerson).sort();
                    
                    // 4. ë“±ë¡ëœ ê²ƒê³¼ ì•ˆëœ ê²ƒì„ ë°˜ë°˜ ì„ì–´ì„œ ë°°ì¹˜
                    const reorderedAssignments = [];
                    const personScheduledMap = {}; // ê° ì‚¬ëŒì˜ ë“±ë¡ ì—¬ë¶€ ì¶”ì 
                    
                    sortedPersonNames.forEach(personName => {
                        const personAssignments = groupedByPerson[personName];
                        personAssignments.forEach(assignment => {
                            const task = projectData.find(t => 
                                t.ì´ë¦„ === assignment.ì´ë¦„ &&
                                t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                                t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                                t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜
                            );
                            personScheduledMap[assignment.ì´ë¦„] = task && isTaskScheduled(task.id, assignment.ì´ë¦„);
                            reorderedAssignments.push(assignment);
                        });
                    });
                    
                    // ì‹¤ì œ ìŠ¤ì¼€ì¤„ì— ë“±ë¡ëœ ë¸”ë¡ ì •ë³´ ìˆ˜ì§‘
                    const scheduledBlockInfo = []; // [{startIndex, endIndex, userName, startDate, endDate}, ...]
                    let currentBlockIndex = 0;
                    
                    reorderedAssignments.forEach(assignment => {
                        // í•´ë‹¹ í…ŒìŠ¤í¬ ì°¾ê¸°
                        const task = projectData.find(t => 
                            t.ì´ë¦„ === assignment.ì´ë¦„ &&
                            t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                            t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                            t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜
                        );
                        if (task && isTaskScheduled(task.id, assignment.ì´ë¦„)) {
                            // ìŠ¤ì¼€ì¤„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                            const schedule = schedules.find(s => 
                                s.taskId === task.id && 
                                (s.userName === assignment.ì´ë¦„ || s.user === assignment.ì´ë¦„)
                            );
                            if (schedule) {
                                // ë“±ë¡ ì‹œê°„ì€ í• ë‹¹ ì‹œê°„ê³¼ ë™ì¼í•´ì•¼ í•¨
                                // ì‹¤ì œ ë“±ë¡ëœ ë¸”ë¡ ìˆ˜ëŠ” í• ë‹¹ì‹œê°„ê³¼ ë™ì¼
                                const actualScheduledBlocks = assignment.í• ë‹¹ì‹œê°„;
                                
                                // í• ë‹¹ëœ ë¸”ë¡ ë²”ìœ„ ë‚´ì—ì„œ ì‹¤ì œ ë“±ë¡ëœ ë¸”ë¡ë§Œ í‘œì‹œ
                                const startIndex = currentBlockIndex;
                                const endIndex = currentBlockIndex + actualScheduledBlocks - 1;
                                scheduledBlockInfo.push({
                                    startIndex,
                                    endIndex,
                                    userName: assignment.ì´ë¦„,
                                    startDate: schedule.startDate,
                                    endDate: schedule.endDate,
                                    startTime: schedule.startTime,
                                    endTime: schedule.endTime,
                                    actualHours: assignment.í• ë‹¹ì‹œê°„, // í• ë‹¹ ì‹œê°„ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •
                                    assignedHours: assignment.í• ë‹¹ì‹œê°„,
                                    assignedStartIndex: currentBlockIndex,
                                    assignedEndIndex: currentBlockIndex + assignment.í• ë‹¹ì‹œê°„ - 1
                                });
                            }
                        }
                        currentBlockIndex += assignment.í• ë‹¹ì‹œê°„;
                    });
                    
                    // ì‹¤ì œ ë“±ë¡ëœ ì‹œê°„ ê³„ì‚° (ì‹œê°„ ë‹¨ìœ„) - í• ë‹¹ ì‹œê°„ì˜ í•©
                    const totalScheduledHours = scheduledBlockInfo.reduce((sum, info) => {
                        return sum + (info.actualHours || info.assignedHours || 0);
                    }, 0);
                    const scheduledBlocks = scheduledBlockInfo.reduce((sum, info) => sum + (info.endIndex - info.startIndex + 1), 0);
                    
                    // ê°™ì€ ì‚¬ëŒ, ê°™ì€ ë‚ ì§œ, ì—°ì†ëœ ë¸”ë¡ì„ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ê¸°
                    // startIndex ìˆœì„œë¡œ ì •ë ¬
                    scheduledBlockInfo.sort((a, b) => a.startIndex - b.startIndex);
                    
                    const blockGroups = [];
                    scheduledBlockInfo.forEach((info, idx) => {
                        // ì´ì „ ê·¸ë£¹ê³¼ ê°™ì€ ì‚¬ëŒ, ê°™ì€ ë‚ ì§œ, ì—°ì†ëœ ë¸”ë¡ì¸ì§€ í™•ì¸
                        const prevGroup = blockGroups[blockGroups.length - 1];
                        if (prevGroup && 
                            prevGroup.userName === info.userName &&
                            prevGroup.startDate === info.startDate &&
                            prevGroup.endIndex + 1 === info.startIndex) {
                            // ì´ì „ ê·¸ë£¹ì— ì¶”ê°€
                            prevGroup.endIndex = info.endIndex;
                            prevGroup.endDate = info.endDate;
                            
                            // ì¢…ë£Œ ì‹œê°„ ê³„ì‚°: ë§ˆì§€ë§‰ ë¸”ë¡ì˜ ì‹œì‘ ì‹œê°„ + í• ë‹¹ ì‹œê°„
                            const [startH, startM] = info.startTime.split(':').map(Number);
                            const assignedHours = info.assignedHours || info.actualHours || 0;
                            const endH = startH + Math.floor(assignedHours);
                            const endM = startM + Math.round((assignedHours % 1) * 60);
                            const finalEndH = endH + Math.floor(endM / 60);
                            const finalEndM = endM % 60;
                            prevGroup.endTime = `${String(finalEndH).padStart(2, '0')}:${String(finalEndM).padStart(2, '0')}`;
                            
                            prevGroup.actualHours += (info.actualHours || info.assignedHours || 0);
                            prevGroup.assignedHours += (info.assignedHours || 0);
                        } else {
                            // ìƒˆ ê·¸ë£¹ ìƒì„±
                            // ì¢…ë£Œ ì‹œê°„ ê³„ì‚°: ì‹œì‘ ì‹œê°„ + í• ë‹¹ ì‹œê°„
                            const [startH, startM] = info.startTime.split(':').map(Number);
                            const assignedHours = info.assignedHours || info.actualHours || 0;
                            const endH = startH + Math.floor(assignedHours);
                            const endM = startM + Math.round((assignedHours % 1) * 60);
                            const finalEndH = endH + Math.floor(endM / 60);
                            const finalEndM = endM % 60;
                            const calculatedEndTime = `${String(finalEndH).padStart(2, '0')}:${String(finalEndM).padStart(2, '0')}`;
                            
                            blockGroups.push({
                                groupId: `group-${taskGroup.ì¤‘ë¶„ë¥˜}-${idx}`,
                                startIndex: info.startIndex,
                                endIndex: info.endIndex,
                                userName: info.userName,
                                startDate: info.startDate,
                                endDate: info.endDate,
                                startTime: info.startTime,
                                endTime: calculatedEndTime,
                                actualHours: info.actualHours || info.assignedHours || 0,
                                assignedHours: info.assignedHours || 0
                            });
                        }
                    });
                    
                    const groupDiv = document.createElement('div');
                    groupDiv.className = `task-block-group ${category}`;
                    
                    groupDiv.innerHTML = `
                        <div class="task-block-header">
                            <div>
                                <div class="task-block-title">${taskGroup.ì¤‘ë¶„ë¥˜}</div>
                                <div class="task-block-meta">
                                    ${taskGroup.ëŒ€ë¶„ë¥˜} > ${taskGroup.ì†Œë¶„ë¥˜} | ê¸°ì¤€: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„ | ë“±ë¡: ${totalScheduledHours.toFixed(1)}ì‹œê°„
                                </div>
                            </div>
                        </div>
                        <div class="task-blocks-grid" id="blocks-${taskGroup.ì¤‘ë¶„ë¥˜}"></div>
                    `;
                    
                    const blocksGrid = groupDiv.querySelector(`#blocks-${taskGroup.ì¤‘ë¶„ë¥˜}`);
                    
                    // ë¸”ë¡ ìƒì„±
                    for (let i = 0; i < totalBlocks; i++) {
                        const isAssigned = i < assignedBlocks;
                        // ì´ ë¸”ë¡ì´ ë“±ë¡ëœ ë¸”ë¡ ë²”ìœ„ì— ì†í•˜ëŠ”ì§€ í™•ì¸
                        const blockScheduleInfo = scheduledBlockInfo.find(info => 
                            i >= info.startIndex && i <= info.endIndex
                        );
                        // ê·¸ë£¹ ì •ë³´ ì°¾ê¸°
                        const blockGroup = blockGroups.find(group => 
                            i >= group.startIndex && i <= group.endIndex
                        );
                        const isScheduled = !!blockScheduleInfo;
                        
                        const block = document.createElement('div');
                        // ë“±ë¡ëœ ê²ƒì€ ì§„í•œ ìƒ‰ìƒ, í• ë‹¹ë§Œ ë˜ê³  ë¯¸ë“±ë¡ì€ íšŒìƒ‰, í• ë‹¹ ì•ˆëœ ê²ƒë„ íšŒìƒ‰
                        if (isScheduled) {
                            block.className = `task-block ${category} scheduled-active`; // ì§„í•œ ìƒ‰ìƒ
                            if (blockGroup) {
                                block.setAttribute('data-group-id', blockGroup.groupId);
                            }
                        } else {
                            block.className = `task-block ${category} scheduled`; // íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œ
                        }
                        block.setAttribute('data-block-index', i);
                        
                        const tooltip = document.createElement('div');
                        tooltip.className = 'task-block-tooltip';
                        
                        // ëª¨ë“  ë¸”ë¡ì— íˆ´íŒ ë‚´ìš© ì„¤ì • (ê·¸ë£¹ì— ì†í•œ ê²½ìš° ê·¸ë£¹ ì •ë³´ ì‚¬ìš©)
                        if (isScheduled && blockGroup) {
                            // ê·¸ë£¹ ì •ë³´ ì‚¬ìš© (ì—°ì†ëœ ë¸”ë¡) - ëª¨ë“  ê·¸ë£¹ ë¸”ë¡ì— ê°™ì€ ë‚´ìš©
                            const dateStr = blockGroup.startDate === blockGroup.endDate 
                                ? blockGroup.startDate 
                                : `${blockGroup.startDate} ~ ${blockGroup.endDate}`;
                            
                            const blockRange = blockGroup.startIndex === blockGroup.endIndex 
                                ? `${blockGroup.startIndex + 1}` 
                                : `${blockGroup.startIndex + 1}~${blockGroup.endIndex + 1}`;
                            
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">ë“±ë¡ë¨ (ë¸”ë¡ ${blockRange}/${totalBlocks})</div>
                                <div>ğŸ‘¤ ${blockGroup.userName}</div>
                                <div>ğŸ“… ${dateStr}</div>
                                <div>â° ${blockGroup.startTime} ~ ${blockGroup.endTime}</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                    <div>âœ… ë“±ë¡ì‹œê°„: ${blockGroup.actualHours}ì‹œê°„</div>
                                    ${blockGroup.assignedHours > 0 ? `<div>ğŸ“‹ í• ë‹¹ì‹œê°„: ${blockGroup.assignedHours}ì‹œê°„</div>` : ''}
                                </div>
                            `;
                        } else if (isScheduled && !blockGroup && blockScheduleInfo) {
                            // ê°œë³„ ë¸”ë¡ ì •ë³´ (ê·¸ë£¹ì— ì†í•˜ì§€ ì•ŠëŠ” ê²½ìš°)
                            const dateStr = blockScheduleInfo.startDate === blockScheduleInfo.endDate 
                                ? blockScheduleInfo.startDate 
                                : `${blockScheduleInfo.startDate} ~ ${blockScheduleInfo.endDate}`;
                            
                            const actualHours = blockScheduleInfo.actualHours || calculateHours(
                                blockScheduleInfo.startTime,
                                blockScheduleInfo.endTime,
                                blockScheduleInfo.startDate,
                                blockScheduleInfo.endDate
                            );
                            const assignedHours = blockScheduleInfo.assignedHours || 0;
                            
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">ë“±ë¡ë¨ (${i + 1}/${totalBlocks})</div>
                                <div>ğŸ‘¤ ${blockScheduleInfo.userName}</div>
                                <div>ğŸ“… ${dateStr}</div>
                                <div>â° ${blockScheduleInfo.startTime} ~ ${blockScheduleInfo.endTime}</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                    <div>âœ… ë“±ë¡ì‹œê°„: ${actualHours}ì‹œê°„</div>
                                    ${assignedHours > 0 ? `<div>ğŸ“‹ í• ë‹¹ì‹œê°„: ${assignedHours}ì‹œê°„</div>` : ''}
                                </div>
                            `;
                        } else if (isAssigned) {
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">í• ë‹¹ë¨ (ë¯¸ë“±ë¡) (${i + 1}/${totalBlocks})</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                </div>
                            `;
                        } else {
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">ë¯¸í• ë‹¹ (${i + 1}/${totalBlocks})</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                </div>
                            `;
                        }
                        block.appendChild(tooltip);
                        
                        // í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€ (ê°œë³„ ë¸”ë¡ ë° ê·¸ë£¹ ëª¨ë‘)
                        block.addEventListener('mouseenter', function() {
                            // í˜„ì¬ ë¸”ë¡ì˜ íˆ´íŒë§Œ í‘œì‹œ
                            const currentTooltip = this.querySelector('.task-block-tooltip');
                            if (currentTooltip) {
                                currentTooltip.style.opacity = '1';
                            }
                            
                            // ê·¸ë£¹ì— ì†í•œ ê²½ìš° ê·¸ë£¹ ì „ì²´ ë¸”ë¡ í™•ëŒ€ íš¨ê³¼
                            if (blockGroup) {
                                const groupId = this.getAttribute('data-group-id');
                                if (groupId) {
                                    const groupBlocks = blocksGrid.querySelectorAll(`[data-group-id="${groupId}"]`);
                                    groupBlocks.forEach(groupBlock => {
                                        groupBlock.style.transform = 'scale(1.15)';
                                        groupBlock.style.zIndex = '20';
                                        groupBlock.style.transition = 'transform 0.2s ease';
                                    });
                                }
                            }
                        });
                        
                        block.addEventListener('mouseleave', function() {
                            // í˜„ì¬ ë¸”ë¡ì˜ íˆ´íŒë§Œ ìˆ¨ê¹€
                            const currentTooltip = this.querySelector('.task-block-tooltip');
                            if (currentTooltip) {
                                currentTooltip.style.opacity = '0';
                            }
                            
                            // ê·¸ë£¹ì— ì†í•œ ê²½ìš° ê·¸ë£¹ ì „ì²´ ë¸”ë¡ í™•ëŒ€ íš¨ê³¼ ì œê±°
                            if (blockGroup) {
                                const groupId = this.getAttribute('data-group-id');
                                if (groupId) {
                                    const groupBlocks = blocksGrid.querySelectorAll(`[data-group-id="${groupId}"]`);
                                    groupBlocks.forEach(groupBlock => {
                                        groupBlock.style.transform = '';
                                        groupBlock.style.zIndex = '';
                                    });
                                }
                            }
                        });
                        
                        blocksGrid.appendChild(block);
                    }
                    
                    container.appendChild(groupDiv);
                });
            });
        }

        function changeFilter(filterType) {
            currentFilter = filterType;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('filterByMember').classList.toggle('active', filterType === 'member');
            document.getElementById('filterByTask').classList.toggle('active', filterType === 'task');
            
            // ë¦¬ìŠ¤íŠ¸ ì¬ë Œë”ë§
            renderTeamList();
        }

        function renderTeamList() {
            const container = document.getElementById('teamListContainer');
            container.innerHTML = '';

            if (projectData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ‘¥</div>
                        <p>íŒ€ì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            if (currentFilter === 'member') {
                renderByMember(container);
            } else {
                renderByTask(container);
            }
        }

        // ìŠ¤ì¼€ì¤„ì— ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸
        function isTaskScheduled(taskId, userName) {
            if (!schedules || schedules.length === 0) return false;
            return schedules.some(s => 
                s && s.taskId === taskId && 
                (s.userName === userName || s.user === userName)
            );
        }

        function renderByMember(container) {
            // íŒ€ì›ë³„ë¡œ ê·¸ë£¹í™” (í• ë‹¹ ì‹œê°„ì´ 0ì¸ ê²ƒë„ í¬í•¨)
            const memberGroups = {};
            projectData.forEach(task => {
                // í• ë‹¹ ì‹œê°„ì´ 0ì´ì–´ë„ í‘œì‹œ
                if (!memberGroups[task.ì´ë¦„]) {
                    memberGroups[task.ì´ë¦„] = {
                        ì´ë¦„: task.ì´ë¦„,
                        ì†Œì†: task.ì†Œì†,
                        ë¶€ì„œ: task.ë¶€ì„œ,
                        í…ŒìŠ¤í¬: []
                    };
                }
                memberGroups[task.ì´ë¦„].í…ŒìŠ¤í¬.push(task);
            });

            // íŒ€ì›ë³„ë¡œ ë Œë”ë§
            Object.values(memberGroups).forEach(member => {
                const totalHours = member.í…ŒìŠ¤í¬.reduce((sum, t) => sum + t.í• ë‹¹ì‹œê°„, 0);
                
                const cardDiv = document.createElement('div');
                cardDiv.className = 'team-member-card';
                
                let taskListHTML = '';
                member.í…ŒìŠ¤í¬.forEach(task => {
                    const isScheduled = isTaskScheduled(task.id, task.ì´ë¦„);
                    const scheduledClass = isScheduled ? '' : 'style="opacity: 0.6; border-left: 3px solid #f59e0b;"';
                    const scheduledBadge = isScheduled 
                        ? '<span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">âœ“ ë“±ë¡ë¨</span>'
                        : '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">â° ë¯¸ë“±ë¡</span>';
                    
                    taskListHTML += `
                        <div class="member-task-item" ${scheduledClass}>
                            <div class="member-task-item-header">
                                <div>
                                    <div class="member-task-title">${task.ì¤‘ë¶„ë¥˜}</div>
                                    ${scheduledBadge}
                                </div>
                                <div class="member-task-hours">${task.í• ë‹¹ì‹œê°„}h</div>
                            </div>
                            <div class="member-task-categories">
                                <span class="category-tag primary">${task.ëŒ€ë¶„ë¥˜}</span>
                                <span class="category-tag secondary">${task.ì¤‘ë¶„ë¥˜}</span>
                                <span class="category-tag tertiary">${task.ì†Œë¶„ë¥˜}</span>
                            </div>
                            ${task.ë¹„ê³  ? `<div style="margin-top: 6px; font-size: 0.75rem; color: #64748b;">ğŸ“ ${task.ë¹„ê³ }</div>` : ''}
                        </div>
                    `;
                });
                
                cardDiv.innerHTML = `
                    <div class="member-header">
                        <div>
                            <div class="member-name">${member.ì´ë¦„}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">
                                ${member.ì†Œì†} ${member.ë¶€ì„œ ? `Â· ${member.ë¶€ì„œ}` : ''}
                            </div>
                        </div>
                        <div class="member-task-count">${member.í…ŒìŠ¤í¬.length}ê°œ</div>
                    </div>
                    <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">
                        ì´ í• ë‹¹ ì‹œê°„: <strong style="color: var(--primary-blue);">${totalHours}ì‹œê°„</strong>
                    </div>
                    <div class="member-task-list">
                        ${taskListHTML}
                    </div>
                `;
                
                container.appendChild(cardDiv);
            });
        }

        function renderByTask(container) {
            // í…ŒìŠ¤í¬ë³„ë¡œ ê·¸ë£¹í™” (ì†Œë¶„ë¥˜ ê¸°ì¤€)
            const taskGroups = {};
            projectData.forEach(task => {
                const key = `${task.ëŒ€ë¶„ë¥˜}-${task.ì¤‘ë¶„ë¥˜}-${task.ì†Œë¶„ë¥˜}`;
                if (!taskGroups[key]) {
                    taskGroups[key] = {
                        ëŒ€ë¶„ë¥˜: task.ëŒ€ë¶„ë¥˜,
                        ì¤‘ë¶„ë¥˜: task.ì¤‘ë¶„ë¥˜,
                        ì†Œë¶„ë¥˜: task.ì†Œë¶„ë¥˜,
                        ê¸°ì¤€ì‹œê°„: task.ê¸°ì¤€ì‹œê°„,
                        í• ë‹¹: []
                    };
                }
                if (task.í• ë‹¹ì‹œê°„ > 0) {
                    taskGroups[key].í• ë‹¹.push({
                        ì´ë¦„: task.ì´ë¦„,
                        ì†Œì†: task.ì†Œì†,
                        ë¶€ì„œ: task.ë¶€ì„œ,
                        í• ë‹¹ì‹œê°„: task.í• ë‹¹ì‹œê°„,
                        ë¹„ê³ : task.ë¹„ê³ 
                    });
                }
            });

            // í…ŒìŠ¤í¬ë³„ë¡œ ë Œë”ë§
            Object.values(taskGroups).forEach(taskGroup => {
                const totalAllocated = taskGroup.í• ë‹¹.reduce((sum, a) => sum + a.í• ë‹¹ì‹œê°„, 0);
                const category = getCategoryFromMajor(taskGroup.ëŒ€ë¶„ë¥˜);
                
                const cardDiv = document.createElement('div');
                cardDiv.className = 'team-member-card';
                
                let memberListHTML = '';
                taskGroup.í• ë‹¹.forEach(assignment => {
                    // í•´ë‹¹ í…ŒìŠ¤í¬ì˜ taskId ì°¾ê¸°
                    const task = projectData.find(t => 
                        t.ì´ë¦„ === assignment.ì´ë¦„ &&
                        t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                        t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                        t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜ &&
                        t.í• ë‹¹ì‹œê°„ === assignment.í• ë‹¹ì‹œê°„
                    );
                    const isScheduled = task ? isTaskScheduled(task.id, assignment.ì´ë¦„) : false;
                    const scheduledClass = isScheduled ? '' : 'style="opacity: 0.6; border-left: 3px solid #f59e0b;"';
                    const scheduledBadge = isScheduled 
                        ? '<span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; margin-left: 8px;">âœ“ ë“±ë¡ë¨</span>'
                        : '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; margin-left: 8px;">â° ë¯¸ë“±ë¡</span>';
                    
                    memberListHTML += `
                        <div class="member-task-item" ${scheduledClass}>
                            <div class="member-task-item-header">
                                <div>
                                    <div class="member-task-title">${assignment.ì´ë¦„}${scheduledBadge}</div>
                                </div>
                                <div class="member-task-hours">${assignment.í• ë‹¹ì‹œê°„}h</div>
                            </div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 4px;">
                                ${assignment.ì†Œì†} ${assignment.ë¶€ì„œ ? `Â· ${assignment.ë¶€ì„œ}` : ''}
                            </div>
                            ${assignment.ë¹„ê³  ? `<div style="margin-top: 6px; font-size: 0.75rem; color: #64748b;">ğŸ“ ${assignment.ë¹„ê³ }</div>` : ''}
                        </div>
                    `;
                });
                
                const categoryClass = category === 'planning' ? 'primary' : category === 'development' ? 'secondary' : 'tertiary';
                
                cardDiv.innerHTML = `
                    <div class="member-header">
                        <div>
                            <div class="member-name">${taskGroup.ì¤‘ë¶„ë¥˜}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">
                                ${taskGroup.ëŒ€ë¶„ë¥˜} > ${taskGroup.ì†Œë¶„ë¥˜}
                            </div>
                        </div>
                        <div class="member-task-count">${taskGroup.í• ë‹¹.length}ëª…</div>
                    </div>
                    <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">
                        ê¸°ì¤€ ì‹œê°„: <strong>${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</strong> | 
                        í• ë‹¹ ì‹œê°„: <strong style="color: var(--primary-blue);">${totalAllocated}ì‹œê°„</strong>
                    </div>
                    <div class="member-task-list">
                        ${memberListHTML}
                    </div>
                `;
                
                container.appendChild(cardDiv);
            });
        }

        function saveToLocalStorage() {
            const data = {
                projectData,
                schedules,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('projectSchedules', JSON.stringify(data));
        }

        // ìƒ˜í”Œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ìƒì„± (ë“±ë¡ëœ ê²ƒê³¼ ì•ˆëœ ê²ƒì„ ë°˜ë°˜ ì„ê¸°)
        function createSampleSchedules() {
            if (projectData.length === 0) return [];
            
            // ì¼ë¶€ í…ŒìŠ¤í¬ì— ìƒ˜í”Œ ìŠ¤ì¼€ì¤„ ì¶”ê°€
            const sampleSchedules = [];
            let scheduleCount = 0;
            const today = new Date();
            const scheduledTaskIds = new Set(); // ì´ë¯¸ ë“±ë¡ëœ taskId ì¶”ì 
            
            // í…ŒìŠ¤í¬ë¥¼ ì‚¬ëŒë³„ë¡œ ê·¸ë£¹í™”
            const tasksByPerson = {};
            projectData.forEach(task => {
                if (task.í• ë‹¹ì‹œê°„ > 0) {
                    if (!tasksByPerson[task.ì´ë¦„]) {
                        tasksByPerson[task.ì´ë¦„] = [];
                    }
                    tasksByPerson[task.ì´ë¦„].push(task);
                }
            });
            
            // ê° ì‚¬ëŒë³„ë¡œ í…ŒìŠ¤í¬ë¥¼ ì„ì–´ì„œ ë°˜ë°˜ ë“±ë¡
            Object.keys(tasksByPerson).sort().forEach(personName => {
                const personTasks = tasksByPerson[personName];
                // ê° ì‚¬ëŒì˜ í…ŒìŠ¤í¬ ì¤‘ ì ˆë°˜ë§Œ ë“±ë¡
                const tasksToSchedule = Math.ceil(personTasks.length / 2);
                
                personTasks.slice(0, tasksToSchedule).forEach((task, idx) => {
                    if (!scheduledTaskIds.has(task.id)) {
                        // ì „ì²´ í• ë‹¹ ì‹œê°„ ë“±ë¡ (ì ˆë°˜ë§Œ ë“±ë¡í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ì ˆë°˜ì˜ í…ŒìŠ¤í¬ë§Œ ë“±ë¡)
                        const scheduledHours = task.í• ë‹¹ì‹œê°„;
                        if (scheduledHours > 0) {
                            const startDate = new Date(today);
                            startDate.setDate(today.getDate() + scheduleCount * 2);
                            
                            // í• ë‹¹ ì‹œê°„ì— ë§ê²Œ ì •í™•í•œ ì¢…ë£Œ ì‹œê°„ ê³„ì‚°
                            // ì‹œì‘ ì‹œê°„: 09:00
                            // ì¢…ë£Œ ì‹œê°„: 09:00 + í• ë‹¹ ì‹œê°„
                            const startHour = 9;
                            const startMinute = 0;
                            const endHour = startHour + Math.floor(scheduledHours);
                            const endMinute = startMinute + Math.round((scheduledHours % 1) * 60);
                            const finalEndHour = endHour + Math.floor(endMinute / 60);
                            const finalEndMinute = endMinute % 60;
                            
                            // ì¢…ë£Œì¼ ê³„ì‚° (í•˜ë£¨ 8ì‹œê°„ ê¸°ì¤€)
                            let endDate = new Date(startDate);
                            const days = Math.floor(scheduledHours / 8);
                            if (days > 0) {
                                endDate.setDate(startDate.getDate() + days);
                                // ë‚¨ì€ ì‹œê°„ì´ ìˆìœ¼ë©´ ë‹¤ìŒ ë‚ ë¡œ
                                if (scheduledHours % 8 > 0) {
                                    endDate.setDate(endDate.getDate() + 1);
                                }
                            } else {
                                // í•˜ë£¨ ë‚´ì— ëë‚˜ëŠ” ê²½ìš°
                                endDate = new Date(startDate);
                            }
                            
                            const endTimeStr = `${String(finalEndHour).padStart(2, '0')}:${String(finalEndMinute).padStart(2, '0')}`;
                            
                            sampleSchedules.push({
                                id: `schedule-${Date.now()}-${scheduleCount}`,
                                taskId: task.id,
                                userId: task.ì´ë¦„,
                                userName: task.ì´ë¦„,
                                task: {
                                    id: task.id,
                                    ì‚¬ì—…ëª…: task.ì‚¬ì—…ëª…,
                                    ëŒ€ë¶„ë¥˜: task.ëŒ€ë¶„ë¥˜,
                                    ì¤‘ë¶„ë¥˜: task.ì¤‘ë¶„ë¥˜,
                                    ì†Œë¶„ë¥˜: task.ì†Œë¶„ë¥˜,
                                    í• ë‹¹ì‹œê°„: task.í• ë‹¹ì‹œê°„
                                },
                                startDate: startDate.toISOString().split('T')[0],
                                endDate: endDate.toISOString().split('T')[0],
                                startTime: '09:00',
                                endTime: endTimeStr,
                                assignedHours: scheduledHours,
                                createdAt: new Date().toISOString()
                            });
                            scheduledTaskIds.add(task.id);
                            scheduleCount++;
                        }
                    }
                });
            });
            
            return sampleSchedules;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ - í•­ìƒ ì—…ë¡œë“œ ì„¹ì…˜ë§Œ í‘œì‹œ
        window.onload = function() {
            // localStorageì— ë°ì´í„°ê°€ ìˆì–´ë„ ì²˜ìŒì—ëŠ” ì—…ë¡œë“œ ì„¹ì…˜ë§Œ í‘œì‹œ
            const saved = localStorage.getItem('projectSchedules');
            if (saved) {
                const data = JSON.parse(saved);
                projectData = data.projectData || [];
                schedules = data.schedules || [];
                
                // ìŠ¤ì¼€ì¤„ì´ ì—†ê±°ë‚˜ ì ìœ¼ë©´ ìƒ˜í”Œ ìŠ¤ì¼€ì¤„ ìƒì„±/ì¶”ê°€ (ì ˆë°˜ë§Œ ë“±ë¡)
                if (projectData.length > 0 && schedules.length === 0) {
                    const newSchedules = createSampleSchedules();
                    schedules = newSchedules;
                    saveToLocalStorage();
                } else if (projectData.length > 0 && schedules.length > 0) {
                    // ê¸°ì¡´ ìŠ¤ì¼€ì¤„ì´ ìˆìœ¼ë©´ ì ˆë°˜ë§Œ ë“±ë¡ë˜ë„ë¡ ì¡°ì •
                    const totalTasks = projectData.filter(t => t.í• ë‹¹ì‹œê°„ > 0).length;
                    const scheduledTasks = new Set(schedules.map(s => s.taskId));
                    const scheduledCount = scheduledTasks.size;
                    
                    // ë“±ë¡ëœ í…ŒìŠ¤í¬ê°€ ì „ì²´ì˜ ì ˆë°˜ ì´ìƒì´ë©´ ì¼ë¶€ ì œê±°
                    if (scheduledCount > totalTasks * 0.6) {
                        // ì ˆë°˜ ì •ë„ë§Œ ë‚¨ê¸°ë„ë¡ ì¡°ì •
                        const targetCount = Math.floor(totalTasks * 0.5);
                        const schedulesToKeep = schedules.slice(0, targetCount);
                        schedules = schedulesToKeep;
                        saveToLocalStorage();
                    }
                }
                
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì—…ë¡œë“œ ì„¹ì…˜ì— ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
                if (projectData.length > 0) {
                    const uploadSection = document.getElementById('uploadSection');
                    const existingP = uploadSection.querySelector('p:last-of-type');
                    if (existingP && !existingP.textContent.includes('ì´ë¯¸ ë“±ë¡ëœ ë°ì´í„°')) {
                        const infoP = document.createElement('p');
                        infoP.style.cssText = 'color: #3b82f6; font-size: 0.9rem; margin-top: 15px; font-weight: 600;';
                        infoP.textContent = `â„¹ï¸ ì´ë¯¸ ${projectData.length}ê°œì˜ í…ŒìŠ¤í¬ê°€ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œ ì—…ë¡œë“œí•˜ë©´ ê¸°ì¡´ ë°ì´í„°ê°€ ëŒ€ì²´ë©ë‹ˆë‹¤.`;
                        uploadSection.appendChild(infoP);
                    }
                }
            }
            
            // í•­ìƒ ì—…ë¡œë“œ ì„¹ì…˜ë§Œ í‘œì‹œ
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
        };
    </script>
</body>
</html>

ì•ˆ
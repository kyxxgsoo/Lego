<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ í…ŒìŠ¤í¬ ê´€ë¦¬ - Lego</title>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --bg-gray: #f4f6f8;
            --border-color: #e5e7eb;
            --primary-blue: #2563eb;
            --text-dark: #1e293b;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .top-nav {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--primary-blue);
            cursor: pointer;
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-menu-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-menu-btn:hover {
            background: var(--bg-gray);
        }

        .nav-menu-btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .logout-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--bg-gray);
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            padding: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* ì™¼ìª½: ë¸”ë¡ ì˜ì—­ */
        .blocks-section {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            min-height: 600px;
        }

        .blocks-section h2 {
            margin: 0 0 20px 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .blocks-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .task-block-group {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }

        .task-block-group.planning {
            border-left-color: #3b82f6;
        }

        .task-block-group.development {
            border-left-color: #22c55e;
        }

        .task-block-group.design {
            border-left-color: #eab308;
        }

        .task-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .task-block-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .task-block-meta {
            font-size: 0.85rem;
            color: #64748b;
        }

        .task-blocks-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .task-block {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 2px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .task-block:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .task-block.planning {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .task-block.planning.scheduled-active {
            background: #3b82f6 !important;
            border-color: #2563eb !important;
            color: white !important;
            opacity: 1;
        }

        .task-block.development {
            background: #dcfce7;
            border-color: #22c55e;
            color: #166534;
        }

        .task-block.development.scheduled-active {
            background: #22c55e !important;
            border-color: #16a34a !important;
            color: white !important;
            opacity: 1;
        }

        .task-block.design {
            background: #fef9c3;
            border-color: #eab308;
            color: #854d0e;
        }

        .task-block.design.scheduled-active {
            background: #eab308 !important;
            border-color: #ca8a04 !important;
            color: white !important;
            opacity: 1;
        }

        .task-block.scheduled {
            background: #9ca3af !important;
            border-color: #6b7280 !important;
            color: white !important;
            opacity: 0.7;
        }

        .task-block-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            background: #1e293b;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: normal;
            min-width: 180px;
            max-width: 250px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            line-height: 1.5;
        }
        
        .task-block-tooltip div {
            margin-bottom: 2px;
        }
        
        .task-block-tooltip div:last-child {
            margin-bottom: 0;
        }

        /* ì˜¤ë¥¸ìª½: íŒ€ì› ë¦¬ìŠ¤íŠ¸ */
        .team-list-section {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-height: 800px;
            overflow-y: auto;
        }

        .team-list-section h2 {
            margin: 0 0 15px 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-btn {
            flex: 1;
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: var(--primary-blue);
            background: #eff6ff;
        }

        .filter-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .team-member-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-blue);
        }

        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .member-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .member-task-count {
            background: var(--primary-blue);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .member-task-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .member-task-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
        }

        .member-task-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 6px;
        }

        .member-task-title {
            font-weight: 600;
            color: var(--text-dark);
        }

        .member-task-hours {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .member-task-categories {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .category-tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .category-tag.primary {
            background: #dbeafe;
            color: #1e40af;
        }

        .category-tag.secondary {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .category-tag.tertiary {
            background: #fef3c7;
            color: #92400e;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .project-header {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
    </style>
    <!-- í”„ë¡œì íŠ¸ ë°ì´í„° JavaScript íŒŒì¼ ë¡œë“œ -->
    <script src="projects-data.js"></script>
</head>
<body>
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="top-nav">
        <div class="nav-left">
            <h1 onclick="location.href='my_calendar.html'">ğŸ§± Lego</h1>
            <div class="nav-menu" id="navMenu">
                <!-- ì—­í• ë³„ ë©”ë‰´ëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ì¶”ê°€ -->
            </div>
        </div>
        <div class="nav-right">
            <div class="user-info" id="userInfo"></div>
            <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <!-- í”„ë¡œì íŠ¸ í—¤ë” -->
        <div id="projectHeader" class="project-header">
            <h2 style="margin: 0; font-size: 1.3rem; color: #1e293b;">
                ğŸ“ <span id="projectNameDisplay"></span>
            </h2>
            <p style="margin: 5px 0 0 0; color: #64748b; font-size: 0.9rem;">
                í”„ë¡œì íŠ¸ë³„ í…ŒìŠ¤í¬ ìƒì„¸ ì •ë³´
            </p>
        </div>

        <div class="main-layout">
            <!-- ì™¼ìª½: í…ŒìŠ¤í¬ ë¸”ë¡ ì˜ì—­ -->
            <div class="blocks-section">
                <h2>ğŸ§± í”„ë¡œì íŠ¸ í…ŒìŠ¤í¬ ë¸”ë¡</h2>
                <div class="blocks-container" id="blocksContainer">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: íŒ€ì› ë¦¬ìŠ¤íŠ¸ -->
            <div class="team-list-section">
                <h2>ğŸ‘¥ í…ŒìŠ¤í¬ ë¦¬ìŠ¤íŠ¸</h2>
                <div class="filter-buttons">
                    <button class="filter-btn active" id="filterByMember" onclick="changeFilter('member')">
                        ğŸ‘¤ íŒ€ì›ë³„
                    </button>
                    <button class="filter-btn" id="filterByTask" onclick="changeFilter('task')">
                        ğŸ“‹ í…ŒìŠ¤í¬ë³„
                    </button>
                </div>
                <div id="teamListContainer">
                    <!-- ë™ì  ìƒì„± -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        const loggedInUser = JSON.parse(sessionStorage.getItem('currentUser'));
        
        if (!loggedInUser) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            window.location.href = 'login.html';
        }

        function getRoleName(role) {
            const roleNames = {
                'admin': 'ê´€ë¦¬ì',
                'teamlead': 'íŒ€ì¥',
                'user': 'íŒ€ì›'
            };
            return roleNames[role] || 'ì‚¬ìš©ì';
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        document.getElementById('userInfo').textContent = `${loggedInUser.name} (${getRoleName(loggedInUser.role)})`;

        // í˜„ì¬ í˜ì´ì§€ ê°ì§€
        const currentPage = window.location.pathname.split('/').pop() || 'project_task_manage.html';
        
        // í†µì¼ëœ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ë Œë”ë§
        function renderNavigation() {
            const navMenu = document.getElementById('navMenu');
            let menuHTML = '';
            
            // ê´€ë¦¬ì: ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ, ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ë“±ë¡, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬
            if (loggedInUser.role === 'admin') {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'admin.html' ? 'active' : ''}" onclick="location.href='admin.html'">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_register.html' ? 'active' : ''}" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            // íŒ€ì¥: íŒ€ì¥ ëŒ€ì‹œë³´ë“œ, ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ë“±ë¡, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬
            else if (loggedInUser.role === 'teamlead') {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'teamlead.html' ? 'active' : ''}" onclick="location.href='teamlead.html'">íŒ€ì¥ ëŒ€ì‹œë³´ë“œ</button>
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_register.html' ? 'active' : ''}" onclick="location.href='project_register.html'">í”„ë¡œì íŠ¸ ë“±ë¡</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            // íŒ€ì›: ë‚´ ìº˜ë¦°ë”, ì „ì²´ ìº˜ë¦°ë”, í”„ë¡œì íŠ¸ ê´€ë¦¬, í…ŒìŠ¤í¬ ê´€ë¦¬ (íŒ€ì¥ ëŒ€ì‹œë³´ë“œ, í”„ë¡œì íŠ¸ ë“±ë¡ ì œì™¸)
            else {
                menuHTML = `
                    <button class="nav-menu-btn ${currentPage === 'my_calendar.html' ? 'active' : ''}" onclick="location.href='my_calendar.html'">ë‚´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'entire_calendar.html' ? 'active' : ''}" onclick="location.href='entire_calendar.html'">ì „ì²´ ìº˜ë¦°ë”</button>
                    <button class="nav-menu-btn ${currentPage === 'project_manage.html' ? 'active' : ''}" onclick="location.href='project_manage.html'">í”„ë¡œì íŠ¸ ê´€ë¦¬</button>
                    <button class="nav-menu-btn ${currentPage === 'task_schedule.html' ? 'active' : ''}" onclick="location.href='task_schedule.html'">í…ŒìŠ¤í¬ ê´€ë¦¬</button>
                `;
            }
            
            navMenu.innerHTML = menuHTML;
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
        renderNavigation();

        // í†µí•© ë°ì´í„° êµ¬ì¡°
        let projects = [];
        let tasks = [];
        let schedules = [];
        // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ ë³€ìˆ˜
        let projectData = [];
        let currentFilter = 'member'; // 'member' or 'task'
        let selectedProject = null; // URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœ í”„ë¡œì íŠ¸ ì´ë¦„

        // ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ëŒ€ë¶„ë¥˜ -> ì†Œë¶„ë¥˜)
        function getCategoryFromMajor(majorCategory) {
            if (majorCategory.includes('ê¸°íš') || majorCategory.includes('í–‰ì‚¬') || majorCategory.includes('ê²½ì˜')) {
                return 'planning';
            } else if (majorCategory.includes('ê°œë°œ') || majorCategory.includes('ì¬ë¬´')) {
                return 'development';
            } else if (majorCategory.includes('ë””ìì¸') || majorCategory.includes('ì‹œê°')) {
                return 'design';
            }
            return 'planning'; // ê¸°ë³¸ê°’
        }

        // ì‹œê°„ ê³„ì‚° í•¨ìˆ˜ (startTime, endTime, startDate, endDateë¥¼ ê³ ë ¤)
        function calculateHours(startTime, endTime, startDate = null, endDate = null) {
            const [startH, startM] = startTime.split(':').map(Number);
            const [endH, endM] = endTime.split(':').map(Number);
            
            let hours = (endH * 60 + endM - startH * 60 - startM) / 60;
            
            // ë‚ ì§œ ë²”ìœ„ê°€ ìˆìœ¼ë©´ ì¼ìˆ˜ì— ë”°ë¼ ì‹œê°„ ê³„ì‚°
            if (startDate && endDate && startDate !== endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const daysDiff = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                if (daysDiff > 1) {
                    // ì²«ë‚ : ì‹œì‘ì‹œê°„ë¶€í„° 18ì‹œê¹Œì§€
                    const firstDayHours = (18 - startH) + (startM / 60);
                    // ë§ˆì§€ë§‰ë‚ : 9ì‹œë¶€í„° ì¢…ë£Œì‹œê°„ê¹Œì§€
                    const lastDayHours = (endH - 9) + (endM / 60);
                    // ì¤‘ê°„ë‚ ë“¤: 9ì‹œë¶€í„° 18ì‹œê¹Œì§€ (9ì‹œê°„)
                    const middleDaysHours = (daysDiff - 2) * 9;
                    
                    hours = firstDayHours + lastDayHours + middleDaysHours;
                }
            }
            
            return Math.max(0, hours);
        }

        function renderTaskBlocks() {
            const container = document.getElementById('blocksContainer');
            container.innerHTML = '';

            if (projectData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <p>ë“±ë¡ëœ í…ŒìŠ¤í¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            // í”„ë¡œì íŠ¸ë³„ë¡œ ê·¸ë£¹í™”
            const projectGroups = {};
            projectData.forEach(task => {
                if (!projectGroups[task.ì‚¬ì—…ëª…]) {
                    projectGroups[task.ì‚¬ì—…ëª…] = [];
                }
                projectGroups[task.ì‚¬ì—…ëª…].push(task);
            });

            // ê° í”„ë¡œì íŠ¸ë³„ë¡œ ë Œë”ë§
            Object.keys(projectGroups).forEach(projectName => {
                const tasks = projectGroups[projectName];
                
                // í…ŒìŠ¤í¬ë³„ë¡œ ê·¸ë£¹í™” (ì¤‘ë¶„ë¥˜ ê¸°ì¤€)
                const taskGroups = {};
                tasks.forEach(task => {
                    const key = `${task.ëŒ€ë¶„ë¥˜}-${task.ì¤‘ë¶„ë¥˜}-${task.ì†Œë¶„ë¥˜}`;
                    if (!taskGroups[key]) {
                        taskGroups[key] = {
                            ëŒ€ë¶„ë¥˜: task.ëŒ€ë¶„ë¥˜,
                            ì¤‘ë¶„ë¥˜: task.ì¤‘ë¶„ë¥˜,
                            ì†Œë¶„ë¥˜: task.ì†Œë¶„ë¥˜,
                            ê¸°ì¤€ì‹œê°„: task.ê¸°ì¤€ì‹œê°„,
                            í• ë‹¹: []
                        };
                    }
                    if (task.í• ë‹¹ì‹œê°„ > 0) {
                        taskGroups[key].í• ë‹¹.push({
                            ì´ë¦„: task.ì´ë¦„,
                            í• ë‹¹ì‹œê°„: task.í• ë‹¹ì‹œê°„
                        });
                    }
                });

                // ê° í…ŒìŠ¤í¬ ê·¸ë£¹ ë Œë”ë§
                Object.values(taskGroups).forEach(taskGroup => {
                    const category = getCategoryFromMajor(taskGroup.ëŒ€ë¶„ë¥˜);
                    const totalBlocks = taskGroup.ê¸°ì¤€ì‹œê°„;
                    
                    // í• ë‹¹ëœ ë¸”ë¡ ìˆ˜ ê³„ì‚°
                    let assignedBlocks = taskGroup.í• ë‹¹.reduce((sum, a) => sum + a.í• ë‹¹ì‹œê°„, 0);
                    
                    // í• ë‹¹ì‹œê°„ì˜ í•©ì´ ê¸°ì¤€ì‹œê°„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ì¡°ì •
                    if (assignedBlocks !== totalBlocks && assignedBlocks > 0 && totalBlocks > 0) {
                        const ratio = totalBlocks / assignedBlocks;
                        taskGroup.í• ë‹¹.forEach(assignment => {
                            assignment.í• ë‹¹ì‹œê°„ = Math.round(assignment.í• ë‹¹ì‹œê°„ * ratio);
                        });
                        assignedBlocks = taskGroup.í• ë‹¹.reduce((sum, a) => sum + a.í• ë‹¹ì‹œê°„, 0);
                        // ë§ˆì§€ë§‰ í• ë‹¹ì— ì°¨ì´ ì¡°ì •
                        if (assignedBlocks !== totalBlocks) {
                            const diff = totalBlocks - assignedBlocks;
                            if (taskGroup.í• ë‹¹.length > 0) {
                                taskGroup.í• ë‹¹[taskGroup.í• ë‹¹.length - 1].í• ë‹¹ì‹œê°„ += diff;
                                assignedBlocks = totalBlocks;
                            }
                        }
                    } else if (assignedBlocks === 0 && totalBlocks > 0) {
                        // í• ë‹¹ì´ ì—†ìœ¼ë©´ ê¸°ì¤€ì‹œê°„ë§Œí¼ í• ë‹¹
                        assignedBlocks = totalBlocks;
                    }
                    
                    // ì‚¬ëŒë³„ë¡œ ê·¸ë£¹í™”í•˜ê³ , ë“±ë¡ëœ ê²ƒê³¼ ì•ˆëœ ê²ƒì„ ì ì ˆíˆ ì„ê¸°
                    const scheduledAssignments = [];
                    const unscheduledAssignments = [];
                    
                    taskGroup.í• ë‹¹.forEach(assignment => {
                        const task = projectData.find(t => 
                            t.ì´ë¦„ === assignment.ì´ë¦„ &&
                            t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                            t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                            t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜
                        );
                        if (task && isTaskScheduled(task.id, assignment.ì´ë¦„)) {
                            scheduledAssignments.push(assignment);
                        } else {
                            unscheduledAssignments.push(assignment);
                        }
                    });
                    
                    // ì‚¬ëŒë³„ë¡œ ê·¸ë£¹í™” (ì´ë¦„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì¼ê´€ì„± ìœ ì§€)
                    const groupedByPerson = {};
                    [...scheduledAssignments, ...unscheduledAssignments].forEach(assignment => {
                        if (!groupedByPerson[assignment.ì´ë¦„]) {
                            groupedByPerson[assignment.ì´ë¦„] = [];
                        }
                        groupedByPerson[assignment.ì´ë¦„].push(assignment);
                    });
                    
                    // ì‚¬ëŒ ì´ë¦„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì™¼ìª½ë¶€í„° ì±„ìš°ê¸°
                    const sortedPersonNames = Object.keys(groupedByPerson).sort();
                    
                    // ë“±ë¡ëœ ê²ƒê³¼ ì•ˆëœ ê²ƒì„ ë°˜ë°˜ ì„ì–´ì„œ ë°°ì¹˜
                    const reorderedAssignments = [];
                    
                    sortedPersonNames.forEach(personName => {
                        const personAssignments = groupedByPerson[personName];
                        personAssignments.forEach(assignment => {
                            reorderedAssignments.push(assignment);
                        });
                    });
                    
                    // ì‹¤ì œ ìŠ¤ì¼€ì¤„ì— ë“±ë¡ëœ ë¸”ë¡ ì •ë³´ ìˆ˜ì§‘
                    const scheduledBlockInfo = [];
                    let currentBlockIndex = 0;
                    
                    reorderedAssignments.forEach(assignment => {
                        // í•´ë‹¹ í…ŒìŠ¤í¬ ì°¾ê¸°
                        const task = projectData.find(t => 
                            t.ì´ë¦„ === assignment.ì´ë¦„ &&
                            t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                            t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                            t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜
                        );
                        if (task && isTaskScheduled(task.id, assignment.ì´ë¦„)) {
                            // ìŠ¤ì¼€ì¤„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                            const schedule = schedules.find(s => 
                                s.taskId === task.id && 
                                (s.userName === assignment.ì´ë¦„ || s.user === assignment.ì´ë¦„)
                            );
                            if (schedule) {
                                const actualScheduledBlocks = assignment.í• ë‹¹ì‹œê°„;
                                
                                const startIndex = currentBlockIndex;
                                const endIndex = currentBlockIndex + actualScheduledBlocks - 1;
                                scheduledBlockInfo.push({
                                    startIndex,
                                    endIndex,
                                    userName: assignment.ì´ë¦„,
                                    startDate: schedule.startDate,
                                    endDate: schedule.endDate,
                                    startTime: schedule.startTime,
                                    endTime: schedule.endTime,
                                    actualHours: assignment.í• ë‹¹ì‹œê°„,
                                    assignedHours: assignment.í• ë‹¹ì‹œê°„,
                                    assignedStartIndex: currentBlockIndex,
                                    assignedEndIndex: currentBlockIndex + assignment.í• ë‹¹ì‹œê°„ - 1
                                });
                            }
                        }
                        currentBlockIndex += assignment.í• ë‹¹ì‹œê°„;
                    });
                    
                    // ì‹¤ì œ ë“±ë¡ëœ ì‹œê°„ ê³„ì‚° (ì‹œê°„ ë‹¨ìœ„) - í• ë‹¹ ì‹œê°„ì˜ í•©
                    const totalScheduledHours = scheduledBlockInfo.reduce((sum, info) => {
                        return sum + (info.actualHours || info.assignedHours || 0);
                    }, 0);
                    
                    // ê°™ì€ ì‚¬ëŒ, ê°™ì€ ë‚ ì§œ, ì—°ì†ëœ ë¸”ë¡ì„ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ê¸°
                    scheduledBlockInfo.sort((a, b) => a.startIndex - b.startIndex);
                    
                    const blockGroups = [];
                    scheduledBlockInfo.forEach((info, idx) => {
                        // ì´ì „ ê·¸ë£¹ê³¼ ê°™ì€ ì‚¬ëŒ, ê°™ì€ ë‚ ì§œ, ì—°ì†ëœ ë¸”ë¡ì¸ì§€ í™•ì¸
                        const prevGroup = blockGroups[blockGroups.length - 1];
                        if (prevGroup && 
                            prevGroup.userName === info.userName &&
                            prevGroup.startDate === info.startDate &&
                            prevGroup.endIndex + 1 === info.startIndex) {
                            // ì´ì „ ê·¸ë£¹ì— ì¶”ê°€
                            prevGroup.endIndex = info.endIndex;
                            prevGroup.endDate = info.endDate;
                            
                            // ì¢…ë£Œ ì‹œê°„ ê³„ì‚°: ë§ˆì§€ë§‰ ë¸”ë¡ì˜ ì‹œì‘ ì‹œê°„ + í• ë‹¹ ì‹œê°„
                            const [startH, startM] = info.startTime.split(':').map(Number);
                            const assignedHours = info.assignedHours || info.actualHours || 0;
                            const endH = startH + Math.floor(assignedHours);
                            const endM = startM + Math.round((assignedHours % 1) * 60);
                            const finalEndH = endH + Math.floor(endM / 60);
                            const finalEndM = endM % 60;
                            prevGroup.endTime = `${String(finalEndH).padStart(2, '0')}:${String(finalEndM).padStart(2, '0')}`;
                            
                            prevGroup.actualHours += (info.actualHours || info.assignedHours || 0);
                            prevGroup.assignedHours += (info.assignedHours || 0);
                        } else {
                            // ìƒˆ ê·¸ë£¹ ìƒì„±
                            const [startH, startM] = info.startTime.split(':').map(Number);
                            const assignedHours = info.assignedHours || info.actualHours || 0;
                            const endH = startH + Math.floor(assignedHours);
                            const endM = startM + Math.round((assignedHours % 1) * 60);
                            const finalEndH = endH + Math.floor(endM / 60);
                            const finalEndM = endM % 60;
                            const calculatedEndTime = `${String(finalEndH).padStart(2, '0')}:${String(finalEndM).padStart(2, '0')}`;
                            
                            blockGroups.push({
                                groupId: `group-${taskGroup.ì¤‘ë¶„ë¥˜}-${idx}`,
                                startIndex: info.startIndex,
                                endIndex: info.endIndex,
                                userName: info.userName,
                                startDate: info.startDate,
                                endDate: info.endDate,
                                startTime: info.startTime,
                                endTime: calculatedEndTime,
                                actualHours: info.actualHours || info.assignedHours || 0,
                                assignedHours: info.assignedHours || 0
                            });
                        }
                    });
                    
                    const groupDiv = document.createElement('div');
                    groupDiv.className = `task-block-group ${category}`;
                    
                    // í—¤ë” ìƒì„±
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'task-block-header';
                    headerDiv.innerHTML = `
                        <div>
                            <div class="task-block-title">${taskGroup.ì¤‘ë¶„ë¥˜}</div>
                            <div class="task-block-meta">
                                ${taskGroup.ëŒ€ë¶„ë¥˜} > ${taskGroup.ì†Œë¶„ë¥˜} | ê¸°ì¤€: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„ | ë“±ë¡: ${totalScheduledHours.toFixed(1)}ì‹œê°„
                            </div>
                        </div>
                    `;
                    
                    // ë¸”ë¡ ê·¸ë¦¬ë“œ ìƒì„±
                    const blocksGrid = document.createElement('div');
                    blocksGrid.className = 'task-blocks-grid';
                    blocksGrid.id = `blocks-${taskGroup.ì¤‘ë¶„ë¥˜}`;
                    
                    groupDiv.appendChild(headerDiv);
                    groupDiv.appendChild(blocksGrid);
                    
                    // ë¸”ë¡ ë°°ì—´ ìƒì„± (ìƒíƒœë³„ë¡œ ì •ë ¬í•˜ì—¬ ì™¼ìª½ë¶€í„° ì±„ìš°ê¸°)
                    const blockArray = [];
                    let newBlockIndex = 0;
                    
                    // 1. ë“±ë¡ëœ ë¸”ë¡ë“¤ (scheduled-active) - ì™¼ìª½ë¶€í„°
                    scheduledBlockInfo.forEach(info => {
                        for (let originalIndex = info.startIndex; originalIndex <= info.endIndex; originalIndex++) {
                            const blockGroup = blockGroups.find(group => 
                                originalIndex >= group.startIndex && originalIndex <= group.endIndex
                            );
                            blockArray.push({
                                originalIndex: originalIndex,
                                newIndex: newBlockIndex++,
                                type: 'scheduled-active',
                                blockScheduleInfo: info,
                                blockGroup: blockGroup
                            });
                        }
                    });
                    
                    // 2. í• ë‹¹ë˜ì—ˆì§€ë§Œ ë¯¸ë“±ë¡ ë¸”ë¡ë“¤ (scheduled) - ì¤‘ê°„
                    let originalAssignedIndex = 0;
                    reorderedAssignments.forEach(assignment => {
                        const task = projectData.find(t => 
                            t.ì´ë¦„ === assignment.ì´ë¦„ &&
                            t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                            t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                            t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜
                        );
                        const isScheduled = task && isTaskScheduled(task.id, assignment.ì´ë¦„);
                        
                        if (!isScheduled) {
                            // ë¯¸ë“±ë¡ í• ë‹¹ ë¸”ë¡
                            for (let j = 0; j < assignment.í• ë‹¹ì‹œê°„; j++) {
                                blockArray.push({
                                    originalIndex: originalAssignedIndex++,
                                    newIndex: newBlockIndex++,
                                    type: 'scheduled',
                                    assignment: assignment
                                });
                            }
                        } else {
                            // ë“±ë¡ëœ ë¸”ë¡ì€ ì´ë¯¸ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ ì›ë˜ ì¸ë±ìŠ¤ë§Œ ì¦ê°€
                            originalAssignedIndex += assignment.í• ë‹¹ì‹œê°„;
                        }
                    });
                    
                    // 3. ë¯¸í• ë‹¹ ë¸”ë¡ë“¤ - ì˜¤ë¥¸ìª½
                    for (let i = assignedBlocks; i < totalBlocks; i++) {
                        blockArray.push({
                            originalIndex: i,
                            newIndex: newBlockIndex++,
                            type: 'unassigned'
                        });
                    }
                    
                    // ë¸”ë¡ ê·¸ë£¹ì˜ ì²« ë²ˆì§¸ ë¸”ë¡ ì¸ë±ìŠ¤ ì €ì¥
                    const groupFirstIndexMap = {};
                    blockArray.forEach((blockData) => {
                        if (blockData.blockGroup) {
                            const groupId = blockData.blockGroup.groupId;
                            if (!groupFirstIndexMap[groupId]) {
                                groupFirstIndexMap[groupId] = blockData.newIndex;
                            }
                        }
                    });
                    
                    // ë¸”ë¡ ìƒì„± ë° ë°°ì¹˜
                    blockArray.forEach((blockData) => {
                        const originalIndex = blockData.originalIndex;
                        const newIndex = blockData.newIndex;
                        const blockScheduleInfo = blockData.blockScheduleInfo;
                        const blockGroup = blockData.blockGroup;
                        const isScheduled = blockData.type === 'scheduled-active';
                        const isAssigned = blockData.type !== 'unassigned';
                        
                        const block = document.createElement('div');
                        if (isScheduled) {
                            block.className = `task-block ${category} scheduled-active`;
                            if (blockGroup) {
                                block.setAttribute('data-group-id', blockGroup.groupId);
                            }
                        } else if (isAssigned) {
                            block.className = `task-block ${category} scheduled`;
                        } else {
                            block.className = `task-block ${category}`;
                        }
                        block.setAttribute('data-block-index', originalIndex);
                        block.setAttribute('data-display-index', newIndex);
                        
                        const tooltip = document.createElement('div');
                        tooltip.className = 'task-block-tooltip';
                        
                        if (isScheduled && blockGroup) {
                            const dateStr = blockGroup.startDate === blockGroup.endDate 
                                ? blockGroup.startDate 
                                : `${blockGroup.startDate} ~ ${blockGroup.endDate}`;
                            
                            // ê°™ì€ ê·¸ë£¹ì˜ ì²« ë²ˆì§¸ ë¸”ë¡ ì¸ë±ìŠ¤ì™€ ë¸”ë¡ ê°œìˆ˜ë¡œ ë²”ìœ„ ê³„ì‚°
                            const groupFirstIndex = groupFirstIndexMap[blockGroup.groupId] || newIndex;
                            const groupBlockCount = blockGroup.endIndex - blockGroup.startIndex + 1;
                            const groupStartDisplay = groupFirstIndex + 1;
                            const groupEndDisplay = groupFirstIndex + groupBlockCount;
                            const blockRange = groupBlockCount === 1 
                                ? `${groupStartDisplay}` 
                                : `${groupStartDisplay}~${groupEndDisplay}`;
                            
                            const assignedHoursHtml = blockGroup.assignedHours > 0 
                                ? `<div>ğŸ“‹ í• ë‹¹ì‹œê°„: ${blockGroup.assignedHours}ì‹œê°„</div>` 
                                : '';
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">ë“±ë¡ë¨ (ë¸”ë¡ ${blockRange}/${totalBlocks})</div>
                                <div>ğŸ‘¤ ${blockGroup.userName}</div>
                                <div>ğŸ“… ${dateStr}</div>
                                <div>â° ${blockGroup.startTime} ~ ${blockGroup.endTime}</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                    <div>âœ… ë“±ë¡ì‹œê°„: ${blockGroup.actualHours}ì‹œê°„</div>
                                    ${assignedHoursHtml}
                                </div>
                            `;
                        } else if (isScheduled && !blockGroup && blockScheduleInfo) {
                            const dateStr = blockScheduleInfo.startDate === blockScheduleInfo.endDate 
                                ? blockScheduleInfo.startDate 
                                : `${blockScheduleInfo.startDate} ~ ${blockScheduleInfo.endDate}`;
                            
                            const actualHours = blockScheduleInfo.actualHours || calculateHours(
                                blockScheduleInfo.startTime,
                                blockScheduleInfo.endTime,
                                blockScheduleInfo.startDate,
                                blockScheduleInfo.endDate
                            );
                            const assignedHours = blockScheduleInfo.assignedHours || 0;
                            
                            const assignedHoursHtml2 = assignedHours > 0 
                                ? `<div>ğŸ“‹ í• ë‹¹ì‹œê°„: ${assignedHours}ì‹œê°„</div>` 
                                : '';
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">ë“±ë¡ë¨ (${newIndex + 1}/${totalBlocks})</div>
                                <div>ğŸ‘¤ ${blockScheduleInfo.userName}</div>
                                <div>ğŸ“… ${dateStr}</div>
                                <div>â° ${blockScheduleInfo.startTime} ~ ${blockScheduleInfo.endTime}</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                    <div>âœ… ë“±ë¡ì‹œê°„: ${actualHours}ì‹œê°„</div>
                                    ${assignedHoursHtml2}
                                </div>
                            `;
                        } else if (isAssigned && !isScheduled) {
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">í• ë‹¹ë¨ (ë¯¸ë“±ë¡) (${newIndex + 1}/${totalBlocks})</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                </div>
                            `;
                        } else if (!isAssigned) {
                            tooltip.innerHTML = `
                                <div style="font-weight: 600; margin-bottom: 4px;">ë¯¸í• ë‹¹ (${newIndex + 1}/${totalBlocks})</div>
                                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.3);">
                                    <div>ğŸ“Š ê¸°ì¤€ì‹œê°„: ${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</div>
                                </div>
                            `;
                        }
                        block.appendChild(tooltip);
                        
                        // í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
                        block.addEventListener('mouseenter', function() {
                            const currentTooltip = this.querySelector('.task-block-tooltip');
                            if (currentTooltip) {
                                currentTooltip.style.opacity = '1';
                            }
                            
                            const groupId = this.getAttribute('data-group-id');
                            if (groupId) {
                                const groupBlocks = blocksGrid.querySelectorAll(`[data-group-id="${groupId}"]`);
                                groupBlocks.forEach(function(groupBlock) {
                                    groupBlock.style.transform = 'scale(1.15)';
                                    groupBlock.style.zIndex = '20';
                                    groupBlock.style.transition = 'transform 0.2s ease';
                                });
                            }
                        });
                        
                        block.addEventListener('mouseleave', function() {
                            const currentTooltip = this.querySelector('.task-block-tooltip');
                            if (currentTooltip) {
                                currentTooltip.style.opacity = '0';
                            }
                            
                            const groupId = this.getAttribute('data-group-id');
                            if (groupId) {
                                const groupBlocks = blocksGrid.querySelectorAll(`[data-group-id="${groupId}"]`);
                                groupBlocks.forEach(function(groupBlock) {
                                    groupBlock.style.transform = '';
                                    groupBlock.style.zIndex = '';
                                });
                            }
                        });
                        
                        blocksGrid.appendChild(block);
                    });
                    
                    container.appendChild(groupDiv);
                });
            });
        }

        function changeFilter(filterType) {
            currentFilter = filterType;
            
            document.getElementById('filterByMember').classList.toggle('active', filterType === 'member');
            document.getElementById('filterByTask').classList.toggle('active', filterType === 'task');
            
            renderTeamList();
        }

        function renderTeamList() {
            const container = document.getElementById('teamListContainer');
            container.innerHTML = '';

            if (projectData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ‘¥</div>
                        <p>íŒ€ì› ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            if (currentFilter === 'member') {
                renderByMember(container);
            } else {
                renderByTask(container);
            }
        }

        // ìŠ¤ì¼€ì¤„ì— ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸
        function isTaskScheduled(taskId, userName) {
            if (!schedules || schedules.length === 0) return false;
            return schedules.some(s => 
                s && s.taskId === taskId && 
                (s.userName === userName || s.user === userName)
            );
        }

        function renderByMember(container) {
            const memberGroups = {};
            projectData.forEach(task => {
                if (!memberGroups[task.ì´ë¦„]) {
                    memberGroups[task.ì´ë¦„] = {
                        ì´ë¦„: task.ì´ë¦„,
                        ì†Œì†: task.ì†Œì†,
                        ë¶€ì„œ: task.ë¶€ì„œ,
                        í…ŒìŠ¤í¬: []
                    };
                }
                memberGroups[task.ì´ë¦„].í…ŒìŠ¤í¬.push(task);
            });

            Object.values(memberGroups).forEach(member => {
                const totalHours = member.í…ŒìŠ¤í¬.reduce((sum, t) => sum + t.í• ë‹¹ì‹œê°„, 0);
                
                const cardDiv = document.createElement('div');
                cardDiv.className = 'team-member-card';
                
                let taskListHTML = '';
                member.í…ŒìŠ¤í¬.forEach(task => {
                    const isScheduled = isTaskScheduled(task.id, task.ì´ë¦„);
                    const scheduledClass = isScheduled ? '' : 'style="opacity: 0.6; border-left: 3px solid #f59e0b;"';
                    const scheduledBadge = isScheduled 
                        ? '<span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">âœ“ ë“±ë¡ë¨</span>'
                        : '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">â° ë¯¸ë“±ë¡</span>';
                    
                    taskListHTML += `
                        <div class="member-task-item" ${scheduledClass}>
                            <div class="member-task-item-header">
                                <div>
                                    <div class="member-task-title">${task.ì¤‘ë¶„ë¥˜}</div>
                                    ${scheduledBadge}
                                </div>
                                <div class="member-task-hours">${task.í• ë‹¹ì‹œê°„}h</div>
                            </div>
                            <div class="member-task-categories">
                                <span class="category-tag primary">${task.ëŒ€ë¶„ë¥˜}</span>
                                <span class="category-tag secondary">${task.ì¤‘ë¶„ë¥˜}</span>
                                <span class="category-tag tertiary">${task.ì†Œë¶„ë¥˜}</span>
                            </div>
                            ${task.ë¹„ê³  ? `<div style="margin-top: 6px; font-size: 0.75rem; color: #64748b;">ğŸ“ ${task.ë¹„ê³ }</div>` : ''}
                        </div>
                    `;
                });
                
                cardDiv.innerHTML = `
                    <div class="member-header">
                        <div>
                            <div class="member-name">${member.ì´ë¦„}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">
                                ${member.ì†Œì†} ${member.ë¶€ì„œ ? `Â· ${member.ë¶€ì„œ}` : ''}
                            </div>
                        </div>
                        <div class="member-task-count">${member.í…ŒìŠ¤í¬.length}ê°œ</div>
                    </div>
                    <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">
                        ì´ í• ë‹¹ ì‹œê°„: <strong style="color: var(--primary-blue);">${totalHours}ì‹œê°„</strong>
                    </div>
                    <div class="member-task-list">
                        ${taskListHTML}
                    </div>
                `;
                
                container.appendChild(cardDiv);
            });
        }

        function renderByTask(container) {
            const taskGroups = {};
            projectData.forEach(task => {
                const key = `${task.ëŒ€ë¶„ë¥˜}-${task.ì¤‘ë¶„ë¥˜}-${task.ì†Œë¶„ë¥˜}`;
                if (!taskGroups[key]) {
                    taskGroups[key] = {
                        ëŒ€ë¶„ë¥˜: task.ëŒ€ë¶„ë¥˜,
                        ì¤‘ë¶„ë¥˜: task.ì¤‘ë¶„ë¥˜,
                        ì†Œë¶„ë¥˜: task.ì†Œë¶„ë¥˜,
                        ê¸°ì¤€ì‹œê°„: task.ê¸°ì¤€ì‹œê°„,
                        í• ë‹¹: []
                    };
                }
                if (task.í• ë‹¹ì‹œê°„ > 0) {
                    taskGroups[key].í• ë‹¹.push({
                        ì´ë¦„: task.ì´ë¦„,
                        ì†Œì†: task.ì†Œì†,
                        ë¶€ì„œ: task.ë¶€ì„œ,
                        í• ë‹¹ì‹œê°„: task.í• ë‹¹ì‹œê°„,
                        ë¹„ê³ : task.ë¹„ê³ 
                    });
                }
            });

            Object.values(taskGroups).forEach(taskGroup => {
                const totalAllocated = taskGroup.í• ë‹¹.reduce((sum, a) => sum + a.í• ë‹¹ì‹œê°„, 0);
                const category = getCategoryFromMajor(taskGroup.ëŒ€ë¶„ë¥˜);
                
                const cardDiv = document.createElement('div');
                cardDiv.className = 'team-member-card';
                
                let memberListHTML = '';
                taskGroup.í• ë‹¹.forEach(assignment => {
                    const task = projectData.find(t => 
                        t.ì´ë¦„ === assignment.ì´ë¦„ &&
                        t.ëŒ€ë¶„ë¥˜ === taskGroup.ëŒ€ë¶„ë¥˜ &&
                        t.ì¤‘ë¶„ë¥˜ === taskGroup.ì¤‘ë¶„ë¥˜ &&
                        t.ì†Œë¶„ë¥˜ === taskGroup.ì†Œë¶„ë¥˜ &&
                        t.í• ë‹¹ì‹œê°„ === assignment.í• ë‹¹ì‹œê°„
                    );
                    const isScheduled = task ? isTaskScheduled(task.id, assignment.ì´ë¦„) : false;
                    const scheduledClass = isScheduled ? '' : 'style="opacity: 0.6; border-left: 3px solid #f59e0b;"';
                    const scheduledBadge = isScheduled 
                        ? '<span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; margin-left: 8px;">âœ“ ë“±ë¡ë¨</span>'
                        : '<span style="background: #f59e0b; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; margin-left: 8px;">â° ë¯¸ë“±ë¡</span>';
                    
                    memberListHTML += `
                        <div class="member-task-item" ${scheduledClass}>
                            <div class="member-task-item-header">
                                <div>
                                    <div class="member-task-title">${assignment.ì´ë¦„}${scheduledBadge}</div>
                                </div>
                                <div class="member-task-hours">${assignment.í• ë‹¹ì‹œê°„}h</div>
                            </div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 4px;">
                                ${assignment.ì†Œì†} ${assignment.ë¶€ì„œ ? `Â· ${assignment.ë¶€ì„œ}` : ''}
                            </div>
                            ${assignment.ë¹„ê³  ? `<div style="margin-top: 6px; font-size: 0.75rem; color: #64748b;">ğŸ“ ${assignment.ë¹„ê³ }</div>` : ''}
                        </div>
                    `;
                });
                
                cardDiv.innerHTML = `
                    <div class="member-header">
                        <div>
                            <div class="member-name">${taskGroup.ì¤‘ë¶„ë¥˜}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">
                                ${taskGroup.ëŒ€ë¶„ë¥˜} > ${taskGroup.ì†Œë¶„ë¥˜}
                            </div>
                        </div>
                        <div class="member-task-count">${taskGroup.í• ë‹¹.length}ëª…</div>
                    </div>
                    <div style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">
                        ê¸°ì¤€ ì‹œê°„: <strong>${taskGroup.ê¸°ì¤€ì‹œê°„}ì‹œê°„</strong> | 
                        í• ë‹¹ ì‹œê°„: <strong style="color: var(--primary-blue);">${totalAllocated}ì‹œê°„</strong>
                    </div>
                    <div class="member-task-list">
                        ${memberListHTML}
                    </div>
                `;
                
                container.appendChild(cardDiv);
            });
        }

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ í”„ë¡œì íŠ¸ ì´ë¦„ ì½ê¸°
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // í”„ë¡œì íŠ¸ í•„í„°ë§
        function filterProjectData(data, projectName) {
            if (!projectName) return data;
            return data.filter(task => task.ì‚¬ì—…ëª… === projectName);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.onload = function() {
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ í”„ë¡œì íŠ¸ ì´ë¦„ í™•ì¸
            selectedProject = getUrlParameter('project');
            
            if (!selectedProject) {
                alert('í”„ë¡œì íŠ¸ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                window.location.href = 'project_manage.html';
                return;
            }
            
            // í”„ë¡œì íŠ¸ í—¤ë” í‘œì‹œ
            document.getElementById('projectNameDisplay').textContent = selectedProject;
            
            // ë°ì´í„° ë¡œë“œ
            loadData();
            
            // localStorage ë³€ê²½ ê°ì§€
            window.addEventListener('storage', function(e) {
                if (e.key === 'projectSchedules') {
                    reloadData();
                }
            });
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ì²´í¬ (ê°™ì€ íƒ­ì—ì„œë„ ì—…ë°ì´íŠ¸)
            setInterval(function() {
                reloadData();
            }, 3000);
            
            // ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
            function loadData() {
                let data = null;
                
                // localStorageì—ì„œ ë¨¼ì € ë¡œë“œ (ë“±ë¡ëœ schedules í¬í•¨)
                const saved = localStorage.getItem('projectSchedules');
                if (saved) {
                    try {
                        data = JSON.parse(saved);
                    } catch (e) {
                        console.error('localStorage ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
                
                // projects-data.jsì—ì„œ ë¡œë“œëœ ë°ì´í„°ì™€ ë³‘í•© (schedulesëŠ” localStorage ìš°ì„ )
                if (typeof PROJECTS_DATA !== 'undefined') {
                    if (!data) {
                        data = {
                            projects: PROJECTS_DATA.projects || [],
                            tasks: PROJECTS_DATA.tasks || [],
                            schedules: PROJECTS_DATA.schedules || []
                        };
                    } else {
                        // localStorage ë°ì´í„°ì— PROJECTS_DATAì˜ projectsì™€ tasks ë³‘í•© (schedulesëŠ” localStorage ìœ ì§€)
                        // tasksëŠ” í•­ìƒ PROJECTS_DATAì—ì„œ ê°€ì ¸ì™€ì„œ ìµœì‹  ê¸°ì¤€ì‹œê°„ ë°˜ì˜
                        data.projects = PROJECTS_DATA.projects || data.projects || [];
                        data.tasks = PROJECTS_DATA.tasks || data.tasks || [];
                        // schedulesëŠ” localStorageì˜ ê²ƒì„ ìœ ì§€ (ë“±ë¡ëœ ì¼ì •ì´ ìˆìœ¼ë¯€ë¡œ)
                        data.schedules = data.schedules || [];
                    }
                }
                
                if (data) {
                    // í†µí•© ë°ì´í„° êµ¬ì¡° ë¡œë“œ
                    const projectsData = data.projects || [];
                    const tasksData = data.tasks || [];
                    schedules = data.schedules || [];
                    // í•˜ìœ„ í˜¸í™˜ì„±: projectDataê°€ ì—†ìœ¼ë©´ tasksì—ì„œ ìƒì„±
                    let allProjectData = data.projectData || tasksData || [];
                    
                    // í”„ë¡œì íŠ¸ í•„í„°ë§
                    projectData = filterProjectData(allProjectData, selectedProject);
                    
                    if (projectData.length === 0) {
                        alert('ì„ íƒí•œ í”„ë¡œì íŠ¸ì— ë“±ë¡ëœ í…ŒìŠ¤í¬ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        window.location.href = 'project_manage.html';
                        return;
                    }
                    
                    // ë¸”ë¡ ë° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
                    renderTaskBlocks();
                    renderTeamList();
                } else {
                    alert('ë“±ë¡ëœ í”„ë¡œì íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    window.location.href = 'project_manage.html';
                }
            }
            
            // ë°ì´í„° ì¬ë¡œë“œ í•¨ìˆ˜
            function reloadData() {
                let data = null;
                
                // localStorageì—ì„œ ë¨¼ì € ë¡œë“œ (ë“±ë¡ëœ schedules í¬í•¨)
                const saved = localStorage.getItem('projectSchedules');
                if (saved) {
                    try {
                        data = JSON.parse(saved);
                    } catch (e) {
                        console.error('localStorage ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
                    }
                }
                
                // projects-data.jsì—ì„œ ë¡œë“œëœ ë°ì´í„°ì™€ ë³‘í•© (schedulesëŠ” localStorage ìš°ì„ )
                if (typeof PROJECTS_DATA !== 'undefined') {
                    if (!data) {
                        data = {
                            projects: PROJECTS_DATA.projects || [],
                            tasks: PROJECTS_DATA.tasks || [],
                            schedules: PROJECTS_DATA.schedules || []
                        };
                    } else {
                        // localStorage ë°ì´í„°ì— PROJECTS_DATAì˜ projectsì™€ tasks ë³‘í•© (schedulesëŠ” localStorage ìœ ì§€)
                        // tasksëŠ” í•­ìƒ PROJECTS_DATAì—ì„œ ê°€ì ¸ì™€ì„œ ìµœì‹  ê¸°ì¤€ì‹œê°„ ë°˜ì˜
                        data.projects = PROJECTS_DATA.projects || data.projects || [];
                        data.tasks = PROJECTS_DATA.tasks || data.tasks || [];
                        // schedulesëŠ” localStorageì˜ ê²ƒì„ ìœ ì§€ (ë“±ë¡ëœ ì¼ì •ì´ ìˆìœ¼ë¯€ë¡œ)
                        data.schedules = data.schedules || [];
                    }
                }
                
                if (data) {
                    const tasksData = data.tasks || [];
                    const newSchedules = data.schedules || [];
                    let allProjectData = data.projectData || tasksData || [];
                    
                    schedules = newSchedules;
                    projectData = filterProjectData(allProjectData, selectedProject);
                    renderTaskBlocks();
                    renderTeamList();
                }
            }
        };
    </script>
</body>
</html>


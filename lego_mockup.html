<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì íŠ¸ ê³„íš ë³´ê¸° - ì¸í„°ë™í‹°ë¸Œ ëª©ì—…</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        :root {
            --bg-gray: #f4f6f8;
            --border-color: #e5e7eb;
            --primary-blue: #2563eb;
            --text-dark: #1e293b;
            --task-blue-bg: #dbeafe; --task-blue-text: #1e40af; --task-blue-border: #3b82f6;
            --task-green-bg: #dcfce7; --task-green-text: #166534; --task-green-border: #22c55e;
            --task-yellow-bg: #fef9c3; --task-yellow-text: #854d0e; --task-yellow-border: #eab308;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg-gray);
            margin: 0; padding: 25px;
            color: var(--text-dark);
            height: 100vh; display: flex; flex-direction: column;
            box-sizing: border-box;
        }

        /* --- Header --- */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h1 { font-size: 1.5rem; font-weight: 700; margin: 0; }
        .upload-btn {
            background-color: #1e293b; color: white; padding: 10px 20px;
            border-radius: 8px; border: none; display: flex; align-items: center;
            gap: 8px; cursor: pointer; font-weight: 600;
        }

        /* --- Layout --- */
        .main-layout { display: flex; gap: 20px; flex: 1; overflow: hidden; }

        /* --- Main Calendar Card --- */
        .content-area {
            flex: 1; background: white; border-radius: 12px;
            border: 1px solid var(--border-color); display: flex;
            flex-direction: column; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .toolbar {
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; border-bottom: 1px solid var(--border-color);
            position: relative; z-index: 100002;
        }

        .view-switch { display: flex; background: #f1f5f9; padding: 4px; border-radius: 8px; }
        .view-switch button {
            border: none; background: none; padding: 6px 14px;
            border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: #64748b;
        }
        .view-switch button.active { background: white; color: var(--text-dark); box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-weight: 600; }

        .legend-wrapper { position: relative; margin-left: 10px; z-index: 100001; }
        .legend-btn { background: #f1f5f9; border: 1px solid var(--border-color); padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .legend-popup {
            display: none; position: absolute; top: 40px; left: 0;
            background: white; border: 1px solid var(--border-color);
            border-radius: 10px; padding: 15px; width: 220px; z-index: 100000 !important;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .legend-wrapper:hover .legend-popup { display: block; }
        .legend-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 0.85rem; }
        .dot { width: 12px; height: 12px; border-radius: 3px; }

        /* --- Calendar Grid --- */
        .calendar-grid {
            flex: 1; overflow: auto; display: none;
        }
        
        /* ì£¼ë³„ ë·° */
        .calendar-grid.week-view {
            grid-template-columns: 80px repeat(5, 1fr);
            grid-template-rows: 45px repeat(10, 80px);
        }
        
        /* ì›”ë³„ ë·° */
        .calendar-grid.month-view {
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 45px repeat(5, 120px);
            position: relative;
            overflow: visible; /* íˆ´íŒì´ ë°–ìœ¼ë¡œ ë‚˜ì˜¤ë„ë¡ */
        }
        
        /* Active ìƒíƒœ - ë°˜ë“œì‹œ ë§ˆì§€ë§‰ì— ì •ì˜ */
        .calendar-grid.active { display: grid !important; }
        .calendar-grid.month-view .cell[data-date] {
            position: relative;
            z-index: 1;
            overflow: visible; /* íˆ´íŒì´ ì…€ ë°–ìœ¼ë¡œ ë‚˜ì˜¤ë„ë¡ */
        }
        
        /* ì›”ë³„ ë·° ì¼ì • í‘œì‹œ */
        .schedule-indicator { 
            font-size: 0.7rem; 
            margin-top: 8px; 
            line-height: 1.6; 
            position: relative;
            overflow: visible;
        }
        .schedule-indicator .person { display: flex; align-items: center; gap: 4px; margin-bottom: 3px; position: relative; }
        .schedule-indicator .person-name { color: #475569; font-weight: 500; cursor: pointer; }
        .schedule-indicator .person-name:hover { color: var(--primary-blue); text-decoration: underline; }
        .schedule-indicator .task-dots { display: inline-flex; gap: 3px; margin-left: 2px; }
        
        /* ì›”ë³„ ë·° ì—°ì† í…ŒìŠ¤í¬ ë°” */
        .month-task-bar {
            position: absolute;
            height: 22px;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: 0.65rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            cursor: pointer;
            border-left: 3px solid;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            pointer-events: auto;
        }
        .month-task-bar:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 10000;
            overflow: visible;
        }
        
        /* ê°™ì€ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ */
        .month-task-bar.same-task-highlight {
            outline: 3px solid #2563eb;
            outline-offset: 2px;
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.4);
            z-index: 999;
            transform: scale(1.02);
            transition: all 0.2s ease;
        }
        
        /* ì›”ë³„ ë·° í…ŒìŠ¤í¬ ë°” íˆ´íŒ */
        .month-task-tooltip {
            display: none;
            position: absolute;
            left: 50%;
            bottom: calc(100% + 8px); /* í…ŒìŠ¤í¬ ë°” ë°”ë¡œ ìœ„ */
            transform: translateX(-50%);
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            z-index: 99999 !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: normal;
            pointer-events: none;
        }
        .month-task-bar:hover .month-task-tooltip {
            display: block;
        }
        .month-task-tooltip strong {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-size: 0.85rem;
        }
        .month-task-tooltip div {
            margin-bottom: 4px;
            color: #64748b;
        }
        .month-task-bar.blue { 
            background: var(--task-blue-bg); 
            color: var(--task-blue-text); 
            border-left-color: var(--task-blue-border); 
        }
        .month-task-bar.green { 
            background: var(--task-green-bg); 
            color: var(--task-green-text); 
            border-left-color: var(--task-green-border); 
        }
        .month-task-bar.yellow { 
            background: var(--task-yellow-bg); 
            color: var(--task-yellow-text); 
            border-left-color: var(--task-yellow-border); 
        }
        
        /* ì‚¬ëŒë³„ ì—…ë¬´ íˆ´íŒ */
        .task-tooltip {
            display: none;
            position: absolute;
            left: 0;
            top: 20px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            min-width: 180px;
            z-index: 200;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            font-size: 0.75rem;
            line-height: 1.5;
        }
        .person:hover .task-tooltip { display: block; }
        .task-tooltip .tooltip-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        .task-tooltip .task-item {
            display: flex;
            align-items: start;
            gap: 6px;
            margin-bottom: 5px;
            color: #475569;
        }
        .task-tooltip .task-item:last-child { margin-bottom: 0; }
        
        /* ì¼ë³„ ë·° */
        .calendar-grid.day-view {
            grid-template-columns: 80px 1fr;
            grid-template-rows: 45px repeat(10, 80px);
        }
        .cell { border-right: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; position: relative; overflow: hidden; }
        
        /* ì£¼ë³„/ì¼ë³„/ì›”ë³„ ë·°ëŠ” íˆ´íŒì´ ë³´ì´ë„ë¡ overflow visible */
        .week-view .cell:not(.cell-header):not(.time-label),
        .day-view .cell:not(.cell-header):not(.time-label),
        .month-view .cell[data-date] {
            overflow: visible;
        }
        .cell-header { 
            background: #fafafa; position: sticky; top: 0; z-index: 10;
            display: flex; justify-content: center; align-items: center;
            font-size: 0.85rem; font-weight: 600; color: #64748b;
        }
        .time-label { display: flex; justify-content: center; padding-top: 10px; font-size: 0.8rem; color: #94a3b8; }
        
        /* ì›”ë³„ ë·° ë‚ ì§œ ì…€ í´ë¦­ ê°€ëŠ¥ */
        .month-view .cell[data-date] { cursor: pointer; transition: 0.2s; }
        .month-view .cell[data-date]:hover { background: #f0f9ff !important; }
        .month-view .cell[data-date].selected { background: #dbeafe !important; border: 2px solid var(--primary-blue); }

        .task {
            position: absolute; left: 8px; right: 8px; top: 5px;
            border-radius: 8px; padding: 10px; font-size: 0.8rem;
            cursor: pointer; border-left: 4px solid rgba(0,0,0,0.2);
            transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 20px;
            z-index: 1;
        }
        .task:hover {
            /* í˜¸ë²„ íš¨ê³¼ëŠ” ìœ ì§€í•˜ë˜ íˆ´íŒì€ JavaScriptë¡œë§Œ ì œì–´ */
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            overflow: visible;
        }
        .task-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }
        
        /* ì¤‘ê°„ ì‹œê°„ëŒ€ í˜¸ë²„ ì˜ì—­ */
        .task-hover-area {
            pointer-events: auto;
        }
        .task-hover-area:hover {
            z-index: 1000 !important;
        }
        /* JavaScriptë¡œ ì œì–´ë˜ëŠ” ê°•ì œ íˆ´íŒ í‘œì‹œ */
        .task-detail-tooltip.force-show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10000 !important;
        }
        
        /* ì¼ì • ë¸”ë¡ íˆ´íŒ */
        .task-detail-tooltip {
            display: none;
            position: absolute;
            left: 50%;
            bottom: 100%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: normal;
            pointer-events: none;
        }
        /* íˆ´íŒì€ JavaScriptë¡œë§Œ ì œì–´ (CSS í˜¸ë²„ ì œê±°í•˜ì—¬ ê¹œë¹¡ì„ ë°©ì§€) */
        .task .task-detail-tooltip.force-show { 
            display: block !important;
        }
        .task-detail-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: white;
        }
        .task-detail-tooltip .tooltip-row {
            margin-bottom: 6px;
        }
        .task-detail-tooltip .tooltip-row:last-child {
            margin-bottom: 0;
        }
        .task-detail-tooltip .tooltip-label {
            font-weight: 600;
            color: #64748b;
            font-size: 0.7rem;
        }
        .task-detail-tooltip .tooltip-value {
            color: var(--text-dark);
            font-weight: 500;
        }
        .task.blue { background: var(--task-blue-bg); color: var(--task-blue-text); border-left-color: var(--task-blue-border); }
        .task.green { background: var(--task-green-bg); color: var(--task-green-text); border-left-color: var(--task-green-border); }
        .task.yellow { background: var(--task-yellow-bg); color: var(--task-yellow-text); border-left-color: var(--task-yellow-border); }
        .task.hidden { display: none !important; }

        /* --- Sidebar --- */
        .sidebar {
            width: 300px; background: white; border-radius: 12px;
            border: 1px solid var(--border-color); padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .sidebar h3 { font-size: 1.1rem; margin-top: 0; margin-bottom: 20px; }
        .team-group { margin-bottom: 25px; }
        .team-header { display: flex; align-items: center; gap: 10px; font-weight: 700; margin-bottom: 12px; color: var(--primary-blue); font-size: 0.95rem; }
        .member-item { display: flex; align-items: center; gap: 10px; padding: 6px 0; margin-left: 15px; font-size: 0.9rem; color: #475569; }
        input[type="checkbox"] { width: 17px; height: 17px; accent-color: var(--primary-blue); cursor: pointer; }

    </style>
</head>
<body>

    <header class="header">
        <h1>í”„ë¡œì íŠ¸ ê³„íš ë³´ê¸°</h1>
        <div style="display: flex; gap: 10px;" id="headerButtons">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
        </div>
    </header>

    <div class="main-layout">
        <div class="content-area">
            <div class="toolbar">
                <div style="display: flex; align-items: center;">
                    <div class="view-switch">
                        <button class="active" onclick="changeView(this)">ì›” (Month)</button>
                        <button onclick="changeView(this)">ì£¼ (Week)</button>
                        <button onclick="changeView(this)">ì¼ (Day)</button>
                    </div>
                    <div class="legend-wrapper">
                        <button class="legend-btn">ğŸ¨ ë¶„ë¥˜ (Legend)</button>
                        <div class="legend-popup">
                            <h4 style="margin:0 0 10px 0;">ì—…ë¬´ ì†Œë¶„ë¥˜ ê°€ì´ë“œ</h4>
                            <div class="legend-item"><div class="dot" style="background:var(--task-blue-border)"></div> ê¸°íš (Planning)</div>
                            <div class="legend-item"><div class="dot" style="background:var(--task-green-border)"></div> ê°œë°œ (Development)</div>
                            <div class="legend-item"><div class="dot" style="background:var(--task-yellow-border)"></div> ë””ìì¸ (Design)</div>
                            <div style="margin-top:12px;padding-top:10px;border-top:1px solid #e5e7eb;font-size:0.75rem;color:#64748b;line-height:1.4;">
                                * í•œ ì‚¬ëŒì´ ì—¬ëŸ¬ ì†Œë¶„ë¥˜ ì—…ë¬´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
                </div>
                <div style="display:flex;align-items:center;gap:12px;position:relative;z-index:50000;">
                    <button id="prev-btn" onclick="navigate(-1)" style="background:#f1f5f9;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:16px;color:#475569;display:none;position:relative;z-index:50000;">â—€</button>
                    <div style="font-weight:600;min-width:200px;text-align:center;" id="current-date-display">2023ë…„ 3ì›”</div>
                    <button id="next-btn" onclick="navigate(1)" style="background:#f1f5f9;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:16px;color:#475569;display:none;position:relative;z-index:50000;">â–¶</button>
                </div>
            </div>

            <!-- ì£¼ë³„ ë·° (Week View) - ë™ì  ìƒì„±ë¨ -->
            <div class="calendar-grid week-view" id="week-view-grid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ì›”ë³„ ë·° (Month View) - ë™ì  ìƒì„±ë¨ -->
            <div class="calendar-grid month-view active" id="month-view-grid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ì¼ë³„ ë·° (Day View) - ë™ì  ìƒì„±ë¨ -->
            <div class="calendar-grid day-view" id="day-view-grid">
                <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>

        <aside class="sidebar">
            <h3>íŒ€/ì‚¬ì› í•„í„°</h3>
            
            <div class="team-group">
                <div class="team-header">
                    <input type="checkbox" id="team-dev" checked onchange="handleTeamAllClick('dev')"> 
                    <label for="team-dev">ê°œë°œíŒ€ (ì „ì²´)</label>
                </div>
                <div class="member-item">
                    <input type="checkbox" checked class="member-check dev-member" data-user="user-kim" onchange="handleMemberClick('dev')"> ê¹€ì² ìˆ˜
                </div>
                <div class="member-item">
                    <input type="checkbox" checked class="member-check dev-member" data-user="user-lee" onchange="handleMemberClick('dev')"> ì´ì˜í¬
                </div>
            </div>

            <div class="team-group">
                <div class="team-header">
                    <input type="checkbox" id="team-design" checked onchange="handleTeamAllClick('design')"> 
                    <label for="team-design">ë””ìì¸íŒ€</label>
                </div>
                <div class="member-item">
                    <input type="checkbox" checked class="member-check design-member" data-user="user-park" onchange="handleMemberClick('design')"> ë°•ëª…ìˆ˜
                </div>
                <div class="member-item">
                    <input type="checkbox" checked class="member-check design-member" data-user="user-haha" onchange="handleMemberClick('design')"> í•˜í•˜
                </div>
            </div>
        </aside>
    </div>

    <script>
        // ============================================
        // ğŸ“Š ë°ì´í„° ê´€ë¦¬ ì˜ì—­ (Data Management)
        // ============================================
        // 
        // âš ï¸ ì¤‘ìš”: ì¼ì • ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ì•„ë˜ ì˜ì—­ë§Œ ìˆ˜ì •í•˜ì„¸ìš”!
        // 
        // 1. TASKS: í”„ë¡œì íŠ¸ì˜ í…ŒìŠ¤í¬ ì •ì˜ (ëŒ€/ì¤‘/ì†Œë¶„ë¥˜, ê¸°ì¤€ ì‹œê°„)
        // 2. TASK_ASSIGNMENTS: í…ŒìŠ¤í¬ë³„ ì‹¤ì œ ë°°ì • ìŠ¤ì¼€ì¤„
        // 
        // í…ŒìŠ¤í¬ í˜•ì‹:
        //    taskId: ê³ ìœ  ID
        //    title: í…ŒìŠ¤í¬ ì œëª©
        //    category: ì†Œë¶„ë¥˜ (planning/development/design)
        //    totalHours: ê¸°ì¤€ ì‹œê°„ (í•´ë‹¹ í…ŒìŠ¤í¬ë¥¼ ì™„ë£Œí•˜ëŠ”ë° í•„ìš”í•œ ì´ ì‹œê°„)
        // 
        // ìŠ¤ì¼€ì¤„ í˜•ì‹:
        //    taskId: í…ŒìŠ¤í¬ ID (TASKSì˜ taskIdì™€ ë§¤ì¹­)
        //    user: ë‹´ë‹¹ì ID
        //    startDate: ì‹œì‘ ë‚ ì§œ 'YYYY-MM-DD'
        //    endDate: ì¢…ë£Œ ë‚ ì§œ 'YYYY-MM-DD' (í•˜ë£¨ë§Œì´ë©´ startDateì™€ ë™ì¼)
        //    startTime: ì‹œì‘ ì‹œê°„ 'HH:MM'
        //    endTime: ì¢…ë£Œ ì‹œê°„ 'HH:MM'
        //    note: ì¶”ê°€ ë©”ëª¨ (ì„ íƒì‚¬í•­)
        // 
        // ============================================
        
        // ì‚¬ìš©ì ì •ë³´
        const USERS = {
            'user-kim': { name: 'ê¹€ì² ìˆ˜', team: 'dev' },
            'user-lee': { name: 'ì´ì˜í¬', team: 'dev' },
            'user-park': { name: 'ë°•ëª…ìˆ˜', team: 'design' },
            'user-haha': { name: 'í•˜í•˜', team: 'design' }
        };
        
        // ì—…ë¬´ ì¹´í…Œê³ ë¦¬ (ì†Œë¶„ë¥˜) - ìƒ‰ìƒ ê¸°ì¤€
        const CATEGORIES = {
            'planning': { name: 'ê¸°íš', color: 'blue', colorCode: '#3b82f6' },
            'development': { name: 'ê°œë°œ', color: 'green', colorCode: '#22c55e' },
            'design': { name: 'ë””ìì¸', color: 'yellow', colorCode: '#eab308' }
        };
        
        // í…ŒìŠ¤í¬ ì •ì˜ (í”„ë¡œì íŠ¸ì˜ ì‘ì—… ë‹¨ìœ„)
        const TASKS = {
            'task-001': {
                taskId: 'task-001',
                title: 'ìš”êµ¬ì‚¬í•­ ë¶„ì„',
                category: 'planning',
                totalHours: 8
            },
            'task-002': {
                taskId: 'task-002',
                title: 'DB ì„¤ê³„',
                category: 'development',
                totalHours: 16
            },
            'task-003': {
                taskId: 'task-003',
                title: 'API ê°œë°œ',
                category: 'development',
                totalHours: 24
            },
            'task-004': {
                taskId: 'task-004',
                title: 'UI ë””ìì¸',
                category: 'design',
                totalHours: 20
            },
            'task-005': {
                taskId: 'task-005',
                title: 'í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ',
                category: 'development',
                totalHours: 20
            },
            'task-006': {
                taskId: 'task-006',
                title: 'í†µí•© í…ŒìŠ¤íŠ¸',
                category: 'development',
                totalHours: 12
            },
            'task-007': {
                taskId: 'task-007',
                title: 'ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶•',
                category: 'design',
                totalHours: 16
            },
            'task-008': {
                taskId: 'task-008',
                title: 'í”„ë¡œì íŠ¸ ë¬¸ì„œí™”',
                category: 'planning',
                totalHours: 10
            }
        };
        
        // í…ŒìŠ¤í¬ ë°°ì • ìŠ¤ì¼€ì¤„ (ì‹¤ì œ ì‘ì—… ì¼ì •)
        const TASK_ASSIGNMENTS = [
            // task-001: ìš”êµ¬ì‚¬í•­ ë¶„ì„ (8ì‹œê°„) - ê¹€ì² ìˆ˜ 4h + ì´ì˜í¬ 4h
            { taskId: 'task-001', user: 'user-kim', startDate: '2023-02-27', endDate: '2023-02-28', startTime: '10:00', endTime: '12:00' },  // 2ì¼ ì—°ì†, ê° 2ì‹œê°„ = 4ì‹œê°„
            { taskId: 'task-001', user: 'user-lee', startDate: '2023-02-27', endDate: '2023-02-27', startTime: '14:00', endTime: '18:00' },  // 4ì‹œê°„
            
            // task-002: DB ì„¤ê³„ (16ì‹œê°„) - ê¹€ì² ìˆ˜ 6h + ì´ì˜í¬ 10h
            { taskId: 'task-002', user: 'user-kim', startDate: '2023-03-01', endDate: '2023-03-02', startTime: '10:00', endTime: '13:00' },  // 2ì¼ ì—°ì†, ê° 3ì‹œê°„ = 6ì‹œê°„
            { taskId: 'task-002', user: 'user-lee', startDate: '2023-03-06', endDate: '2023-03-08', startTime: '10:00', endTime: '13:00', note: 'ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„' },  // 3ì¼ ì—°ì†, ê° 3ì‹œê°„ = 9ì‹œê°„
            { taskId: 'task-002', user: 'user-lee', startDate: '2023-03-08', endDate: '2023-03-08', startTime: '14:00', endTime: '15:00' },  // 1ì‹œê°„ ì¶”ê°€
            
            // task-003: API ê°œë°œ (24ì‹œê°„) - ì´ì˜í¬ 24h
            { taskId: 'task-003', user: 'user-lee', startDate: '2023-03-09', endDate: '2023-03-09', startTime: '10:00', endTime: '14:00' },  // 4ì‹œê°„
            { taskId: 'task-003', user: 'user-lee', startDate: '2023-03-13', endDate: '2023-03-14', startTime: '10:00', endTime: '15:00' },  // 2ì¼ ì—°ì†, ê° 5ì‹œê°„ = 10ì‹œê°„
            { taskId: 'task-003', user: 'user-lee', startDate: '2023-03-17', endDate: '2023-03-17', startTime: '10:00', endTime: '15:00' },  // 5ì‹œê°„
            { taskId: 'task-003', user: 'user-lee', startDate: '2023-03-20', endDate: '2023-03-20', startTime: '10:00', endTime: '15:00' },  // 5ì‹œê°„
            
            // task-004: UI ë””ìì¸ (20ì‹œê°„) - ë°•ëª…ìˆ˜ 20h
            { taskId: 'task-004', user: 'user-park', startDate: '2023-03-01', endDate: '2023-03-01', startTime: '12:00', endTime: '14:00' },  // 2ì‹œê°„
            { taskId: 'task-004', user: 'user-park', startDate: '2023-03-03', endDate: '2023-03-03', startTime: '14:00', endTime: '16:00' },  // 2ì‹œê°„
            { taskId: 'task-004', user: 'user-park', startDate: '2023-03-08', endDate: '2023-03-10', startTime: '10:00', endTime: '13:00' },  // 3ì¼ ì—°ì†, ê° 3ì‹œê°„ = 9ì‹œê°„
            { taskId: 'task-004', user: 'user-park', startDate: '2023-03-14', endDate: '2023-03-15', startTime: '10:00', endTime: '13:00' },  // 2ì¼ ì—°ì†, ê° 3ì‹œê°„ = 6ì‹œê°„
            { taskId: 'task-004', user: 'user-park', startDate: '2023-03-15', endDate: '2023-03-15', startTime: '14:00', endTime: '15:00', note: 'ìµœì¢… ê²€í† ' },  // 1ì‹œê°„
            
            // task-005: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ (20ì‹œê°„) - ê¹€ì² ìˆ˜ 12h + ë°•ëª…ìˆ˜ 8h
            { taskId: 'task-005', user: 'user-kim', startDate: '2023-03-17', endDate: '2023-03-17', startTime: '13:00', endTime: '16:00' },  // 3ì‹œê°„
            { taskId: 'task-005', user: 'user-kim', startDate: '2023-03-21', endDate: '2023-03-23', startTime: '10:00', endTime: '13:00' },  // 3ì¼ ì—°ì†, ê° 3ì‹œê°„ = 9ì‹œê°„
            { taskId: 'task-005', user: 'user-park', startDate: '2023-03-15', endDate: '2023-03-15', startTime: '14:00', endTime: '16:00' },  // 2ì‹œê°„ (ë””ìì¸íŒ€ì—ì„œ í˜‘ì—…)
            { taskId: 'task-005', user: 'user-park', startDate: '2023-03-17', endDate: '2023-03-17', startTime: '13:00', endTime: '16:00' },  // 3ì‹œê°„
            { taskId: 'task-005', user: 'user-park', startDate: '2023-03-27', endDate: '2023-03-27', startTime: '14:00', endTime: '17:00' },  // 3ì‹œê°„
            
            // task-006: í†µí•© í…ŒìŠ¤íŠ¸ (12ì‹œê°„) - ì´ì˜í¬ 12h
            { taskId: 'task-006', user: 'user-lee', startDate: '2023-03-24', endDate: '2023-03-24', startTime: '10:00', endTime: '15:00' },  // 5ì‹œê°„
            { taskId: 'task-006', user: 'user-lee', startDate: '2023-03-29', endDate: '2023-03-30', startTime: '10:00', endTime: '13:00' },  // 2ì¼ ì—°ì†, ê° 3ì‹œê°„ = 6ì‹œê°„
            { taskId: 'task-006', user: 'user-lee', startDate: '2023-03-31', endDate: '2023-03-31', startTime: '10:00', endTime: '11:00' },  // 1ì‹œê°„
            
            // task-007: ë””ìì¸ ì‹œìŠ¤í…œ êµ¬ì¶• (16ì‹œê°„) - ë°•ëª…ìˆ˜ 16h
            { taskId: 'task-007', user: 'user-park', startDate: '2023-03-20', endDate: '2023-03-20', startTime: '10:00', endTime: '13:00' },  // 3ì‹œê°„
            { taskId: 'task-007', user: 'user-park', startDate: '2023-03-27', endDate: '2023-03-28', startTime: '10:00', endTime: '13:00' },  // 2ì¼ ì—°ì†, ê° 3ì‹œê°„ = 6ì‹œê°„
            { taskId: 'task-007', user: 'user-park', startDate: '2023-03-29', endDate: '2023-03-31', startTime: '10:00', endTime: '12:00' },  // 3ì¼ ì—°ì†, ê° 2ì‹œê°„ = 6ì‹œê°„
            { taskId: 'task-007', user: 'user-park', startDate: '2023-03-31', endDate: '2023-03-31', startTime: '14:00', endTime: '15:00' },  // 1ì‹œê°„
            
            // task-008: í”„ë¡œì íŠ¸ ë¬¸ì„œí™” (10ì‹œê°„) - ê¹€ì² ìˆ˜ 4h + í•˜í•˜ 6h
            { taskId: 'task-008', user: 'user-kim', startDate: '2023-03-23', endDate: '2023-03-23', startTime: '14:00', endTime: '16:00' },  // 2ì‹œê°„
            { taskId: 'task-008', user: 'user-kim', startDate: '2023-03-27', endDate: '2023-03-27', startTime: '10:00', endTime: '12:00' },  // 2ì‹œê°„
            { taskId: 'task-008', user: 'user-kim', startDate: '2023-03-31', endDate: '2023-03-31', startTime: '10:00', endTime: '12:00' },  // 2ì‹œê°„ (ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬)
            { taskId: 'task-008', user: 'user-lee', startDate: '2023-03-31', endDate: '2023-03-31', startTime: '14:00', endTime: '16:00' },  // 2ì‹œê°„
            { taskId: 'task-008', user: 'user-haha', startDate: '2023-03-29', endDate: '2023-03-29', startTime: '10:00', endTime: '12:00' },  // 2ì‹œê°„
            { taskId: 'task-008', user: 'user-haha', startDate: '2023-04-04', endDate: '2023-04-04', startTime: '13:00', endTime: '17:00' },  // 4ì‹œê°„
            
            // ì¶”ê°€ ì¼ì •ë“¤ (ê¸°ì¡´ ë°ì´í„° ìœ ì§€ìš©)
            { taskId: 'task-009', user: 'user-kim', startDate: '2023-03-31', endDate: '2023-03-31', startTime: '14:00', endTime: '16:00' },  // ë””ìì¸ QA
            { taskId: 'task-010', user: 'user-kim', startDate: '2023-04-03', endDate: '2023-04-03', startTime: '10:00', endTime: '12:00' },  // í”„ë¡œì íŠ¸ íšŒê³ 
            { taskId: 'task-011', user: 'user-lee', startDate: '2023-04-03', endDate: '2023-04-03', startTime: '14:00', endTime: '16:00' },  // ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§
            { taskId: 'task-012', user: 'user-park', startDate: '2023-04-04', endDate: '2023-04-04', startTime: '10:00', endTime: '15:00' },  // ë””ìì¸ ì‹œìŠ¤í…œ ì •ë¦¬
            { taskId: 'task-013', user: 'user-kim', startDate: '2023-04-05', endDate: '2023-04-05', startTime: '10:00', endTime: '12:00' },  // Q2 ê³„íš
            { taskId: 'task-014', user: 'user-lee', startDate: '2023-04-05', endDate: '2023-04-05', startTime: '13:00', endTime: '16:00' }   // ì„±ëŠ¥ ê°œì„ 
        ];
        
        // ì¶”ê°€ í…ŒìŠ¤í¬ ì •ì˜ (ìœ„ ë°°ì •ì— ì‚¬ìš©ëœ task-009~014)
        TASKS['task-009'] = { taskId: 'task-009', title: 'ë””ìì¸ QA', category: 'design', totalHours: 2 };
        TASKS['task-010'] = { taskId: 'task-010', title: 'í”„ë¡œì íŠ¸ íšŒê³ ', category: 'planning', totalHours: 2 };
        TASKS['task-011'] = { taskId: 'task-011', title: 'ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§', category: 'development', totalHours: 2 };
        TASKS['task-012'] = { taskId: 'task-012', title: 'ë””ìì¸ ì‹œìŠ¤í…œ ì •ë¦¬', category: 'design', totalHours: 5 };
        TASKS['task-013'] = { taskId: 'task-013', title: 'Q2 ê³„íš ìˆ˜ë¦½', category: 'planning', totalHours: 2 };
        TASKS['task-014'] = { taskId: 'task-014', title: 'ì„±ëŠ¥ ê°œì„ ', category: 'development', totalHours: 3 };
        
        // ============================================
        // ğŸ“… í—¬í¼ í•¨ìˆ˜: TASK_ASSIGNMENTSë¡œë¶€í„° ë‚ ì§œë³„ ìŠ¤ì¼€ì¤„ ìƒì„±
        // ============================================
        
        /**
         * íŠ¹ì • ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ìŠ¤ì¼€ì¤„ì„ ê°€ì ¸ì˜µë‹ˆë‹¤
         * @param {string} dateStr - 'YYYY-MM-DD' í˜•ì‹ì˜ ë‚ ì§œ
         * @returns {Array} í•´ë‹¹ ë‚ ì§œì˜ ìŠ¤ì¼€ì¤„ ë°°ì—´
         */
        function getSchedulesForDate(dateStr) {
            const schedules = [];
            
            TASK_ASSIGNMENTS.forEach(assignment => {
                const task = TASKS[assignment.taskId];
                if (!task) return;
                
                //ë‚ ì§œê°€ ë²”ìœ„ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
                const targetDate = new Date(dateStr);
                const startDate = new Date(assignment.startDate);
                const endDate = new Date(assignment.endDate);
                
                if (targetDate >= startDate && targetDate <= endDate) {
                    // ì´ ë°°ì •ì´ í•´ë‹¹ ë‚ ì§œì— ì†í•¨
                    schedules.push({
                        taskId: assignment.taskId,
                        user: assignment.user,
                        category: task.category,
                        title: task.title,
                        startTime: assignment.startTime,
                        endTime: assignment.endTime,
                        note: assignment.note || '',
                        startDate: assignment.startDate,
                        endDate: assignment.endDate,
                        totalHours: task.totalHours
                    });
                }
            });
            
            return schedules;
        }
        
        // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ SCHEDULE_DATA (ê¸°ì¡´ ì½”ë“œì™€ í˜¸í™˜)
        const SCHEDULE_DATA = {
        };
        
        // SCHEDULE_DATAë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” Proxy
        const SCHEDULE_DATA_HANDLER = {
            get: function(target, dateStr) {
                if (typeof dateStr !== 'string' || !dateStr.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    return target[dateStr];
                }
                // ìºì‹œì— ì—†ìœ¼ë©´ ë™ì ìœ¼ë¡œ ìƒì„±
                if (!target[dateStr]) {
                    target[dateStr] = getSchedulesForDate(dateStr);
                }
                return target[dateStr];
            }
        };
        
        const SCHEDULE_DATA_PROXY = new Proxy(SCHEDULE_DATA, SCHEDULE_DATA_HANDLER);
        
        // ============================================
        // ğŸ¯ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì˜ì—­
        // ============================================
        
        // 1. íŒ€ ì „ì²´ ì„ íƒ í´ë¦­ ì‹œ
        function handleTeamAllClick(teamType) {
            const isChecked = document.getElementById(`team-${teamType}`).checked;
            const members = document.querySelectorAll(`.${teamType}-member`);
            members.forEach(m => m.checked = isChecked);
            syncCalendar();
        }

        // 2. ê°œë³„ ë©¤ë²„ í´ë¦­ ì‹œ (íŒ€ ì „ì²´ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—°ë™)
        function handleMemberClick(teamType) {
            const teamAllCb = document.getElementById(`team-${teamType}`);
            const members = document.querySelectorAll(`.${teamType}-member`);
            const checkedCount = document.querySelectorAll(`.${teamType}-member:checked`).length;

            // í•˜ë‚˜ë¼ë„ ì„ íƒ í•´ì œ ì‹œ ì „ì²´ ì„ íƒ í•´ì œ, ëª¨ë‘ ì„ íƒ ì‹œ ì „ì²´ ì„ íƒ ì²´í¬
            teamAllCb.checked = (members.length === checkedCount);
            
            syncCalendar();
        }

        // 3. ìº˜ë¦°ë” í™”ë©´ ë™ê¸°í™”
        function syncCalendar() {
            const activeUsers = Array.from(document.querySelectorAll('.member-check:checked'))
                                     .map(cb => cb.dataset.user);
            
            // Task ë¸”ë¡ í•„í„°ë§ (ì£¼ë³„/ì¼ë³„ ë·°)
            document.querySelectorAll('.task').forEach(t => {
                t.style.display = 'none';
            });
            
            activeUsers.forEach(user => {
                document.querySelectorAll('.task.' + user).forEach(task => {
                    task.style.display = 'block';
                });
            });
            
            // ì›”ë³„ ë·°ì˜ í…ŒìŠ¤í¬ ë°” í•„í„°ë§
            document.querySelectorAll('.month-task-bar').forEach(bar => {
                const classList = Array.from(bar.classList);
                const userClass = classList.find(c => c.startsWith('user-'));
                
                if (userClass && activeUsers.includes(userClass)) {
                    bar.style.display = 'flex';
                } else if (userClass) {
                    bar.style.display = 'none';
                }
            });
            
            // ì›”ë³„ ë·°ì˜ ì‚¬ëŒë³„ ì¼ì • í‘œì‹œ í•„í„°ë§
            document.querySelectorAll('.month-view .person').forEach(person => {
                const classList = Array.from(person.classList);
                const userClass = classList.find(c => c.startsWith('user-'));
                
                if (userClass && activeUsers.includes(userClass)) {
                    person.style.display = 'flex';
                } else if (userClass) {
                    person.style.display = 'none';
                }
            });
            
            // ë¹ˆ ì¼ì • í‘œì‹œ ìˆ¨ê¸°ê¸° (ëª¨ë“  ì‚¬ëŒì´ í•„í„°ë§ëœ ê²½ìš°)
            document.querySelectorAll('.schedule-indicator').forEach(indicator => {
                const visiblePersons = Array.from(indicator.querySelectorAll('.person')).filter(p => p.style.display !== 'none');
                if (visiblePersons.length === 0) {
                    indicator.style.display = 'none';
                } else {
                    indicator.style.display = 'block';
                }
            });
        }

        // ============================================
        // ğŸ“… ë°ì´í„° ê¸°ë°˜ ë·° ìƒì„± í•¨ìˆ˜
        // ============================================
        
        // íŠ¹ì • ë‚ ì§œì˜ ì¼ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getScheduleByDate(dateStr) {
            return getSchedulesForDate(dateStr);
        }
        
        // ë‚ ì§œë³„ë¡œ ì‚¬ìš©ìë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ì¼ì • ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getScheduleSummaryByDate(dateStr) {
            const schedules = getScheduleByDate(dateStr);
            const userSchedules = {};
            
            schedules.forEach(schedule => {
                if (!userSchedules[schedule.user]) {
                    userSchedules[schedule.user] = {
                        userName: USERS[schedule.user].name,
                        categories: []
                    };
                }
                
                if (!userSchedules[schedule.user].categories.find(c => c.category === schedule.category)) {
                    userSchedules[schedule.user].categories.push({
                        category: schedule.category,
                        categoryName: CATEGORIES[schedule.category].name,
                        color: CATEGORIES[schedule.category].color,
                        colorCode: CATEGORIES[schedule.category].colorCode,
                        tasks: []
                    });
                }
                
                const catIndex = userSchedules[schedule.user].categories.findIndex(c => c.category === schedule.category);
                userSchedules[schedule.user].categories[catIndex].tasks.push({
                    title: schedule.title,
                    startTime: schedule.startTime,
                    endTime: schedule.endTime,
                    note: schedule.note
                });
            });
            
            return userSchedules;
        }

        function changeView(btn) {
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // ë·° íƒ€ì… ê²°ì •
            const viewText = btn.textContent.trim();
            let viewType = 'week-view';
            if (viewText.includes('ì›”')) viewType = 'month-view';
            else if (viewText.includes('ì¼')) viewType = 'day-view';
            
            // ëª¨ë“  ìº˜ë¦°ë” ê·¸ë¦¬ë“œ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.calendar-grid').forEach(grid => {
                grid.classList.remove('active');
            });
            
            // ì„ íƒëœ ë·°ë§Œ í‘œì‹œ
            document.querySelector(`.${viewType}`).classList.add('active');
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ë° í™”ì‚´í‘œ ë²„íŠ¼ ì œì–´
            const monthNames = ['', '1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            // ëª¨ë“  ë·°ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ
            prevBtn.style.display = 'block';
            nextBtn.style.display = 'block';
            
            if (viewType === 'month-view') {
                document.getElementById('current-date-display').textContent = `${currentYear}ë…„ ${monthNames[currentMonth]}`;
            } else if (viewType === 'day-view') {
                document.getElementById('current-date-display').textContent = currentDayDateDisplay.replace(/\s*\([^)]*\)/, '');
            } else {
                // ì£¼ë³„ ë·°
                const startDate = new Date(currentWeekDates[0]);
                const endDate = new Date(currentWeekDates[4]);
                const startMonth = startDate.getMonth() + 1;
                const startDay = startDate.getDate();
                const endMonth = endDate.getMonth() + 1;
                const endDay = endDate.getDate();
                document.getElementById('current-date-display').textContent = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            }
        }

        // ë‚ ì§œ í´ë¦­ ì‹œ ì¼ë³„ ë·°ë¡œ ì „í™˜
        // ì£¼ë³„ ë·°ë¡œ ì´ë™ (íŠ¹ì • ë‚ ì§œê°€ ì†í•œ ì£¼)
        function goToWeekView(targetDate) {
            // í•´ë‹¹ ë‚ ì§œê°€ ì†í•œ ì£¼ì˜ ì›”ìš”ì¼ ì°¾ê¸°
            const date = new Date(targetDate);
            const day = date.getDay(); // 0(ì¼) ~ 6(í† )
            const mondayOffset = day === 0 ? -6 : 1 - day; // ì›”ìš”ì¼ê¹Œì§€ì˜ ê±°ë¦¬
            const monday = new Date(date);
            monday.setDate(date.getDate() + mondayOffset);
            
            // í•´ë‹¹ ì£¼ì˜ ë‚ ì§œ ë°°ì—´ ìƒì„± (ì›”~ê¸ˆ)
            const weekDates = [];
            for (let i = 0; i < 5; i++) {
                const d = new Date(monday);
                d.setDate(monday.getDate() + i);
                const dateStr = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                weekDates.push(dateStr);
            }
            
            // í˜„ì¬ ì£¼ ì—…ë°ì´íŠ¸
            currentWeekDates = weekDates;
            
            // ì£¼ë³„ ë·° ì¬ìƒì„±
            generateWeekView(weekDates);
            
            // ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.calendar-grid').forEach(grid => {
                grid.classList.remove('active');
            });
            
            // ì£¼ë³„ ë·° í‘œì‹œ
            document.querySelector('.week-view').classList.add('active');
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.view-switch button')[1].classList.add('active'); // ì£¼ë³„ ë²„íŠ¼
            
            // ìƒë‹¨ ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const startDate = new Date(weekDates[0]);
            const endDate = new Date(weekDates[4]);
            const startMonth = startDate.getMonth() + 1;
            const startDay = startDate.getDate();
            const endMonth = endDate.getMonth() + 1;
            const endDay = endDate.getDate();
            document.getElementById('current-date-display').textContent = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
            
            console.log('ğŸ“… ì£¼ë³„ ë·°ë¡œ ì´ë™:', weekDates);
        }
        
        function goToDayView(dateString, event) {
            // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ (ì´ì „ ì„ íƒ í•´ì œ)
            document.querySelectorAll('.month-view .cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('selected');
            }
            
            // ë‚ ì§œ ë°ì´í„° ì¶”ì¶œ (data-date ì†ì„±ì—ì„œ)
            let dateStr;
            if (event && event.currentTarget) {
                dateStr = event.currentTarget.getAttribute('data-date');
            } else if (typeof dateString === 'string' && dateString.match(/^\d{4}-\d{2}-\d{2}$/)) {
                // dateStringì´ ì´ë¯¸ YYYY-MM-DD í˜•ì‹ì¸ ê²½ìš°
                dateStr = dateString;
                const date = new Date(dateStr);
                const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
                dateString = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ (${dayNames[date.getDay()]})`;
            } else {
                dateStr = event ? event.currentTarget.getAttribute('data-date') : dateString;
            }
            
            // ìƒë‹¨ íˆ´ë°” ë‚ ì§œ ì—…ë°ì´íŠ¸ (ìš”ì¼ ì œì™¸)
            const shortDate = dateString.replace(/\s*\([^)]*\)/, '');
            document.getElementById('current-date-display').textContent = shortDate;
            
            // ì¼ë³„ ë·° ì¬ìƒì„±
            currentDayDate = dateStr;
            currentDayDateDisplay = dateString;
            generateDayView(dateStr, dateString);
            
            // ëª¨ë“  ë·° ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.calendar-grid').forEach(grid => {
                grid.classList.remove('active');
            });
            
            // ì¼ë³„ ë·° í‘œì‹œ
            document.querySelector('.day-view').classList.add('active');
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.view-switch button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.view-switch button')[2].classList.add('active'); // ì¼ë³„ ë²„íŠ¼
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('prev-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'block';
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // ì›” ì´ë™ í•¨ìˆ˜ (ì´ì „/ë‹¤ìŒ ë‹¬)
        function navigateMonth(direction) {
            currentMonth += direction;
            
            // ì›” ë²”ìœ„ ì¡°ì •
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            
            // ì›”ë³„ ë·° ì¬ìƒì„±
            generateMonthView(currentYear, currentMonth);
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // ì£¼ ì´ë™ í•¨ìˆ˜ (ì´ì „/ë‹¤ìŒ ì£¼)
        function navigateWeek(direction) {
            // í˜„ì¬ ì£¼ì˜ ì²« ë²ˆì§¸ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì´ë™
            const firstDate = new Date(currentWeekDates[0]);
            firstDate.setDate(firstDate.getDate() + (direction * 7)); // 7ì¼ì”© ì´ë™
            
            // ìƒˆë¡œìš´ ì£¼ì˜ ë‚ ì§œ ë°°ì—´ ìƒì„± (ì›”~ê¸ˆ)
            currentWeekDates = [];
            for (let i = 0; i < 5; i++) {
                const date = new Date(firstDate);
                date.setDate(firstDate.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                currentWeekDates.push(dateStr);
            }
            
            // ì£¼ë³„ ë·° ì¬ìƒì„±
            generateWeekView(currentWeekDates);
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const startDate = new Date(currentWeekDates[0]);
            const endDate = new Date(currentWeekDates[4]);
            const startMonth = startDate.getMonth() + 1;
            const startDay = startDate.getDate();
            const endMonth = endDate.getMonth() + 1;
            const endDay = endDate.getDate();
            document.getElementById('current-date-display').textContent = `${startMonth}/${startDay} - ${endMonth}/${endDay}`;
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // ì¼ ì´ë™ í•¨ìˆ˜ (ì´ì „/ë‹¤ìŒ ì¼)
        function navigateDay(direction) {
            // í˜„ì¬ ë‚ ì§œì—ì„œ directionì¼ ì´ë™
            const date = new Date(currentDayDate);
            date.setDate(date.getDate() + direction);
            
            // ìƒˆë¡œìš´ ë‚ ì§œ ë¬¸ìì—´ ìƒì„±
            currentDayDate = date.toISOString().split('T')[0];
            
            // ë‚ ì§œ í‘œì‹œ í˜•ì‹ ìƒì„±
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
            const dayName = dayNames[date.getDay()];
            currentDayDateDisplay = `${year}ë…„ ${month}ì›” ${day}ì¼ (${dayName})`;
            
            // ì¼ë³„ ë·° ì¬ìƒì„±
            generateDayView(currentDayDate, currentDayDateDisplay);
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('current-date-display').textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            
            // í•„í„° ë™ê¸°í™”
            syncCalendar();
        }
        
        // í†µí•© ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
        function navigate(direction) {
            // í˜„ì¬ í™œì„±í™”ëœ ë·° ì°¾ê¸°
            const activeView = document.querySelector('.calendar-grid.active');
            
            if (activeView.classList.contains('month-view')) {
                navigateMonth(direction);
            } else if (activeView.classList.contains('week-view')) {
                navigateWeek(direction);
            } else if (activeView.classList.contains('day-view')) {
                navigateDay(direction);
            }
        }
        
        // ============================================
        // ğŸ“… ì£¼ë³„ ë·° ë™ì  ìƒì„±
        // ============================================
        
        // í˜„ì¬ ì£¼ë³„ ë·°ì— í‘œì‹œí•  ë‚ ì§œ ë°°ì—´ (ê¸°ë³¸: 2/27~3/3)
        let currentWeekDates = ['2023-02-27', '2023-02-28', '2023-03-01', '2023-03-02', '2023-03-03'];
        
        function generateWeekView(weekDates = currentWeekDates) {
            const weekGrid = document.getElementById('week-view-grid');
            weekGrid.innerHTML = '';
            
            // ì‹œê°„ ë°°ì—´ (09:00~18:00)
            const hours = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
            
            // ìš”ì¼ í—¤ë” ìƒì„±
            let headerHTML = '<div class="cell cell-header">ì‹œê°„</div>';
            const dayNames = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'];
            weekDates.forEach((dateStr, index) => {
                const date = new Date(dateStr);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                headerHTML += `<div class="cell cell-header">${dayNames[index]} (${month}/${day})</div>`;
            });
            weekGrid.innerHTML += headerHTML;
            
            // ì‹œê°„ë³„ í–‰ ìƒì„±
            hours.forEach(hour => {
                let rowHTML = `<div class="cell time-label">${hour}</div>`;
                
                weekDates.forEach(dateStr => {
                    const schedules = getScheduleByDate(dateStr);
                    let cellContent = '';
                    
                    // í•´ë‹¹ ì‹œê°„ì— ì‹œì‘í•˜ëŠ” ì¼ì • ì°¾ê¸°
                    const hourSchedules = schedules.filter(s => s.startTime === hour);
                    const columnCount = hourSchedules.length;
                    
                    if (columnCount > 1) {
                        // ê²¹ì¹˜ëŠ” ì¼ì •ì´ ìˆëŠ” ê²½ìš° - ì»¬ëŸ¼ ë¶„í•  ë°©ì‹
                        hourSchedules.forEach((schedule, index) => {
                            const category = CATEGORIES[schedule.category];
                            const user = USERS[schedule.user];
                            const startHour = parseInt(schedule.startTime.split(':')[0]);
                            const endHour = parseInt(schedule.endTime.split(':')[0]);
                            const durationHours = endHour - startHour;
                            const height = durationHours * 80 - 20;
                            
                            // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ - ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ë¸”ë¡)
                            const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                            
                            // ì»¬ëŸ¼ ë¶„í• : ë™ì¼í•œ ë„ˆë¹„ë¡œ ë‚˜ëˆ”
                            const widthPercent = 100 / columnCount;
                            const leftPercent = (100 / columnCount) * index;
                            const rightPercent = 100 - leftPercent - widthPercent;
                            
                            const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                            const noteText = schedule.note ? schedule.note : '';
                            
                            // íˆ´íŒ HTML
                            const tooltip = `<div class="task-detail-tooltip">
                                <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                                ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                            </div>`;
                            
                            cellContent += `<div class="task ${category.color} ${schedule.user}" data-schedule-id="${scheduleId}" data-date="${dateStr}" onclick="goToDayView('${dateStr}')" style="height: ${height}px; position: absolute; left: calc(${leftPercent}% + 4px); right: calc(${rightPercent}% + 4px); width: auto; top: 5px; z-index: ${index + 1}; cursor: pointer; ${index < columnCount - 1 ? 'border-right: 2px solid white;' : ''}"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                        });
                    } else {
                        // ê²¹ì¹˜ì§€ ì•ŠëŠ” ê²½ìš° - ì „ì²´ ë„ˆë¹„ ì‚¬ìš©
                        hourSchedules.forEach(schedule => {
                            const category = CATEGORIES[schedule.category];
                            const user = USERS[schedule.user];
                            const startHour = parseInt(schedule.startTime.split(':')[0]);
                            const endHour = parseInt(schedule.endTime.split(':')[0]);
                            const durationHours = endHour - startHour;
                            const height = durationHours * 80 - 20;
                            
                            // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ - ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ë¸”ë¡)
                            const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                            console.log(`âœ… ì‹œì‘ ë¸”ë¡ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                            
                            const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                            const noteText = schedule.note ? schedule.note : '';
                            
                            // íˆ´íŒ HTML
                            const tooltip = `<div class="task-detail-tooltip">
                                <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                                <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                                ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                            </div>`;
                            
                            cellContent += `<div class="task ${category.color} ${schedule.user}" data-schedule-id="${scheduleId}" data-date="${dateStr}" onclick="goToDayView('${dateStr}')" style="height: ${height}px; cursor: pointer;"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                        });
                    }
                    
                    // ì¤‘ê°„ ì‹œê°„ëŒ€ ì¼ì • (ì‹œì‘í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì§„í–‰ ì¤‘ì¸ ì¼ì •)ì— ëŒ€í•œ í˜¸ë²„ ì˜ì—­ ì¶”ê°€
                    const currentHourNum = parseInt(hour.split(':')[0]);
                    const middleSchedules = schedules.filter(s => {
                        const startHourNum = parseInt(s.startTime.split(':')[0]);
                        const endHourNum = parseInt(s.endTime.split(':')[0]);
                        return s.startTime !== hour && currentHourNum >= startHourNum && currentHourNum < endHourNum;
                    });
                    
                    if (middleSchedules.length > 0) {
                        // í˜„ì¬ ì‹œê°„ì— ì§„í–‰ ì¤‘ì¸ ëª¨ë“  ì¼ì • (ì‹œì‘ + ì¤‘ê°„)
                        const allOngoingSchedules = schedules.filter(s => {
                            const startHourNum = parseInt(s.startTime.split(':')[0]);
                            const endHourNum = parseInt(s.endTime.split(':')[0]);
                            return currentHourNum >= startHourNum && currentHourNum < endHourNum;
                        });
                        
                        middleSchedules.forEach(schedule => {
                            // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ - ë‚ ì§œë³„ë¡œ ë…ë¦½ì ì¸ ë¸”ë¡)
                            const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                            console.log(`ğŸ”´ í˜¸ë²„ ì˜ì—­ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                            
                            // ì´ ì¼ì •ì´ ì „ì²´ ì§„í–‰ ì¤‘ì¸ ì¼ì • ì¤‘ ëª‡ ë²ˆì§¸ì¸ì§€ ì°¾ê¸°
                            const scheduleIndex = allOngoingSchedules.findIndex(s => 
                                s.taskId === schedule.taskId && s.user === schedule.user && s.startTime === schedule.startTime
                            );
                            
                            // ì»¬ëŸ¼ ìœ„ì¹˜ ê³„ì‚° (ì‹œì‘ ì‹œê°„ê³¼ ë™ì¼í•œ ìœ„ì¹˜)
                            const totalColumns = allOngoingSchedules.length;
                            const widthPercent = 100 / totalColumns;
                            const leftPercent = (100 / totalColumns) * scheduleIndex;
                            const rightPercent = 100 - leftPercent - widthPercent;
                            
                            // ì¼ì •ì˜ ì „ì²´ ë†’ì´ ê³„ì‚°
                            const startHour = parseInt(schedule.startTime.split(':')[0]);
                            const endHour = parseInt(schedule.endTime.split(':')[0]);
                            const durationHours = endHour - startHour;
                            const totalHeight = durationHours * 80 - 20;
                            
                            // í˜„ì¬ ì‹œê°„ëŒ€ì—ì„œì˜ ì˜¤í”„ì…‹ ê³„ì‚°
                            const hourOffset = currentHourNum - startHour;
                            const topOffset = hourOffset * 80 + 5;
                            const remainingHeight = totalHeight - (hourOffset * 80);
                            const cellHeight = Math.min(80 - 5, remainingHeight);
                            
                            // íˆ¬ëª…í•œ í˜¸ë²„ ì˜ì—­ - ì…€ ì „ì²´ ë†’ì´ë¥¼ ì°¨ì§€
                            cellContent += `<div class="task-hover-area ${schedule.user}" data-schedule-id="${scheduleId}" style="position: absolute; left: calc(${leftPercent}% + 8px); right: calc(${rightPercent}% + 8px); width: auto; top: 0; bottom: 0; z-index: 100; background: rgba(255,0,0,0.05); cursor: pointer; pointer-events: auto;"></div>`;
                        });
                    }
                    
                    rowHTML += `<div class="cell" style="position: relative;">${cellContent}</div>`;
                });
                
                weekGrid.innerHTML += rowHTML;
            });
            
            // í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì •
            setupScheduleHoverEvents();
        }
        
        // ì¼ì • í˜¸ë²„ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupScheduleHoverEvents() {
            console.log('ğŸ”§ í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì • ì¤‘...');
            
            // 1. Task ë¸”ë¡ ìì²´ì— í˜¸ë²„ ì´ë²¤íŠ¸ ì¶”ê°€
            const taskBlocks = document.querySelectorAll('.task[data-schedule-id]');
            console.log(`ë°œê²¬ëœ Task ë¸”ë¡: ${taskBlocks.length}ê°œ`);
            
            taskBlocks.forEach((taskBlock, index) => {
                const scheduleId = taskBlock.getAttribute('data-schedule-id');
                console.log(`Task ë¸”ë¡ ${index}: ${scheduleId}`);
                
                if (!scheduleId) return;
                
                // ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ
                taskBlock.onmouseenter = function() {
                    console.log(`ğŸ–±ï¸ [Task ë¸”ë¡] í˜¸ë²„ ì§„ì…: ${scheduleId}`);
                    
                    // z-index ìƒìŠ¹
                    this.style.zIndex = '10000';
                    
                    const tooltip = this.querySelector('.task-detail-tooltip');
                    if (tooltip) {
                        tooltip.classList.add('force-show');
                        console.log('âœ… íˆ´íŒ í‘œì‹œ');
                    }
                };
                
                // ë§ˆìš°ìŠ¤ ë– ë‚¬ì„ ë•Œ
                taskBlock.onmouseleave = function() {
                    console.log(`ğŸ–±ï¸ [Task ë¸”ë¡] í˜¸ë²„ ì´íƒˆ: ${scheduleId}`);
                    
                    // z-index ë³µêµ¬
                    this.style.zIndex = '1';
                    
                    const tooltip = this.querySelector('.task-detail-tooltip');
                    if (tooltip) {
                        tooltip.classList.remove('force-show');
                        console.log('âŒ íˆ´íŒ ìˆ¨ê¹€');
                    }
                };
            });
            
            // 2. í˜¸ë²„ ì˜ì—­ì— ì§ì ‘ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const hoverAreas = document.querySelectorAll('.task-hover-area');
            console.log(`ë°œê²¬ëœ í˜¸ë²„ ì˜ì—­: ${hoverAreas.length}ê°œ`);
            
            hoverAreas.forEach((hoverArea, index) => {
                const scheduleId = hoverArea.getAttribute('data-schedule-id');
                console.log(`í˜¸ë²„ ì˜ì—­ ${index}: ${scheduleId}`);
                
                if (!scheduleId) return;
                
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                hoverArea.onmouseenter = null;
                hoverArea.onmouseleave = null;
                
                // ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ
                hoverArea.onmouseenter = function() {
                    console.log(`ğŸ–±ï¸ í˜¸ë²„ ì§„ì…: ${scheduleId}`);
                    
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    console.log('ì°¾ì€ ë¸”ë¡:', taskBlock);
                    
                    if (taskBlock) {
                        // ë¸”ë¡ì˜ z-indexë¥¼ ì˜¬ë ¤ì„œ í˜¸ë²„ ì˜ì—­ë³´ë‹¤ ìœ„ì— í‘œì‹œ
                        taskBlock.style.zIndex = '10000';
                        
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        console.log('ì°¾ì€ íˆ´íŒ:', tooltip);
                        
                        if (tooltip) {
                            tooltip.classList.add('force-show');
                            console.log('âœ… íˆ´íŒ í‘œì‹œ');
                        }
                    }
                };
                
                // ë§ˆìš°ìŠ¤ ë– ë‚¬ì„ ë•Œ
                hoverArea.onmouseleave = function() {
                    console.log(`ğŸ–±ï¸ í˜¸ë²„ ì´íƒˆ: ${scheduleId}`);
                    
                    const taskBlock = document.querySelector(`.task[data-schedule-id="${scheduleId}"]`);
                    if (taskBlock) {
                        // z-indexë¥¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
                        taskBlock.style.zIndex = '1';
                        
                        const tooltip = taskBlock.querySelector('.task-detail-tooltip');
                        if (tooltip) {
                            tooltip.classList.remove('force-show');
                            console.log('âŒ íˆ´íŒ ìˆ¨ê¹€');
                        }
                    }
                };
            });
            
            console.log('âœ… í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì • ì™„ë£Œ');
        }
        
        // ============================================
        // ğŸ“… ì›”ë³„ ë·° í˜„ì¬ ìƒíƒœ
        // ============================================
        
        let currentYear = 2023;
        let currentMonth = 3;
        
        // ============================================
        // ğŸ“† ì¼ë³„ ë·° ë™ì  ìƒì„±
        // ============================================
        
        let currentDayDate = '2023-03-01';
        let currentDayDateDisplay = '2023ë…„ 3ì›” 1ì¼ (ìˆ˜ìš”ì¼)';
        
        function generateDayView(dateStr = currentDayDate, dateDisplay = currentDayDateDisplay) {
            const dayGrid = document.getElementById('day-view-grid');
            dayGrid.innerHTML = '';
            
            // ì‹œê°„ ë°°ì—´ (09:00~18:00)
            const hours = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
            
            // í—¤ë” ìƒì„±
            let headerHTML = '<div class="cell cell-header">ì‹œê°„</div>';
            headerHTML += `<div class="cell cell-header" id="day-view-date">${dateDisplay}</div>`;
            dayGrid.innerHTML += headerHTML;
            
            // ì‹œê°„ë³„ í–‰ ìƒì„±
            const schedules = getScheduleByDate(dateStr);
            
            hours.forEach(hour => {
                let cellContent = '';
                
                // í•´ë‹¹ ì‹œê°„ì— ì‹œì‘í•˜ëŠ” ì¼ì • ì°¾ê¸°
                const hourSchedules = schedules.filter(s => s.startTime === hour);
                const columnCount = hourSchedules.length;
                
                if (columnCount > 1) {
                    // ê²¹ì¹˜ëŠ” ì¼ì •ì´ ìˆëŠ” ê²½ìš° - ì»¬ëŸ¼ ë¶„í•  ë°©ì‹
                    hourSchedules.forEach((schedule, index) => {
                        const category = CATEGORIES[schedule.category];
                        const user = USERS[schedule.user];
                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const endHour = parseInt(schedule.endTime.split(':')[0]);
                        const durationHours = endHour - startHour;
                        const height = durationHours * 80 - 20;
                        
                        // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        
                        // ì»¬ëŸ¼ ë¶„í• : ë™ì¼í•œ ë„ˆë¹„ë¡œ ë‚˜ëˆ”
                        const widthPercent = 100 / columnCount;
                        const leftPercent = (100 / columnCount) * index;
                        const rightPercent = 100 - leftPercent - widthPercent;
                        
                        const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                        const noteText = schedule.note ? schedule.note : '';
                        
                        // íˆ´íŒ HTML
                        const tooltip = `<div class="task-detail-tooltip">
                            <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                            ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                        </div>`;
                        
                        cellContent += `<div class="task ${category.color} ${schedule.user}" data-schedule-id="${scheduleId}" style="height: ${height}px; position: absolute; left: calc(${leftPercent}% + 4px); right: calc(${rightPercent}% + 4px); width: auto; top: 5px; z-index: ${index + 1}; ${index < columnCount - 1 ? 'border-right: 2px solid white;' : ''}"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                    });
                } else {
                    // ê²¹ì¹˜ì§€ ì•ŠëŠ” ê²½ìš° - ì „ì²´ ë„ˆë¹„ ì‚¬ìš©
                    hourSchedules.forEach(schedule => {
                        const category = CATEGORIES[schedule.category];
                        const user = USERS[schedule.user];
                        const startHour = parseInt(schedule.startTime.split(':')[0]);
                        const endHour = parseInt(schedule.endTime.split(':')[0]);
                        const durationHours = endHour - startHour;
                        const height = durationHours * 80 - 20;
                        
                        // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        console.log(`âœ… [ì¼ë³„] ì‹œì‘ ë¸”ë¡ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                        
                        const note = schedule.note ? `<br><small style="opacity:0.7;">${schedule.note}</small>` : '';
                        const noteText = schedule.note ? schedule.note : '';
                        
                        // íˆ´íŒ HTML
                        const tooltip = `<div class="task-detail-tooltip">
                            <div class="tooltip-row"><span class="tooltip-label">ë¶„ë¥˜:</span> <span class="tooltip-value">${category.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì œëª©:</span> <span class="tooltip-value">${schedule.title}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ë‹´ë‹¹ì:</span> <span class="tooltip-value">${user.name}</span></div>
                            <div class="tooltip-row"><span class="tooltip-label">ì‹œê°„:</span> <span class="tooltip-value">${schedule.startTime} - ${schedule.endTime} (${durationHours}ì‹œê°„)</span></div>
                            ${noteText ? `<div class="tooltip-row"><span class="tooltip-label">ë¹„ê³ :</span> <span class="tooltip-value">${noteText}</span></div>` : ''}
                        </div>`;
                        
                        cellContent += `<div class="task ${category.color} ${schedule.user}" data-schedule-id="${scheduleId}" style="height: ${height}px;"><div class="task-content-wrapper">[${category.name}] ${schedule.title} - ${user.name}${note}</div>${tooltip}</div>`;
                    });
                }
                
                // ì¤‘ê°„ ì‹œê°„ëŒ€ ì¼ì • (ì‹œì‘í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì§„í–‰ ì¤‘ì¸ ì¼ì •)ì— ëŒ€í•œ í˜¸ë²„ ì˜ì—­ ì¶”ê°€
                const currentHourNum = parseInt(hour.split(':')[0]);
                const middleSchedules = schedules.filter(s => {
                    const startHourNum = parseInt(s.startTime.split(':')[0]);
                    const endHourNum = parseInt(s.endTime.split(':')[0]);
                    return s.startTime !== hour && currentHourNum >= startHourNum && currentHourNum < endHourNum;
                });
                
                if (middleSchedules.length > 0) {
                    // í˜„ì¬ ì‹œê°„ì— ì§„í–‰ ì¤‘ì¸ ëª¨ë“  ì¼ì • (ì‹œì‘ + ì¤‘ê°„)
                    const allOngoingSchedules = schedules.filter(s => {
                        const startHourNum = parseInt(s.startTime.split(':')[0]);
                        const endHourNum = parseInt(s.endTime.split(':')[0]);
                        return currentHourNum >= startHourNum && currentHourNum < endHourNum;
                    });
                    
                    middleSchedules.forEach(schedule => {
                        // ê³ ìœ  ì¼ì • ID ìƒì„± (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
                        const scheduleId = `schedule-${schedule.taskId}-${schedule.user}-${dateStr}-${schedule.startTime.replace(':', '')}`;
                        console.log(`ğŸ”´ [ì¼ë³„] í˜¸ë²„ ì˜ì—­ ìƒì„± - ID: ${scheduleId}, ë‚ ì§œ: ${dateStr}, ì‹œê°„: ${hour}`);
                        
                        // ì´ ì¼ì •ì´ ì „ì²´ ì§„í–‰ ì¤‘ì¸ ì¼ì • ì¤‘ ëª‡ ë²ˆì§¸ì¸ì§€ ì°¾ê¸°
                        const scheduleIndex = allOngoingSchedules.findIndex(s => 
                            s.taskId === schedule.taskId && s.user === schedule.user && s.startTime === schedule.startTime
                        );
                        
                        // ì»¬ëŸ¼ ìœ„ì¹˜ ê³„ì‚° (ì‹œì‘ ì‹œê°„ê³¼ ë™ì¼í•œ ìœ„ì¹˜)
                        const totalColumns = allOngoingSchedules.length;
                        const widthPercent = 100 / totalColumns;
                        const leftPercent = (100 / totalColumns) * scheduleIndex;
                        const rightPercent = 100 - leftPercent - widthPercent;
                        
                        // íˆ¬ëª…í•œ í˜¸ë²„ ì˜ì—­ - ì…€ ì „ì²´ ë†’ì´ ì°¨ì§€
                        cellContent += `<div class="task-hover-area ${schedule.user}" data-schedule-id="${scheduleId}" style="position: absolute; left: calc(${leftPercent}% + 4px); right: calc(${rightPercent}% + 4px); width: auto; top: 0; bottom: 0; z-index: 100; background: rgba(255,0,0,0.05); cursor: pointer; pointer-events: auto;"></div>`;
                    });
                }
                
                dayGrid.innerHTML += `<div class="cell time-label">${hour}</div><div class="cell" style="position: relative;">${cellContent}</div>`;
            });
            
            // í˜¸ë²„ ì´ë²¤íŠ¸ ì„¤ì •
            setupScheduleHoverEvents();
        }
        
        // ============================================
        // ğŸ“… ì›”ë³„ ë·° í—¬í¼ í•¨ìˆ˜
        // ============================================
        
        /**
         * í•œ ë‹¬ ì „ì²´ì˜ ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„ì„ ì°¾ìŠµë‹ˆë‹¤
         * @param {number} year - ì—°ë„
         * @param {number} month - ì›”
         * @returns {Array} ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„ ë°°ì—´
         */
        function findContinuousTaskRanges(year, month) {
            const ranges = [];
            const lastDate = new Date(year, month, 0).getDate();
            
            // ëª¨ë“  ë‚ ì§œì˜ ìŠ¤ì¼€ì¤„ ìˆ˜ì§‘
            const allSchedules = [];
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const daySchedules = getScheduleByDate(dateStr);
                
                daySchedules.forEach(schedule => {
                    allSchedules.push({
                        ...schedule,
                        date: date,
                        dateStr: dateStr
                    });
                });
            }
            
            // ì‚¬ëŒ-í…ŒìŠ¤í¬ë³„ë¡œ ê·¸ë£¹í™”
            const taskGroups = {};
            allSchedules.forEach(schedule => {
                const key = `${schedule.user}-${schedule.taskId}`;
                if (!taskGroups[key]) {
                    taskGroups[key] = [];
                }
                taskGroups[key].push(schedule);
            });
            
            // ê° ê·¸ë£¹ì—ì„œ ì—°ì†ëœ ë‚ ì§œ êµ¬ê°„ ì°¾ê¸°
            Object.values(taskGroups).forEach(group => {
                // ë‚ ì§œìˆœ ì •ë ¬
                group.sort((a, b) => a.date - b.date);
                
                let rangeStart = group[0];
                let rangeEnd = group[0];
                
                for (let i = 1; i < group.length; i++) {
                    if (group[i].date === rangeEnd.date + 1) {
                        // ì—°ì†ëœ ë‚ ì§œ
                        rangeEnd = group[i];
                    } else {
                        // ëŠê¹€ - í˜„ì¬ ë²”ìœ„ ì €ì¥í•˜ê³  ìƒˆë¡œ ì‹œì‘
                        ranges.push({
                            user: rangeStart.user,
                            taskId: rangeStart.taskId,
                            category: rangeStart.category,
                            title: rangeStart.title,
                            startDate: rangeStart.date,
                            endDate: rangeEnd.date,
                            startDateStr: rangeStart.dateStr,
                            endDateStr: rangeEnd.dateStr,
                            totalHours: rangeStart.totalHours
                        });
                        
                        rangeStart = group[i];
                        rangeEnd = group[i];
                    }
                }
                
                // ë§ˆì§€ë§‰ ë²”ìœ„ ì €ì¥
                ranges.push({
                    user: rangeStart.user,
                    taskId: rangeStart.taskId,
                    category: rangeStart.category,
                    title: rangeStart.title,
                    startDate: rangeStart.date,
                    endDate: rangeEnd.date,
                    startDateStr: rangeStart.dateStr,
                    endDateStr: rangeEnd.dateStr,
                    totalHours: rangeStart.totalHours
                });
            });
            
            return ranges;
        }
        
        // ============================================
        // ğŸ“… ì›”ë³„ ë·° ë™ì  ìƒì„±
        // ============================================
        
        function generateMonthView(year = 2023, month = 3) {
            const monthGrid = document.getElementById('month-view-grid');
            monthGrid.innerHTML = '';
            
            // í˜„ì¬ ìƒíƒœ ì—…ë°ì´íŠ¸
            currentYear = year;
            currentMonth = month;
            
            // í—¤ë” ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            const monthNames = ['', '1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('current-date-display').textContent = `${year}ë…„ ${monthNames[month]}`;
            
            // í—¤ë” ìƒì„±
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            let headerHTML = '';
            dayNames.forEach(day => {
                headerHTML += `<div class="cell cell-header">${day}</div>`;
            });
            monthGrid.innerHTML += headerHTML;
            
            // í•´ë‹¹ ì›”ì˜ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚  ê³„ì‚°
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            const firstDayOfWeek = firstDay.getDay(); // 0(ì¼) ~ 6(í† )
            const lastDate = lastDay.getDate();
            
            // ì´ì „ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ë“¤
            const prevLastDay = new Date(year, month - 1, 0);
            const prevLastDate = prevLastDay.getDate();
            
            let dateHTML = '';
            let cellCount = 0;
            
            // ì´ì „ ë‹¬ ë‚ ì§œë“¤
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const date = prevLastDate - i;
                const isWeekend = cellCount % 7 === 0 || cellCount % 7 === 6;
                dateHTML += `<div class="cell" style="background:#fafafa;color:#ccc;display:flex;align-items:start;padding:8px;">${date}</div>`;
                cellCount++;
            }
            
            // ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„ ì°¾ê¸°
            const taskRanges = findContinuousTaskRanges(year, month);
            console.log('ğŸ“Š ì—°ì†ëœ í…ŒìŠ¤í¬ êµ¬ê°„:', taskRanges);
            
            // í˜„ì¬ ë‹¬ ë‚ ì§œë“¤ - ê°„ë‹¨í•œ ë‚ ì§œ ì…€ë§Œ ìƒì„±
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayOfWeek = (firstDayOfWeek + date - 1) % 7;
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const weekendStyle = isWeekend ? 'background:#fafafa;' : '';
                
                const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
                const dayName = dayNames[dayOfWeek];
                
                // ê°„ë‹¨í•œ ë‚ ì§œ ì…€ (í…ŒìŠ¤í¬ ë°”ëŠ” ë‚˜ì¤‘ì— ì¶”ê°€)
                dateHTML += `<div class="cell" data-date="${dateStr}" data-cell-index="${cellCount}" onclick="goToDayView('${year}ë…„ ${month}ì›” ${date}ì¼ (${dayName})', event)" style="${weekendStyle}display:flex;flex-direction:column;align-items:start;padding:8px;position:relative;">`;
                dateHTML += `<div style="font-weight:600;">${date}</div>`;
                dateHTML += `<div class="schedule-indicator" id="schedule-${dateStr}"></div>`;
                dateHTML += `</div>`;
                cellCount++;
            }
            
            // ë‹¤ìŒ ë‹¬ ë‚ ì§œë“¤
            const remainingCells = (7 - (cellCount % 7)) % 7;
            for (let i = 1; i <= remainingCells; i++) {
                dateHTML += `<div class="cell" style="background:#fafafa;color:#ccc;display:flex;align-items:start;padding:8px;">${i}</div>`;
            }
            
            monthGrid.innerHTML += dateHTML;
            
            // ============================================
            // ì—°ì†ëœ í…ŒìŠ¤í¬ ë°” ë Œë”ë§ (DOM ë Œë”ë§ í›„)
            // ============================================
            
            // DOMì´ ë Œë”ë§ëœ í›„ í…ŒìŠ¤í¬ ë°” ì¶”ê°€
            setTimeout(() => {
                const gridElement = monthGrid;
                const firstDateCell = gridElement.querySelector('.cell[data-date]');
                if (!firstDateCell) return;
                
                // ì…€ í¬ê¸° ê³„ì‚°
                const cellWidth = firstDateCell.offsetWidth;
                const cellHeight = firstDateCell.offsetHeight;
                const gridRect = gridElement.getBoundingClientRect();
                
                console.log('ğŸ“ ì…€ í¬ê¸°:', { cellWidth, cellHeight });
                
                // ì „ì²´ í…ŒìŠ¤í¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë ˆì´ì–´ ê´€ë¦¬ (ì‚¬ìš©ì êµ¬ë¶„ ì—†ì´)
                const allTaskLayers = []; // [{ row: 0, occupiedCells: [0,1,2] }, ...]
                
                taskRanges.forEach(range => {
                const category = CATEGORIES[range.category];
                const user = USERS[range.user];
                
                if (!user || !category) return;
                
                // ì‹œì‘ ë‚ ì§œì˜ ì…€ ì¸ë±ìŠ¤ ê³„ì‚°
                const startCellIndex = firstDayOfWeek + range.startDate - 1;
                const endCellIndex = firstDayOfWeek + range.endDate - 1;
                const duration = range.endDate - range.startDate + 1;
                
                // ì£¼(row) ê³„ì‚°
                const startRow = Math.floor(startCellIndex / 7);
                const endRow = Math.floor(endCellIndex / 7);
                
                // ê°™ì€ ì£¼ ë‚´ì—ì„œë§Œ ë°”ë¥¼ ê·¸ë¦¼ (ì£¼ë¥¼ ë„˜ì–´ê°€ë©´ ì—¬ëŸ¬ ê°œë¡œ ë¶„í• )
                for (let currentRow = startRow; currentRow <= endRow; currentRow++) {
                    const rowStartIndex = currentRow * 7;
                    const rowEndIndex = rowStartIndex + 6;
                    
                    const barStartIndex = Math.max(startCellIndex, rowStartIndex);
                    const barEndIndex = Math.min(endCellIndex, rowEndIndex);
                    
                    const barStartCol = barStartIndex % 7;
                    const barEndCol = barEndIndex % 7;
                    const barSpan = barEndCol - barStartCol + 1;
                    
                    // í˜„ì¬ rowì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ y ìœ„ì¹˜ ì°¾ê¸° (ì „ì²´ ë ˆì´ì–´ ëŒ€ìƒ)
                    let layerIndex = 0;
                    let foundLayer = false;
                    
                    // ëª¨ë“  ë ˆì´ì–´ë¥¼ ìˆœíšŒí•˜ë©° ì‚¬ìš© ê°€ëŠ¥í•œ ë ˆì´ì–´ ì°¾ê¸°
                    for (let i = 0; i < allTaskLayers.length; i++) {
                        const layer = allTaskLayers[i];
                        
                        // ë‹¤ë¥¸ rowëŠ” ë¬´ì¡°ê±´ ê²¹ì¹˜ì§€ ì•ŠìŒ
                        if (layer.row !== currentRow) continue;
                        
                        // í˜„ì¬ ë ˆì´ì–´ì— ê²¹ì¹˜ëŠ” ì…€ì´ ìˆëŠ”ì§€ í™•ì¸
                        let hasConflict = false;
                        for (let cellIndex = barStartIndex; cellIndex <= barEndIndex; cellIndex++) {
                            if (layer.occupiedCells.includes(cellIndex)) {
                                hasConflict = true;
                                break;
                            }
                        }
                        
                        if (!hasConflict) {
                            // ì´ ë ˆì´ì–´ ì‚¬ìš© ê°€ëŠ¥ - ì…€ ì¸ë±ìŠ¤ ì¶”ê°€
                            layerIndex = i;
                            foundLayer = true;
                            for (let cellIndex = barStartIndex; cellIndex <= barEndIndex; cellIndex++) {
                                layer.occupiedCells.push(cellIndex);
                            }
                            break;
                        }
                    }
                    
                    if (!foundLayer) {
                        // ìƒˆ ë ˆì´ì–´ ìƒì„±
                        layerIndex = allTaskLayers.length;
                        const occupiedCells = [];
                        for (let cellIndex = barStartIndex; cellIndex <= barEndIndex; cellIndex++) {
                            occupiedCells.push(cellIndex);
                        }
                        allTaskLayers.push({
                            row: currentRow,
                            occupiedCells: occupiedCells
                        });
                    }
                    
                    // í…ŒìŠ¤í¬ ë°” HTML ìƒì„± - Gridì— ì§ì ‘ ì¶”ê°€
                    const barStartDate = Math.max(range.startDate, barStartIndex - firstDayOfWeek + 1);
                    const barEndDate = Math.min(range.endDate, barEndIndex - firstDayOfWeek + 1);
                    
                    const taskBar = document.createElement('div');
                    taskBar.className = `month-task-bar ${category.color} ${range.user}`;
                    taskBar.setAttribute('data-task-id', range.taskId); // ê°™ì€ í…ŒìŠ¤í¬ ì‹ë³„ìš©
                    
                    // í”½ì…€ ê¸°ë°˜ ìœ„ì¹˜ ê³„ì‚°
                    // í—¤ë” í–‰(45px) + í˜„ì¬ ì£¼ í–‰ê¹Œì§€ì˜ ë†’ì´
                    const topPosition = 45 + (currentRow * cellHeight) + 24 + (layerIndex * 24);
                    const leftPosition = barStartCol * cellWidth + 10;
                    const barWidth = (barSpan * cellWidth) - 20; // ì–‘ìª½ ì—¬ë°± ì¦ê°€ (ê° 10px)
                    
                    taskBar.style.top = `${topPosition}px`;
                    taskBar.style.left = `${leftPosition}px`;
                    taskBar.style.width = `${barWidth}px`;
                    
                    const daysText = barSpan > 1 ? ` (${barSpan}ì¼)` : '';
                    taskBar.textContent = `${user.name}: ${range.title}${daysText}`;
                    
                    // ì»¤ìŠ¤í…€ íˆ´íŒ ì¶”ê°€
                    const tooltip = document.createElement('div');
                    tooltip.className = 'month-task-tooltip';
                    tooltip.innerHTML = `
                        <strong>${category.name} - ${range.title}</strong>
                        <div>ğŸ‘¤ ë‹´ë‹¹: ${user.name}</div>
                        <div>ğŸ“… ê¸°ê°„: ${barStartDate}ì¼ ~ ${barEndDate}ì¼ (${barSpan}ì¼)</div>
                        <div>â±ï¸ ì´ ì‹œê°„: ${range.totalHours || 0}ì‹œê°„</div>
                    `;
                    taskBar.appendChild(tooltip);
                    
                    // í´ë¦­ ì‹œ ì£¼ë³„ ë·°ë¡œ ì´ë™
                    taskBar.addEventListener('click', (e) => {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        // í…ŒìŠ¤í¬ ì‹œì‘ ë‚ ì§œë¡œ ì£¼ë³„ ë·° ì´ë™
                        const startDate = new Date(range.startDateStr);
                        goToWeekView(startDate);
                    });
                    
                    // ê°™ì€ í…ŒìŠ¤í¬ í•˜ì´ë¼ì´íŠ¸
                    taskBar.addEventListener('mouseenter', function() {
                        // ê°™ì€ task_idë¥¼ ê°€ì§„ ëª¨ë“  í…ŒìŠ¤í¬ ë°” í•˜ì´ë¼ì´íŠ¸
                        const taskId = this.getAttribute('data-task-id');
                        console.log('ğŸ¯ í˜¸ë²„í•œ í…ŒìŠ¤í¬ ID:', taskId); // ë””ë²„ê¹…ìš©
                        
                        document.querySelectorAll('.month-task-bar').forEach(bar => {
                            const barTaskId = bar.getAttribute('data-task-id');
                            if (barTaskId === taskId) {
                                bar.classList.add('same-task-highlight');
                                console.log('âœ… í•˜ì´ë¼ì´íŠ¸ ì¶”ê°€:', barTaskId);
                            }
                        });
                    });
                    
                    taskBar.addEventListener('mouseleave', function() {
                        // ëª¨ë“  í•˜ì´ë¼ì´íŠ¸ ì œê±°
                        document.querySelectorAll('.month-task-bar').forEach(bar => {
                            bar.classList.remove('same-task-highlight');
                        });
                    });
                    
                    gridElement.appendChild(taskBar);
                    console.log(`ğŸ“ í…ŒìŠ¤í¬ ë°” ì¶”ê°€: ${range.title}, row:${currentRow}, col:${barStartCol}-${barEndCol}, top:${topPosition}, left:${leftPosition}, width:${barWidth}`);
                }
                });
                
                console.log('âœ… ì›”ë³„ ë·° í…ŒìŠ¤í¬ ë°” ë Œë”ë§ ì™„ë£Œ:', taskRanges.length);
            }, 100);  // DOM ë Œë”ë§ ëŒ€ê¸°
            
            console.log('âœ… ì›”ë³„ ë·° ìƒì„± ì™„ë£Œ');
        }
        
        // ============================================
        // ğŸ¨ ì›”ë³„ ë·° íˆ´íŒ ìë™ ìƒì„±
        // ============================================
        
        function generateTooltipsForMonthView() {
            // ì›”ë³„ ë·°ì˜ ëª¨ë“  ë‚ ì§œ ì…€ì„ ì°¾ìŒ
            document.querySelectorAll('.month-view [data-date]').forEach(dateCell => {
                const dateStr = dateCell.getAttribute('data-date');
                const scheduleSummary = getScheduleSummaryByDate(dateStr);
                
                // í•´ë‹¹ ë‚ ì§œì— ì¼ì •ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                if (Object.keys(scheduleSummary).length === 0) return;
                
                // ë‚ ì§œ ì…€ ë‚´ì˜ ëª¨ë“  .person ìš”ì†Œë¥¼ ì°¾ìŒ
                const personElements = dateCell.querySelectorAll('.person');
                
                personElements.forEach(personEl => {
                    // ì´ë¯¸ íˆ´íŒì´ ìˆìœ¼ë©´ ìŠ¤í‚µ
                    if (personEl.querySelector('.task-tooltip')) return;
                    
                    // ì‚¬ìš©ì í´ë˜ìŠ¤ ì°¾ê¸° (user-kim, user-lee ë“±)
                    const userClass = Array.from(personEl.classList).find(c => c.startsWith('user-'));
                    if (!userClass) return;
                    
                    const userSchedule = scheduleSummary[userClass];
                    if (!userSchedule) return;
                    
                    // ë‚ ì§œ í¬ë§· (MM/DD)
                    const dateObj = new Date(dateStr);
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    
                    // íˆ´íŒ HTML ìƒì„±
                    const tooltip = document.createElement('div');
                    tooltip.className = 'task-tooltip';
                    
                    let tooltipHTML = `<div class="tooltip-title">${userSchedule.userName} - ${month}/${day} ì—…ë¬´</div>`;
                    
                    userSchedule.categories.forEach(cat => {
                        cat.tasks.forEach(task => {
                            tooltipHTML += `
                                <div class="task-item">
                                    <span style="color:${cat.colorCode};">â—</span>
                                    <span>${cat.categoryName} - ${task.title}</span>
                                </div>
                            `;
                        });
                    });
                    
                    tooltip.innerHTML = tooltipHTML;
                    personEl.appendChild(tooltip);
                });
            });
        }
        
        // ============================================
        // ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“… ìº˜ë¦°ë” ì´ˆê¸°í™” ì¤‘...');
            
            // ë¡œê·¸ì¸ ì²´í¬
            const loggedInUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (!loggedInUser) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            // ì—­í• ë³„ í—¤ë” ë²„íŠ¼ ìƒì„±
            createHeaderButtons(loggedInUser.role);
            
            // 0. localStorageì—ì„œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ
            loadSchedulesFromLocalStorage();
            
            // 1. ì›”ë³„ ë·° ìƒì„± (ê¸°ë³¸: 2023ë…„ 3ì›”)
            generateMonthView(2023, 3);
            console.log('âœ… ì›”ë³„ ë·° ìƒì„± ì™„ë£Œ!');
            
            // 2. ì£¼ë³„ ë·° ìƒì„± (ê¸°ë³¸: 2/27~3/3 ì£¼)
            generateWeekView();
            console.log('âœ… ì£¼ë³„ ë·° ìƒì„± ì™„ë£Œ!');
            
            // 3. ì¼ë³„ ë·° ìƒì„± (ê¸°ë³¸: 3ì›” 1ì¼)
            generateDayView();
            console.log('âœ… ì¼ë³„ ë·° ìƒì„± ì™„ë£Œ!');
            
            // 4. ì´ˆê¸° ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ (ì›”ë³„ ë·°ê°€ ê¸°ë³¸)
            document.getElementById('prev-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'block';
            
            // 5. ì´ˆê¸° í•„í„° ì ìš© (ì›”ë³„ ë·°ì˜ í…ŒìŠ¤í¬ ë°”ë„ í¬í•¨)
            setTimeout(() => {
                syncCalendar();
                console.log('âœ… ì´ˆê¸° í•„í„° ì ìš© ì™„ë£Œ!');
            }, 200); // ì›”ë³„ ë·° í…ŒìŠ¤í¬ ë°” ìƒì„± í›„ ì ìš©
            
            console.log('ğŸ‰ ëª¨ë“  ë·° ì´ˆê¸°í™” ì™„ë£Œ!');
        });
        
        // ============================================
        // ğŸ¨ ì—­í• ë³„ í—¤ë” ë²„íŠ¼ ìƒì„±
        // ============================================
        
        function createHeaderButtons(role) {
            const headerButtons = document.getElementById('headerButtons');
            const buttons = [];
            
            // ê´€ë¦¬ì: ëª¨ë“  ë²„íŠ¼
            if (role === 'admin') {
                buttons.push('<button class="upload-btn" onclick="location.href=\'admin.html\'"><span>ğŸ”§</span> ê´€ë¦¬ì</button>');
                buttons.push('<button class="upload-btn" onclick="location.href=\'task_schedule.html\'"><span>ğŸ“‹</span> ìŠ¤ì¼€ì¤„ ë“±ë¡</button>');
                buttons.push('<input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleExcelUpload(event)">');
                buttons.push('<button class="upload-btn" onclick="document.getElementById(\'excelFileInput\').click()"><span>ğŸ“¤</span> ì—‘ì…€ ì—…ë¡œë“œ</button>');
                buttons.push('<button class="upload-btn" onclick="logout()" style="background:#ef4444;"><span>ğŸšª</span> ë¡œê·¸ì•„ì›ƒ</button>');
            }
            // íŒ€ì¥: ê´€ë¦¬ì ì œì™¸í•œ ëª¨ë“  ë²„íŠ¼
            else if (role === 'teamlead') {
                buttons.push('<button class="upload-btn" onclick="location.href=\'teamlead.html\'"><span>ğŸ‘”</span> íŒ€ì¥</button>');
                buttons.push('<button class="upload-btn" onclick="location.href=\'task_schedule.html\'"><span>ğŸ“‹</span> ìŠ¤ì¼€ì¤„ ë“±ë¡</button>');
                buttons.push('<input type="file" id="excelFileInput" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleExcelUpload(event)">');
                buttons.push('<button class="upload-btn" onclick="document.getElementById(\'excelFileInput\').click()"><span>ğŸ“¤</span> ì—‘ì…€ ì—…ë¡œë“œ</button>');
                buttons.push('<button class="upload-btn" onclick="logout()" style="background:#ef4444;"><span>ğŸšª</span> ë¡œê·¸ì•„ì›ƒ</button>');
            }
            // íŒ€ì›: ìŠ¤ì¼€ì¤„ ë“±ë¡ê³¼ ìº˜ë¦°ë”ë§Œ
            else {
                buttons.push('<button class="upload-btn" onclick="location.href=\'task_schedule.html\'"><span>ğŸ“‹</span> ë‚´ í• ë‹¹ ì—…ë¬´</button>');
                buttons.push('<button class="upload-btn" onclick="logout()" style="background:#ef4444;"><span>ğŸšª</span> ë¡œê·¸ì•„ì›ƒ</button>');
            }
            
            headerButtons.innerHTML = buttons.join('');
        }
        
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                sessionStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }
        
        // ============================================
        // ğŸ’¾ localStorageì—ì„œ ìŠ¤ì¼€ì¤„ ë°ì´í„° ë¡œë“œ
        // ============================================
        
        function loadSchedulesFromLocalStorage() {
            const saved = localStorage.getItem('projectSchedules');
            if (!saved) return;
            
            try {
                const data = JSON.parse(saved);
                const schedules = data.schedules || [];
                
                console.log('ğŸ“¥ ì €ì¥ëœ ìŠ¤ì¼€ì¤„ ë¡œë“œ:', schedules);
                
                // ì‚¬ìš©ì ë§¤í•‘
                const userMapping = {
                    'ì´ê²½ìˆ˜': 'user-kim',
                    'ë¬¸ì •ì„': 'user-lee',
                    'ê¹€íƒœí˜•': 'user-park',
                    'ì„œì¬ì›': 'user-haha',
                    'ì „ìƒë¯¼': 'user-kim',
                    'ê¹€ë„ì—°': 'user-lee'
                };
                
                // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
                const categoryMapping = {
                    'í–‰ì‚¬ìš´ì˜': 'planning',
                    'ê²½ì˜ê¸°íš': 'planning',
                    'ì¬ë¬´ê´€ë¦¬': 'development',
                    'ë””ìì¸': 'design',
                    'êµìœ¡ìš´ì˜': 'planning'
                };
                
                schedules.forEach(schedule => {
                    const task = schedule.task;
                    const userId = userMapping[schedule.user] || 'user-kim';
                    const category = categoryMapping[task.ëŒ€ë¶„ë¥˜] || 'planning';
                    
                    // TASKSì— ì¶”ê°€ (ì¤‘ë³µ ì²´í¬)
                    if (!TASKS[schedule.taskId]) {
                        TASKS[schedule.taskId] = {
                            taskId: schedule.taskId,
                            title: `${task.ì¤‘ë¶„ë¥˜} - ${task.ì†Œë¶„ë¥˜}`,
                            category: category,
                            totalHours: task.í• ë‹¹ì‹œê°„
                        };
                    }
                    
                    // TASK_ASSIGNMENTSì— ì¶”ê°€
                    TASK_ASSIGNMENTS.push({
                        taskId: schedule.taskId,
                        user: userId,
                        startDate: schedule.startDate,
                        endDate: schedule.endDate,
                        startTime: schedule.startTime,
                        endTime: schedule.endTime,
                        note: task.ë¹„ê³  || ''
                    });
                });
                
                console.log('âœ… ìŠ¤ì¼€ì¤„ ë¡œë“œ ì™„ë£Œ - TASKS:', TASKS);
                console.log('âœ… ìŠ¤ì¼€ì¤„ ë¡œë“œ ì™„ë£Œ - TASK_ASSIGNMENTS:', TASK_ASSIGNMENTS);
                
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ============================================
        // ğŸ“¤ ì—‘ì…€ ì—…ë¡œë“œ ë° ë°ì´í„° ì²˜ë¦¬
        // ============================================
        
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    processExcelData(jsonData);
                } catch (error) {
                    console.error('ì—‘ì…€ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
                    alert('ì—‘ì…€ íŒŒì¼ ì½ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function processExcelData(data) {
            console.log('ğŸ“Š ì—‘ì…€ ë°ì´í„°:', data);
            
            // ê¸°ì¡´ ë°ì´í„° ì´ˆê¸°í™”
            TASK_ASSIGNMENTS.length = 0;
            Object.keys(TASKS).forEach(key => delete TASKS[key]);
            
            let taskCounter = 1;
            const categoryMapping = {
                'ê¸°íš': 'planning',
                'ê°œë°œ': 'development',
                'ë””ìì¸': 'design',
                'ì´¬ì˜': 'design',
                'ì—ì…‹': 'development',
                'êµìœ¡': 'planning'
            };
            
            // ì‚¬ìš©ì ë§¤í•‘ (ì‹¤ì œë¡œëŠ” ì—‘ì…€ì—ì„œ ë‹´ë‹¹ì ì •ë³´ë¥¼ ì½ì–´ì™€ì•¼ í•¨)
            const userMapping = {
                'ê¹€ì² ìˆ˜': 'user-kim',
                'ì´ì˜í¬': 'user-lee',
                'ë°•ëª…ìˆ˜': 'user-park',
                'í•˜í•˜': 'user-haha'
            };
            
            data.forEach((row, index) => {
                const taskId = `task-${String(taskCounter).padStart(3, '0')}`;
                
                // ì†Œë¶„ë¥˜ì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ë¡ 
                const category3 = row['ì†Œë¶„ë¥˜'] || row['category3'] || '';
                let category = 'planning';
                for (const [key, value] of Object.entries(categoryMapping)) {
                    if (category3.includes(key)) {
                        category = value;
                        break;
                    }
                }
                
                // í…ŒìŠ¤í¬ ì •ì˜ ìƒì„±
                TASKS[taskId] = {
                    taskId: taskId,
                    title: row['ì¤‘ë¶„ë¥˜'] || row['category2'] || `í…ŒìŠ¤í¬ ${taskCounter}`,
                    category: category,
                    totalHours: parseInt(row['ê¸°ì¤€ì‹œê°„'] || row['standardHours']) || 8
                };
                
                // ì„ì‹œ í• ë‹¹ ìƒì„± (ì‹¤ì œë¡œëŠ” ì—‘ì…€ì—ì„œ ë‹´ë‹¹ì, ë‚ ì§œ ì •ë³´ë¥¼ ì½ì–´ì™€ì•¼ í•¨)
                const userName = row['ë‹´ë‹¹ì'] || Object.keys(userMapping)[index % 4];
                const userId = userMapping[userName] || 'user-kim';
                const hours = TASKS[taskId].totalHours;
                
                // 3ì›” ì²«ì§¸ ì£¼ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë°°ì¹˜
                const startDay = 1 + Math.floor(taskCounter / 2);
                const endDay = Math.min(startDay + Math.ceil(hours / 8) - 1, 31);
                
                TASK_ASSIGNMENTS.push({
                    taskId: taskId,
                    user: userId,
                    startDate: `2023-03-${String(startDay).padStart(2, '0')}`,
                    endDate: `2023-03-${String(endDay).padStart(2, '0')}`,
                    startTime: '09:00',
                    endTime: hours <= 8 ? `${9 + hours}:00` : '18:00',
                    note: row['ë¹„ê³ '] || row['note'] || ''
                });
                
                taskCounter++;
            });
            
            console.log('âœ… ì²˜ë¦¬ëœ í…ŒìŠ¤í¬:', TASKS);
            console.log('âœ… ì²˜ë¦¬ëœ í• ë‹¹:', TASK_ASSIGNMENTS);
            
            // ëª¨ë“  ë·° ì¬ìƒì„±
            generateMonthView(2023, 3);
            generateWeekView();
            generateDayView();
            syncCalendar();
            
            alert(`${data.length}ê°œì˜ í…ŒìŠ¤í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }
    </script>
</body>
</html>